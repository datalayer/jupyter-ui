{"version":3,"file":"comlink.worker-BoJfbDln.js","sources":["../../../node_modules/comlink/dist/esm/comlink.mjs","../../react/lib/jupyter/lite/contents/emscripten.js","../../react/lib/jupyter/lite/contents/drivefs.js","../../react/lib/jupyter/lite/pyodide-kernel/worker.js","../../react/lib/jupyter/lite/pyodide-kernel/comlink.worker.js"],"sourcesContent":["/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\nconst proxyMarker = Symbol(\"Comlink.proxy\");\nconst createEndpoint = Symbol(\"Comlink.endpoint\");\nconst releaseProxy = Symbol(\"Comlink.releaseProxy\");\nconst finalizer = Symbol(\"Comlink.finalizer\");\nconst throwMarker = Symbol(\"Comlink.thrown\");\nconst isObject = (val) => (typeof val === \"object\" && val !== null) || typeof val === \"function\";\n/**\n * Internal transfer handle to handle objects marked to proxy.\n */\nconst proxyTransferHandler = {\n    canHandle: (val) => isObject(val) && val[proxyMarker],\n    serialize(obj) {\n        const { port1, port2 } = new MessageChannel();\n        expose(obj, port1);\n        return [port2, [port2]];\n    },\n    deserialize(port) {\n        port.start();\n        return wrap(port);\n    },\n};\n/**\n * Internal transfer handler to handle thrown exceptions.\n */\nconst throwTransferHandler = {\n    canHandle: (value) => isObject(value) && throwMarker in value,\n    serialize({ value }) {\n        let serialized;\n        if (value instanceof Error) {\n            serialized = {\n                isError: true,\n                value: {\n                    message: value.message,\n                    name: value.name,\n                    stack: value.stack,\n                },\n            };\n        }\n        else {\n            serialized = { isError: false, value };\n        }\n        return [serialized, []];\n    },\n    deserialize(serialized) {\n        if (serialized.isError) {\n            throw Object.assign(new Error(serialized.value.message), serialized.value);\n        }\n        throw serialized.value;\n    },\n};\n/**\n * Allows customizing the serialization of certain values.\n */\nconst transferHandlers = new Map([\n    [\"proxy\", proxyTransferHandler],\n    [\"throw\", throwTransferHandler],\n]);\nfunction isAllowedOrigin(allowedOrigins, origin) {\n    for (const allowedOrigin of allowedOrigins) {\n        if (origin === allowedOrigin || allowedOrigin === \"*\") {\n            return true;\n        }\n        if (allowedOrigin instanceof RegExp && allowedOrigin.test(origin)) {\n            return true;\n        }\n    }\n    return false;\n}\nfunction expose(obj, ep = globalThis, allowedOrigins = [\"*\"]) {\n    ep.addEventListener(\"message\", function callback(ev) {\n        if (!ev || !ev.data) {\n            return;\n        }\n        if (!isAllowedOrigin(allowedOrigins, ev.origin)) {\n            console.warn(`Invalid origin '${ev.origin}' for comlink proxy`);\n            return;\n        }\n        const { id, type, path } = Object.assign({ path: [] }, ev.data);\n        const argumentList = (ev.data.argumentList || []).map(fromWireValue);\n        let returnValue;\n        try {\n            const parent = path.slice(0, -1).reduce((obj, prop) => obj[prop], obj);\n            const rawValue = path.reduce((obj, prop) => obj[prop], obj);\n            switch (type) {\n                case \"GET\" /* MessageType.GET */:\n                    {\n                        returnValue = rawValue;\n                    }\n                    break;\n                case \"SET\" /* MessageType.SET */:\n                    {\n                        parent[path.slice(-1)[0]] = fromWireValue(ev.data.value);\n                        returnValue = true;\n                    }\n                    break;\n                case \"APPLY\" /* MessageType.APPLY */:\n                    {\n                        returnValue = rawValue.apply(parent, argumentList);\n                    }\n                    break;\n                case \"CONSTRUCT\" /* MessageType.CONSTRUCT */:\n                    {\n                        const value = new rawValue(...argumentList);\n                        returnValue = proxy(value);\n                    }\n                    break;\n                case \"ENDPOINT\" /* MessageType.ENDPOINT */:\n                    {\n                        const { port1, port2 } = new MessageChannel();\n                        expose(obj, port2);\n                        returnValue = transfer(port1, [port1]);\n                    }\n                    break;\n                case \"RELEASE\" /* MessageType.RELEASE */:\n                    {\n                        returnValue = undefined;\n                    }\n                    break;\n                default:\n                    return;\n            }\n        }\n        catch (value) {\n            returnValue = { value, [throwMarker]: 0 };\n        }\n        Promise.resolve(returnValue)\n            .catch((value) => {\n            return { value, [throwMarker]: 0 };\n        })\n            .then((returnValue) => {\n            const [wireValue, transferables] = toWireValue(returnValue);\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n            if (type === \"RELEASE\" /* MessageType.RELEASE */) {\n                // detach and deactive after sending release response above.\n                ep.removeEventListener(\"message\", callback);\n                closeEndPoint(ep);\n                if (finalizer in obj && typeof obj[finalizer] === \"function\") {\n                    obj[finalizer]();\n                }\n            }\n        })\n            .catch((error) => {\n            // Send Serialization Error To Caller\n            const [wireValue, transferables] = toWireValue({\n                value: new TypeError(\"Unserializable return value\"),\n                [throwMarker]: 0,\n            });\n            ep.postMessage(Object.assign(Object.assign({}, wireValue), { id }), transferables);\n        });\n    });\n    if (ep.start) {\n        ep.start();\n    }\n}\nfunction isMessagePort(endpoint) {\n    return endpoint.constructor.name === \"MessagePort\";\n}\nfunction closeEndPoint(endpoint) {\n    if (isMessagePort(endpoint))\n        endpoint.close();\n}\nfunction wrap(ep, target) {\n    const pendingListeners = new Map();\n    ep.addEventListener(\"message\", function handleMessage(ev) {\n        const { data } = ev;\n        if (!data || !data.id) {\n            return;\n        }\n        const resolver = pendingListeners.get(data.id);\n        if (!resolver) {\n            return;\n        }\n        try {\n            resolver(data);\n        }\n        finally {\n            pendingListeners.delete(data.id);\n        }\n    });\n    return createProxy(ep, pendingListeners, [], target);\n}\nfunction throwIfProxyReleased(isReleased) {\n    if (isReleased) {\n        throw new Error(\"Proxy has been released and is not useable\");\n    }\n}\nfunction releaseEndpoint(ep) {\n    return requestResponseMessage(ep, new Map(), {\n        type: \"RELEASE\" /* MessageType.RELEASE */,\n    }).then(() => {\n        closeEndPoint(ep);\n    });\n}\nconst proxyCounter = new WeakMap();\nconst proxyFinalizers = \"FinalizationRegistry\" in globalThis &&\n    new FinalizationRegistry((ep) => {\n        const newCount = (proxyCounter.get(ep) || 0) - 1;\n        proxyCounter.set(ep, newCount);\n        if (newCount === 0) {\n            releaseEndpoint(ep);\n        }\n    });\nfunction registerProxy(proxy, ep) {\n    const newCount = (proxyCounter.get(ep) || 0) + 1;\n    proxyCounter.set(ep, newCount);\n    if (proxyFinalizers) {\n        proxyFinalizers.register(proxy, ep, proxy);\n    }\n}\nfunction unregisterProxy(proxy) {\n    if (proxyFinalizers) {\n        proxyFinalizers.unregister(proxy);\n    }\n}\nfunction createProxy(ep, pendingListeners, path = [], target = function () { }) {\n    let isProxyReleased = false;\n    const proxy = new Proxy(target, {\n        get(_target, prop) {\n            throwIfProxyReleased(isProxyReleased);\n            if (prop === releaseProxy) {\n                return () => {\n                    unregisterProxy(proxy);\n                    releaseEndpoint(ep);\n                    pendingListeners.clear();\n                    isProxyReleased = true;\n                };\n            }\n            if (prop === \"then\") {\n                if (path.length === 0) {\n                    return { then: () => proxy };\n                }\n                const r = requestResponseMessage(ep, pendingListeners, {\n                    type: \"GET\" /* MessageType.GET */,\n                    path: path.map((p) => p.toString()),\n                }).then(fromWireValue);\n                return r.then.bind(r);\n            }\n            return createProxy(ep, pendingListeners, [...path, prop]);\n        },\n        set(_target, prop, rawValue) {\n            throwIfProxyReleased(isProxyReleased);\n            // FIXME: ES6 Proxy Handler `set` methods are supposed to return a\n            // boolean. To show good will, we return true asynchronously ¯\\_(ツ)_/¯\n            const [value, transferables] = toWireValue(rawValue);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"SET\" /* MessageType.SET */,\n                path: [...path, prop].map((p) => p.toString()),\n                value,\n            }, transferables).then(fromWireValue);\n        },\n        apply(_target, _thisArg, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const last = path[path.length - 1];\n            if (last === createEndpoint) {\n                return requestResponseMessage(ep, pendingListeners, {\n                    type: \"ENDPOINT\" /* MessageType.ENDPOINT */,\n                }).then(fromWireValue);\n            }\n            // We just pretend that `bind()` didn’t happen.\n            if (last === \"bind\") {\n                return createProxy(ep, pendingListeners, path.slice(0, -1));\n            }\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"APPLY\" /* MessageType.APPLY */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n        construct(_target, rawArgumentList) {\n            throwIfProxyReleased(isProxyReleased);\n            const [argumentList, transferables] = processArguments(rawArgumentList);\n            return requestResponseMessage(ep, pendingListeners, {\n                type: \"CONSTRUCT\" /* MessageType.CONSTRUCT */,\n                path: path.map((p) => p.toString()),\n                argumentList,\n            }, transferables).then(fromWireValue);\n        },\n    });\n    registerProxy(proxy, ep);\n    return proxy;\n}\nfunction myFlat(arr) {\n    return Array.prototype.concat.apply([], arr);\n}\nfunction processArguments(argumentList) {\n    const processed = argumentList.map(toWireValue);\n    return [processed.map((v) => v[0]), myFlat(processed.map((v) => v[1]))];\n}\nconst transferCache = new WeakMap();\nfunction transfer(obj, transfers) {\n    transferCache.set(obj, transfers);\n    return obj;\n}\nfunction proxy(obj) {\n    return Object.assign(obj, { [proxyMarker]: true });\n}\nfunction windowEndpoint(w, context = globalThis, targetOrigin = \"*\") {\n    return {\n        postMessage: (msg, transferables) => w.postMessage(msg, targetOrigin, transferables),\n        addEventListener: context.addEventListener.bind(context),\n        removeEventListener: context.removeEventListener.bind(context),\n    };\n}\nfunction toWireValue(value) {\n    for (const [name, handler] of transferHandlers) {\n        if (handler.canHandle(value)) {\n            const [serializedValue, transferables] = handler.serialize(value);\n            return [\n                {\n                    type: \"HANDLER\" /* WireValueType.HANDLER */,\n                    name,\n                    value: serializedValue,\n                },\n                transferables,\n            ];\n        }\n    }\n    return [\n        {\n            type: \"RAW\" /* WireValueType.RAW */,\n            value,\n        },\n        transferCache.get(value) || [],\n    ];\n}\nfunction fromWireValue(value) {\n    switch (value.type) {\n        case \"HANDLER\" /* WireValueType.HANDLER */:\n            return transferHandlers.get(value.name).deserialize(value.value);\n        case \"RAW\" /* WireValueType.RAW */:\n            return value.value;\n    }\n}\nfunction requestResponseMessage(ep, pendingListeners, msg, transfers) {\n    return new Promise((resolve) => {\n        const id = generateUUID();\n        pendingListeners.set(id, resolve);\n        if (ep.start) {\n            ep.start();\n        }\n        ep.postMessage(Object.assign({ id }, msg), transfers);\n    });\n}\nfunction generateUUID() {\n    return new Array(4)\n        .fill(0)\n        .map(() => Math.floor(Math.random() * Number.MAX_SAFE_INTEGER).toString(16))\n        .join(\"-\");\n}\n\nexport { createEndpoint, expose, finalizer, proxy, proxyMarker, releaseProxy, transfer, transferHandlers, windowEndpoint, wrap };\n//# sourceMappingURL=comlink.mjs.map\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n/// <reference types=\"emscripten\" />\nexport const DIR_MODE = 16895; // 040777\nexport const FILE_MODE = 33206; // 100666\nexport const SEEK_CUR = 1;\nexport const SEEK_END = 2;\nexport function instanceOfStream(nodeOrStream) {\n    return 'node' in nodeOrStream;\n}\n//# sourceMappingURL=emscripten.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { DIR_MODE, SEEK_CUR, SEEK_END, instanceOfStream, } from './emscripten';\nexport const DRIVE_SEPARATOR = ':';\nexport const DRIVE_API_PATH = '/api/drive.v1';\nexport const BLOCK_SIZE = 4096;\nconst encoder = new TextEncoder();\nconst decoder = new TextDecoder('utf-8');\n// Mapping flag -> do we need to overwrite the file upon closing it\nconst flagNeedsWrite = {\n    0 /*O_RDONLY*/: false,\n    1 /*O_WRONLY*/: true,\n    2 /*O_RDWR*/: true,\n    64 /*O_CREAT*/: true,\n    65 /*O_WRONLY|O_CREAT*/: true,\n    66 /*O_RDWR|O_CREAT*/: true,\n    129 /*O_WRONLY|O_EXCL*/: true,\n    193 /*O_WRONLY|O_CREAT|O_EXCL*/: true,\n    514 /*O_RDWR|O_TRUNC*/: true,\n    577 /*O_WRONLY|O_CREAT|O_TRUNC*/: true,\n    578 /*O_CREAT|O_RDWR|O_TRUNC*/: true,\n    705 /*O_WRONLY|O_CREAT|O_EXCL|O_TRUNC*/: true,\n    706 /*O_RDWR|O_CREAT|O_EXCL|O_TRUNC*/: true,\n    1024 /*O_APPEND*/: true,\n    1025 /*O_WRONLY|O_APPEND*/: true,\n    1026 /*O_RDWR|O_APPEND*/: true,\n    1089 /*O_WRONLY|O_CREAT|O_APPEND*/: true,\n    1090 /*O_RDWR|O_CREAT|O_APPEND*/: true,\n    1153 /*O_WRONLY|O_EXCL|O_APPEND*/: true,\n    1154 /*O_RDWR|O_EXCL|O_APPEND*/: true,\n    1217 /*O_WRONLY|O_CREAT|O_EXCL|O_APPEND*/: true,\n    1218 /*O_RDWR|O_CREAT|O_EXCL|O_APPEND*/: true,\n    4096 /*O_RDONLY|O_DSYNC*/: true,\n    4098 /*O_RDWR|O_DSYNC*/: true,\n};\nexport class DriveFSEmscriptenStreamOps {\n    fs;\n    constructor(fs) {\n        this.fs = fs;\n    }\n    open(stream) {\n        const path = this.fs.realPath(stream.node);\n        if (this.fs.FS.isFile(stream.node.mode)) {\n            stream.file = this.fs.API.get(path);\n        }\n    }\n    close(stream) {\n        if (!this.fs.FS.isFile(stream.node.mode) || !stream.file) {\n            return;\n        }\n        const path = this.fs.realPath(stream.node);\n        const flags = stream.flags;\n        let parsedFlags = typeof flags === 'string' ? parseInt(flags, 10) : flags;\n        parsedFlags &= 0x1fff;\n        let needsWrite = true;\n        if (parsedFlags in flagNeedsWrite) {\n            needsWrite = flagNeedsWrite[parsedFlags];\n        }\n        if (needsWrite) {\n            this.fs.API.put(path, stream.file);\n        }\n        stream.file = undefined;\n    }\n    read(stream, buffer, offset, length, position) {\n        if (length <= 0 ||\n            stream.file === undefined ||\n            position >= (stream.file.data.length || 0)) {\n            return 0;\n        }\n        const size = Math.min(stream.file.data.length - position, length);\n        buffer.set(stream.file.data.subarray(position, position + size), offset);\n        return size;\n    }\n    write(stream, buffer, offset, length, position) {\n        if (length <= 0 || stream.file === undefined) {\n            return 0;\n        }\n        stream.node.timestamp = Date.now();\n        if (position + length > (stream.file?.data.length || 0)) {\n            const oldData = stream.file.data ? stream.file.data : new Uint8Array();\n            stream.file.data = new Uint8Array(position + length);\n            stream.file.data.set(oldData);\n        }\n        stream.file.data.set(buffer.subarray(offset, offset + length), position);\n        return length;\n    }\n    llseek(stream, offset, whence) {\n        let position = offset;\n        if (whence === SEEK_CUR) {\n            position += stream.position;\n        }\n        else if (whence === SEEK_END) {\n            if (this.fs.FS.isFile(stream.node.mode)) {\n                if (stream.file !== undefined) {\n                    position += stream.file.data.length;\n                }\n                else {\n                    throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EPERM);\n                }\n            }\n        }\n        if (position < 0) {\n            throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES.EINVAL);\n        }\n        return position;\n    }\n}\nexport class DriveFSEmscriptenNodeOps {\n    fs;\n    constructor(fs) {\n        this.fs = fs;\n    }\n    node(nodeOrStream) {\n        if (instanceOfStream(nodeOrStream)) {\n            return nodeOrStream.node;\n        }\n        return nodeOrStream;\n    }\n    getattr(value) {\n        const node = this.node(value);\n        return {\n            ...this.fs.API.getattr(this.fs.realPath(node)),\n            mode: node.mode,\n            ino: node.id,\n        };\n    }\n    setattr(value, attr) {\n        const node = this.node(value);\n        for (const [key, value] of Object.entries(attr)) {\n            switch (key) {\n                case 'mode':\n                    node.mode = value;\n                    break;\n                case 'timestamp':\n                    node.timestamp = value;\n                    break;\n                case 'size': {\n                    const size = value;\n                    const path = this.fs.realPath(node);\n                    if (this.fs.FS.isFile(node.mode) && size >= 0) {\n                        const file = this.fs.API.get(path);\n                        const oldData = file.data ? file.data : new Uint8Array();\n                        if (size !== oldData.length) {\n                            if (size < oldData.length) {\n                                file.data = file.data.slice(0, size);\n                            }\n                            else {\n                                file.data = new Uint8Array(size);\n                                file.data.set(oldData);\n                            }\n                            this.fs.API.put(path, file);\n                        }\n                    }\n                    else {\n                        console.warn('setattr size of', size, 'on', node, 'not yet implemented');\n                    }\n                    break;\n                }\n                default:\n                    console.warn('setattr', key, 'of', value, 'on', node, 'not yet implemented');\n                    break;\n            }\n        }\n    }\n    lookup(parent, name) {\n        const node = this.node(parent);\n        const path = this.fs.PATH.join2(this.fs.realPath(node), name);\n        const result = this.fs.API.lookup(path);\n        if (!result.ok) {\n            throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES['ENOENT']);\n        }\n        return this.fs.createNode(node, name, result.mode, 0);\n    }\n    mknod(parent, name, mode, dev) {\n        const node = this.node(parent);\n        const path = this.fs.PATH.join2(this.fs.realPath(node), name);\n        this.fs.API.mknod(path, mode);\n        return this.fs.createNode(node, name, mode, dev);\n    }\n    rename(value, newDir, newName) {\n        const oldNode = this.node(value);\n        const newDirNode = this.node(newDir);\n        this.fs.API.rename(oldNode.parent\n            ? this.fs.PATH.join2(this.fs.realPath(oldNode.parent), oldNode.name)\n            : oldNode.name, this.fs.PATH.join2(this.fs.realPath(newDirNode), newName));\n        // Updating the in-memory node\n        oldNode.name = newName;\n        oldNode.parent = newDirNode;\n    }\n    unlink(parent, name) {\n        this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(parent)), name));\n    }\n    rmdir(parent, name) {\n        this.fs.API.rmdir(this.fs.PATH.join2(this.fs.realPath(this.node(parent)), name));\n    }\n    readdir(value) {\n        return this.fs.API.readdir(this.fs.realPath(this.node(value)));\n    }\n    symlink(parent, newName, oldPath) {\n        throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES['EPERM']);\n    }\n    readlink(node) {\n        throw new this.fs.FS.ErrnoError(this.fs.ERRNO_CODES['EPERM']);\n    }\n}\n/**\n * ContentsAPI base class\n */\nexport class ContentsAPI {\n    constructor(driveName, mountpoint, FS, ERRNO_CODES) {\n        this._driveName = driveName;\n        this._mountpoint = mountpoint;\n        this.FS = FS;\n        this.ERRNO_CODES = ERRNO_CODES;\n    }\n    lookup(path) {\n        return this.request({ method: 'lookup', path: this.normalizePath(path) });\n    }\n    getmode(path) {\n        return this.request({ method: 'getmode', path: this.normalizePath(path) });\n    }\n    mknod(path, mode) {\n        return this.request({\n            method: 'mknod',\n            path: this.normalizePath(path),\n            data: { mode },\n        });\n    }\n    rename(oldPath, newPath) {\n        return this.request({\n            method: 'rename',\n            path: this.normalizePath(oldPath),\n            data: { newPath: this.normalizePath(newPath) },\n        });\n    }\n    readdir(path) {\n        const dirlist = this.request({\n            method: 'readdir',\n            path: this.normalizePath(path),\n        });\n        dirlist.push('.');\n        dirlist.push('..');\n        return dirlist;\n    }\n    rmdir(path) {\n        return this.request({ method: 'rmdir', path: this.normalizePath(path) });\n    }\n    get(path) {\n        const response = this.request({\n            method: 'get',\n            path: this.normalizePath(path),\n        });\n        if (!response) {\n            throw new this.FS.ErrnoError(this.ERRNO_CODES['ENOENT']);\n        }\n        const serializedContent = response.content;\n        const format = response.format;\n        switch (format) {\n            case 'json':\n            case 'text':\n                return {\n                    data: encoder.encode(serializedContent),\n                    format,\n                };\n            case 'base64': {\n                const binString = atob(serializedContent);\n                const len = binString.length;\n                const data = new Uint8Array(len);\n                for (let i = 0; i < len; i++) {\n                    data[i] = binString.charCodeAt(i);\n                }\n                return {\n                    data,\n                    format,\n                };\n            }\n            default:\n                throw new this.FS.ErrnoError(this.ERRNO_CODES['ENOENT']);\n        }\n    }\n    put(path, value) {\n        switch (value.format) {\n            case 'json':\n            case 'text':\n                return this.request({\n                    method: 'put',\n                    path: this.normalizePath(path),\n                    data: {\n                        format: value.format,\n                        data: decoder.decode(value.data),\n                    },\n                });\n            case 'base64': {\n                let binary = '';\n                for (let i = 0; i < value.data.byteLength; i++) {\n                    binary += String.fromCharCode(value.data[i]);\n                }\n                return this.request({\n                    method: 'put',\n                    path: this.normalizePath(path),\n                    data: {\n                        format: value.format,\n                        data: btoa(binary),\n                    },\n                });\n            }\n        }\n    }\n    getattr(path) {\n        const stats = this.request({\n            method: 'getattr',\n            path: this.normalizePath(path),\n        });\n        // Turn datetimes into proper objects\n        if (stats.atime) {\n            stats.atime = new Date(stats.atime);\n        }\n        if (stats.mtime) {\n            stats.mtime = new Date(stats.mtime);\n        }\n        if (stats.ctime) {\n            stats.ctime = new Date(stats.ctime);\n        }\n        // ensure a non-undefined size (0 isn't great, though)\n        stats.size = stats.size || 0;\n        return stats;\n    }\n    /**\n     * Normalize a Path by making it compliant for the content manager\n     *\n     * @param path: the path relatively to the Emscripten drive\n     */\n    normalizePath(path) {\n        // Remove mountpoint prefix\n        if (path.startsWith(this._mountpoint)) {\n            path = path.slice(this._mountpoint.length);\n        }\n        // Add JupyterLab drive name\n        if (this._driveName) {\n            path = `${this._driveName}${DRIVE_SEPARATOR}${path}`;\n        }\n        return path;\n    }\n    _driveName;\n    _mountpoint;\n    FS;\n    ERRNO_CODES;\n}\n/**\n * An Emscripten-compatible synchronous Contents API using the service worker.\n */\nexport class ServiceWorkerContentsAPI extends ContentsAPI {\n    constructor(baseUrl, driveName, mountpoint, FS, ERRNO_CODES) {\n        super(driveName, mountpoint, FS, ERRNO_CODES);\n        this._baseUrl = baseUrl;\n    }\n    request(data) {\n        const xhr = new XMLHttpRequest();\n        xhr.open('POST', encodeURI(this.endpoint), false);\n        try {\n            xhr.send(JSON.stringify(data));\n        }\n        catch (e) {\n            console.error(e);\n        }\n        if (xhr.status >= 400) {\n            throw new this.FS.ErrnoError(this.ERRNO_CODES['EINVAL']);\n        }\n        return JSON.parse(xhr.responseText);\n    }\n    /**\n     * Get the api/drive endpoint\n     */\n    get endpoint() {\n        return `${this._baseUrl}api/drive`;\n    }\n    _baseUrl;\n}\nexport class DriveFS {\n    FS;\n    API;\n    PATH;\n    ERRNO_CODES;\n    driveName;\n    constructor(options) {\n        this.FS = options.FS;\n        this.PATH = options.PATH;\n        this.ERRNO_CODES = options.ERRNO_CODES;\n        this.API = this.createAPI(options);\n        this.driveName = options.driveName;\n        this.node_ops = new DriveFSEmscriptenNodeOps(this);\n        this.stream_ops = new DriveFSEmscriptenStreamOps(this);\n    }\n    node_ops;\n    stream_ops;\n    /**\n     * Create the ContentsAPI.\n     *\n     * This is supposed to be overwritten if needed.\n     */\n    createAPI(options) {\n        return new ServiceWorkerContentsAPI(options.baseUrl, options.driveName, options.mountpoint, options.FS, options.ERRNO_CODES);\n    }\n    mount(mount) {\n        return this.createNode(null, mount.mountpoint, DIR_MODE | 511, 0);\n    }\n    createNode(parent, name, mode, dev) {\n        const FS = this.FS;\n        if (!FS.isDir(mode) && !FS.isFile(mode)) {\n            throw new FS.ErrnoError(this.ERRNO_CODES['EINVAL']);\n        }\n        const node = FS.createNode(parent, name, mode, dev);\n        node.node_ops = this.node_ops;\n        node.stream_ops = this.stream_ops;\n        return node;\n    }\n    getMode(path) {\n        return this.API.getmode(path);\n    }\n    realPath(node) {\n        const parts = [];\n        let currentNode = node;\n        parts.push(currentNode.name);\n        while (currentNode.parent !== currentNode) {\n            currentNode = currentNode.parent;\n            parts.push(currentNode.name);\n        }\n        parts.reverse();\n        return this.PATH.join.apply(null, parts);\n    }\n}\n//# sourceMappingURL=drivefs.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nexport class PyodideRemoteKernel {\n    constructor() {\n        this._initialized = new Promise((resolve, reject) => {\n            this._initializer = { resolve, reject };\n        });\n    }\n    /**\n     * Accept the URLs from the host\n     **/\n    async initialize(options) {\n        this._options = options;\n        if (options.location.includes(':')) {\n            const parts = options.location.split(':');\n            this._driveName = parts[0];\n            this._localPath = parts[1];\n        }\n        else {\n            this._driveName = '';\n            this._localPath = options.location;\n        }\n        await this.initRuntime(options);\n        await this.initFilesystem(options);\n        await this.initPackageManager(options);\n        await this.initKernel(options);\n        await this.initGlobals(options);\n        this._initializer?.resolve();\n    }\n    async initRuntime(options) {\n        const { pyodideUrl, indexUrl } = options;\n        let loadPyodide;\n        // Always use dynamic import for module workers\n        // In module workers, importScripts exists but throws when called\n        // Dynamic import works for both .mjs and .js files in module workers\n        const pyodideModule = await import(\n        /* webpackIgnore: true */ /* @vite-ignore */ pyodideUrl);\n        // Pyodide may export loadPyodide directly, or set it on self (for non-ESM builds)\n        loadPyodide = pyodideModule.loadPyodide || self.loadPyodide;\n        if (typeof loadPyodide !== 'function') {\n            throw new Error(`Failed to load pyodide from ${pyodideUrl}. loadPyodide is not a function.`);\n        }\n        this._pyodide = await loadPyodide({\n            indexURL: indexUrl,\n            ...options.loadPyodideOptions,\n        });\n    }\n    async initPackageManager(options) {\n        if (!this._options) {\n            throw new Error('Uninitialized');\n        }\n        const { pipliteWheelUrl, disablePyPIFallback, pipliteUrls, loadPyodideOptions, } = this._options;\n        const preloaded = (loadPyodideOptions || {}).packages || [];\n        if (!preloaded.includes('micropip')) {\n            await this._pyodide.loadPackage(['micropip']);\n        }\n        if (!preloaded.includes('piplite')) {\n            await this._pyodide.runPythonAsync(`\n      import micropip\n      await micropip.install('${pipliteWheelUrl}', keep_going=True)\n    `);\n        }\n        // get piplite early enough to impact pyodide-kernel dependencies\n        await this._pyodide.runPythonAsync(`\n      import piplite.piplite\n      piplite.piplite._PIPLITE_DISABLE_PYPI = ${disablePyPIFallback ? 'True' : 'False'}\n      piplite.piplite._PIPLITE_URLS = ${JSON.stringify(pipliteUrls)}\n    `);\n    }\n    async initKernel(options) {\n        const preloaded = (options.loadPyodideOptions || {}).packages || [];\n        const toLoad = [\n            'ssl',\n            'sqlite3',\n            'ipykernel',\n            'comm',\n            'pyodide_kernel',\n            'ipython',\n        ];\n        const scriptLines = [];\n        // use piplite for packages that weren't pre-loaded\n        for (const pkgName of toLoad) {\n            if (!preloaded.includes(pkgName)) {\n                scriptLines.push(`await piplite.install('${pkgName}', keep_going=True)`);\n            }\n        }\n        // import the kernel\n        scriptLines.push('import pyodide_kernel');\n        // cd to the kernel location\n        if (options.mountDrive && this._localPath) {\n            scriptLines.push('import os', `os.chdir(\"${this._localPath}\")`);\n        }\n        // from this point forward, only use piplite (but not %pip)\n        await this._pyodide.runPythonAsync(scriptLines.join('\\n'));\n    }\n    async initGlobals(options) {\n        const { globals } = this._pyodide;\n        this._kernel = globals.get('pyodide_kernel').kernel_instance.copy();\n        this._stdout_stream = globals.get('pyodide_kernel').stdout_stream.copy();\n        this._stderr_stream = globals.get('pyodide_kernel').stderr_stream.copy();\n        this._interpreter = this._kernel.interpreter.copy();\n        this._interpreter.send_comm = this.sendComm.bind(this);\n    }\n    /**\n     * Setup custom Emscripten FileSystem\n     */\n    async initFilesystem(options) {\n        if (options.mountDrive) {\n            const mountpoint = '/drive';\n            const { FS, PATH, ERRNO_CODES } = this._pyodide;\n            const { baseUrl } = options;\n            const { DriveFS } = await import('../contents');\n            const driveFS = new DriveFS({\n                FS: FS,\n                PATH,\n                ERRNO_CODES,\n                baseUrl,\n                driveName: this._driveName,\n                mountpoint,\n            });\n            FS.mkdirTree(mountpoint);\n            FS.mount(driveFS, {}, mountpoint);\n            FS.chdir(mountpoint);\n            this._driveFS = driveFS;\n        }\n    }\n    /**\n     * Recursively convert a Map to a JavaScript object\n     * @param obj A Map, Array, or other  object to convert\n     */\n    mapToObject(obj) {\n        const out = obj instanceof Array ? [] : {};\n        obj.forEach((value, key) => {\n            out[key] =\n                value instanceof Map || value instanceof Array\n                    ? this.mapToObject(value)\n                    : value;\n        });\n        return out;\n    }\n    /**\n     * Format the response from the Pyodide evaluation.\n     *\n     * @param res The result object from the Pyodide evaluation\n     */\n    formatResult(res) {\n        if (!(res instanceof this._pyodide.ffi.PyProxy)) {\n            return res;\n        }\n        // TODO: this is a bit brittle\n        const m = res.toJs();\n        const results = this.mapToObject(m);\n        return results;\n    }\n    /**\n     * Register the callback function to send messages from the worker back to the main thread.\n     * @param callback the callback to register\n     */\n    registerCallback(callback) {\n        this._sendWorkerMessage = callback;\n    }\n    /**\n     * Makes sure pyodide is ready before continuing, and cache the parent message.\n     */\n    async setup(parent) {\n        await this._initialized;\n        this._kernel._parent_header = this._pyodide.toPy(parent);\n    }\n    /**\n     * Execute code with the interpreter.\n     *\n     * @param content The incoming message with the code to execute.\n     */\n    async execute(content, parent) {\n        await this.setup(parent);\n        const publishExecutionResult = (prompt_count, data, metadata) => {\n            const bundle = {\n                execution_count: prompt_count,\n                data: this.formatResult(data),\n                metadata: this.formatResult(metadata),\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'execute_result',\n            });\n        };\n        const publishExecutionError = (ename, evalue, traceback) => {\n            const bundle = {\n                ename: ename,\n                evalue: evalue,\n                traceback: traceback,\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'execute_error',\n            });\n        };\n        const clearOutputCallback = (wait) => {\n            const bundle = {\n                wait: this.formatResult(wait),\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'clear_output',\n            });\n        };\n        const displayDataCallback = (data, metadata, transient) => {\n            const bundle = {\n                data: this.formatResult(data),\n                metadata: this.formatResult(metadata),\n                transient: this.formatResult(transient),\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'display_data',\n            });\n        };\n        const updateDisplayDataCallback = (data, metadata, transient) => {\n            const bundle = {\n                data: this.formatResult(data),\n                metadata: this.formatResult(metadata),\n                transient: this.formatResult(transient),\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'update_display_data',\n            });\n        };\n        const publishStreamCallback = (name, text) => {\n            const bundle = {\n                name: this.formatResult(name),\n                text: this.formatResult(text),\n            };\n            this._sendWorkerMessage({\n                parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n                bundle,\n                type: 'stream',\n            });\n        };\n        this._stdout_stream.publish_stream_callback = publishStreamCallback;\n        this._stderr_stream.publish_stream_callback = publishStreamCallback;\n        this._interpreter.display_pub.clear_output_callback = clearOutputCallback;\n        this._interpreter.display_pub.display_data_callback = displayDataCallback;\n        this._interpreter.display_pub.update_display_data_callback =\n            updateDisplayDataCallback;\n        this._interpreter.displayhook.publish_execution_result =\n            publishExecutionResult;\n        this._interpreter.input = this.input.bind(this);\n        this._interpreter.getpass = this.getpass.bind(this);\n        const res = await this._kernel.run(content.code);\n        const results = this.formatResult(res);\n        if (results['status'] === 'error') {\n            publishExecutionError(results['ename'], results['evalue'], results['traceback']);\n        }\n        return results;\n    }\n    /**\n     * Complete the code submitted by a user.\n     *\n     * @param content The incoming message with the code to complete.\n     */\n    async complete(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.complete(content.code, content.cursor_pos);\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Inspect the code submitted by a user.\n     *\n     * @param content The incoming message with the code to inspect.\n     */\n    async inspect(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.inspect(content.code, content.cursor_pos, content.detail_level);\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Check code for completeness submitted by a user.\n     *\n     * @param content The incoming message with the code to check.\n     */\n    async isComplete(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.is_complete(content.code);\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Respond to the commInfoRequest.\n     *\n     * @param content The incoming message with the comm target name.\n     */\n    async commInfo(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.comm_info(content.target_name);\n        const results = this.formatResult(res);\n        return {\n            comms: results,\n            status: 'ok',\n        };\n    }\n    /**\n     * Respond to the commOpen.\n     *\n     * @param content The incoming message with the comm open.\n     */\n    async commOpen(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.comm_manager.comm_open(this._pyodide.toPy(null), this._pyodide.toPy(null), this._pyodide.toPy(content));\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Respond to the commMsg.\n     *\n     * @param content The incoming message with the comm msg.\n     */\n    async commMsg(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.comm_manager.comm_msg(this._pyodide.toPy(null), this._pyodide.toPy(null), this._pyodide.toPy(content));\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Respond to the commClose.\n     *\n     * @param content The incoming message with the comm close.\n     */\n    async commClose(content, parent) {\n        await this.setup(parent);\n        const res = this._kernel.comm_manager.comm_close(this._pyodide.toPy(null), this._pyodide.toPy(null), this._pyodide.toPy(content));\n        const results = this.formatResult(res);\n        return results;\n    }\n    /**\n     * Resolve the input request by getting back the reply from the main thread\n     *\n     * @param content The incoming message with the reply\n     */\n    async inputReply(content, parent) {\n        await this.setup(parent);\n        this._resolveInputReply(content);\n    }\n    /**\n     * Send a input request to the front-end.\n     *\n     * @param prompt the text to show at the prompt\n     * @param password Is the request for a password?\n     */\n    async sendInputRequest(prompt, password) {\n        const content = {\n            prompt,\n            password,\n        };\n        this._sendWorkerMessage({\n            type: 'input_request',\n            parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n            content,\n        });\n    }\n    async getpass(prompt) {\n        prompt = typeof prompt === 'undefined' ? '' : prompt;\n        await this.sendInputRequest(prompt, true);\n        const replyPromise = new Promise(resolve => {\n            this._resolveInputReply = resolve;\n        });\n        const result = await replyPromise;\n        return result['value'];\n    }\n    async input(prompt) {\n        prompt = typeof prompt === 'undefined' ? '' : prompt;\n        await this.sendInputRequest(prompt, false);\n        const replyPromise = new Promise(resolve => {\n            this._resolveInputReply = resolve;\n        });\n        const result = await replyPromise;\n        return result['value'];\n    }\n    /**\n     * Send a comm message to the front-end.\n     *\n     * @param type The type of the comm message.\n     * @param content The content.\n     * @param metadata The metadata.\n     * @param ident The ident.\n     * @param buffers The binary buffers.\n     */\n    async sendComm(type, content, metadata, ident, buffers) {\n        this._sendWorkerMessage({\n            type: type,\n            content: this.formatResult(content),\n            metadata: this.formatResult(metadata),\n            ident: this.formatResult(ident),\n            buffers: this.formatResult(buffers),\n            parentHeader: this.formatResult(this._kernel._parent_header)['header'],\n        });\n    }\n    /**\n     * Initialization options.\n     */\n    _options = null;\n    /**\n     * A promise that resolves when all initiaization is complete.\n     */\n    _initialized;\n    _initializer = null;\n    _pyodide = null;\n    /** TODO: real typing */\n    _localPath = '';\n    _driveName = '';\n    _kernel;\n    _interpreter;\n    _stdout_stream;\n    _stderr_stream;\n    _resolveInputReply;\n    _driveFS = null;\n    _sendWorkerMessage = () => { };\n}\n//# sourceMappingURL=worker.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\n/**\n * A WebWorker entrypoint that uses comlink to handle postMessage details\n */\nimport { expose } from 'comlink';\nimport { DriveFS, ServiceWorkerContentsAPI } from '../contents';\nimport { PyodideRemoteKernel } from './worker';\n/**\n * A custom drive implementation which uses the service worker\n */\nclass PyodideDriveFS extends DriveFS {\n    createAPI(options) {\n        return new ServiceWorkerContentsAPI(options.baseUrl, options.driveName, options.mountpoint, options.FS, options.ERRNO_CODES);\n    }\n}\nexport class PyodideComlinkKernel extends PyodideRemoteKernel {\n    constructor() {\n        super();\n        this._sendWorkerMessage = (msg) => {\n            // use postMessage, but in a format, that comlink would not process.\n            postMessage({ _kernelMessage: msg });\n        };\n    }\n    /**\n     * Setup custom Emscripten FileSystem\n     */\n    async initFilesystem(options) {\n        if (options.mountDrive) {\n            const mountpoint = '/drive';\n            const { FS, PATH, ERRNO_CODES } = this._pyodide;\n            const { baseUrl } = options;\n            const driveFS = new PyodideDriveFS({\n                FS: FS,\n                PATH,\n                ERRNO_CODES,\n                baseUrl,\n                driveName: this._driveName,\n                mountpoint,\n            });\n            FS.mkdirTree(mountpoint);\n            FS.mount(driveFS, {}, mountpoint);\n            FS.chdir(mountpoint);\n            this._driveFS = driveFS;\n        }\n    }\n}\nconst worker = new PyodideComlinkKernel();\nexpose(worker);\n//# sourceMappingURL=comlink.worker.js.map"],"names":["proxyMarker","createEndpoint","releaseProxy","finalizer","throwMarker","isObject","val","transferHandlers","Map","canHandle","serialize","obj","port1","port2","MessageChannel","expose","deserialize","port","start","ep","target","pendingListeners","addEventListener","ev","data","id","resolver","get","delete","createProxy","wrap","value","serialized","Error","isError","message","name","stack","Object","assign","globalThis","allowedOrigins","callback","origin","allowedOrigin","RegExp","test","isAllowedOrigin","console","warn","type","path","argumentList","map","fromWireValue","returnValue","parent","slice","reduce","prop","rawValue","apply","proxy","transfers","transferCache","set","transfer","Promise","resolve","catch","then","wireValue","transferables","toWireValue","postMessage","removeEventListener","closeEndPoint","error","TypeError","endpoint","constructor","isMessagePort","close","throwIfProxyReleased","isReleased","releaseEndpoint","requestResponseMessage","proxyCounter","WeakMap","proxyFinalizers","FinalizationRegistry","newCount","isProxyReleased","Proxy","_target","unregister","unregisterProxy","clear","length","r","p","toString","bind","_thisArg","rawArgumentList","last","processArguments","construct","register","registerProxy","processed","v","arr","Array","prototype","concat","handler","serializedValue","msg","fill","Math","floor","random","Number","MAX_SAFE_INTEGER","join","instanceOfStream","nodeOrStream","encoder","TextEncoder","decoder","TextDecoder","flagNeedsWrite","DriveFSEmscriptenStreamOps","fs","this","open","stream","realPath","node","FS","isFile","mode","file","API","flags","parsedFlags","parseInt","needsWrite","put","read","buffer","offset","position","size","min","subarray","write","timestamp","Date","now","oldData","Uint8Array","llseek","whence","ErrnoError","ERRNO_CODES","EPERM","EINVAL","DriveFSEmscriptenNodeOps","getattr","ino","setattr","attr","key","entries","lookup","PATH","join2","result","ok","createNode","mknod","dev","rename","newDir","newName","oldNode","newDirNode","unlink","rmdir","readdir","symlink","oldPath","readlink","ContentsAPI","driveName","mountpoint","_driveName","_mountpoint","request","method","normalizePath","getmode","newPath","dirlist","push","response","serializedContent","content","format","encode","binString","atob","len","i","charCodeAt","decode","binary","byteLength","String","fromCharCode","btoa","stats","atime","mtime","ctime","startsWith","ServiceWorkerContentsAPI","baseUrl","super","_baseUrl","xhr","XMLHttpRequest","encodeURI","send","JSON","stringify","e","status","parse","responseText","DriveFS","options","createAPI","node_ops","stream_ops","mount","DIR_MODE","isDir","getMode","parts","currentNode","reverse","PyodideRemoteKernel","_initialized","reject","_initializer","initialize","_options","location","includes","split","_localPath","initRuntime","initFilesystem","initPackageManager","initKernel","initGlobals","pyodideUrl","indexUrl","loadPyodide","import","self","_pyodide","indexURL","loadPyodideOptions","pipliteWheelUrl","disablePyPIFallback","pipliteUrls","preloaded","packages","loadPackage","runPythonAsync","toLoad","scriptLines","pkgName","mountDrive","globals","_kernel","kernel_instance","copy","_stdout_stream","stdout_stream","_stderr_stream","stderr_stream","_interpreter","interpreter","send_comm","sendComm","index","driveFS","mkdirTree","chdir","_driveFS","mapToObject","out","forEach","formatResult","res","ffi","PyProxy","m","toJs","registerCallback","_sendWorkerMessage","setup","_parent_header","toPy","execute","publishExecutionError","ename","evalue","traceback","bundle","parentHeader","publishStreamCallback","text","publish_stream_callback","display_pub","clear_output_callback","wait","display_data_callback","metadata","transient","update_display_data_callback","displayhook","publish_execution_result","prompt_count","execution_count","input","getpass","run","code","results","complete","cursor_pos","inspect","detail_level","isComplete","is_complete","commInfo","comm_info","target_name","comms","commOpen","comm_manager","comm_open","commMsg","comm_msg","commClose","comm_close","inputReply","_resolveInputReply","sendInputRequest","prompt","password","replyPromise","ident","buffers","PyodideDriveFS","_kernelMessage"],"mappings":"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","x_google_ignoreList":[0]}