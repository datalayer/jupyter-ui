import{l as e,t,P as n,aL as r,aM as o,ag as i,ak as a,aN as s,aO as c,ai as u,aP as l,aQ as f}from"./JupyterReactTheme-CX3WbnDJ.js";import{g as d}from"./vendor-mathjax-Bog1Ynz5.js";import{F as h,M as p,c as g,d as v,a as y,I as m,b as w,e as _}from"./tokens-Dt5QILm-.js";import{D as b,a as S}from"./drivecontents-BJnbG0Iq.js";const k=e.PageConfig.getOption("appVersion");class I{constructor(t){const n=e.URLExt.join(e.PageConfig.getOption("serviceWorkerUrl")),r=new URL(n);r.searchParams.set("enableCache","true"),this.initialize(r.href).catch(console.warn)}get registrationChanged(){return this._registrationChanged}get enabled(){return null!==this._registration}get ready(){return this._ready.promise}unregisterOldServiceWorkers=async e=>{const t=`${e}-version`,n=localStorage.getItem(t);if(n&&n!==k||!n){console.info("New version, unregistering existing service workers.");const e=await navigator.serviceWorker.getRegistrations();await Promise.all(e.map(e=>e.unregister())),console.info("All existing service workers have been unregistered.")}localStorage.setItem(t,k)};async initialize(e){const{serviceWorker:t}=navigator;let n=null;if(t){if(t.controller){const e=t.controller.scriptURL;await this.unregisterOldServiceWorkers(e),n=await t.getRegistration(e)||null,console.info("JupyterLite ServiceWorker was already registered")}}else console.warn("ServiceWorkers not supported in this browser");if(!n&&t)try{console.info("Registering new JupyterLite ServiceWorker",e),n=await t.register(e),console.info("JupyterLite ServiceWorker was sucessfully registered")}catch(r){console.warn(r),console.warn(`JupyterLite ServiceWorker registration unexpectedly failed: ${r}`)}this._setRegistration(n),n?(this._ready.resolve(void 0),setTimeout(this._pingServiceWorker,2e4)):this._ready.reject(void 0)}_pingServiceWorker=async()=>{const e=await fetch("/api/service-worker-heartbeat");"ok"===await e.text()&&setTimeout(this._pingServiceWorker,2e4)};_setRegistration(e){this._registration=e,this._registrationChanged.emit(this._registration)}_registration=null;_registrationChanged=new t(this);_ready=new n}const N="JupyterLite Storage",E=new TextEncoder,O=new TextDecoder("utf-8");class x{constructor(e){this._localforage=e.localforage,this._storageName=e.storageName||N,this._storageDrivers=e.storageDrivers||null,this._ready=new n}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}async initStorage(){this._storage=this.createDefaultStorage(),this._counters=this.createDefaultCounters(),this._checkpoints=this.createDefaultCheckpoints()}get ready(){return this._ready.promise}get storage(){return this.ready.then(()=>this._storage)}get counters(){return this.ready.then(()=>this._counters)}get checkpoints(){return this.ready.then(()=>this._checkpoints)}get defaultStorageOptions(){const e=this._storageDrivers&&this._storageDrivers.length?this._storageDrivers:null;return{version:1,name:this._storageName,...e?{driver:e}:{}}}createDefaultStorage(){return this._localforage.createInstance({description:"Offline Storage for Notebooks and Files",storeName:"files",...this.defaultStorageOptions})}createDefaultCounters(){return this._localforage.createInstance({description:"Store the current file suffix counters",storeName:"counters",...this.defaultStorageOptions})}createDefaultCheckpoints(){return this._localforage.createInstance({description:"Offline Storage for Checkpoints",storeName:"checkpoints",...this.defaultStorageOptions})}async newUntitled(t){const n=t?.path??"",r=t?.type??"notebook",o=/* @__PURE__ */(new Date).toISOString();let i=e.PathExt.dirname(n);const a=e.PathExt.basename(n),s=e.PathExt.extname(n),c=await this.get(i);let u,l="";switch(n&&!s&&c?(i=`${n}/`,l=""):i&&a?(i=`${i}/`,l=a):(i="",l=n),r){case"directory":l=`Untitled Folder${await this._incrementCounter("directory")||""}`,u={name:l,path:`${i}${l}`,last_modified:o,created:o,format:"json",mimetype:"",content:null,size:0,writable:!0,type:"directory"};break;case"notebook":{const e=await this._incrementCounter("notebook");l=l||`Untitled${e||""}.ipynb`,u={name:l,path:`${i}${l}`,last_modified:o,created:o,format:"json",mimetype:p.JSON,content:j.EMPTY_NB,size:E.encode(JSON.stringify(j.EMPTY_NB)).length,writable:!0,type:"notebook"};break}default:{const e=t?.ext??".txt",n=await this._incrementCounter("file"),r=h.getType(e)||p.OCTET_STREAM;let a;a=h.hasFormat(e,"text")||-1!==r.indexOf("text")?"text":-1!==e.indexOf("json")||-1!==e.indexOf("ipynb")?"json":"base64",l=l||`untitled${n||""}${e}`,u={name:l,path:`${i}${l}`,last_modified:o,created:o,format:a,mimetype:r,content:"",size:0,writable:!0,type:"file"};break}}const f=u.path;return await(await this.storage).setItem(f,u),u}async copy(t,n){let r=e.PathExt.basename(t);for(n=""===n?"":`${e.PathExt.removeSlash(n)}/`;await this.get(`${n}${r}`,{content:!0});){const t=e.PathExt.extname(r),n=r.replace(t,"");r=`${n} (copy)${t}`}const o=`${n}${r}`;let i=await this.get(t,{content:!0});if(!i)throw Error(`Could not find file with path ${t}`);return i={...i,name:r,path:o},await(await this.storage).setItem(o,i),i}async get(t,n){if(""===(t=decodeURIComponent(t.replace(/^\//,""))))return await this._getFolder(t);const r=await this.storage,o=await r.getItem(t),i=await this._getServerContents(t,n),a=o||i;if(!a)return null;if(!n?.content)return{size:0,...a,content:null};if("directory"===a.type){const n=/* @__PURE__ */new Map;await r.iterate((e,r)=>{r===`${t}/${e.name}`&&n.set(e.name,e)});const o=i?i.content:Array.from((await this._getServerDirectory(t)).values());for(const e of o)n.has(e.name)||n.set(e.name,e);const s=[...n.values()];return{name:e.PathExt.basename(t),path:t,last_modified:a.last_modified,created:a.created,format:"json",mimetype:p.JSON,content:s,size:0,writable:!0,type:"directory"}}return a}async rename(t,n){const r=decodeURIComponent(t),o=await this.get(r,{content:!0});if(!o)throw Error(`Could not find file with path ${r}`);const i=/* @__PURE__ */(new Date).toISOString(),a=e.PathExt.basename(n),s={...o,name:a,path:n,last_modified:i},c=await this.storage;if(await c.setItem(n,s),await c.removeItem(r),await(await this.checkpoints).removeItem(r),"directory"===o.type){let r;for(r of o.content)await this.rename(e.URLExt.join(t,r.name),e.URLExt.join(n,r.name))}return s}async save(t,n={}){t=decodeURIComponent(t);const r=e.PathExt.extname(n.name??""),o=n.chunk,i=!!o&&(o>1||-1===o);let a=await this.get(t,{content:i});if(a||(a=await this.newUntitled({path:t,ext:r,type:"file"})),!a)return null;const s=a.content,c=/* @__PURE__ */(new Date).toISOString();if(a={...a,...n,last_modified:c},n.content&&"base64"===n.format){const e=!o||-1===o,t=this._handleUploadChunk(n.content,s,i);if(".ipynb"===r){const n=e?JSON.parse(O.decode(this._binaryStringToBytes(t))):t;a={...a,content:n,format:"json",type:"notebook",size:t.length}}else if(h.hasFormat(r,"json")){const n=e?JSON.parse(O.decode(this._binaryStringToBytes(t))):t;a={...a,content:n,format:"json",type:"file",size:t.length}}else if(h.hasFormat(r,"text")){const n=e?O.decode(this._binaryStringToBytes(t)):t;a={...a,content:n,format:"text",type:"file",size:t.length}}else{const n=e?btoa(t):t;a={...a,content:n,format:"base64",type:"file",size:t.length}}}if(a.content)switch(n.format){case"json":a={...a,size:E.encode(JSON.stringify(a.content)).length};break;case"text":a={...a,size:E.encode(a.content).length};break;case"base64":break;default:a={...a,size:0}}else a={...a,size:0};return await(await this.storage).setItem(t,a),a}async delete(e){const t=`${e=decodeURIComponent(e)}/`,n=(await(await this.storage).keys()).filter(n=>n===e||n.startsWith(t));await Promise.all(n.map(this.forgetPath,this))}async forgetPath(e){await Promise.all([(await this.storage).removeItem(e),(await this.checkpoints).removeItem(e)])}async createCheckpoint(e){const t=await this.checkpoints;e=decodeURIComponent(e);const n=await this.get(e,{content:!0});if(!n)throw Error(`Could not find file with path ${e}`);const r=(await t.getItem(e)??[]).filter(Boolean);r.push(n),r.length>5&&r.splice(0,r.length-5),await t.setItem(e,r);return{id:""+(r.length-1),last_modified:n.last_modified}}async listCheckpoints(e){return(await(await this.checkpoints).getItem(e)||[]).filter(Boolean).map(this.normalizeCheckpoint,this)}normalizeCheckpoint(e,t){return{id:t.toString(),last_modified:e.last_modified}}async restoreCheckpoint(e,t){e=decodeURIComponent(e);const n=(await(await this.checkpoints).getItem(e)||[])[parseInt(t)];await(await this.storage).setItem(e,n)}async deleteCheckpoint(e,t){e=decodeURIComponent(e);const n=await(await this.checkpoints).getItem(e)||[],r=parseInt(t);n.splice(r,1),await(await this.checkpoints).setItem(e,n)}_handleUploadChunk(e,t,n){const r=atob(e);return n?t+r:r}_binaryStringToBytes(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}async _getFolder(e){const t=/* @__PURE__ */new Map,n=await this.storage;await n.iterate((e,n)=>{n.includes("/")||t.set(e.path,e)});for(const r of(await this._getServerDirectory(e)).values())t.has(r.path)||t.set(r.path,r);return e&&0===t.size?null:{name:"",path:e,last_modified:/* @__PURE__ */new Date(0).toISOString(),created:/* @__PURE__ */new Date(0).toISOString(),format:"json",mimetype:p.JSON,content:Array.from(t.values()),size:0,writable:!0,type:"directory"}}async _getServerContents(t,n){const r=e.PathExt.basename(t);let o=(await this._getServerDirectory(e.URLExt.join(t,".."))).get(r);if(!o)return null;if(o=o||{name:r,path:t,last_modified:/* @__PURE__ */new Date(0).toISOString(),created:/* @__PURE__ */new Date(0).toISOString(),format:"text",mimetype:p.PLAIN_TEXT,type:"file",writable:!0,size:0,content:""},n?.content)if("directory"===o.type){const e=await this._getServerDirectory(t);o={...o,content:Array.from(e.values())}}else{const n=e.URLExt.join(e.PageConfig.getBaseUrl(),"files",t),i=await fetch(n);if(!i.ok)return null;const a=o.mimetype||i.headers.get("Content-Type"),s=e.PathExt.extname(r);if("notebook"===o.type||h.hasFormat(s,"json")||-1!==a?.indexOf("json")||t.match(/\.(ipynb|[^/]*json[^/]*)$/)){const e=await i.text();o={...o,content:JSON.parse(e),format:"json",mimetype:o.mimetype||p.JSON,size:E.encode(e).length}}else if(h.hasFormat(s,"text")||-1!==a.indexOf("text")){const e=await i.text();o={...o,content:e,format:"text",mimetype:a||p.PLAIN_TEXT,size:E.encode(e).length}}else{const e=await i.arrayBuffer(),t=new Uint8Array(e);o={...o,content:btoa(t.reduce(this.reduceBytesToString,"")),format:"base64",mimetype:a||p.OCTET_STREAM,size:t.length}}}return o}reduceBytesToString=(e,t)=>e+String.fromCharCode(t);async _getServerDirectory(t){const n=this._serverContents.get(t)||/* @__PURE__ */new Map;if(!this._serverContents.has(t)){const o=e.URLExt.join(e.PageConfig.getBaseUrl(),"api/contents",t,"all.json");try{const e=await fetch(o),t=JSON.parse(await e.text());for(const r of t.content)n.set(r.name,r)}catch(r){console.warn(`don't worry, about ${r}... nothing's broken. If there had been a\n          file at ${o}, you might see some more files.`)}this._serverContents.set(t,n)}return n}async _incrementCounter(e){const t=await this.counters,n=(await t.getItem(e)??-1)+1;return await t.setItem(e,n),n}_serverContents=/* @__PURE__ */new Map;_storageName=N;_storageDrivers=null;_ready;_storage;_counters;_checkpoints;_localforage}var j;(j||(j={})).EMPTY_NB={metadata:{orig_nbformat:4},nbformat_minor:5,nbformat:4,cells:[]};class R{isDisposed=!1;constructor(e){this._contents=e.contents,this._driveContentsProcessor=new b({contentsManager:this._contents})}get enabled(){return this._enabled}enable(){this._channel?console.warn("BroadcastChannel already created and enabled"):(this._channel=new BroadcastChannel(S),this._channel.addEventListener("message",this._onMessage),this._enabled=!0)}disable(){this._channel&&(this._channel.removeEventListener("message",this._onMessage),this._channel=null),this._enabled=!1}dispose(){this.isDisposed||(this.disable(),this.isDisposed=!0)}_onMessage=async e=>{if(!this._channel)return;const t=e.data,n=t?.receiver;if("broadcast.ts"!==n)return;const r=await this._driveContentsProcessor.processDriveRequest(t);this._channel.postMessage(r)};_channel=null;_contents;_driveContentsProcessor;_enabled=!1}var C=r(),D=o();const P=new Error("request for lock canceled");var A=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})};class L{constructor(e,t=P){if(this._maxConcurrency=e,this._cancelError=t,this._queue=[],this._waiters=[],e<=0)throw new Error("semaphore must be initialized to a positive value");this._value=e}acquire(){const e=this.isLocked(),t=new Promise((e,t)=>this._queue.push({resolve:e,reject:t}));return e||this._dispatch(),t}runExclusive(e){return A(this,void 0,void 0,function*(){const[t,n]=yield this.acquire();try{return yield e(t)}finally{n()}})}waitForUnlock(){return A(this,void 0,void 0,function*(){if(!this.isLocked())return Promise.resolve();return new Promise(e=>this._waiters.push({resolve:e}))})}isLocked(){return this._value<=0}release(){if(this._maxConcurrency>1)throw new Error("this method is unavailable on semaphores with concurrency > 1; use the scoped release returned by acquire instead");if(this._currentReleaser){const e=this._currentReleaser;this._currentReleaser=void 0,e()}}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatch(){const e=this._queue.shift();if(!e)return;let t=!1;this._currentReleaser=()=>{t||(t=!0,this._value++,this._resolveWaiters(),this._dispatch())},e.resolve([this._value--,this._currentReleaser])}_resolveWaiters(){this._waiters.forEach(e=>e.resolve()),this._waiters=[]}}var T=function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{c(r.next(e))}catch(t){i(t)}}function s(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}c((r=r.apply(e,t||[])).next())})};class B{constructor(e){this._semaphore=new L(1,e)}acquire(){return T(this,void 0,void 0,function*(){const[,e]=yield this._semaphore.acquire();return e})}runExclusive(e){return this._semaphore.runExclusive(()=>e())}isLocked(){return this._semaphore.isLocked()}waitForUnlock(){return this._semaphore.waitForUnlock()}release(){this._semaphore.release()}cancel(){return this._semaphore.cancel()}}const U=D.supportedKernelWebSocketProtocols.v1KernelWebsocketJupyterOrg;class z{constructor(e){const{kernelspecs:t}=e;this._kernelspecs=t,this._kernels.changed.connect((e,t)=>{this._changed.emit(t)})}get changed(){return this._changed}async startNew(t){const{id:n,name:r,location:o}=t,c=this._kernelspecs.factories.get(r);if(!c)return console.error("No factory associated with",r,this._kernelspecs.factories),{id:n,name:r};const u=new B,l=(e,t,n)=>{const r=this._kernels.get(e);if(!r)throw Error(`No kernel ${e}`);this._clients.set(t,n),this._kernelClients.get(e)?.add(t);n.on("message",async e=>{let t;if(e instanceof ArrayBuffer)e=new Uint8Array(e).buffer,t=C.deserialize(e,U);else{if("string"!=typeof e)return;{const n=(new TextEncoder).encode(e);t=C.deserialize(n.buffer,U)}}"input_reply"===t.header.msg_type?r.handleMessage(t):(async e=>{await u.runExclusive(async()=>{await r.ready,await r.handleMessage(e)})})(t)});const o=()=>{this._clients.delete(t),this._kernelClients.get(e)?.delete(t)};r.disposed.connect(o),n.onclose=o},f=n??i.uuid4(),d=e.URLExt.join(z.WS_BASE_URL,a.KernelAPI.KERNEL_SERVICE_URL,encodeURIComponent(f),"channels"),h=this._kernels.get(f);if(h)return{id:h.id,name:h.name};const p=await c({id:f,sendMessage:e=>{const t=e.header.session,n=this._clients.get(t);if(!n)return void console.warn(`Trying to send message on removed socket for kernel ${f}`);const r=C.serialize(e,U);if("iopub"===e.channel){const e=this._kernelClients.get(f);return void e?.forEach(e=>{this._clients.get(e)?.send(r)})}n.send(r)},name:r,location:o});this._kernels.set(f,p),this._kernelClients.set(f,/* @__PURE__ */new Set);const g=new s.Server(d,{mock:!1,selectProtocol:()=>U});return g.on("connection",e=>{const t=new URL(e.url).searchParams.get("session_id")??"";l(f,t,e)}),g.on("close",()=>{this._clients.keys().forEach(e=>{const t=this._clients.get(e);t?.readyState===WebSocket.CLOSED&&(this._clients.delete(e),this._kernelClients.get(f)?.delete(e))})}),p.disposed.connect(()=>{g.close(),this._kernels.delete(f),this._kernelClients.delete(f)}),{id:p.id,name:p.name}}async restart(e){const t=this._kernels.get(e);if(!t)throw Error(`Kernel ${e} does not exist`);const{id:n,name:r,location:o}=t;return t.dispose(),this.startNew({id:n,name:r,location:o})}async list(){return[...this._kernels.values()].map(e=>({id:e.id,name:e.name}))}async shutdown(e){this._kernels.delete(e)?.dispose()}async get(e){return this._kernels.get(e)}_kernels=new c;_clients=new c;_kernelClients=new c;_kernelspecs;_changed=new t(this)}(z||(z={})).WS_BASE_URL=e.PageConfig.getBaseUrl().replace(/^http/,"ws");class J{get specs(){return 0===this._specs.size?null:{default:this.defaultKernelName,kernelspecs:Object.fromEntries(this._specs)}}get defaultKernelName(){let t=e.PageConfig.getOption("defaultKernelName");if(!t&&this._specs.size){const e=Array.from(this._specs.keys());e.sort(),t=e[0]}return t||g}get factories(){return this._factories}register(e){const{spec:t,create:n}=e;this._specs.set(t.name,t),this._factories.set(t.name,n)}_specs=/* @__PURE__ */new Map;_factories=/* @__PURE__ */new Map}const F=new u("@jupyterlite/localforge:ILocalForage");function M(e){return M.result||(e&&"function"==typeof e.getSerializer||Promise.reject(new Error("localforage.getSerializer() was not available! localforage v1.4+ is required!")),M.result=e.getSerializer()),M.result}function $(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var q={};var W={_driver:"memoryStorageDriver",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];var r=q[t.name]=q[t.name]||{},o=r[t.storeName]=r[t.storeName]||{};return t.db=o,this._dbInfo=t,M(this).then(function(e){t.serializer=e})},iterate:function(e,t){var n=this,r=n.ready().then(function(){var t=n._dbInfo.db,r=1;for(var o in t)if(t.hasOwnProperty(o)){var i=t[o];if(i&&(i=n._dbInfo.serializer.deserialize(i)),void 0!==(i=e(i,o,r++)))return i}});return $(r,t),r},getItem:function(e,t){var n=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var r=n.ready().then(function(){var t=n._dbInfo.db[e];return t&&(t=n._dbInfo.serializer.deserialize(t)),t});return $(r,t),r},setItem:function(e,t,n){var r=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var o=r.ready().then(function(){void 0===t&&(t=null);var n,o=t;return(n=t,new Promise(function(e,t){r._dbInfo.serializer.serialize(n,function(n,r){r?t(r):e(n)})})).then(function(t){return r._dbInfo.db[e]=t,o})});return $(o,n),o},removeItem:function(e,t){var n=this;"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e));var r=n.ready().then(function(){var t=n._dbInfo.db;t.hasOwnProperty(e)&&delete t[e]});return $(r,t),r},clear:function(e){var t=this,n=t.ready().then(function(){var e=t._dbInfo.db;for(var n in e)e.hasOwnProperty(n)&&delete e[n]});return $(n,e),n},length:function(e){var t=this.keys().then(function(e){return e.length});return $(t,e),t},key:function(e,t){var n=this,r=n.ready().then(function(){var t=n._dbInfo.db,r=null,o=0;for(var i in t)if(t.hasOwnProperty(i)){if(e===o){r=i;break}o++}return r});return $(r,t),r},keys:function(e){var t=this,n=t.ready().then(function(){var e=t._dbInfo.db,n=[];for(var r in e)e.hasOwnProperty(r)&&n.push(r);return n});return $(n,e),n}};const K=new u("@jupyterlite/session:ISessions");class V{constructor(e){this._kernels=e.kernels,this._kernels.changed.connect((e,t)=>{switch(t.type){case"remove":{const e=t.oldValue?.id;if(!e)return;const n=this._sessions.find(t=>t.kernel?.id===e);if(!n)return;this._pendingRestarts.add(e),setTimeout(async()=>{this._pendingRestarts.has(e)&&(this._pendingRestarts.delete(e),await this.shutdown(n.id))},100);break}case"add":{const e=t.newValue?.id;if(!e)return;this._pendingRestarts.delete(e);break}}})}async get(e){const t=this._sessions.find(t=>t.id===e);if(!t)throw Error(`Session ${e} not found`);return t}async list(){return this._sessions}async patch(t){const{id:n,path:r,name:o,kernel:a}=t,s=this._sessions.findIndex(e=>e.id===n),c=this._sessions[s];if(!c)throw Error(`Session ${n} not found`);const u={...c,path:r??c.path,name:o??c.name};if(a)if(a.id){const e=this._sessions.find(e=>e.kernel?.id===a?.id);e&&(u.kernel=e.kernel)}else if(a.name){const t=await this._kernels.startNew({id:i.uuid4(),name:a.name,location:e.PathExt.dirname(u.path)});t&&(u.kernel=t),this._handleKernelShutdown({kernelId:t.id,sessionId:c.id})}return this._sessions[s]=u,u}async startNew(t){const{path:n,name:r}=t,o=this._sessions.find(e=>e.name===r);if(o)return o;const a=t.kernel?.name??"",s=t.id??i.uuid4(),c=t.name??t.path,u=e.PathExt.dirname(t.name)||e.PathExt.dirname(t.path),l=c.includes(":")?c.split(":")[0]:"",f=u.includes(l)?u:`${l}:${u}`,d=await this._kernels.startNew({id:s,name:a,location:f}),h={id:s,path:n,name:r??n,type:"notebook",kernel:{id:d.id,name:d.name}};return this._sessions.push(h),this._handleKernelShutdown({kernelId:s,sessionId:h.id}),h}async shutdown(e){const t=this._sessions.find(t=>t.id===e);if(!t)throw Error(`Session ${e} not found`);const n=t.kernel?.id;n&&await this._kernels.shutdown(n),l.removeFirstOf(this._sessions,t)}async _handleKernelShutdown({kernelId:e,sessionId:t}){}_kernels;_sessions=[];_pendingRestarts=/* @__PURE__ */new Set}const Q="third-party-licenses.json",X=new u("@jupyterlite/licenses:ILicenses"),H=Object.freeze({packages:[]});class Y{async get(){return{bundles:{...await this._getFederated(),[this.appName]:await this._getAppLicenses()}}}get appName(){return e.PageConfig.getOption("appName")||"JupyterLite"}get appLicensesUrl(){return e.URLExt.join(e.PageConfig.getBaseUrl(),"build",Q)}get labExtensionsUrl(){return e.PageConfig.getOption("fullLabextensionsUrl")}async _getAppLicenses(){let e=H;try{e=(await fetch(this.appLicensesUrl)).json()}catch(t){console.warn("Could not resolve licenses for",this.appName)}return e}async _getFederated(){const t={};let n;try{n=JSON.parse(e.PageConfig.getOption("federated_extensions"))}catch{return t}const r=[];for(const e of n)r.push(this._getOneFederated(e,t));try{await Promise.all(r)}catch(o){console.warn("Error resolving licenses",o)}return t}async _getOneFederated(t,n){try{const r=e.URLExt.join(this.labExtensionsUrl,t.name,"static",Q),o=await fetch(r);n[t.name]=await o.json()}catch{console.warn("Could not resolve licenses for",t),n[t.name]=H}}}const G="JupyterLite Storage";class Z{constructor(e){this._localforage=e.localforage,this._storageName=e.storageName||G,this._storageDrivers=e.storageDrivers||null,this._ready=new n}get ready(){return this._ready.promise}get storage(){return this.ready.then(()=>this._storage)}async initialize(){await this.initStorage(),this._ready.resolve(void 0)}async initStorage(){this._storage=this.defaultSettingsStorage()}get defaultStorageOptions(){const e=this._storageDrivers?.length?this._storageDrivers:null;return{version:1,name:this._storageName,...e?{driver:e}:{}}}defaultSettingsStorage(){return this._localforage.createInstance({description:"Offline Storage for Settings",storeName:"settings",...this.defaultStorageOptions})}async get(e){return(await this.getAll()).settings.find(t=>t.id===e)}async getAll(){const e=await this._getAll("all.json");let t=[];try{t=await this._getAll("all_federated.json")}catch{}const n=e.concat(t),r=await this.storage;return{settings:await Promise.all(n.map(async e=>{const{id:t}=e,n=await r.getItem(t)??e.raw;return{...ee.override(e),raw:n,settings:(void 0)(n)}}))}}async save(e,t){await(await this.storage).setItem(e,t)}async _getAll(t){const n=e.PageConfig.getOption("settingsUrl")??"/";return await(await fetch(e.URLExt.join(n,t))).json()}_storageName=G;_storageDrivers=null;_storage;_localforage;_ready}var ee;!function(t){const n=JSON.parse(e.PageConfig.getOption("settingsOverrides")||"{}");t.override=function(e){if(n[e.id]){e.schema.properties||(e.schema.properties={});for(const[t,r]of Object.entries(n[e.id]||{}))e.schema.properties[t].default=r}return e}}(ee||(ee={}));const te=new u("@jupyterlite/settings:ISettings");class ne{async get(t){const n=e.URLExt.join(e.PageConfig.getBaseUrl(),`api/translations/${t}.json`);try{const e=await fetch(n),r=JSON.parse(await e.text());if("all"!==this._prevLocale&&"all"===t){const e=this._prevLocale;r.data[e].displayName=r.data[e].nativeName,"en"!==e&&(r.data.en.displayName=`${r.data.en.nativeName} (default)`)}return this._prevLocale=t,r}catch(r){return t?{data:{},message:`Language pack '${t}' not installed!`}:{data:{en:{displayName:"English",nativeName:"English"}},message:""}}}_prevLocale=""}const re=new u("@jupyterlite/translation:ITranslation");var oe,ie={exports:{}};const ae=/* @__PURE__ */d((oe||(oe=1,ie.exports=function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var c="function"==typeof f&&f;if(!s&&c)return c(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){var n=t[a][1][e];return o(n||e)},l,l.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof f&&f,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){(function(e){var n,r,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var i=0,a=new o(l),s=e.document.createTextNode("");a.observe(s,{characterData:!0}),n=function(){s.data=i=++i%2}}else if(e.setImmediate||void 0===e.MessageChannel)n="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){l(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(l,0)};else{var c=new e.MessageChannel;c.port1.onmessage=l,n=function(){c.port2.postMessage(0)}}var u=[];function l(){var e,t;r=!0;for(var n=u.length;n;){for(t=u,u=[],e=-1;++e<n;)t[e]();n=u.length}r=!1}function f(e){1!==u.push(e)||r||n()}t.exports=f}).call(this,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){var r=e(1);function o(){}var i={},a=["REJECTED"],s=["FULFILLED"],c=["PENDING"];function u(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=c,this.queue=[],this.outcome=void 0,e!==o&&h(this,e)}function l(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function f(e,t,n){r(function(){var r;try{r=t(n)}catch(o){return i.reject(e,o)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)})}function d(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function r(t){n||(n=!0,i.reject(e,t))}function o(t){n||(n=!0,i.resolve(e,t))}function a(){t(o,r)}var s=p(a);"error"===s.status&&r(s.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(r){n.status="error",n.value=r}return n}function g(e){return e instanceof this?e:i.resolve(new this(o),e)}function v(e){var t=new this(o);return i.reject(t,e)}function y(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=new Array(n),s=0,c=-1,u=new this(o);++c<n;)l(e[c],c);return u;function l(e,o){function c(e){a[o]=e,++s!==n||r||(r=!0,i.resolve(u,a))}t.resolve(e).then(c,function(e){r||(r=!0,i.reject(u,e))})}}function m(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,r=!1;if(!n)return this.resolve([]);for(var a=-1,s=new this(o);++a<n;)c(e[a]);return s;function c(e){t.resolve(e).then(function(e){r||(r=!0,i.resolve(s,e))},function(e){r||(r=!0,i.reject(s,e))})}}t.exports=u,u.prototype.catch=function(e){return this.then(null,e)},u.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===a)return this;var n=new this.constructor(o);return this.state!==c?f(n,this.state===s?e:t,this.outcome):this.queue.push(new l(n,e,t)),n},l.prototype.callFulfilled=function(e){i.resolve(this.promise,e)},l.prototype.otherCallFulfilled=function(e){f(this.promise,this.onFulfilled,e)},l.prototype.callRejected=function(e){i.reject(this.promise,e)},l.prototype.otherCallRejected=function(e){f(this.promise,this.onRejected,e)},i.resolve=function(e,t){var n=p(d,t);if("error"===n.status)return i.reject(e,n.value);var r=n.value;if(r)h(e,r);else{e.state=s,e.outcome=t;for(var o=-1,a=e.queue.length;++o<a;)e.queue[o].callFulfilled(t)}return e},i.reject=function(e,t){e.state=a,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},u.resolve=g,u.reject=v,u.all=y,u.race=m},{1:1}],3:[function(e,t,n){(function(t){"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}var a=i();function s(){try{if(!a||!a.open)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(n){return!1}}function c(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),r=0;r<e.length;r+=1)n.append(e[r]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var u=Promise;function l(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}function f(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function d(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function h(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var p="local-forage-detect-blob-support",g=void 0,v={},y=Object.prototype.toString,m="readonly",w="readwrite";function _(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=0;o<t;o++)r[o]=e.charCodeAt(o);return n}function b(e){return new u(function(t){var n=e.transaction(p,w),r=c([""]);n.objectStore(p).put(r,"key"),n.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)},n.oncomplete=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)}}).catch(function(){return!1})}function S(e){return"boolean"==typeof g?u.resolve(g):b(e).then(function(e){return g=e})}function k(e){var t=v[e.name],n={};n.promise=new u(function(e,t){n.resolve=e,n.reject=t}),t.deferredOperations.push(n),t.dbReady?t.dbReady=t.dbReady.then(function(){return n.promise}):t.dbReady=n.promise}function I(e){var t=v[e.name].deferredOperations.pop();if(t)return t.resolve(),t.promise}function N(e,t){var n=v[e.name].deferredOperations.pop();if(n)return n.reject(t),n.promise}function E(e,t){return new u(function(n,r){if(v[e.name]=v[e.name]||T(),e.db){if(!t)return n(e.db);k(e),e.db.close()}var o=[e.name];t&&o.push(e.version);var i=a.open.apply(a,o);t&&(i.onupgradeneeded=function(t){var n=i.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(p)}catch(r){if("ConstraintError"!==r.name)throw r;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),i.onerror=function(e){e.preventDefault(),r(i.error)},i.onsuccess=function(){var t=i.result;t.onversionchange=function(e){e.target.close()},n(t),I(e)}})}function O(e){return E(e,!1)}function x(e){return E(e,!0)}function j(e,t){if(!e.db)return!0;var n=!e.db.objectStoreNames.contains(e.storeName),r=e.version<e.db.version,o=e.version>e.db.version;if(r&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),o||n){if(n){var i=e.db.version+1;i>e.version&&(e.version=i)}return!0}return!1}function R(e){return new u(function(t,n){var r=new FileReader;r.onerror=n,r.onloadend=function(n){var r=btoa(n.target.result||"");t({__local_forage_encoded_blob:!0,data:r,type:e.type})},r.readAsBinaryString(e)})}function C(e){return c([_(atob(e.data))],{type:e.type})}function D(e){return e&&e.__local_forage_encoded_blob}function P(e){var t=this,n=t._initReady().then(function(){var e=v[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady});return f(n,e,e),n}function A(e){k(e);for(var t=v[e.name],n=t.forages,r=0;r<n.length;r++){var o=n[r];o._dbInfo.db&&(o._dbInfo.db.close(),o._dbInfo.db=null)}return e.db=null,O(e).then(function(t){return e.db=t,j(e)?x(e):t}).then(function(r){e.db=t.db=r;for(var o=0;o<n.length;o++)n[o]._dbInfo.db=r}).catch(function(t){throw N(e,t),t})}function L(e,t,n,r){void 0===r&&(r=1);try{var o=e.db.transaction(e.storeName,t);n(null,o)}catch(i){if(r>0&&(!e.db||"InvalidStateError"===i.name||"NotFoundError"===i.name))return u.resolve().then(function(){if(!e.db||"NotFoundError"===i.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),x(e)}).then(function(){return A(e).then(function(){L(e,t,n,r-1)})}).catch(n);n(i)}}function T(){return{forages:[],db:null,dbReady:null,deferredOperations:[]}}function B(e){var t=this,n={db:null};if(e)for(var r in e)n[r]=e[r];var o=v[n.name];o||(o=T(),v[n.name]=o),o.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=P);var i=[];function a(){return u.resolve()}for(var s=0;s<o.forages.length;s++){var c=o.forages[s];c!==t&&i.push(c._initReady().catch(a))}var l=o.forages.slice(0);return u.all(i).then(function(){return n.db=o.db,O(n)}).then(function(e){return n.db=e,j(n,t._defaultConfig.version)?x(n):e}).then(function(e){n.db=o.db=e,t._dbInfo=n;for(var r=0;r<l.length;r++){var i=l[r];i!==t&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})}function U(e,t){var n=this;e=d(e);var r=new u(function(t,r){n.ready().then(function(){L(n._dbInfo,m,function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).get(e);a.onsuccess=function(){var e=a.result;void 0===e&&(e=null),D(e)&&(e=C(e)),t(e)},a.onerror=function(){r(a.error)}}catch(s){r(s)}})}).catch(r)});return l(r,t),r}function z(e,t){var n=this,r=new u(function(t,r){n.ready().then(function(){L(n._dbInfo,m,function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).openCursor(),s=1;a.onsuccess=function(){var n=a.result;if(n){var r=n.value;D(r)&&(r=C(r));var o=e(r,n.key,s++);void 0!==o?t(o):n.continue()}else t()},a.onerror=function(){r(a.error)}}catch(c){r(c)}})}).catch(r)});return l(r,t),r}function J(e,t,n){var r=this;e=d(e);var o=new u(function(n,o){var i;r.ready().then(function(){return i=r._dbInfo,"[object Blob]"===y.call(t)?S(i.db).then(function(e){return e?t:R(t)}):t}).then(function(t){L(r._dbInfo,w,function(i,a){if(i)return o(i);try{var s=a.objectStore(r._dbInfo.storeName);null===t&&(t=void 0);var c=s.put(t,e);a.oncomplete=function(){void 0===t&&(t=null),n(t)},a.onabort=a.onerror=function(){var e=c.error?c.error:c.transaction.error;o(e)}}catch(u){o(u)}})}).catch(o)});return l(o,n),o}function F(e,t){var n=this;e=d(e);var r=new u(function(t,r){n.ready().then(function(){L(n._dbInfo,w,function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName).delete(e);i.oncomplete=function(){t()},i.onerror=function(){r(a.error)},i.onabort=function(){var e=a.error?a.error:a.transaction.error;r(e)}}catch(s){r(s)}})}).catch(r)});return l(r,t),r}function M(e){var t=this,n=new u(function(e,n){t.ready().then(function(){L(t._dbInfo,w,function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).clear();o.oncomplete=function(){e()},o.onabort=o.onerror=function(){var e=i.error?i.error:i.transaction.error;n(e)}}catch(a){n(a)}})}).catch(n)});return l(n,e),n}function $(e){var t=this,n=new u(function(e,n){t.ready().then(function(){L(t._dbInfo,m,function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).count();i.onsuccess=function(){e(i.result)},i.onerror=function(){n(i.error)}}catch(a){n(a)}})}).catch(n)});return l(n,e),n}function q(e,t){var n=this,r=new u(function(t,r){e<0?t(null):n.ready().then(function(){L(n._dbInfo,m,function(o,i){if(o)return r(o);try{var a=i.objectStore(n._dbInfo.storeName),s=!1,c=a.openKeyCursor();c.onsuccess=function(){var n=c.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},c.onerror=function(){r(c.error)}}catch(u){r(u)}})}).catch(r)});return l(r,t),r}function W(e){var t=this,n=new u(function(e,n){t.ready().then(function(){L(t._dbInfo,m,function(r,o){if(r)return n(r);try{var i=o.objectStore(t._dbInfo.storeName).openKeyCursor(),a=[];i.onsuccess=function(){var t=i.result;t?(a.push(t.key),t.continue()):e(a)},i.onerror=function(){n(i.error)}}catch(s){n(s)}})}).catch(n)});return l(n,e),n}function K(e,t){t=h.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;if(e.name){var i=e.name===n.name&&o._dbInfo.db?u.resolve(o._dbInfo.db):O(e).then(function(t){var n=v[e.name],r=n.forages;n.db=t;for(var o=0;o<r.length;o++)r[o]._dbInfo.db=t;return t});r=e.storeName?i.then(function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;k(e);var r=v[e.name],o=r.forages;t.close();for(var i=0;i<o.length;i++){var s=o[i];s._dbInfo.db=null,s._dbInfo.version=n}return new u(function(t,r){var o=a.open(e.name,n);o.onerror=function(e){o.result.close(),r(e)},o.onupgradeneeded=function(){o.result.deleteObjectStore(e.storeName)},o.onsuccess=function(){var e=o.result;e.close(),t(e)}}).then(function(e){r.db=e;for(var t=0;t<o.length;t++){var n=o[t];n._dbInfo.db=e,I(n._dbInfo)}}).catch(function(t){throw(N(e,t)||u.resolve()).catch(function(){}),t})}}):i.then(function(t){k(e);var n=v[e.name],r=n.forages;t.close();for(var o=0;o<r.length;o++)r[o]._dbInfo.db=null;return new u(function(t,n){var r=a.deleteDatabase(e.name);r.onerror=function(){var e=r.result;e&&e.close(),n(r.error)},r.onblocked=function(){console.warn('dropInstance blocked for database "'+e.name+'" until all open connections are closed')},r.onsuccess=function(){var e=r.result;e&&e.close(),t(e)}}).then(function(e){n.db=e;for(var t=0;t<r.length;t++)I(r[t]._dbInfo)}).catch(function(t){throw(N(e,t)||u.resolve()).catch(function(){}),t})})}else r=u.reject("Invalid arguments");return l(r,t),r}var V={_driver:"asyncStorage",_initStorage:B,_support:s(),iterate:z,getItem:U,setItem:J,removeItem:F,clear:M,length:$,key:q,keys:W,dropInstance:K};function Q(){return"function"==typeof openDatabase}var X="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",H="~~local_forage_type~",Y=/^~~local_forage_type~([^~]+)~/,G="__lfsc__:",Z=G.length,ee="arbf",te="blob",ne="si08",re="ui08",oe="uic8",ie="si16",ae="si32",se="ur16",ce="ui32",ue="fl32",le="fl64",fe=Z+ee.length,de=Object.prototype.toString;function he(e){var t,n,r,o,i,a=.75*e.length,s=e.length,c=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<s;t+=4)n=X.indexOf(e[t]),r=X.indexOf(e[t+1]),o=X.indexOf(e[t+2]),i=X.indexOf(e[t+3]),l[c++]=n<<2|r>>4,l[c++]=(15&r)<<4|o>>2,l[c++]=(3&o)<<6|63&i;return u}function pe(e){var t,n=new Uint8Array(e),r="";for(t=0;t<n.length;t+=3)r+=X[n[t]>>2],r+=X[(3&n[t])<<4|n[t+1]>>4],r+=X[(15&n[t+1])<<2|n[t+2]>>6],r+=X[63&n[t+2]];return n.length%3==2?r=r.substring(0,r.length-1)+"=":n.length%3==1&&(r=r.substring(0,r.length-2)+"=="),r}function ge(e,t){var n="";if(e&&(n=de.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===de.call(e.buffer))){var r,o=G;e instanceof ArrayBuffer?(r=e,o+=ee):(r=e.buffer,"[object Int8Array]"===n?o+=ne:"[object Uint8Array]"===n?o+=re:"[object Uint8ClampedArray]"===n?o+=oe:"[object Int16Array]"===n?o+=ie:"[object Uint16Array]"===n?o+=se:"[object Int32Array]"===n?o+=ae:"[object Uint32Array]"===n?o+=ce:"[object Float32Array]"===n?o+=ue:"[object Float64Array]"===n?o+=le:t(new Error("Failed to get type for BinaryArray"))),t(o+pe(r))}else if("[object Blob]"===n){var i=new FileReader;i.onload=function(){var n=H+e.type+"~"+pe(this.result);t(G+te+n)},i.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(a){console.error("Couldn't convert value into a JSON string: ",e),t(null,a)}}function ve(e){if(e.substring(0,Z)!==G)return JSON.parse(e);var t,n=e.substring(fe),r=e.substring(Z,fe);if(r===te&&Y.test(n)){var o=n.match(Y);t=o[1],n=n.substring(o[0].length)}var i=he(n);switch(r){case ee:return i;case te:return c([i],{type:t});case ne:return new Int8Array(i);case re:return new Uint8Array(i);case oe:return new Uint8ClampedArray(i);case ie:return new Int16Array(i);case se:return new Uint16Array(i);case ae:return new Int32Array(i);case ce:return new Uint32Array(i);case ue:return new Float32Array(i);case le:return new Float64Array(i);default:throw new Error("Unkown type: "+r)}}var ye={serialize:ge,deserialize:ve,stringToBuffer:he,bufferToString:pe};function me(e,t,n,r){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,r)}function we(e){var t=this,n={db:null};if(e)for(var r in e)n[r]="string"!=typeof e[r]?e[r].toString():e[r];var o=new u(function(e,r){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(o){return r(o)}n.db.transaction(function(o){me(o,n,function(){t._dbInfo=n,e()},function(e,t){r(t)})},r)});return n.serializer=ye,o}function _e(e,t,n,r,o,i){e.executeSql(n,r,o,function(e,a){a.code===a.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],function(e,s){s.rows.length?i(e,a):me(e,t,function(){e.executeSql(n,r,o,i)},i)},i):i(e,a)},i)}function be(e,t){var n=this;e=d(e);var r=new u(function(t,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){_e(n,o,"SELECT * FROM "+o.storeName+" WHERE key = ? LIMIT 1",[e],function(e,n){var r=n.rows.length?n.rows.item(0).value:null;r&&(r=o.serializer.deserialize(r)),t(r)},function(e,t){r(t)})})}).catch(r)});return l(r,t),r}function Se(e,t){var n=this,r=new u(function(t,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){_e(n,o,"SELECT * FROM "+o.storeName,[],function(n,r){for(var i=r.rows,a=i.length,s=0;s<a;s++){var c=i.item(s),u=c.value;if(u&&(u=o.serializer.deserialize(u)),void 0!==(u=e(u,c.key,s+1)))return void t(u)}t()},function(e,t){r(t)})})}).catch(r)});return l(r,t),r}function ke(e,t,n,r){var o=this;e=d(e);var i=new u(function(i,a){o.ready().then(function(){void 0===t&&(t=null);var s=t,c=o._dbInfo;c.serializer.serialize(t,function(t,u){u?a(u):c.db.transaction(function(n){_e(n,c,"INSERT OR REPLACE INTO "+c.storeName+" (key, value) VALUES (?, ?)",[e,t],function(){i(s)},function(e,t){a(t)})},function(t){if(t.code===t.QUOTA_ERR){if(r>0)return void i(ke.apply(o,[e,s,n,r-1]));a(t)}})})}).catch(a)});return l(i,n),i}function Ie(e,t,n){return ke.apply(this,[e,t,n,1])}function Ne(e,t){var n=this;e=d(e);var r=new u(function(t,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){_e(n,o,"DELETE FROM "+o.storeName+" WHERE key = ?",[e],function(){t()},function(e,t){r(t)})})}).catch(r)});return l(r,t),r}function Ee(e){var t=this,n=new u(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){_e(t,r,"DELETE FROM "+r.storeName,[],function(){e()},function(e,t){n(t)})})}).catch(n)});return l(n,e),n}function Oe(e){var t=this,n=new u(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){_e(t,r,"SELECT COUNT(key) as c FROM "+r.storeName,[],function(t,n){var r=n.rows.item(0).c;e(r)},function(e,t){n(t)})})}).catch(n)});return l(n,e),n}function xe(e,t){var n=this,r=new u(function(t,r){n.ready().then(function(){var o=n._dbInfo;o.db.transaction(function(n){_e(n,o,"SELECT key FROM "+o.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,n){var r=n.rows.length?n.rows.item(0).key:null;t(r)},function(e,t){r(t)})})}).catch(r)});return l(r,t),r}function je(e){var t=this,n=new u(function(e,n){t.ready().then(function(){var r=t._dbInfo;r.db.transaction(function(t){_e(t,r,"SELECT key FROM "+r.storeName,[],function(t,n){for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o).key);e(r)},function(e,t){n(t)})})}).catch(n)});return l(n,e),n}function Re(e){return new u(function(t,n){e.transaction(function(r){r.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],function(n,r){for(var o=[],i=0;i<r.rows.length;i++)o.push(r.rows.item(i).name);t({db:e,storeNames:o})},function(e,t){n(t)})},function(e){n(e)})})}function Ce(e,t){t=h.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var r,o=this;return l(r=e.name?new u(function(t){var r;r=e.name===n.name?o._dbInfo.db:openDatabase(e.name,"","",0),e.storeName?t({db:r,storeNames:[e.storeName]}):t(Re(r))}).then(function(e){return new u(function(t,n){e.db.transaction(function(r){function o(e){return new u(function(t,n){r.executeSql("DROP TABLE IF EXISTS "+e,[],function(){t()},function(e,t){n(t)})})}for(var i=[],a=0,s=e.storeNames.length;a<s;a++)i.push(o(e.storeNames[a]));u.all(i).then(function(){t()}).catch(function(e){n(e)})},function(e){n(e)})})}):u.reject("Invalid arguments"),t),r}var De={_driver:"webSQLStorage",_initStorage:we,_support:Q(),iterate:Se,getItem:be,setItem:Ie,removeItem:Ne,clear:Ee,length:Oe,key:xe,keys:je,dropInstance:Ce};function Pe(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}function Ae(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Le(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),localStorage.removeItem(e),!1}catch(t){return!0}}function Te(){return!Le()||localStorage.length>0}function Be(e){var t=this,n={};if(e)for(var r in e)n[r]=e[r];return n.keyPrefix=Ae(e,t._defaultConfig),Te()?(t._dbInfo=n,n.serializer=ye,u.resolve()):u.reject()}function Ue(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;n>=0;n--){var r=localStorage.key(n);0===r.indexOf(e)&&localStorage.removeItem(r)}});return l(n,e),n}function ze(e,t){var n=this;e=d(e);var r=n.ready().then(function(){var t=n._dbInfo,r=localStorage.getItem(t.keyPrefix+e);return r&&(r=t.serializer.deserialize(r)),r});return l(r,t),r}function Je(e,t){var n=this,r=n.ready().then(function(){for(var t=n._dbInfo,r=t.keyPrefix,o=r.length,i=localStorage.length,a=1,s=0;s<i;s++){var c=localStorage.key(s);if(0===c.indexOf(r)){var u=localStorage.getItem(c);if(u&&(u=t.serializer.deserialize(u)),void 0!==(u=e(u,c.substring(o),a++)))return u}}});return l(r,t),r}function Fe(e,t){var n=this,r=n.ready().then(function(){var t,r=n._dbInfo;try{t=localStorage.key(e)}catch(o){t=null}return t&&(t=t.substring(r.keyPrefix.length)),t});return l(r,t),r}function Me(e){var t=this,n=t.ready().then(function(){for(var e=t._dbInfo,n=localStorage.length,r=[],o=0;o<n;o++){var i=localStorage.key(o);0===i.indexOf(e.keyPrefix)&&r.push(i.substring(e.keyPrefix.length))}return r});return l(n,e),n}function $e(e){var t=this.keys().then(function(e){return e.length});return l(t,e),t}function qe(e,t){var n=this;e=d(e);var r=n.ready().then(function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)});return l(r,t),r}function We(e,t,n){var r=this;e=d(e);var o=r.ready().then(function(){void 0===t&&(t=null);var n=t;return new u(function(o,i){var a=r._dbInfo;a.serializer.serialize(t,function(t,r){if(r)i(r);else try{localStorage.setItem(a.keyPrefix+e,t),o(n)}catch(s){"QuotaExceededError"!==s.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==s.name||i(s),i(s)}})})});return l(o,n),o}function Ke(e,t){if(t=h.apply(this,arguments),!(e="function"!=typeof e&&e||{}).name){var n=this.config();e.name=e.name||n.name,e.storeName=e.storeName||n.storeName}var r,o=this;return l(r=e.name?new u(function(t){e.storeName?t(Ae(e,o._defaultConfig)):t(e.name+"/")}).then(function(e){for(var t=localStorage.length-1;t>=0;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}}):u.reject("Invalid arguments"),t),r}var Ve={_driver:"localStorageWrapper",_initStorage:Be,_support:Pe(),iterate:Je,getItem:ze,setItem:We,removeItem:qe,clear:Ue,length:$e,key:Fe,keys:Me,dropInstance:Ke},Qe=function(e,t){return e===t||"number"==typeof e&&"number"==typeof t&&isNaN(e)&&isNaN(t)},Xe=function(e,t){for(var n=e.length,r=0;r<n;){if(Qe(e[r],t))return!0;r++}return!1},He=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},Ye={},Ge={},Ze={INDEXEDDB:V,WEBSQL:De,LOCALSTORAGE:Ve},et=[Ze.INDEXEDDB._driver,Ze.WEBSQL._driver,Ze.LOCALSTORAGE._driver],tt=["dropInstance"],nt=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(tt),rt={description:"",driver:et.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ot(e,t){e[t]=function(){var n=arguments;return e.ready().then(function(){return e[t].apply(e,n)})}}function it(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var n in t)t.hasOwnProperty(n)&&(He(t[n])?arguments[0][n]=t[n].slice():arguments[0][n]=t[n])}return arguments[0]}var at=function(){function e(t){for(var n in o(this,e),Ze)if(Ze.hasOwnProperty(n)){var r=Ze[n],i=r._driver;this[n]=i,Ye[i]||this.defineDriver(r)}this._defaultConfig=it({},rt),this._config=it({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch(function(){})}return e.prototype.config=function(e){if("object"===(void 0===e?"undefined":r(e))){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e)||!e.driver||this.setDriver(this._config.driver)}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,n){var r=new u(function(t,n){try{var r=e._driver,o=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(o);for(var i=nt.concat("_initStorage"),a=0,s=i.length;a<s;a++){var c=i[a];if((!Xe(tt,c)||e[c])&&"function"!=typeof e[c])return void n(o)}var f=function(){for(var t=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver"),n=u.reject(t);return l(n,arguments[arguments.length-1]),n}},n=0,r=tt.length;n<r;n++){var o=tt[n];e[o]||(e[o]=t(o))}};f();var d=function(n){Ye[r]&&console.info("Redefining LocalForage driver: "+r),Ye[r]=e,Ge[r]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(d,n):d(!!e._support):d(!0)}catch(h){n(h)}});return f(r,t,n),r},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var r=Ye[e]?u.resolve(Ye[e]):u.reject(new Error("Driver not found."));return f(r,t,n),r},e.prototype.getSerializer=function(e){var t=u.resolve(ye);return f(t,e),t},e.prototype.ready=function(e){var t=this,n=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return f(n,e,e),n},e.prototype.setDriver=function(e,t,n){var r=this;He(e)||(e=[e]);var o=this._getSupportedDrivers(e);function i(){r._config.driver=r.driver()}function a(e){return r._extend(e),i(),r._ready=r._initStorage(r._config),r._ready}function s(e){return function(){var t=0;function n(){for(;t<e.length;){var o=e[t];return t++,r._dbInfo=null,r._ready=null,r.getDriver(o).then(a).catch(n)}i();var s=new Error("No available storage method found.");return r._driverSet=u.reject(s),r._driverSet}return n()}}var c=null!==this._driverSet?this._driverSet.catch(function(){return u.resolve()}):u.resolve();return this._driverSet=c.then(function(){var e=o[0];return r._dbInfo=null,r._ready=null,r.getDriver(e).then(function(e){r._driver=e._driver,i(),r._wrapLibraryMethodsWithReady(),r._initDriver=s(o)})}).catch(function(){i();var e=new Error("No available storage method found.");return r._driverSet=u.reject(e),r._driverSet}),f(this._driverSet,t,n),this._driverSet},e.prototype.supports=function(e){return!!Ge[e]},e.prototype._extend=function(e){it(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var o=e[n];this.supports(o)&&t.push(o)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=nt.length;e<t;e++)ot(this,nt[e])},e.prototype.createInstance=function(t){return new e(t)},e}(),st=new at;t.exports=st},{3:3}]},{},[4])(4)),ie.exports)),se={id:"@jupyterlite/server-extension:localforage",autoStart:!0,provides:F,activate:e=>({localforage:ae})},ce={id:"@jupyterlite/server-extension:localforage-memory-storage",autoStart:!0,requires:[F],activate:async(t,n)=>{JSON.parse(e.PageConfig.getOption("enableMemoryStorage")||"false")&&(console.warn("Memory storage fallback enabled: contents and settings may not be saved"),await async function(e){return await e.defineDriver(W)}(n.localforage))}},ue={id:"@jupyterlite/server-extension:service-worker",autoStart:!0,provides:m,activate:e=>new I},le=[{id:"@jupyterlite/server-extension:config-section-routes",autoStart:!0,activate:e=>{const t={};e.router.get("/api/config/(.*)",async(e,n)=>{const r=t[n]??JSON.stringify({});return new Response(r)}),e.router.patch("/api/config/(.*)",async(e,n)=>{const r=e.body;return t[n]=r,new Response(r)})}},{id:"@jupyterlite/server-extension:contents",requires:[F],autoStart:!0,provides:v,activate:(t,n)=>{const r=e.PageConfig.getOption("contentsStorageName"),o=JSON.parse(e.PageConfig.getOption("contentsStorageDrivers")||"null"),{localforage:i}=n,a=new x({storageName:r,storageDrivers:o,localforage:i});return t.started.then(()=>a.initialize().catch(console.warn)),a}},{id:"@jupyterlite/server-extension:contents-routes",autoStart:!0,requires:[v],activate:(e,t)=>{e.router.get("/api/contents/(.+)/checkpoints",async(e,n)=>{const r=await t.listCheckpoints(n);return new Response(JSON.stringify(r))}),e.router.post("/api/contents/(.+)/checkpoints/(.*)",async(e,n,r)=>{const o=await t.restoreCheckpoint(n,r);return new Response(JSON.stringify(o),{status:204})}),e.router.post("/api/contents/(.+)/checkpoints",async(e,n)=>{const r=await t.createCheckpoint(n);return new Response(JSON.stringify(r),{status:201})}),e.router.delete("/api/contents/(.+)/checkpoints/(.*)",async(e,n,r)=>{const o=await t.deleteCheckpoint(n,r);return new Response(JSON.stringify(o),{status:204})}),e.router.get("/api/contents(.*)",async(e,n)=>{const r={content:"1"===e.query?.content},o=await t.get(n,r);return o?new Response(JSON.stringify(o)):new Response(null,{status:404})}),e.router.post("/api/contents(.*)",async(e,n)=>{const r=e.body,o=r?.copy_from;let i;return i=o?await t.copy(o,n):await t.newUntitled(r),i?new Response(JSON.stringify(i),{status:201}):new Response(null,{status:400})}),e.router.patch("/api/contents(.*)",async(e,n)=>{const r=e.body?.path??"";n="/"===n[0]?n.slice(1):n;const o=await t.rename(n,r);return new Response(JSON.stringify(o))}),e.router.put("/api/contents/(.+)",async(e,n)=>{const r=e.body,o=await t.save(n,r);return new Response(JSON.stringify(o))}),e.router.delete("/api/contents/(.+)",async(e,n)=>(await t.delete(n),new Response(null,{status:204})))}},{id:"@jupyterlite/server-extension:emscripten-filesystem",autoStart:!0,optional:[m],provides:y,activate:(e,t)=>{const{contents:n}=e.serviceManager,r=new R({contents:n}),o="Kernel filesystem and JupyterLite contents";function i(e,t){t&&console.warn(t),e&&console.warn(e),t||e?console.warn(`${o} will NOT be synced`):console.info(`${o} will be synced`)}return t?t.ready.then(()=>{r.enable(),i()}).catch(e=>{i("JupyterLite ServiceWorker failed to become available",e)}):i("JupyterLite ServiceWorker not available"),r}},{id:"@jupyterlite/server-extension:kernels",autoStart:!0,provides:_,requires:[w],activate:(e,t)=>new z({kernelspecs:t})},{id:"@jupyterlite/server-extension:kernels-routes",autoStart:!0,requires:[_],activate:(e,t)=>{e.router.get("/api/kernels",async e=>{const n=await t.list();return new Response(JSON.stringify(n))}),e.router.post("/api/kernels",async e=>{const n=e.body.name??"python",r=await t.startNew({id:"123",name:n,location:"/"});return new Response(JSON.stringify(r))}),e.router.post("/api/kernels/(.*)/restart",async(e,n)=>{const r=await t.restart(n);return new Response(JSON.stringify(r))}),e.router.delete("/api/kernels/(.*)",async(e,n)=>{const r=await t.shutdown(n);return new Response(JSON.stringify(r),{status:204})})}},{id:"@jupyterlite/server-extension:kernelspec",autoStart:!0,provides:w,activate:e=>new J},{id:"@jupyterlite/server-extension:kernelspec-routes",autoStart:!0,requires:[w],activate:(e,t)=>{e.router.get("/api/kernelspecs",async e=>{const{specs:n}=t;if(!n)return new Response(null);const r={},o=n.kernelspecs;Object.keys(o).forEach(e=>{const t=o[e],{resources:n}=t??{};r[e]={name:e,spec:t,resources:n}});const i={default:n.default,kernelspecs:r};return new Response(JSON.stringify(i))})}},{id:"@jupyterlite/server-extension:licenses",autoStart:!0,provides:X,activate:e=>new Y},{id:"@jupyterlite/server-extension:licenses-routes",autoStart:!0,requires:[X],activate(e,t){e.router.get("/api/licenses",async e=>{const n=await t.get();return new Response(JSON.stringify(n))})}},ce,se,{id:"@jupyterlite/server-extension:lsp-routes",autoStart:!0,activate:e=>{e.router.get("/lsp/status",async e=>new Response(JSON.stringify({version:2,sessions:{},specs:{}})))}},{id:"@jupyterlite/server-extension:nbconvert-routes",autoStart:!0,activate:e=>{e.router.get("/api/nbconvert",async e=>new Response(JSON.stringify({})))}},ue,{id:"@jupyterlite/server-extension:sessions",autoStart:!0,provides:K,requires:[_],activate:(e,t)=>new V({kernels:t})},{id:"@jupyterlite/server-extension:sessions-routes",autoStart:!0,requires:[K],activate:(e,t)=>{e.router.get("/api/sessions/(.+)",async(e,n)=>{const r=await t.get(n);return new Response(JSON.stringify(r),{status:200})}),e.router.get("/api/sessions",async e=>{const n=await t.list();return new Response(JSON.stringify(n),{status:200})}),e.router.patch("/api/sessions(.*)",async(e,n)=>{const r=e.body,o=await t.patch(r);return new Response(JSON.stringify(o),{status:200})}),e.router.delete("/api/sessions/(.+)",async(e,n)=>(await t.shutdown(n),new Response(null,{status:204}))),e.router.post("/api/sessions",async e=>{const n=e.body,r=await t.startNew(n);return new Response(JSON.stringify(r),{status:201})})}},{id:"@jupyterlite/server-extension:settings",autoStart:!0,requires:[F],provides:te,activate:(t,n)=>{const r=e.PageConfig.getOption("settingsStorageName"),o=JSON.parse(e.PageConfig.getOption("settingsStorageDrivers")||"null"),{localforage:i}=n,a=new Z({storageName:r,storageDrivers:o,localforage:i});return t.started.then(()=>a.initialize().catch(console.warn)),a}},{id:"@jupyterlite/server-extension:settings-routes",autoStart:!0,requires:[te],activate:(e,t)=>{const n="/api/settings/((?:@([^/]+?)[/])?([^/]+?):([^:]+))$";e.router.get(n,async(e,n)=>{const r=await t.get(n);return new Response(JSON.stringify(r))}),e.router.put(n,async(e,n)=>{const r=e.body,{raw:o}=r;return await t.save(n,o),new Response(null,{status:204})}),e.router.get("/api/settings",async e=>{const n=await t.getAll();return new Response(JSON.stringify(n))})}},{id:"@jupyterlite/server-extension:translation",autoStart:!0,provides:re,activate:e=>{const t=new ne;return e.router.get("/api/translations/?(.*)",async(e,n)=>{"default"===n&&(n="en");const r=await t.get(n||"all");return new Response(JSON.stringify(r))}),t}},{id:"@jupyterlite/server-extension:translation-routes",autoStart:!0,requires:[re],activate:(e,t)=>{e.router.get("/api/translations/?(.*)",async(e,n)=>{const r=await t.get(n||"all");return new Response(JSON.stringify(r))})}}];export{le as default};
//# sourceMappingURL=index-DalesL42.js.map
