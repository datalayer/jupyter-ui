import{a as e,j as t}from"./vendor-react-Bc3S_DuI.js";import{getJupyterEmbedConfig as s}from"../jupyter-embed.lazy.js";import{u as n}from"./JupyterUse-0A4JMZk-.js";import{R as o,L as i}from"./Lumino-D6-gHQxh.js";import{a5 as r,a6 as l,j as a,t as d,W as c,n as h,a7 as u,a8 as p,a9 as m,aa as _,g as C,d as g,ab as f,ac as y,ad as v,ae as x,e as w,k as b,f as P,af as F,l as S,ag as E,_ as j,H as D,ah as k,ai as I,a2 as M,a0 as z,m as R,E as L,s as T,a as O,y as B,aj as A,J as K}from"./JupyterReactTheme-CX3WbnDJ.js";import{C as N}from"./factory-BucVdXsD.js";import{C as W}from"./mimetype-WrG96ErW.js";import"./vendor-codemirror-OzOnFEf0.js";const q="jp-dragImage",H="jp-dragImage-singlePrompt",U="jp-dragImage-content",$="jp-dragImage-prompt",J="jp-dragImage-multipleBack";var X,Y,G;async function V({cell:e,onCellExecuted:t,sessionContext:s}){return a.execute(e,s).then(s=>{if(s&&"ok"===s.content.status){const n=s.content;if(n.payload&&n.payload.length){const t=n.payload.filter(e=>"set_next_input"===e.source)[0];if(t){const s=t.text;e.model.sharedModel.setSource(s)}}return t({cell:e,executionDate:/* @__PURE__ */new Date,success:!0}),!0}if(s&&"error"===s.content.status){const n=s.content.ename,o=s.content.evalue;return t({cell:e,executionDate:/* @__PURE__ */new Date,success:!1,error:new Error(`KernelReplyNotOK: ${n} ${o}`)}),!1}return t({cell:e,executionDate:/* @__PURE__ */new Date,success:!1}),!1},s=>(t({cell:e,executionDate:/* @__PURE__ */new Date,success:!1,error:new Error(s)}),!1))}(Y=X||(X={})).findCell=function(e,t,s){let n=-1;for(;e&&e.parentElement;){if(s(e)){let s=-1;for(const o of t)if(o.node===e){n=++s;break}break}e=e.parentElement}return n},Y.detectTargetArea=function(e,t){var s,n;let o;return o=e?(null===(s=e.editorWidget)||void 0===s?void 0:s.node.contains(t))?"input":(null===(n=e.promptNode)||void 0===n?void 0:n.contains(t))?"prompt":"cell":"unknown",o},Y.shouldStartDrag=function(e,t,s,n){const o=Math.abs(s-e),i=Math.abs(n-t);return o>=5||i>=5},Y.createCellDragImage=function(e,t){const s=t.length;let n;if("code"===e.model.type){const t=e.model.executionCount;n=" ",t&&(n=t.toString())}else n="";const o=e.model.sharedModel.getSource().split("\n")[0].slice(0,26);return s>1?""!==n?r.realize(l.div(l.div({className:q},l.span({className:$},"["+n+"]:"),l.span({className:U},o)),l.div({className:J},""))):r.realize(l.div(l.div({className:q},l.span({className:$}),l.span({className:U},o)),l.div({className:J},""))):""!==n?r.realize(l.div(l.div({className:`${q} ${H}`},l.span({className:$},"["+n+"]:"),l.span({className:U},o)))):r.realize(l.div(l.div({className:`${q} ${H}`},l.span({className:$}),l.span({className:U},o))))};class Q{constructor(e){this._cursor=0,this._hasSession=!1,this._history=[],this._placeholder="",this._setByHistory=!1,this._isDisposed=!1,this._editor=null,this._filtered=[];const{sessionContext:t}=e;t&&(this.sessionContext=t,this._handleKernel(),this.sessionContext.kernelChanged.connect(this._handleKernel,this))}get editor(){return this._editor}set editor(e){if(this._editor===e)return;const t=this._editor;t&&(t.edgeRequested.disconnect(this.onEdgeRequest,this),t.model.sharedModel.changed.disconnect(this.onTextChange,this)),this._editor=e,e&&(e.edgeRequested.connect(this.onEdgeRequest,this),e.model.sharedModel.changed.connect(this.onTextChange,this))}get placeholder(){return this._placeholder}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._history.length=0,d.clearData(this)}back(e){this._hasSession||(this._hasSession=!0,this._placeholder=e,this.setFilter(e),this._cursor=this._filtered.length-1),--this._cursor,this._cursor=Math.max(0,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}forward(e){this._hasSession||(this._hasSession=!0,this._placeholder=e,this.setFilter(e),this._cursor=this._filtered.length),++this._cursor,this._cursor=Math.min(this._filtered.length-1,this._cursor);const t=this._filtered[this._cursor];return Promise.resolve(t)}push(e){e&&e!==this._history[this._history.length-1]&&this._history.push(e),this.reset()}reset(){this._cursor=this._history.length,this._hasSession=!1,this._placeholder=""}onHistory(e){this._history.length=0;let t="",s="";if("ok"===e.content.status)for(let n=0;n<e.content.history.length;n++)s=e.content.history[n][2],s!==t&&this._history.push(t=s);this._cursor=this._history.length}onTextChange(){this._setByHistory?this._setByHistory=!1:this.reset()}onEdgeRequest(e,t){const s=e.model.sharedModel,n=s.getSource();"top"===t||"topLine"===t?this.back(n).then(t=>{if(this.isDisposed||!t)return;if(s.getSource()===t)return;this._setByHistory=!0,s.setSource(t);let n=0;n=t.indexOf("\n"),n<0&&(n=t.length),e.setCursorPosition({line:0,column:n})}):this.forward(n).then(t=>{if(this.isDisposed)return;const n=t||this.placeholder;if(s.getSource()===n)return;this._setByHistory=!0,s.setSource(n);const o=e.getPositionAt(n.length);o&&e.setCursorPosition(o)})}async _handleKernel(){var e,t;const s=null===(t=null===(e=this.sessionContext)||void 0===e?void 0:e.session)||void 0===t?void 0:t.kernel;if(s)return s.requestHistory(G.initialRequest).then(e=>{this.onHistory(e)});this._history.length=0}setFilter(e=""){this._filtered.length=0;let t="",s="";for(let n=0;n<this._history.length;n++)s=this._history[n],s!==t&&e===s.slice(0,e.length)&&this._filtered.push(t=s);this._filtered.push(e)}}(G||(G={})).initialRequest={output:!1,raw:!0,hist_access_type:"tail",n:500};const Z="jp-Console-cell",ee="jp-CodeConsole-promptCell";class te extends c{constructor(e){var t,s,n;super(),this.editorConfig=te.defaultEditorConfig,this._banner=null,this._executed=new d(this),this._config={},this._mimetype="text/x-ipython",this._msgIds=/* @__PURE__ */new Map,this._msgIdCells=/* @__PURE__ */new Map,this._promptCellCreated=new d(this),this._dragData=null,this._drag=null,this._focusedCell=null,this._promptResizeObserver=null,this._hasManualResize=!1,this._resizeAnimationFrameId=null,this._translator=null!==(t=e.translator)&&void 0!==t?t:h,this._executor=null!==(s=e.executor)&&void 0!==s?s:Object.freeze({runCell:V}),this.addClass("jp-CodeConsole"),this.node.dataset.jpKernelUser="true",this.node.dataset.jpCodeRunner="true",this.node.dataset.jpUndoer="true",this.node.tabIndex=-1;const o=this.layout=new u;this._cells=new p,this._content=new m,this._input=new m,this._splitPanel=new _({spacing:0}),this._splitPanel.addClass("jp-CodeConsole-split"),this.contentFactory=e.contentFactory,this.modelFactory=null!==(n=e.modelFactory)&&void 0!==n?n:te.defaultModelFactory,this.rendermime=e.rendermime,this.sessionContext=e.sessionContext,this._mimeTypeService=e.mimeTypeService,this._content.addClass("jp-CodeConsole-content"),this._input.addClass("jp-CodeConsole-input"),o.addWidget(this._splitPanel),this._splitPanel.handleMoved.connect(()=>{this._setManualResize()},this),this._splitPanel.node.addEventListener("pointerdown",e=>{e.target.classList.contains("lm-SplitPanel-handle")&&this._setManualResize()},!0),this.setConfig({clearCellsOnExecute:!1,clearCodeContentOnExecute:!0,hideCodeInput:!1,promptCellPosition:"bottom",showBanner:!0}),this._history=new Q({sessionContext:this.sessionContext}),this._onKernelChanged(),this.sessionContext.kernelChanged.connect(this._onKernelChanged,this),this.sessionContext.statusChanged.connect(this._onKernelStatusChanged,this)}get executed(){return this._executed}get promptCellCreated(){return this._promptCellCreated}get cells(){return this._cells}get promptCell(){const e=this._input.layout;return e&&e.widgets[0]||null}addCell(e,t){this._config.clearCellsOnExecute&&this.clear(),e.addClass(Z),this._content.addWidget(e),this._cells.push(e),t&&(this._msgIds.set(t,e),this._msgIdCells.set(e,t)),e.disposed.connect(this._onCellDisposed,this),this.update()}addBanner(){if(this._banner){const e=this._banner;this._cells.push(this._banner),e.disposed.connect(this._onCellDisposed,this)}const e=this.modelFactory.createRawCell({sharedModel:C({cell_type:"raw",source:"..."})}),t=(this._banner=new g({model:e,contentFactory:this.contentFactory,placeholder:!1,editorConfig:{autoClosingBrackets:!1,codeFolding:!1,highlightActiveLine:!1,highlightTrailingWhitespace:!1,highlightWhitespace:!1,indentUnit:"4",lineNumbers:!1,lineWrap:!0,matchBrackets:!1,readOnly:!0,rulers:[],scrollPastEnd:!1,smartIndent:!1,tabSize:4,theme:"jupyter"}})).initializeState();t.addClass("jp-CodeConsole-banner"),t.readOnly=!0,this._content.addWidget(t)}clear(){const e=this._cells;for(;e.length>0;)e.get(0).dispose()}createCodeCell(){const e=this.contentFactory,t=this._createCodeCellOptions(),s=e.createCodeCell(t);return s.readOnly=!0,s.model.mimeType=this._mimetype,s}dispose(){if(this.isDisposed)return;const e=this.promptCell;e&&(this._promptResizeObserver&&(this._promptResizeObserver.disconnect(),this._promptResizeObserver=null),e.model.sharedModel.changed.disconnect(this._onPromptContentChanged,this)),this._cancelPendingResizeAdjustment(),this._msgIdCells=null,this._msgIds=null,this._history.dispose(),super.dispose()}async execute(e=!1,t=250){var s,n;if("dead"===(null===(n=null===(s=this.sessionContext.session)||void 0===s?void 0:s.kernel)||void 0===n?void 0:n.status))return;const o=this.promptCell;if(!o)throw new Error("Cannot execute without a prompt cell");if(o.model.trusted=!0,e)return this.newPromptCell(),void(await this._execute(o));const i=await this._shouldExecute(t);this.isDisposed||(i?(this.newPromptCell(),this.promptCell.editor.focus(),await this._execute(o)):o.editor.newIndentedLine())}getCell(e){return this._msgIds.get(e)}inject(e,t={}){const s=this.createCodeCell();s.model.sharedModel.setSource(e);for(const n of Object.keys(t))s.model.setMetadata(n,t[n]);return this.addCell(s),this._execute(s)}insertLinebreak(){const e=this.promptCell;e&&e.editor.newIndentedLine()}replaceSelection(e){var t,s;const n=this.promptCell;n&&(null===(s=(t=n.editor).replaceSelection)||void 0===s||s.call(t,e))}setConfig(e){const{clearCellsOnExecute:t,clearCodeContentOnExecute:s,hideCodeInput:n,promptCellPosition:o,showBanner:i}=e;this._config={clearCellsOnExecute:null!=t?t:this._config.clearCellsOnExecute,clearCodeContentOnExecute:null!=s?s:this._config.clearCodeContentOnExecute,hideCodeInput:null!=n?n:this._config.hideCodeInput,promptCellPosition:null!=o?o:this._config.promptCellPosition,showBanner:null!=i?i:this._config.showBanner},this._updateLayout()}serialize(){const e=[];for(const t of this._cells){const s=t.model;f(s)&&e.push(s.toJSON())}return this.promptCell&&e.push(this.promptCell.model.toJSON()),e}_evtMouseDown(e){const{button:t,shiftKey:s}=e;if(0!==t&&2!==t||s&&2===t)return;let n=e.target;const o=e=>e.classList.contains(Z);let i=X.findCell(n,this._cells,o);if(-1===i&&(n=document.elementFromPoint(e.clientX,e.clientY),i=X.findCell(n,this._cells,o)),-1===i)return;const r=this._cells.get(i);"prompt"===X.detectTargetArea(r,e.target)&&(this._dragData={pressX:e.clientX,pressY:e.clientY,index:i},this._focusedCell=r,document.addEventListener("mouseup",this,!0),document.addEventListener("mousemove",this,!0),e.preventDefault())}_evtMouseMove(e){const t=this._dragData;t&&X.shouldStartDrag(t.pressX,t.pressY,e.clientX,e.clientY)&&this._startDrag(t.index,e.clientX,e.clientY)}_startDrag(e,t,s){const n=this._focusedCell.model,o=[n.toJSON()],i=X.createCellDragImage(this._focusedCell,o);this._drag=new y({mimeData:new v,dragImage:i,proposedAction:"copy",supportedActions:"copy",source:this}),this._drag.mimeData.setData("application/vnd.jupyter.cells",o);const r=n.sharedModel.getSource();return this._drag.mimeData.setData("text/plain",r),this._focusedCell=null,document.removeEventListener("mousemove",this,!0),document.removeEventListener("mouseup",this,!0),this._drag.start(t,s).then(()=>{this.isDisposed||(this._drag=null,this._dragData=null)})}handleEvent(e){switch(e.type){case"keydown":this._evtKeyDown(e);break;case"mousedown":this._evtMouseDown(e);break;case"mousemove":this._evtMouseMove(e);break;case"mouseup":this._evtMouseUp(e);break;case"resize":this._splitPanel.fit();break;case"focusin":this._evtFocusIn(e);break;case"focusout":this._evtFocusOut(e)}}onAfterAttach(e){const t=this.node;t.addEventListener("keydown",this,!0),t.addEventListener("click",this),t.addEventListener("mousedown",this),t.addEventListener("focusin",this),t.addEventListener("focusout",this),this.promptCell?(this.promptCell.editor.focus(),this.update()):this.newPromptCell()}onBeforeDetach(e){const t=this.node;t.removeEventListener("keydown",this,!0),t.removeEventListener("click",this),t.removeEventListener("focusin",this),t.removeEventListener("focusout",this)}onActivateRequest(e){const t=this.promptCell&&this.promptCell.editor;t&&t.focus(),this.update()}newPromptCell(){var e,t,s,n,o;let i=this.promptCell;const r=this._input,l=null!==(e=null==i?void 0:i.model.sharedModel.getSource())&&void 0!==e?e:"",a=null===(t=null==i?void 0:i.editor)||void 0===t?void 0:t.getCursorPosition();if(i){i.readOnly=!0,i.removeClass(ee),i.model.sharedModel.changed.disconnect(this._onPromptContentChanged,this);const e=i,t=this._promptResizeObserver;requestIdleCallback(()=>{d.clearData(e.editor),t&&t.disconnect()}),null===(s=i.editor)||void 0===s||s.blur();r.widgets[0].parent=null,this._config.hideCodeInput&&(null===(n=i.inputArea)||void 0===n||n.setHidden(!0)),this.addCell(i)}const c=this.contentFactory,h=this._createCodeCellOptions();i=c.createCodeCell(h),i.model.mimeType=this._mimetype,i.addClass(ee),this._input.addWidget(i),this._history.editor=i.editor,i.node&&(this._promptResizeObserver=new ResizeObserver(()=>{this._scheduleInputSizeAdjustment()}),this._promptResizeObserver.observe(i.node)),i.model.sharedModel.changed.connect(this._onPromptContentChanged,this),this._config.clearCodeContentOnExecute||(i.model.sharedModel.setSource(l),a&&(null===(o=i.editor)||void 0===o||o.setCursorPosition(a))),this._promptCellCreated.emit(i)}onUpdateRequest(e){se.scrollToBottom(this._content.node)}_evtKeyDown(e){const t=this.promptCell&&this.promptCell.editor;t&&(13!==e.keyCode||t.hasFocus()?27===e.keyCode&&t.hasFocus()&&(e.preventDefault(),e.stopPropagation(),this.node.focus()):(e.preventDefault(),t.focus()))}_evtMouseUp(e){this.promptCell&&this.promptCell.node.contains(e.target)&&this.promptCell.editor.focus()}_evtFocusIn(e){this._updateReadWrite()}_evtFocusOut(e){this._updateReadWrite()}async _execute(e){const t=e.model.sharedModel.getSource();if(this._history.push(t),"clear"===t||"%clear"===t)return this.clear(),Promise.resolve(void 0);e.model.contentChanged.connect(this.update,this);const s={cell:e,sessionContext:this.sessionContext,onCellExecuted:e=>{if(this._executed.emit(e.executionDate),e.error)for(const t of this._cells)null===t.model.executionCount&&(t.model.executionState="idle")}};try{await this._executor.runCell(s)}finally{this.isDisposed||(e.model.contentChanged.disconnect(this.update,this),this.update())}}_handleInfo(e){if("ok"!==e.status)return void(this._banner&&this._banner.model.sharedModel.setSource("Error in getting kernel banner"));this._banner&&this._banner.model.sharedModel.setSource(e.banner);const t=e.language_info;this._mimetype=this._mimeTypeService.getMimeTypeByLanguage(t),this.promptCell&&(this.promptCell.model.mimeType=this._mimetype)}_createCodeCellOptions(){const e=this.contentFactory;return{model:this.modelFactory.createCodeCell({}),rendermime:this.rendermime,contentFactory:e,editorConfig:this.editorConfig,placeholder:!1,translator:this._translator}}_onCellDisposed(e,t){if(!this.isDisposed){this._cells.removeValue(e);const t=this._msgIdCells.get(e);t&&(this._msgIdCells.delete(e),this._msgIds.delete(t))}}_shouldExecute(e){const t=this.promptCell;if(!t)return Promise.resolve(!1);const s=t.model.sharedModel.getSource();return new Promise((t,n)=>{var o;const i=setTimeout(()=>{t(!0)},e),r=null===(o=this.sessionContext.session)||void 0===o?void 0:o.kernel;r?r.requestIsComplete({code:s}).then(e=>{clearTimeout(i),this.isDisposed&&t(!1),"incomplete"===e.content.status?t(!1):t(!0)}).catch(()=>{t(!0)}):t(!1)})}async _onKernelChanged(){var e;this.clear(),this._banner&&(this._banner.dispose(),this._banner=null),this._config.showBanner&&this.addBanner(),(null===(e=this.sessionContext.session)||void 0===e?void 0:e.kernel)&&this._handleInfo(await this.sessionContext.session.kernel.info)}async _onKernelStatusChanged(){var e;const t=null===(e=this.sessionContext.session)||void 0===e?void 0:e.kernel;"restarting"===(null==t?void 0:t.status)&&(this._config.showBanner&&this.addBanner(),this._handleInfo(await(null==t?void 0:t.info)))}_updateReadWrite(){const e=x.hasActiveEditableElement(this.node);this.node.classList.toggle("jp-mod-readWrite",e)}_calculateRelativeSizes(){const{promptCellPosition:e="bottom"}=this._config;let t=[1,1];return"top"===e?t=[1,100]:"bottom"===e&&(t=[100,1]),t}_setManualResize(){this._hasManualResize=!0,this._cancelPendingResizeAdjustment()}_cancelPendingResizeAdjustment(){null!==this._resizeAnimationFrameId&&(cancelAnimationFrame(this._resizeAnimationFrameId),this._resizeAnimationFrameId=null)}_scheduleInputSizeAdjustment(){this._hasManualResize||null===this._resizeAnimationFrameId&&(this._resizeAnimationFrameId=requestAnimationFrame(()=>{this._resizeAnimationFrameId=null,this._adjustSplitPanelForInputGrowth()}))}_onPromptContentChanged(){this._scheduleInputSizeAdjustment()}_adjustSplitPanelForInputGrowth(){if(this.isDisposed||!this._input.node||!this._content.node||this._hasManualResize)return;const{promptCellPosition:e="bottom"}=this._config;if("left"===e||"right"===e)return;const t=this.promptCell;if(!t||!t.editor)return;const s=t.editor.editor.contentHeight+this._getInputCellPadding(),n=this._splitPanel.node.clientHeight;if(n<=0||s<=0)return void this._splitPanel.fit();const o=n-s;let i,r;"bottom"===e?(i=o/n,r=s/n):(r=s/n,i=o/n);const l=i+r;if(l>0){const t="bottom"===e?[i/l,r/l]:[r/l,i/l];this._splitPanel.setRelativeSizes(t)}}_getInputCellPadding(){var e;const t=this._input.node,s=window.getComputedStyle(t),n=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom),o=this.promptCell;if(!o)return n;const i=window.getComputedStyle(o.node),r=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom),l=null===(e=o.editorWidget)||void 0===e?void 0:e.node;let a=0;if(l){const e=window.getComputedStyle(l);a=parseFloat(e.borderTopWidth)+parseFloat(e.borderBottomWidth)}return n+r+a}_updateLayout(){const{promptCellPosition:e="bottom"}=this._config;this._hasManualResize=!1,this._splitPanel.orientation=["left","right"].includes(e)?"horizontal":"vertical",_.setStretch(this._content,1),_.setStretch(this._input,1),"bottom"===e||"right"===e?(this._splitPanel.insertWidget(0,this._content),this._splitPanel.insertWidget(1,this._input)):(this._splitPanel.insertWidget(0,this._input),this._splitPanel.insertWidget(1,this._content)),this._splitPanel.setRelativeSizes(this._calculateRelativeSizes()),requestAnimationFrame(()=>{this._adjustSplitPanelForInputGrowth()})}}var se;!function(e){e.defaultEditorConfig={codeFolding:!1,lineNumbers:!1};class t extends w.ContentFactory{createCodeCell(e){return new a(e).initializeState()}createRawCell(e){return new g(e).initializeState()}}e.ContentFactory=t;class s{constructor(e={}){this.codeCellContentFactory=e.codeCellContentFactory||b.defaultContentFactory}createCodeCell(e={}){return e.contentFactory||(e.contentFactory=this.codeCellContentFactory),new b(e)}createRawCell(e){return new P(e)}}e.ModelFactory=s,e.defaultModelFactory=new s({})}(te||(te={})),(se||(se={})).scrollToBottom=function(e){e.scrollTop=e.scrollHeight-e.clientHeight};class ne extends F{constructor(e){super({content:new m}),this._executed=null,this._connected=null,this.addClass("jp-ConsolePanel");let{executor:t,rendermime:s,mimeTypeService:n,path:i,basePath:r,name:l,manager:a,modelFactory:d,sessionContext:c,translator:u}=e;this.translator=null!=u?u:h;const p=this.translator.load("jupyterlab"),_=this.contentFactory=e.contentFactory,C=oe.count++;i||(i=S.PathExt.join(r||"",`console-${C}-${E.uuid4()}`)),c=this._sessionContext=null!=c?c:new j({kernelManager:a.kernels,sessionManager:a.sessions,specsManager:a.kernelspecs,path:a.contents.localPath(i),name:l||p.__("Console %1",C),type:"console",kernelPreference:e.kernelPreference,setBusy:e.setBusy});const g=new o.UrlResolver({path:i,contents:a.contents});s=s.clone({resolver:g}),this.console=_.createConsole({executor:t,rendermime:s,sessionContext:c,mimeTypeService:n,contentFactory:_,modelFactory:d,translator:u}),this.content.addWidget(this.console),c.initialize().then(async t=>{var s;t&&await(null!==(s=e.sessionDialogs)&&void 0!==s?s:new D({translator:u})).selectKernel(c),this._connected=/* @__PURE__ */new Date,this._updateTitlePanel()}),this.console.executed.connect(this._onExecuted,this),this._updateTitlePanel(),c.kernelChanged.connect(this._updateTitlePanel,this),c.propertyChanged.connect(this._updateTitlePanel,this),this.title.icon=k,this.title.closable=!0,this.id=`console-${C}`}get sessionContext(){return this._sessionContext}dispose(){this.sessionContext.dispose(),this.console.dispose(),super.dispose()}onActivateRequest(e){const t=this.console.promptCell;t&&t.editor.focus()}onCloseRequest(e){super.onCloseRequest(e),this.dispose()}_onExecuted(e,t){this._executed=t,this._updateTitlePanel()}_updateTitlePanel(){oe.updateTitle(this,this._connected,this._executed,this.translator)}}var oe,ie;!function(e){class t extends te.ContentFactory{createConsole(e){return new te(e)}}e.ContentFactory=t,e.IContentFactory=new I("@jupyterlab/console:IContentFactory","A factory object that creates new code consoles. Use this if you want to create and host code consoles in your own UI elements.")}(ne||(ne={})),(ie=oe||(oe={})).count=1,ie.updateTitle=function(e,t,s,n){const o=(n=n||h).load("jupyterlab"),i=e.console.sessionContext.session;if(i){let n=o.__("Name: %1\n",i.name)+o.__("Directory: %1\n",S.PathExt.dirname(i.path))+o.__("Kernel: %1",e.console.sessionContext.kernelDisplayName);t&&(n+=o.__("\nConnected: %1",S.Time.format(t.toISOString()))),s&&(n+=o.__("\nLast Execution: %1")),e.title.label=i.name,e.title.caption=n}else e.title.label=o.__("Console"),e.title.caption=""};class re{_panel;_code;constructor(e){const{kernel:t,serviceManager:s,code:n}=e;this._code=n,this._panel=new M,this._panel.direction="top-to-bottom",this._panel.spacing=0,this._panel.addClass("dla-JupyterLab-Console"),Promise.all([s.ready,t?.ready]).then(()=>{this.setupConsole(s,t)})}setupConsole(e,t){const s=new z;this._panel.node.addEventListener("keydown",e=>{s.processKeydownEvent(e)});const n=new R;for(const o of R.getDefaultThemes())n.addTheme(o);const i=new L;for(const o of L.getDefaultLanguages())i.addLanguage(o);i.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await import("./vendor-codemirror-OzOnFEf0.js").then(e=>e.ap)).markdown({codeLanguages:e=>i.findBest(e)})});const r=new N({extensions:(()=>{const e=new O;for(const t of O.getDefaultExtensions({themes:n}))e.addExtension(t);return e.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return O.createImmutableExtension(B({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),e})(),languages:i}),l=new o({initialFactories:T}),a=new W(i),d=r.newInlineEditor,c=new ne.ContentFactory({editorFactory:d}),h=new ne({name:t?.session.name,manager:e,rendermime:l,path:t?.session.path??"console-path",contentFactory:c,mimeTypeService:a,kernelPreference:{shouldStart:!0,name:t?.connection?.name??"python",id:t?.id,language:t?.info?.language_info.name}});h.title.label="Console",M.setStretch(h,1),this._panel.addWidget(h),window.addEventListener("resize",()=>{this._panel.update()});const u=".jp-ConsolePanel";let p;p="console:clear",s.addCommand(p,{label:"Clear",execute:()=>{h.console.clear()}}),p="console:execute",s.addCommand(p,{label:"Execute Prompt",execute:()=>h.console.execute()}),s.addKeyBinding({command:p,selector:u,keys:["Enter"]}),p="console:execute-forced",s.addCommand(p,{label:"Execute Cell (forced)",execute:()=>h.console.execute(!0)}),s.addKeyBinding({command:p,selector:u,keys:["Shift Enter"]}),p="console:linebreak",s.addCommand(p,{label:"Insert Line Break",execute:()=>{h.console.insertLinebreak()}}),s.addKeyBinding({command:p,selector:u,keys:["Ctrl Enter"]}),this._code&&h.console.sessionContext.ready.then(()=>{h.console.inject(this._code??"")})}get panel(){return this._panel}}const le=s=>{const{defaultKernel:o,serviceManager:r}=n(),[l,a]=e.useState(),d=A();return e.useEffect(()=>{if(r){const e=new re({kernel:o,serviceManager:r,code:s.code});a(e),d.setAdapter(e)}},[o,r]),l?t.jsx(i,{children:l.panel}):t.jsx(t.Fragment,{children:"Loading Jupyter Console..."})},ae=({options:e})=>((()=>{const e=s();n({jupyterServerUrl:e.serverUrl||"",jupyterServerToken:e.token||"",startDefaultKernel:e.autoStartKernel,defaultKernelName:e.defaultKernel,terminals:!0})})(),/* @__PURE__ */t.jsx("div",{style:{height:e.height||"400px"},children:/* @__PURE__ */t.jsx(le,{code:e.initCode})})),de=({options:e})=>/* @__PURE__ */t.jsx(K,{children:/* @__PURE__ */t.jsx(ae,{options:e})});export{de as ConsoleChunk,de as default};
//# sourceMappingURL=ConsoleChunk-cMbRaTuk.js.map
