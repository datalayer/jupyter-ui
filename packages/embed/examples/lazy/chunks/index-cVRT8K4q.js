import{ak as e,t,l as s,P as n}from"./JupyterReactTheme-CX3WbnDJ.js";import{D as a}from"./drivecontents-BJnbG0Iq.js";class r{constructor(e){const{id:t,name:s,location:n,sendMessage:a}=e;this._id=t,this._name=s,this._location=n,this._sendMessage=a}get ready(){return Promise.resolve()}get isDisposed(){return this._isDisposed}get disposed(){return this._disposed}get id(){return this._id}get name(){return this._name}get location(){return this._location}get executionCount(){return this._executionCount}get parentHeader(){return this._parentHeader}get parent(){return this._parent}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(void 0))}async handleMessage(e){this._busy(e),this._parent=e;switch(e.header.msg_type){case"kernel_info_request":await this._kernelInfo(e);break;case"execute_request":await this._execute(e);break;case"input_reply":this.inputReply(e.content);break;case"inspect_request":await this._inspect(e);break;case"is_complete_request":await this._isCompleteRequest(e);break;case"complete_request":await this._complete(e);break;case"history_request":await this._historyRequest(e);break;case"comm_open":await this.commOpen(e);break;case"comm_msg":await this.commMsg(e);break;case"comm_close":await this.commClose(e)}this._idle(e)}stream(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"iopub",msgType:"stream",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}displayData(t,s=void 0){const n=void 0!==s?s:this._parentHeader;t.metadata=t.metadata??{};const a=e.KernelMessage.createMessage({channel:"iopub",msgType:"display_data",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}inputRequest(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"stdin",msgType:"input_request",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}publishExecuteResult(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"iopub",msgType:"execute_result",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}publishExecuteError(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"iopub",msgType:"error",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}updateDisplayData(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"iopub",msgType:"update_display_data",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}clearOutput(t,s=void 0){const n=void 0!==s?s:this._parentHeader,a=e.KernelMessage.createMessage({channel:"iopub",msgType:"clear_output",session:n?.session??"",parentHeader:n,content:t});this._sendMessage(a)}handleComm(t,s,n,a,r=void 0){const o=void 0!==r?r:this._parentHeader,i=e.KernelMessage.createMessage({channel:"iopub",msgType:t,session:o?.session??"",parentHeader:o,content:s,metadata:n,buffers:a});this._sendMessage(i)}_idle(t){const s=e.KernelMessage.createMessage({msgType:"status",session:t.header.session,parentHeader:t.header,channel:"iopub",content:{execution_state:"idle"}});this._sendMessage(s)}_busy(t){const s=e.KernelMessage.createMessage({msgType:"status",session:t.header.session,parentHeader:t.header,channel:"iopub",content:{execution_state:"busy"}});this._sendMessage(s)}async _kernelInfo(t){const s=await this.kernelInfoRequest(),n=e.KernelMessage.createMessage({msgType:"kernel_info_reply",channel:"shell",session:t.header.session,parentHeader:t.header,content:s});this._sendMessage(n)}async _historyRequest(t){const s=t,n=e.KernelMessage.createMessage({msgType:"history_reply",channel:"shell",parentHeader:s.header,session:t.header.session,content:{status:"ok",history:this._history}});this._sendMessage(n)}_executeInput(t){const s=t,n=s.content.code,a=e.KernelMessage.createMessage({msgType:"execute_input",parentHeader:s.header,channel:"iopub",session:t.header.session,content:{code:n,execution_count:this._executionCount}});this._sendMessage(a)}async _execute(t){const s=t,n=s.content;n.store_history&&this._executionCount++,this._parentHeader=s.header,this._executeInput(s),n.store_history&&this._history.push([0,0,n.code]);const a=await this.executeRequest(s.content),r=e.KernelMessage.createMessage({msgType:"execute_reply",channel:"shell",parentHeader:s.header,session:t.header.session,content:a});this._sendMessage(r)}async _complete(t){const s=t,n=await this.completeRequest(s.content),a=e.KernelMessage.createMessage({msgType:"complete_reply",parentHeader:s.header,channel:"shell",session:t.header.session,content:n});this._sendMessage(a)}async _inspect(t){const s=t,n=await this.inspectRequest(s.content),a=e.KernelMessage.createMessage({msgType:"inspect_reply",parentHeader:s.header,channel:"shell",session:t.header.session,content:n});this._sendMessage(a)}async _isCompleteRequest(t){const s=t,n=await this.isCompleteRequest(s.content),a=e.KernelMessage.createMessage({msgType:"is_complete_reply",parentHeader:s.header,channel:"shell",session:t.header.session,content:n});this._sendMessage(a)}_id;_name;_location;_history=[];_executionCount=0;_isDisposed=!1;_disposed=new t(this);_sendMessage;_parentHeader=void 0;_parent=void 0}const o={ipykernel:{releases:{"6.9.2":[{url:"https://assets.datalayer.tech/pypi/ipykernel-6.9.2-py3-none-any.whl"}]}},piplite:{releases:{"0.5.1":[{url:"https://assets.datalayer.tech/pypi/piplite-0.5.1-py3-none-any.whl"}]}},"pyodide-kernel":{releases:{"0.5.1":[{url:"https://assets.datalayer.tech/pypi/pyodide_kernel-0.5.1-py3-none-any.whl"}]}},widgetsnbextension:{releases:{"3.6.999":[{url:"https://assets.datalayer.tech/pypi/widgetsnbextension-3.6.999-py3-none-any.whl"}],"4.0.999":[{url:"https://assets.datalayer.tech/pypi/widgetsnbextension-4.0.999-py3-none-any.whl"}]}}};function i(e,t){const s=o[e];if(!s)throw console.error("all.json contents:",o),console.error("Looking for package:",e),new Error(`Package ${e} not found in all.json`);const n=Object.keys(s.releases),a=t||n[n.length-1],r=s.releases[a];if(!r||0===r.length)throw new Error(`No releases found for ${e}@${a}`);return r[0].url}const c={default:o.piplite?.releases["0.5.1"]?.[0]?.url?.replace(/piplite-.*\.whl$/,"all.json")||"https://assets.datalayer.tech/pypi/all.json"},l={default:i("piplite","0.5.1")};i("ipykernel","6.9.2"),i("pyodide-kernel","0.5.1"),i("widgetsnbextension","3.6.999"),i("widgetsnbextension","4.0.999");const p="function",d="64e10b34-2bf7-4616-9668-f99de5aa046e",u="get",h="has",g="set",{isArray:m}=Array;let{SharedArrayBuffer:y,window:_}=globalThis,{notify:f,wait:w,waitAsync:b}=Atomics,M=null;b||(b=e=>({value:new Promise(t=>{let s=new Worker("data:application/javascript,onmessage%3D(%7Bdata%3Ab%7D)%3D%3E(Atomics.wait(b%2C0)%2CpostMessage(0))");s.onmessage=t,s.postMessage(e)})}));try{new y(4)}catch(Z){y=ArrayBuffer;const e=/* @__PURE__ */new WeakMap;if(_){const t=/* @__PURE__ */new Map,{prototype:{postMessage:s}}=Worker,n=e=>{const s=e.data?.[d];if(!m(s)){e.stopImmediatePropagation();const{id:n,sb:a}=s;t.get(n)(a)}};M=function(t,...a){const r=t?.[d];if(m(r)){const[t,s]=r;e.set(s,t),this.addEventListener("message",n)}return s.call(this,t,...a)},b=s=>({value:new Promise(n=>{t.set(e.get(s),n)}).then(n=>{t.delete(e.get(s)),e.delete(s);for(let e=0;e<n.length;e++)s[e]=n[e];return"ok"})})}else{const t=(e,t)=>({[d]:{id:e,sb:t}});f=s=>{postMessage(t(e.get(s),s))},addEventListener("message",t=>{const s=t.data?.[d];if(m(s)){const[t,n]=s;e.set(n,t)}})}}const{Int32Array:k,Map:v,Uint16Array:E}=globalThis,{BYTES_PER_ELEMENT:x}=k,{BYTES_PER_ELEMENT:R}=E,H=/* @__PURE__ */new WeakSet,T=/* @__PURE__ */new WeakMap,P={value:{then:e=>e()}};let C=0;const K=(e,{parse:t=JSON.parse,stringify:s=JSON.stringify,transform:n,interrupt:a}=JSON)=>{if(!T.has(e)){const r=M||e.postMessage,o=(t,...s)=>r.call(e,{[d]:s},{transfer:t}),i=typeof a===p?a:a?.handler,c=a?.delay||42,l=new TextDecoder("utf-16"),_=(e,t)=>e?b(t,0):(i?((e,t,s)=>{for(;"timed-out"===w(e,0,0,t);)s()})(t,c,i):w(t,0),P);let K=!1;T.set(e,new Proxy(new v,{[h]:(e,t)=>"string"==typeof t&&!t.startsWith("_"),[u]:(s,a)=>"then"===a?null:(...s)=>{const r=C++;let i=new k(new y(2*x)),c=[];H.has(s.at(-1)||c)&&H.delete(c=s.pop()),o(c,r,i,a,n?s.map(n):s);const p=e!==globalThis;let d=0;return K&&p&&(d=setTimeout(console.warn,1e3,`ðŸ’€ðŸ”’ - Possible deadlock if proxy.${a}(...args) is awaited`)),_(p,i).value.then(()=>{clearTimeout(d);const e=i[1];if(!e)return;const s=R*e;return i=new k(new y(s+s%x)),o([],r,i),_(p,i).value.then(()=>t(l.decode(new E(i.buffer).slice(0,e))))})},[g](t,a,r){const o=typeof r;if(o!==p)throw new Error(`Unable to assign ${a} as ${o}`);if(!t.size){const a=new v;e.addEventListener("message",async e=>{const r=e.data?.[d];if(m(r)){e.stopImmediatePropagation();const[o,i,...c]=r;let l;if(c.length){const[e,r]=c;if(t.has(e)){K=!0;try{const c=await t.get(e)(...r);if(void 0!==c){const e=s(n?n(c):c);a.set(o,e),i[1]=e.length}}catch(Z){l=Z}finally{K=!1}}else l=new Error(`Unsupported action: ${e}`);i[0]=1}else{const e=a.get(o);a.delete(o);for(let t=new E(i.buffer),s=0;s<e.length;s++)t[s]=e.charCodeAt(s)}if(f(i,0),l)throw l}})}return!!t.set(a,r)}}))}return T.get(e)};K.transfer=(...e)=>(H.add(e),e);const A=/* @__PURE__ */Symbol("Comlink.proxy"),O=/* @__PURE__ */Symbol("Comlink.endpoint"),q=/* @__PURE__ */Symbol("Comlink.releaseProxy"),D=/* @__PURE__ */Symbol("Comlink.finalizer"),S=/* @__PURE__ */Symbol("Comlink.thrown"),L=e=>"object"==typeof e&&null!==e||"function"==typeof e,W=/* @__PURE__ */new Map([["proxy",{canHandle:e=>L(e)&&e[A],serialize(e){const{port1:t,port2:s}=new MessageChannel;return j(e,t),[s,[s]]},deserialize:e=>(e.start(),U(e))}],["throw",{canHandle:e=>L(e)&&S in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function j(e,t=globalThis,s=["*"]){t.addEventListener("message",function n(a){if(!a||!a.data)return;if(!function(e,t){for(const s of e){if(t===s||"*"===s)return!0;if(s instanceof RegExp&&s.test(t))return!0}return!1}(s,a.origin))return void console.warn(`Invalid origin '${a.origin}' for comlink proxy`);const{id:r,type:o,path:i}=Object.assign({path:[]},a.data),c=(a.data.argumentList||[]).map(V);let l;try{const t=i.slice(0,-1).reduce((e,t)=>e[t],e),s=i.reduce((e,t)=>e[t],e);switch(o){case"GET":l=s;break;case"SET":t[i.slice(-1)[0]]=V(a.data.value),l=!0;break;case"APPLY":l=s.apply(t,c);break;case"CONSTRUCT":l=function(e){return Object.assign(e,{[A]:!0})}(new s(...c));break;case"ENDPOINT":{const{port1:t,port2:s}=new MessageChannel;j(e,s),l=function(e,t){return Y.set(e,t),e}(t,[t])}break;case"RELEASE":l=void 0;break;default:return}}catch(p){l={value:p,[S]:0}}Promise.resolve(l).catch(e=>({value:e,[S]:0})).then(s=>{const[a,i]=G(s);t.postMessage(Object.assign(Object.assign({},a),{id:r}),i),"RELEASE"===o&&(t.removeEventListener("message",n),I(t),D in e&&"function"==typeof e[D]&&e[D]())}).catch(e=>{const[s,n]=G({value:new TypeError("Unserializable return value"),[S]:0});t.postMessage(Object.assign(Object.assign({},s),{id:r}),n)})}),t.start&&t.start()}function I(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function U(e,t){const s=/* @__PURE__ */new Map;return e.addEventListener("message",function(e){const{data:t}=e;if(!t||!t.id)return;const n=s.get(t.id);if(n)try{n(t)}finally{s.delete(t.id)}}),F(e,s,[],t)}function N(e){if(e)throw new Error("Proxy has been released and is not useable")}function z(e){return X(e,/* @__PURE__ */new Map,{type:"RELEASE"}).then(()=>{I(e)})}const $=/* @__PURE__ */new WeakMap,B="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{const t=($.get(e)||0)-1;$.set(e,t),0===t&&z(e)});function F(e,t,s=[],n=function(){}){let a=!1;const r=new Proxy(n,{get(n,o){if(N(a),o===q)return()=>{!function(e){B&&B.unregister(e)}(r),z(e),t.clear(),a=!0};if("then"===o){if(0===s.length)return{then:()=>r};const n=X(e,t,{type:"GET",path:s.map(e=>e.toString())}).then(V);return n.then.bind(n)}return F(e,t,[...s,o])},set(n,r,o){N(a);const[i,c]=G(o);return X(e,t,{type:"SET",path:[...s,r].map(e=>e.toString()),value:i},c).then(V)},apply(n,r,o){N(a);const i=s[s.length-1];if(i===O)return X(e,t,{type:"ENDPOINT"}).then(V);if("bind"===i)return F(e,t,s.slice(0,-1));const[c,l]=J(o);return X(e,t,{type:"APPLY",path:s.map(e=>e.toString()),argumentList:c},l).then(V)},construct(n,r){N(a);const[o,i]=J(r);return X(e,t,{type:"CONSTRUCT",path:s.map(e=>e.toString()),argumentList:o},i).then(V)}});return function(e,t){const s=($.get(t)||0)+1;$.set(t,s),B&&B.register(e,t,e)}(r,e),r}function J(e){const t=e.map(G);return[t.map(e=>e[0]),(s=t.map(e=>e[1]),Array.prototype.concat.apply([],s))];var s}const Y=/* @__PURE__ */new WeakMap;function G(e){for(const[t,s]of W)if(s.canHandle(e)){const[n,a]=s.serialize(e);return[{type:"HANDLER",name:t,value:n},a]}return[{type:"RAW",value:e},Y.get(e)||[]]}function V(e){switch(e.type){case"HANDLER":return W.get(e.name).deserialize(e.value);case"RAW":return e.value}}function X(e,t,s,n){return new Promise(a=>{const r=new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(r,a),e.start&&e.start(),e.postMessage(Object.assign({id:r},s),n)})}class Q extends r{constructor(e){super(e),this._worker=this.initWorker(e),this._remoteKernel=this.initRemote(e),this._contentsManager=e.contentsManager}initWorker(e){return crossOriginIsolated?new Worker(new URL("/assets/coincident.worker-0RevFpcV.js",import.meta.url),{type:"module"}):new Worker(new URL("/assets/comlink.worker-BoJfbDln.js",import.meta.url),{type:"module"})}initRemote(e){let t;crossOriginIsolated?(t=K(this._worker),t.processWorkerMessage=this._processWorkerMessage.bind(this),t.processDriveRequest=async e=>{if(!a)throw new Error("File system calls over Atomics.wait is only supported with jupyterlite>=0.4.0a3");return void 0===this._contentsProcessor&&(this._contentsProcessor=new a({contentsManager:this._contentsManager})),await this._contentsProcessor.processDriveRequest(e)}):(t=U(this._worker),this._worker.addEventListener("message",e=>{void 0!==e?.data?._kernelMessage&&this._processWorkerMessage(e.data._kernelMessage)}));const s=this.initRemoteOptions(e);return t.initialize(s).then(this._ready.resolve.bind(this._ready)),t}initRemoteOptions(e){const{pyodideUrl:t}=e,n=t.slice(0,t.lastIndexOf("/")+1),a=s.PageConfig.getBaseUrl(),r=[...e.pipliteUrls||[],c.default],o=!!e.disablePyPIFallback;return{baseUrl:a,pyodideUrl:t,indexUrl:n,pipliteWheelUrl:e.pipliteWheelUrl||l.default,pipliteUrls:r,disablePyPIFallback:o,location:this.location,mountDrive:e.mountDrive,loadPyodideOptions:e.loadPyodideOptions||{}}}dispose(){this.isDisposed||(this._worker.terminate(),this._worker=null,super.dispose())}get ready(){return this._ready.promise}_processWorkerMessage(e){if(e.type)switch(e.type){case"stream":{const t=e.bundle??{name:"stdout",text:""};this.stream(t,e.parentHeader);break}case"input_request":{const t=e.content??{prompt:"",password:!1};this.inputRequest(t,e.parentHeader);break}case"display_data":{const t=e.bundle??{data:{},metadata:{},transient:{}};this.displayData(t,e.parentHeader);break}case"update_display_data":{const t=e.bundle??{data:{},metadata:{},transient:{}};this.updateDisplayData(t,e.parentHeader);break}case"clear_output":{const t=e.bundle??{wait:!1};this.clearOutput(t,e.parentHeader);break}case"execute_result":{const t=e.bundle??{execution_count:0,data:{},metadata:{}};this.publishExecuteResult(t,e.parentHeader);break}case"execute_error":{const t=e.bundle??{ename:"",evalue:"",traceback:[]};this.publishExecuteError(t,e.parentHeader);break}case"comm_msg":case"comm_open":case"comm_close":this.handleComm(e.type,e.content,e.metadata,e.buffers,e.parentHeader)}}async kernelInfoRequest(){return{implementation:"pyodide",implementation_version:"0.1.0",language_info:{codemirror_mode:{name:"python",version:3},file_extension:".py",mimetype:"text/x-python",name:"python",nbconvert_exporter:"python",pygments_lexer:"ipython3",version:"3.8"},protocol_version:"5.3",status:"ok",banner:"A WebAssembly-powered Python kernel backed by Pyodide",help_links:[{text:"Python (WASM) Kernel",url:"https://pyodide.org"}]}}async executeRequest(e){await this.ready;const t=await this._remoteKernel.execute(e,this.parent);return t.execution_count=this.executionCount,t}async completeRequest(e){return await this._remoteKernel.complete(e,this.parent)}async inspectRequest(e){return await this._remoteKernel.inspect(e,this.parent)}async isCompleteRequest(e){return await this._remoteKernel.isComplete(e,this.parent)}async commInfoRequest(e){return await this._remoteKernel.commInfo(e,this.parent)}async commOpen(e){return await this._remoteKernel.commOpen(e,this.parent)}async commMsg(e){return await this._remoteKernel.commMsg(e,this.parent)}async commClose(e){return await this._remoteKernel.commClose(e,this.parent)}async inputReply(e){return await this._remoteKernel.inputReply(e,this.parent)}_contentsManager;_contentsProcessor;_worker;_remoteKernel;_ready=new n}export{Q as PyodideKernel,c as allJSONUrl,l as pipliteWheelUrl};
//# sourceMappingURL=index-cVRT8K4q.js.map
