import{j as e,a as t}from"./vendor-react-Bc3S_DuI.js";import{getJupyterEmbedConfig as o}from"../jupyter-embed.lazy.js";import{a as s,S as n,H as i,B as r,b as a,$ as l}from"./vendor-primer-BmSALTY4.js";import{an as d,ao as c,x as h,ap as u,aq as m,ar as p,t as g,as as _,at as f,f as v,i as y,k as C,n as w,au as b,av as k,aw as x,ax as M,P as S,H as P,l as E,_ as j,ay as D,az as N,W as T,aA as A,aB as I,aC as O,aD as L,a9 as R,Z as F,a7 as $,aE as W,aF as B,aG as V,aH as K,c as H,aI as U,aJ as z,aK as q,a0 as J,E as G,s as Y,m as Z,a as Q,y as X,$ as ee,J as te}from"./JupyterReactTheme-CX3WbnDJ.js";import{C as oe}from"./factory-BucVdXsD.js";import{C as se}from"./mimetype-WrG96ErW.js";import{F as ne,V as ie,A as re,E as ae,l as le,S as de,t as ce,a as he,R as ue,s as me,b as pe,D as ge,W as _e}from"./vendor-codemirror-OzOnFEf0.js";import{r as fe,a as ve}from"./index-C33QxsM_.js";import{M as ye}from"./index-49nYpSCp.js";import{H as Ce,a as we,C as be,P as ke,K as xe,b as Me}from"./kernelprovider-D2ZPVQRu.js";import{f as Se,M as Pe,d as Ee,e as je,S as De,h as Ne,i as Te,s as Ae,g as Ie,r as Oe,j as Le,b as Re}from"./index-V6IoXEpD.js";import{R as Fe,L as $e}from"./Lumino-D6-gHQxh.js";import{u as We}from"./JupyterUse-0A4JMZk-.js";const Be=ne.define({combine:e=>e[e.length-1]}),Ve=ae.baseTheme({".jp-remote-cursor":{borderLeft:"1px solid black",marginLeft:"-1px"},".jp-remote-cursor.jp-mod-primary":{borderLeftWidth:"2px"},".jp-remote-selection":{opacity:.5},".cm-tooltip":{border:"none"},".cm-tooltip.jp-remote-userInfo":{color:"var(--jp-ui-inverse-font-color0)",padding:"0px 2px"}}),Ke=re.define();class He{style;marker;constructor(e,t){this.style=e,this.marker=t}draw(){const e=this.marker.draw();for(const[t,o]of Object.entries(this.style))e.style[t]=o;return e}eq(e){return this.marker.eq(e.marker)&&h.deepEqual(this.style,e.style)}update(e,t){for(const[o,s]of Object.entries(this.style))e.style[o]=s;return this.marker.update(e,t.marker)}}const Ue=le({above:!0,markers(e){const{awareness:t,ytext:o}=e.state.facet(Be),s=o.doc,n=[];return t.getStates().forEach((i,r)=>{if(r===t.doc.clientID)return;const a=i.cursors;for(const t of a??[]){if(!t?.anchor||!t?.head)return;const r=u(t.anchor,s),a=u(t.head,s);if(r?.type!==o||a?.type!==o)return;const l=t.primary??1?"jp-remote-cursor jp-mod-primary":"jp-remote-cursor",d=he.cursor(a.index,a.index>r.index?-1:1);for(const t of ue.forRange(e,l,d))n.push(new He({borderLeftColor:i.user?.color??"black"},t))}}),n},update:(e,t)=>!!e.transactions.find(e=>e.annotation(Ke)),class:"jp-remote-cursors"});function ze(e){const t=new Array,{awareness:o,ytext:s}=e.facet(Be),n=s.doc;for(const[i,r]of o.getStates())if(i!==o.doc.clientID)for(const e of r.cursors??[]){if(!e?.head)continue;const o=u(e.head,n);o?.type===s&&t.push({pos:o.index,above:!0,create:()=>{const e=document.createElement("div");return e.classList.add("jp-remote-userInfo"),e.style.backgroundColor=r.user?.color??"darkgrey",e.textContent=r.user?.display_name??"Anonymous",{dom:e}}})}return t}const qe=de.define({create:ze,update:(e,t)=>t.annotation(Ke)?ze(t.state):e,provide:e=>me.computeN([e],t=>t.field(e))}),Je=le({above:!1,markers(e){const{awareness:t,ytext:o}=e.state.facet(Be),s=o.doc,n=[];return t.getStates().forEach((i,r)=>{if(r===t.doc.clientID)return;const a=i.cursors;for(const t of a??[]){if((t.empty??1)||!t?.anchor||!t?.head)return;const r=u(t.anchor,s),a=u(t.head,s);if(r?.type!==o||a?.type!==o)return;const l="jp-remote-selection";for(const t of ue.forRange(e,l,he.range(r.index,a.index)))n.push(new He({backgroundColor:i.user?.color??"black"},t))}}),n},update:(e,t)=>!!e.transactions.find(e=>e.annotation(Ke)),class:"jp-remote-selections"}),Ge=ie.fromClass(class{editorAwareness;_listener;constructor(e){this.editorAwareness=e.state.facet(Be),this._listener=({added:t,updated:o,removed:s})=>{t.concat(o).concat(s).findIndex(e=>e!==this.editorAwareness.awareness.doc.clientID)>=0&&e.dispatch({annotations:[Ke.of([])]})},this.editorAwareness.awareness.on("change",this._listener)}destroy(){this.editorAwareness.awareness.off("change",this._listener)}update(e){if(!e.docChanged&&!e.selectionSet)return;const{awareness:t,ytext:o}=this.editorAwareness,s=t.getLocalState();if(s){const n=e.view.hasFocus&&e.view.dom.ownerDocument.hasFocus(),i=e.state.selection,r=new Array;if(n&&i){for(const e of i.ranges){const t=e===i.main,s=d(o,e.anchor),n=d(o,e.head);r.push({anchor:s,head:n,primary:t,empty:e.empty})}if(!s.cursors||r.length>0){const e=s.cursors?.map(e=>({...e,anchor:e?.anchor?c(e.anchor):null,head:e?.head?c(e.head):null}));h.deepEqual(r,e)||t.setLocalStateField("cursors",r)}}}}},{provide:()=>[Ve,Ue,Je,qe,ce({position:"absolute",parent:document.body})]});class Ye extends m{constructor(e={}){var t;super(),this.version="2.0.0",this.ymeta=this.ydoc.getMap("meta"),this._onMetaChanged=e=>{const t=e.find(e=>e.target===this.ymeta.get("metadata"));if(t){const e=t.changes.keys,o=this.ymeta.get("metadata");t.changes.keys.forEach((e,t)=>{switch(e.action){case"add":this._metadataChanged.emit({key:t,type:"add",newValue:o.get(t)});break;case"delete":this._metadataChanged.emit({key:t,type:"remove",oldValue:e.oldValue});break;case"update":{const s=o.get(t),n=e.oldValue;let i=!0;i="object"==typeof n&&"object"==typeof s?h.deepEqual(n,s):n===s,i||this._metadataChanged.emit({key:t,type:"change",oldValue:n,newValue:s})}}}),this._changed.emit({metadataChange:e})}const o=e.find(e=>e.target===this.ymeta);if(o){if(o.keysChanged.has("metadata")){const e=o.changes.keys.get("metadata");if("add"===(null==e?void 0:e.action)&&!e.oldValue){const e=/* @__PURE__ */new Map;for(const t of Object.keys(this.metadata))e.set(t,{action:"add",oldValue:void 0}),this._metadataChanged.emit({key:t,type:"add",newValue:this.getMetadata(t)});this._changed.emit({metadataChange:e})}}if(o.keysChanged.has("nbformat")){const e=o.changes.keys.get("nbformat"),t={key:"nbformat",oldValue:(null==e?void 0:e.oldValue)?e.oldValue:void 0,newValue:this.nbformat};this._changed.emit({nbformatChanged:t})}if(o.keysChanged.has("nbformat_minor")){const e=o.changes.keys.get("nbformat_minor"),t={key:"nbformat_minor",oldValue:(null==e?void 0:e.oldValue)?e.oldValue:void 0,newValue:this.nbformat_minor};this._changed.emit({nbformatChanged:t})}}},this._onYCellsChanged=e=>{e.changes.added.forEach(e=>{const t=e.content.type;if(!this._ycellMapping.has(t)){const e=p(t,{notebook:this});this._ycellMapping.set(t,e)}}),e.changes.deleted.forEach(e=>{const t=e.content.type,o=this._ycellMapping.get(t);o&&(o.dispose(),this._ycellMapping.delete(t))});let t=0;const o=[];e.changes.delta.forEach(e=>{if(null!=e.insert){const s=e.insert.map(e=>this._ycellMapping.get(e));o.push({insert:s}),this.cells.splice(t,0,...s),t+=e.insert.length}else null!=e.delete?(o.push(e),this.cells.splice(t,e.delete)):null!=e.retain&&(o.push(e),t+=e.retain)}),this._changed.emit({cellsChange:o})},this._metadataChanged=new g(this),this._ycells=this.ydoc.getArray("cells"),this._ycellMapping=/* @__PURE__ */new WeakMap,this._disableDocumentWideUndoRedo=null!==(t=e.disableDocumentWideUndoRedo)&&void 0!==t&&t,this.cells=this._ycells.toArray().map(e=>(this._ycellMapping.has(e)||this._ycellMapping.set(e,p(e,{notebook:this})),this._ycellMapping.get(e))),this.undoManager.addToScope(this._ycells),this._ycells.observe(this._onYCellsChanged),this.ymeta.observeDeep(this._onMetaChanged)}static create(e={}){var t,o,s,n,i,r,a,l,d;const c=new Ye({disableDocumentWideUndoRedo:null!==(t=e.disableDocumentWideUndoRedo)&&void 0!==t&&t}),h={cells:null!==(s=null===(o=e.data)||void 0===o?void 0:o.cells)&&void 0!==s?s:[],nbformat:null!==(i=null===(n=e.data)||void 0===n?void 0:n.nbformat)&&void 0!==i?i:4,nbformat_minor:null!==(a=null===(r=e.data)||void 0===r?void 0:r.nbformat_minor)&&void 0!==a?a:5,metadata:null!==(d=null===(l=e.data)||void 0===l?void 0:l.metadata)&&void 0!==d?d:{}};return c.fromJSON(h),c}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}get metadata(){return this.getMetadata()}set metadata(e){this.setMetadata(e)}get metadataChanged(){return this._metadataChanged}get nbformat(){return this.ymeta.get("nbformat")}set nbformat(e){this.transact(()=>{this.ymeta.set("nbformat",e)},!1)}get nbformat_minor(){return this.ymeta.get("nbformat_minor")}set nbformat_minor(e){this.transact(()=>{this.ymeta.set("nbformat_minor",e)},!1)}dispose(){this.isDisposed||(this._ycells.unobserve(this._onYCellsChanged),this.ymeta.unobserveDeep(this._onMetaChanged),super.dispose())}getCell(e){return this.cells[e]}addCell(e){return this.insertCell(this._ycells.length,e)}insertCell(e,t){return this.insertCells(e,[t])[0]}insertCells(e,t){const o=t.map(e=>{const t=_(e,this);return this._ycellMapping.set(t.ymodel,t),t});return this.transact(()=>{this._ycells.insert(e,o.map(e=>e.ymodel))}),o}moveCell(e,t){this.moveCells(e,t)}moveCells(e,t,o=1){const s=new Array(o).fill(!0).map((t,o)=>this.getCell(e+o).toJSON());this.transact(()=>{this._ycells.delete(e,o),this._ycells.insert(e>t?t:t-o+1,s.map(e=>_(e,this).ymodel))})}deleteCell(e){this.deleteCellRange(e,e+1)}deleteCellRange(e,t){this.transact(()=>{this._ycells.delete(e,t-e)})}deleteMetadata(e){if(void 0===this.getMetadata(e))return;const t=this.metadata;delete t[e],this.setMetadata(t)}getMetadata(e){const t=this.ymeta.get("metadata");if(void 0!==t){if("string"==typeof e){const o=t.get(e);return void 0===o?void 0:h.deepCopy(o)}return h.deepCopy(t.toJSON())}}setMetadata(e,t){var o;if("string"==typeof e){if(void 0===t)throw new TypeError(`Metadata value for ${e} cannot be 'undefined'; use deleteMetadata.`);if(h.deepEqual(null!==(o=this.getMetadata(e))&&void 0!==o?o:null,t))return;const s={};s[e]=t,this.updateMetadata(s)}else if(!this.metadata||!h.deepEqual(this.metadata,e)){const t=h.deepCopy(e),o=this.ymeta.get("metadata");if(void 0===o)return;this.transact(()=>{o.clear();for(const[e,s]of Object.entries(t))o.set(e,s)})}}updateMetadata(e){const t=h.deepCopy(e),o=this.ymeta.get("metadata");void 0!==o&&this.transact(()=>{for(const[e,s]of Object.entries(t))o.set(e,s)})}getSource(){return this.toJSON()}setSource(e){this.fromJSON(e)}fromJSON(e){this.transact(()=>{this.nbformat=e.nbformat,this.nbformat_minor=e.nbformat_minor;const t=e.metadata;if(void 0!==t.orig_nbformat&&delete t.orig_nbformat,this.metadata)this.metadata=t;else{const e=new f;for(const[o,s]of Object.entries(t))e.set(o,s);this.ymeta.set("metadata",e)}const o=4===e.nbformat&&e.nbformat_minor>=5,s=e.cells.map(e=>(o||delete e.id,e));this.insertCells(this.cells.length,s),this.deleteCellRange(0,this.cells.length)})}toJSON(){const e=4===this.nbformat&&this.nbformat_minor<=4;return{metadata:this.metadata,nbformat_minor:this.nbformat_minor,nbformat:this.nbformat,cells:this.cells.map(t=>{const o=t.toJSON();return e&&delete o.id,o})}}}class Ze{constructor(e){this.model=e,this._cellMap=/* @__PURE__ */new WeakMap,this._changed=new g(this),this._isDisposed=!1,this._insertCells(0,this.model.cells),this.model.changed.connect(this._onSharedModelChanged,this)}get changed(){return this._changed}get isDisposed(){return this._isDisposed}get length(){return this.model.cells.length}*[Symbol.iterator](){for(const e of this.model.cells)yield this._cellMap.get(e)}dispose(){var e;if(!this._isDisposed){this._isDisposed=!0;for(const t of this.model.cells)null===(e=this._cellMap.get(t))||void 0===e||e.dispose();g.clearData(this)}}get(e){return this._cellMap.get(this.model.cells[e])}_insertCells(e,t){return t.forEach(e=>{let t;switch(e.cell_type){case"code":t=new C({sharedModel:e});break;case"markdown":t=new y({sharedModel:e});break;default:t=new v({sharedModel:e})}this._cellMap.set(e,t),e.disposed.connect(()=>{t.dispose(),this._cellMap.delete(e)})}),this.length}_onSharedModelChanged(e,t){var o;let s=0;const n=new Array;null===(o=t.cellsChange)||void 0===o||o.forEach(e=>{null!=e.insert?(this._insertCells(s,e.insert),n.push({type:"add",newIndex:s,newValues:e.insert.map(e=>this._cellMap.get(e)),oldIndex:-2,oldValues:[]}),s+=e.insert.length):null!=e.delete?n.push({type:"remove",newIndex:-1,newValues:[],oldIndex:s,oldValues:new Array(e.delete).fill(void 0)}):null!=e.retain&&(s+=e.retain)}),n.forEach(e=>this._changed.emit(e))}}class Qe{constructor(e){this._requestBatchSize=10,this._cursor=0,this._hasSession=!1,this._history=[],this._placeholder="",this._kernelSession="",this._setByHistory=!1,this._isDisposed=!1,this._editor=null,this._filtered=[],this._kernel=null,this._sessionContext=e.sessionContext,this._trans=(e.translator||w).load("jupyterlab"),this._handleKernel().then(()=>{this._sessionContext.kernelChanged.connect(this._handleKernel,this)}),this._toRequest=this._requestBatchSize}get editor(){return this._editor}set editor(e){if(this._editor===e)return;const t=this._editor;t&&t.model.sharedModel.changed.disconnect(this.onTextChange,this),this._editor=e,e&&e.model.sharedModel.changed.connect(this.onTextChange,this)}get placeholder(){return this._placeholder}get kernelSession(){return this._kernelSession}get isDisposed(){return this._isDisposed}dispose(){this._isDisposed=!0,this._history.length=0,g.clearData(this)}async checkSession(e){var t;this._hasSession||(await this._retrieveHistory(),this._hasSession=!0,this.editor=e.editor,this._placeholder=(null===(t=this._editor)||void 0===t?void 0:t.model.sharedModel.getSource())||"",this.setFilter(this._placeholder),this._cursor=this._filtered.length-1)}async back(e){await this.checkSession(e),--this._cursor,this._cursor<0&&await this.fetchBatch(),this._cursor=Math.max(0,this._cursor);return this._filtered[this._cursor]}async forward(e){await this.checkSession(e),++this._cursor,this._cursor=Math.min(this._filtered.length-1,this._cursor);return this._filtered[this._cursor]}updateEditor(e,t){var o,s;if(e){const n=null===(o=e.editor)||void 0===o?void 0:o.model,i=null==n?void 0:n.sharedModel.getSource();if(this.isDisposed||!t)return;if(i===t)return;this._setByHistory=!0,null==n||n.sharedModel.setSource(t);let r=0;r=t.indexOf("\n"),r<0&&(r=t.length),null===(s=e.editor)||void 0===s||s.setCursorPosition({line:0,column:r})}}reset(){this._hasSession=!1,this._placeholder="",this._toRequest=this._requestBatchSize}async fetchBatch(){this._toRequest+=this._requestBatchSize;let e=this._filtered.slice().reverse(),t=this._history.slice();await this._retrieveHistory().then(()=>{this.setFilter(this._placeholder);let t=0,o=this._filtered.slice().reverse();for(let s=0;s<e.length;s++){let n=e[s];for(let e=s+t;e<o.length&&n!==o[e];e++)t+=1}this._cursor=this._filtered.length-(e.length+1)-t}),this._cursor<0&&this._history.length>t.length&&await this.fetchBatch()}onHistory(e,t){this._history.length=0;let o=["","",""],s=["","",""],n="";if("ok"===e.content.status){for(let t=0;t<e.content.history.length;t++)s=e.content.history[t],s!==o&&(n=e.content.history[t][0],this._history.push(o=s));this.kernelSession||s[2]==(null==t?void 0:t.model.sharedModel.getSource())&&(this._kernelSession=n)}}onTextChange(){this._setByHistory?this._setByHistory=!1:this.reset()}async _handleKernel(){var e;this._kernel=null===(e=this._sessionContext.session)||void 0===e?void 0:e.kernel,this._kernel?await this._retrieveHistory().catch():this._history.length=0}async _retrieveHistory(e){var t,o;return await(null===(t=this._kernel)||void 0===t?void 0:t.requestHistory((o=this._toRequest,{output:!1,raw:!0,hist_access_type:"tail",n:o})).then(t=>{this.onHistory(t,e)}).catch(()=>{console.warn(this._trans.__("History was unable to be retrieved"))}))}setFilter(e=""){this._filtered.length=0;let t="",o="";for(let s=0;s<this._history.length;s++)o=this._history[s][2],o!==t&&e!==o&&this._filtered.push(t=o);this._filtered.push(e)}}class Xe{constructor(e={}){var t,o;this.standaloneModel=!1,this._dirty=!1,this._readOnly=!1,this._contentChanged=new g(this),this._stateChanged=new g(this),this._isDisposed=!1,this._metadataChanged=new g(this),this.standaloneModel=void 0===e.sharedModel,e.sharedModel?this.sharedModel=e.sharedModel:this.sharedModel=Ye.create({disableDocumentWideUndoRedo:null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,data:{nbformat:k,nbformat_minor:b,metadata:{kernelspec:{name:"",display_name:""},language_info:{name:null!==(o=e.languagePreference)&&void 0!==o?o:""}}}}),this._cells=new Ze(this.sharedModel),this._trans=(e.translator||w).load("jupyterlab"),this._deletedCells=[],this._collaborationEnabled=!!(null==e?void 0:e.collaborationEnabled),this._cells.changed.connect(this._onCellsChanged,this),this.sharedModel.changed.connect(this._onStateChanged,this),this.sharedModel.metadataChanged.connect(this._onMetadataChanged,this)}get contentChanged(){return this._contentChanged}get metadataChanged(){return this._metadataChanged}get stateChanged(){return this._stateChanged}get cells(){return this._cells}get dirty(){return this._dirty}set dirty(e){const t=this._dirty;e!==t&&(this._dirty=e,this.triggerStateChange({name:"dirty",oldValue:t,newValue:e}))}get readOnly(){return this._readOnly}set readOnly(e){if(e===this._readOnly)return;const t=this._readOnly;this._readOnly=e,this.triggerStateChange({name:"readOnly",oldValue:t,newValue:e})}get metadata(){return this.sharedModel.metadata}get nbformat(){return this.sharedModel.nbformat}get nbformatMinor(){return this.sharedModel.nbformat_minor}get defaultKernelName(){var e;const t=this.getMetadata("kernelspec");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get deletedCells(){return this._deletedCells}get defaultKernelLanguage(){var e;const t=this.getMetadata("language_info");return null!==(e=null==t?void 0:t.name)&&void 0!==e?e:""}get collaborative(){return this._collaborationEnabled}dispose(){if(this.isDisposed)return;this._isDisposed=!0;const e=this.cells;this._cells=null,e.dispose(),this.standaloneModel&&this.sharedModel.dispose(),g.clearData(this)}deleteMetadata(e){return this.sharedModel.deleteMetadata(e)}getMetadata(e){return this.sharedModel.getMetadata(e)}setMetadata(e,t){void 0===t?this.sharedModel.deleteMetadata(e):this.sharedModel.setMetadata(e,t)}toString(){return JSON.stringify(this.toJSON())}fromString(e){this.fromJSON(JSON.parse(e))}toJSON(){return this._ensureMetadata(),this.sharedModel.toJSON()}fromJSON(e){var t,o;const s=h.deepCopy(e),n=e.metadata.orig_nbformat;if(s.nbformat=Math.max(e.nbformat,k),(s.nbformat!==e.nbformat||s.nbformat_minor<b)&&(s.nbformat_minor=b),void 0!==n&&s.nbformat!==n){let e;e=s.nbformat>n?this._trans.__("This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.",n,s.nbformat):this._trans.__("This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.",n,s.nbformat),x({title:this._trans.__("Notebook converted"),body:e,buttons:[M.okButton({label:this._trans.__("Ok")})]})}0===(null!==(o=null===(t=s.cells)||void 0===t?void 0:t.length)&&void 0!==o?o:0)&&(s.cells=[{cell_type:"code",source:"",metadata:{trusted:!0}}]),this.sharedModel.fromJSON(s),this._ensureMetadata(),this.dirty=!0}_onCellsChanged(e,t){switch(t.type){case"add":case"set":t.newValues.forEach(e=>{e.contentChanged.connect(this.triggerContentChange,this)})}this.triggerContentChange()}_onMetadataChanged(e,t){this._metadataChanged.emit(t),this.triggerContentChange()}_onStateChanged(e,t){t.stateChange&&t.stateChange.forEach(e=>{"dirty"===e.name?this.dirty=e.newValue:e.oldValue!==e.newValue&&this.triggerStateChange({newValue:void 0,oldValue:void 0,...e})})}_ensureMetadata(e=""){this.getMetadata("language_info")||this.sharedModel.setMetadata("language_info",{name:e}),this.getMetadata("kernelspec")||this.sharedModel.setMetadata("kernelspec",{name:"",display_name:""})}triggerStateChange(e){this._stateChanged.emit(e)}triggerContentChange(){this._contentChanged.emit(void 0),this.dirty=!0}get isDisposed(){return this._isDisposed}}class et{constructor(e={}){var t,o;this._disposed=!1,this._disableDocumentWideUndoRedo=null===(t=e.disableDocumentWideUndoRedo)||void 0===t||t,this._collaborative=null===(o=e.collaborative)||void 0===o||o}get disableDocumentWideUndoRedo(){return this._disableDocumentWideUndoRedo}set disableDocumentWideUndoRedo(e){this._disableDocumentWideUndoRedo=e}get name(){return"notebook"}get contentType(){return"notebook"}get fileFormat(){return"json"}get collaborative(){return this._collaborative}get isDisposed(){return this._disposed}dispose(){this._disposed=!0}createNew(e={}){return new Xe({languagePreference:e.languagePreference,sharedModel:e.sharedModel,collaborationEnabled:e.collaborationEnabled&&this.collaborative,disableDocumentWideUndoRedo:this._disableDocumentWideUndoRedo})}preferredLanguage(e){return""}}class tt{constructor(e){var t,o;this._isReady=!1,this._isDisposed=!1,this._isPopulated=!1,this._path="",this._lineEnding=null,this._contentsModel=null,this._populatedPromise=new S,this._pathChanged=new g(this),this._fileChanged=new g(this),this._saveState=new g(this),this._disposed=new g(this),this._lastModifiedCheckMargin=500,this._conflictModalIsOpen=!1;const s=this._manager=e.manager;this.translator=e.translator||w,this._contentProviderId=e.contentProviderId,this._trans=this.translator.load("jupyterlab"),this._factory=e.factory,this._dialogs=null!==(t=e.sessionDialogs)&&void 0!==t?t:new P({translator:e.translator}),this._opener=e.opener||ot.noOp,this._path=this._manager.contents.normalize(e.path),this._lastModifiedCheckMargin=e.lastModifiedCheckMargin||500;const n=this._manager.contents.localPath(this._path),i=this._factory.preferredLanguage(E.PathExt.basename(n)),r=this._manager.contents.getSharedModelFactory(this._path,{contentProviderId:e.contentProviderId}),a=null==r?void 0:r.createNew({path:this._path,format:this._factory.fileFormat,contentType:this._factory.contentType,collaborative:this._factory.collaborative});this._model=this._factory.createNew({languagePreference:i,sharedModel:a,collaborationEnabled:null!==(o=null==r?void 0:r.collaborative)&&void 0!==o&&o}),this._readyPromise=s.ready.then(()=>this._populatedPromise.promise);const l=E.PathExt.extname(this._path);this.sessionContext=new j({kernelManager:s.kernels,sessionManager:s.sessions,specsManager:s.kernelspecs,path:this._path,type:".ipynb"===l?"notebook":"file",name:E.PathExt.basename(n),kernelPreference:e.kernelPreference||{shouldStart:!1},setBusy:e.setBusy}),this.sessionContext.propertyChanged.connect(this._onSessionChanged,this),s.contents.fileChanged.connect(this._onFileChanged,this);const d=e.urlResolverFactory?e.urlResolverFactory:{createResolver:e=>new Fe.UrlResolver(e)};this._urlResolver=d.createResolver({path:this._path,contents:s.contents})}get pathChanged(){return this._pathChanged}get fileChanged(){return this._fileChanged}get saveState(){return this._saveState}get disposed(){return this._disposed}get lastModifiedCheckMargin(){return this._lastModifiedCheckMargin}set lastModifiedCheckMargin(e){this._lastModifiedCheckMargin=e}get model(){return this._model}get path(){return this._path}get localPath(){return this._manager.contents.localPath(this._path)}get contentsModel(){return this._contentsModel?{...this._contentsModel}:null}get factoryName(){return this.isDisposed?"":this._factory.name}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this.sessionContext.dispose(),this._model.dispose(),this._model.sharedModel.dispose(),this._disposed.emit(void 0),g.clearData(this))}get isReady(){return this._isReady}get ready(){return this._readyPromise}get canSave(){var e;return!(!(null===(e=this._contentsModel)||void 0===e?void 0:e.writable)||this._model.collaborative)}get urlResolver(){return this._urlResolver}async initialize(e){e?await this._save():await this._revert(),this.model.sharedModel.clearUndoHistory()}rename(e){return this.ready.then(()=>this._manager.ready.then(()=>this._rename(e)))}async save(){await this.ready,await this._save()}async saveAs(){await this.ready;const e=this._manager.contents.localPath(this.path),t=await ot.getSavePath(e);if(this.isDisposed||!t)return!1;const o=this._manager.contents.driveName(this.path),s=""==o?t:`${o}:${t}`;if(s===this._path)return await this.save(),!0;try{await this._manager.ready,await this._manager.contents.get(s,{contentProviderId:this._contentProviderId}),await this._maybeOverWrite(s)}catch(n){if(!n.response||404!==n.response.status){if(!n.response)return!1;throw n}}return await this._finishSaveAs(s),!0}async download(){const e=await this._manager.contents.getDownloadUrl(this._path),t=document.createElement("a");t.href=e,t.download="",document.body.appendChild(t),t.click(),document.body.removeChild(t)}async revert(){await this.ready,await this._revert()}createCheckpoint(){const e=this._manager.contents;return this._manager.ready.then(()=>e.createCheckpoint(this._path))}deleteCheckpoint(e){const t=this._manager.contents;return this._manager.ready.then(()=>t.deleteCheckpoint(this._path,e))}restoreCheckpoint(e){const t=this._manager.contents,o=this._path;return this._manager.ready.then(()=>e?t.restoreCheckpoint(o,e):this.listCheckpoints().then(s=>{if(!this.isDisposed&&s.length)return e=s[s.length-1].id,t.restoreCheckpoint(o,e)}))}listCheckpoints(){const e=this._manager.contents;return this._manager.ready.then(()=>e.listCheckpoints(this._path))}addSibling(e,t={}){const o=this._opener;return o&&o(e,t),new D(()=>{e.close()})}_onFileChanged(e,t){var o,s,n;if("save"===t.type&&this._model.collaborative){if((null===(o=this._contentsModel)||void 0===o?void 0:o.path)!==(null===(s=t.newValue)||void 0===s?void 0:s.path))return;return void this._updateContentsModel({...this._contentsModel,...t.newValue})}if("rename"!==t.type)return;let i=t.oldValue&&t.oldValue.path,r=t.newValue&&t.newValue.path;if(r&&0===this._path.indexOf(i||"")){let e=t.newValue;i!==this._path&&(r=this._path.replace(new RegExp(`^${i}/`),`${r}/`),i=this._path,e={last_modified:null===(n=t.newValue)||void 0===n?void 0:n.created,path:r}),this._updateContentsModel({...this._contentsModel,...e}),this._updatePath(r)}}_onSessionChanged(e,t){if("path"!==t)return;const o=this._manager.contents.driveName(this.path);let s=this._manager.contents.localPath(this.sessionContext.session.path);o&&(s=`${o}:${s}`),this._updatePath(s)}_updateContentsModel(e){var t,o,s,n;const i={path:e.path,name:e.name,type:e.type,writable:e.writable,created:e.created,last_modified:e.last_modified,mimetype:e.mimetype,format:e.format,hash:e.hash,hash_algorithm:e.hash_algorithm},r=null!==(o=null===(t=this._contentsModel)||void 0===t?void 0:t.last_modified)&&void 0!==o?o:null,a=null!==(n=null===(s=this._contentsModel)||void 0===s?void 0:s.hash)&&void 0!==n?n:null;this._contentsModel=i,(!r&&!a||!a&&i.last_modified!==r||a&&i.hash!==a)&&this._fileChanged.emit(i)}_updatePath(e){var t,o,s,n;if(this._path===e)return;this._path=e;const i=this._manager.contents.localPath(e),r=E.PathExt.basename(i);if((null===(t=this.sessionContext.session)||void 0===t?void 0:t.path)!==e&&(null===(o=this.sessionContext.session)||void 0===o||o.setPath(e)),(null===(s=this.sessionContext.session)||void 0===s?void 0:s.name)!==r&&(null===(n=this.sessionContext.session)||void 0===n||n.setName(r)),this._urlResolver.path!==e&&(this._urlResolver.path=e),this._contentsModel&&(this._contentsModel.path!==e||this._contentsModel.name!==r)){const t={...this._contentsModel,name:r,path:e};this._updateContentsModel(t)}this._pathChanged.emit(e)}async _populate(){if(this._isPopulated=!0,this._isReady=!0,this._populatedPromise.resolve(void 0),await this._maybeCheckpoint(!1),this.isDisposed)return;const e=this._model.defaultKernelName||this.sessionContext.kernelPreference.name;this.sessionContext.kernelPreference={...this.sessionContext.kernelPreference,name:e,language:this._model.defaultKernelLanguage},this.sessionContext.initialize().then(e=>{e&&this._dialogs.selectKernel(this.sessionContext)})}async _rename(e){const t=this.localPath.split("/");t[t.length-1]=e;let o=E.PathExt.join(...t);const s=this._manager.contents.driveName(this.path);s&&(o=`${s}:${o}`),await this._manager.contents.rename(this.path,o)}async _save(){this._saveState.emit("started");const e=this._createSaveOptions();try{await this._manager.ready;const t=await this._maybeSave(e);if(this.isDisposed)return;this._model.dirty=!1,this._updateContentsModel(t),this._isPopulated||await this._populate(),this._saveState.emit("completed")}catch(t){const{name:e}=t;if("ModalCancelError"===e||"ModalDuplicateError"===e)throw t;const o=this._manager.contents.localPath(this._path),s=E.PathExt.basename(o);throw this._handleError(t,this._trans.__("File Save Error for %1",s)),this._saveState.emit("failed"),t}}_revert(e=!1){const t={type:this._factory.contentType,content:null!==this._factory.fileFormat,hash:null!==this._factory.fileFormat,...null!==this._factory.fileFormat?{format:this._factory.fileFormat}:{},contentProviderId:this._contentProviderId},o=this._path,s=this._model;return this._manager.ready.then(()=>this._manager.contents.get(o,t)).then(e=>{if(!this.isDisposed){if(e.content)if("json"===e.format)s.fromJSON(e.content);else{let t=e.content;-1!==t.indexOf("\r\n")?(this._lineEnding="\r\n",t=t.replace(/\r\n/g,"\n")):-1!==t.indexOf("\r")?(this._lineEnding="\r",t=t.replace(/\r/g,"\n")):this._lineEnding=null,s.fromString(t)}return this._updateContentsModel(e),s.dirty=!1,this._isPopulated?void 0:this._populate()}}).catch(async e=>{const t=this._manager.contents.localPath(this._path),o=E.PathExt.basename(t);throw this._handleError(e,this._trans.__("File Load Error for %1",o)),e})}_maybeSave(e){const t=this._path;return this._manager.contents.get(t,{content:!1,hash:!0,contentProviderId:this._contentProviderId}).then(o=>{var s,n,i,r;if(this.isDisposed)return Promise.reject(new Error("Disposed"));const a=void 0!==(null===(s=this.contentsModel)||void 0===s?void 0:s.hash)&&null!==(null===(n=this.contentsModel)||void 0===n?void 0:n.hash)&&void 0!==o.hash&&null!==o.hash,l=null===(i=this.contentsModel)||void 0===i?void 0:i.hash,d=o.hash;if(a&&l!==d)return console.warn(`Different hash found for ${this.path}`),this._raiseConflict(o,e);const c=this._lastModifiedCheckMargin,h=null===(r=this.contentsModel)||void 0===r?void 0:r.last_modified,u=h?new Date(h):/* @__PURE__ */new Date,m=new Date(o.last_modified);return!a&&h&&m.getTime()-u.getTime()>c?(console.warn(`Last saving performed ${u} while the current file seems to have been saved ${m}`),this._raiseConflict(o,e)):this._manager.contents.save(t,{...e,contentProviderId:this._contentProviderId}).then(async e=>{const o=await this._manager.contents.get(t,{content:!1,hash:!0,contentProviderId:this._contentProviderId});return{...e,hash:o.hash,hash_algorithm:o.hash_algorithm}})},o=>{if(o.response&&404===o.response.status)return this._manager.contents.save(t,e).then(async e=>{const o=await this._manager.contents.get(t,{content:!1,hash:!0,contentProviderId:this._contentProviderId});return{...e,hash:o.hash,hash_algorithm:o.hash_algorithm}});throw o})}async _handleError(e,t){await N(t,e)}_maybeCheckpoint(e){let t=Promise.resolve(void 0);return this.canSave?(t=e?this.createCheckpoint().then():this.listCheckpoints().then(e=>{if(!this.isDisposed&&!e.length&&this.canSave)return this.createCheckpoint().then()}),t.catch(e=>{if(!e.response||403!==e.response.status)throw e})):t}_raiseConflict(e,t){if(this._conflictModalIsOpen){const e=new Error("Modal is already displayed");return e.name="ModalDuplicateError",Promise.reject(e)}const o=this._trans.__('"%1" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?',this.path),s=M.okButton({label:this._trans.__("Revert"),actions:["revert"]}),n=M.warnButton({label:this._trans.__("Overwrite"),actions:["overwrite"]});return this._conflictModalIsOpen=!0,x({title:this._trans.__("File Changed"),body:o,buttons:[M.cancelButton(),s,n]}).then(o=>{if(this._conflictModalIsOpen=!1,this.isDisposed)return Promise.reject(new Error("Disposed"));if(o.button.actions.includes("overwrite"))return this._manager.contents.save(this._path,{...t,contentProviderId:this._contentProviderId});if(o.button.actions.includes("revert"))return this.revert().then(()=>e);const s=new Error("Cancel");return s.name="ModalCancelError",Promise.reject(s)})}_maybeOverWrite(e){const t=this._trans.__('"%1" already exists. Do you want to replace it?',e),o=M.warnButton({label:this._trans.__("Overwrite"),accept:!0});return x({title:this._trans.__("File Overwrite?"),body:t,buttons:[M.cancelButton(),o]}).then(t=>this.isDisposed?Promise.reject(new Error("Disposed")):t.button.accept?this._manager.contents.delete(e).then(()=>this._finishSaveAs(e)):Promise.reject(new Error("Cancelled")))}async _finishSaveAs(e){this._saveState.emit("started");try{await this._manager.ready;const t=this._createSaveOptions();await this._manager.contents.save(e,t),await this._maybeCheckpoint(!0),this._saveState.emit("completed")}catch(t){if("Cancel"===t.message||"Modal is already displayed"===t.message)throw t;const e=this._manager.contents.localPath(this._path),o=E.PathExt.basename(e);return this._handleError(t,this._trans.__("File Save Error for %1",o)),void this._saveState.emit("failed")}}_createSaveOptions(){let e=null;return"json"===this._factory.fileFormat?e=this._model.toJSON():(e=this._model.toString(),this._lineEnding&&(e=e.replace(/\n/g,this._lineEnding))),{type:this._factory.contentType,format:this._factory.fileFormat,content:e}}}var ot;!function(e){e.getSavePath=function(e,o){const s=(o=o||w).load("jupyterlab"),n=M.okButton({label:s.__("Save"),accept:!0});return x({title:s.__("Save File As…"),body:new t(e),buttons:[M.cancelButton(),n]}).then(e=>{var t;if(e.button.accept)return null!==(t=e.value)&&void 0!==t?t:void 0})},e.noOp=function(){};class t extends T{constructor(e){super({node:o(e)})}getValue(){return this.node.value}}function o(e){const t=document.createElement("input");return t.value=e,t}}(ot||(ot={}));class st extends A{constructor(){super(...arguments),this._activeCell=null,this._activeCellChanged=new g(this),this._selectionChanged=new g(this)}get activeCell(){const e=this.currentWidget;return e&&e.content.activeCell||null}get activeCellChanged(){return this._activeCellChanged}get selectionChanged(){return this._selectionChanged}add(e){const t=super.add(e);return e.content.activeCellChanged.connect(this._onActiveCellChanged,this),e.content.selectionChanged.connect(this._onSelectionChanged,this),t}dispose(){this._activeCell=null,super.dispose()}onCurrentChanged(e){const t=this.activeCell;t&&t===this._activeCell||(this._activeCell=t,e&&this._activeCellChanged.emit(e.content.activeCell||null))}_onActiveCellChanged(e,t){this.currentWidget&&this.currentWidget.content===e&&(this._activeCell=t||null,this._activeCellChanged.emit(this._activeCell))}_onSelectionChanged(e){this.currentWidget&&this.currentWidget.content===e&&this._selectionChanged.emit(void 0)}}class nt extends I{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||O.defaultEditorConfig,this._notebookConfig=e.notebookConfig||O.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const o=e.translator,s=new Qe({sessionContext:e.sessionContext,translator:o}),n={rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig,translator:o,kernelHistory:s},i=this.contentFactory.createNotebook(n);return new L({context:e,content:i})}}"undefined"!=typeof window&&void 0!==window.define&&(window.define("@jupyter-widgets/base",Ee),window.define("@jupyter-widgets/controls",je));class it extends Pe{constructor(e){super(),this._rendermime=e;const t=document.createElement("script"),o=document.createElement("script");o.setAttribute("data-jupyter-widgets-cdn-only","true"),document.body.appendChild(o),t.src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js",document.body.appendChild(t),t.onload=()=>{window.define("@jupyter-widgets/base",Ee),window.define("@jupyter-widgets/controls",je),this._registry=new De,this.register({name:"@jupyter-widgets/base",version:Ne,exports:()=>import("./index-V6IoXEpD.js").then(e=>e.d)}),this.register({name:"@jupyter-widgets/controls",version:Te,exports:()=>import("./index-V6IoXEpD.js").then(e=>e.e)})}}callbacks(e){return{iopub:{output:e=>{this._onUnhandledIOPubMessage.emit(e)}}}}registerWithKernel(e){this._commRegistration&&this._commRegistration.dispose(),e&&e.registerCommTarget(this.comm_target_name,this._handleCommOpen)}_handleKernelChanged({oldValue:e,newValue:t}){e&&e.removeCommTarget(this.comm_target_name,this._handleCommOpen),t&&t.registerCommTarget(this.comm_target_name,this._handleCommOpen)}disconnect(){super.disconnect(),this._restoredStatus=!1}async _loadFromKernel(){if(!this.kernel)throw new Error("Kernel not set");if(!1!==this.kernel?.handleComms)return super._loadFromKernel()}filterExistingModelState(e){return super.filterExistingModelState(e)}async _create_comm(e,t,o,s,n){const i=this.kernel;if(!i)throw new Error("No current kernel");const r=i.createComm(e,t);return(o||s)&&r.open(o,s,n),new Ae.services.Comm(r)}async _get_comm_info(){const e=this.kernel;if(!e)throw new Error("No current kernel");const t=await e.requestCommInfo({target_name:this.comm_target_name});return"ok"===t.content.status?t.content.comms:{}}get isDisposed(){return this._isDisposed}dispose(){this.isDisposed||(this._isDisposed=!0,this._commRegistration&&this._commRegistration.dispose())}async resolveUrl(e){return e}async loadClass(e,t,o){"@jupyter-widgets/base"!==t&&"@jupyter-widgets/controls"!==t||!Ie.valid(o)||(o=`^${o}`);let s=this._getRegistry().getAllVersions(t);const n=2===o.split(".").length?o+".0":o;if(!s){const e=await Oe(t,n),o={name:t,version:n.replaceAll("^",""),exports:{...e}};if(this.register(o),s=this._getRegistry().getAllVersions(t),!s)throw new Error(`No version of module ${t} is registered`)}const i=this._registry.get(t,o);if(!i){const e=Object.keys(s);throw new Error(`Module ${t}, version ${o} is not registered, however,         ${e.join(",")} ${e.length>1?"are":"is"}`)}let r;r="function"==typeof i?await i():await i;const a=r[e];if(!a)throw new Error(`Class ${e} not found in module ${t}`);return a}_getRegistry(){return this._registry}get rendermime(){return this._rendermime}get restored(){return this._restored}get restoredStatus(){return this._restoredStatus}get onUnhandledIOPubMessage(){return this._onUnhandledIOPubMessage}register(e){this._registry.set(e.name,e.version,e.exports)}register_model(e,t){super.register_model(e,t),t.then(t=>{this._modelsSync.set(e,t),t.once("comm:close",()=>{this._modelsSync.delete(e)})})}async clear_state(){await super.clear_state(),this._modelsSync=/* @__PURE__ */new Map}get_state_sync(e={}){const t=[];for(const o of this._modelsSync.values())o.comm_live&&t.push(o);return Le(t,e)}_handleCommOpen=async(e,t)=>{const o=new Ae.services.Comm(e);await this.handle_comm_open(o,t)};_restored=new g(this);_restoredStatus=!1;_kernelRestoreInProgress=!1;_isDisposed=!1;_registry=new De;_rendermime;_commRegistration;_modelsSync=/* @__PURE__ */new Map;_onUnhandledIOPubMessage=new g(this)}class rt extends it{constructor(e,t,o){super(t),this._context=e,this._context.sessionContext.kernelChanged.connect((e,t)=>{this._handleKernelChanged(t)}),this._context.sessionContext.statusChanged.connect((e,t)=>{this._handleKernelStatusChange(t)}),this._context.sessionContext.connectionStatusChanged.connect((e,t)=>{this._handleKernelConnectionStatusChange(t)}),this._context.sessionContext.session?.kernel&&this._handleKernelChanged({name:"kernel",oldValue:null,newValue:this._context.sessionContext.session?.kernel}),this.restoreWidgets(this._context.model),this._settings=o,e.saveState.connect((e,t)=>{"started"===t&&o.saveState&&this._saveState()})}_saveState(){const e=this.get_state_sync({drop_defaults:!0});this._context.model.setMetadata("widgets",{"application/vnd.jupyter.widget-state+json":e})}_handleKernelConnectionStatusChange(e){"connected"===e&&(this._kernelRestoreInProgress||this.restoreWidgets(this._context.model,{loadKernel:!0,loadNotebook:!1}))}_handleKernelStatusChange(e){"restarting"===e&&this.disconnect()}async restoreWidgets(e,{loadKernel:t,loadNotebook:o}={loadKernel:!0,loadNotebook:!0}){await this.context.sessionContext.ready;try{if(t)try{this._kernelRestoreInProgress=!0,await this._loadFromKernel()}finally{this._kernelRestoreInProgress=!1}o&&await this._loadFromNotebook(e),this._restoredStatus=!0,this._restored.emit()}catch(s){}}async _loadFromNotebook(e){const t=e.getMetadata("widgets");if(t&&t[Se]){let e=t[Se];e=this.filterExistingModelState(e),await this.set_state(e)}}dispose(){this.isDisposed||(this._context=null,super.dispose())}async resolveUrl(e){const t=await this.context.urlResolver.resolveUrl(e);return this.context.urlResolver.getDownloadUrl(t)}get context(){return this._context}get kernel(){return this._context.sessionContext?.session?.kernel??null}register_model(e,t){super.register_model(e,t),this.setDirty()}async clear_state(){await super.clear_state(),this.setDirty()}setDirty(){this._settings.saveState&&(this._context.model.dirty=!0)}_context;_settings}class at extends R{constructor(e,t){super(),this.mimeType=e.mimeType,t&&(this.manager=t)}set manager(e){e.restored.connect(this._rerender,this),this._manager.resolve(e)}async renderModel(e){const t=e.data[this.mimeType];this.node.textContent="Loading widget...";const o=await this._manager.promise;if(""===t.model_id)return this.hide(),Promise.resolve();let s,n;try{s=await o.get_model(t.model_id)}catch(i){return o.restoredStatus?(this.node.textContent="Please run the cell to display the IPyWidgets.",this.addClass("jupyter-widgets"),void console.error(i)):void(this._rerenderMimeModel=e)}this._rerenderMimeModel=null;try{n=(await o.create_view(s)).luminoWidget}catch(i){return this.node.textContent="Error displaying widget",this.addClass("jupyter-widgets"),void console.error(i)}this.node.textContent="",this.addWidget(n),n.disposed.connect(()=>{this.hide(),t.model_id=""})}dispose(){this.isDisposed||(this._manager=null,super.dispose())}_rerender(){this._rerenderMimeModel&&(this.node.textContent="",this.removeClass("jupyter-widgets"),this.renderModel(this._rerenderMimeModel))}mimeType;_manager=new S;_rerenderMimeModel=null}const lt="jp-GhostText-streamingIndicator",dt="jp-GhostText-errorIndicator";class ct{constructor(e){this.options=e}placeGhost(e,t){const o=[gt.addMark.of(t)];e.state.field(gt.markField,!1)||(o.push(pe.appendConfig.of([gt.markField])),o.push(pe.appendConfig.of([ae.domEventHandlers({blur:t=>{if(!1===this.options.onBlur(t))return!0;const o=[gt.removeMark.of(null)];setTimeout(()=>{e.dispatch({effects:o})},0)}})]))),e.dispatch({effects:o})}clearGhosts(e){const t=[gt.removeMark.of(null)];e.dispatch({effects:t})}}ct.streamingAnimation="uncover",ct.spacerRemovalDelay=700,ct.spacerRemovalDuration=300;class ht extends _e{constructor(e){super(),this.options=e,this.isSpacer=!1,this._clearErrorTimeout=null}eq(e){return e.content==this.content&&e.options.streaming===this.options.streaming&&e.options.error===this.options.error}get lineBreaks(){return(this.content.match(/\n/g)||"").length}updateDOM(e,t){return this._updateDOM(e),!0}get content(){return this.options.content}toDOM(){let e=document.createElement("span");return this.options.onPointerOver&&e.addEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.addEventListener("pointerleave",this.options.onPointerLeave),e.classList.add("jp-GhostText"),e.dataset.animation=ct.streamingAnimation,e.dataset.providedBy=this.options.providerId,this._updateDOM(e),e}_removeErrorAnimation(e){e.querySelectorAll(`.${dt}`).forEach(e=>{e.remove()})}_mountErrorAnimation(e){const t=document.createElement("span");t.className=dt;const o=this.options.error;(null==o?void 0:o.message)&&(t.title=null==o?void 0:o.message);e.querySelectorAll(`.${lt}, .${dt}`).forEach(e=>{e.remove()}),e.appendChild(t)}_updateDOM(e){var t,o;if(this.options.error)return this._mountErrorAnimation(e),void(this._clearErrorTimeout=setTimeout(()=>{this._removeErrorAnimation(e),this._clearErrorTimeout=null},5e3));null!==this._clearErrorTimeout&&(clearTimeout(this._clearErrorTimeout),this._removeErrorAnimation(e),this._clearErrorTimeout=null);let s=this.content,n="",i=this.options.addedPart;if(i&&(i.startsWith("\n")&&(i=i.substring(1)),s=s.substring(0,s.length-i.length)),this.options.maxLines){const e=s.split("\n");s=e.slice(0,this.options.maxLines).join("\n"),n=e.slice(this.options.maxLines).join("\n")}const r=Math.min(null!==(t=this.options.minLines)&&void 0!==t?t:0,null!==(o=this.options.maxLines)&&void 0!==o?o:1/0),a=Math.max(0,r-s.split("\n").length+1),l=new Array(a).fill("").join("\n");if(this.isSpacer)return void(e.innerText=s+l);e.innerText=s;let d=e;if(n.length>0){const t=document.createElement("span");t.className="jp-GhostText-hiddenWrapper",e.appendChild(t);const o=document.createElement("span");o.className="jp-GhostText-expandHidden",o.innerText="⇓";const s=document.createElement("span");t.appendChild(o),s.className="jp-GhostText-hiddenLines",s.innerText="\n"+n,t.appendChild(s),d=s}if(i){const e=document.createElement("span");e.className="jp-GhostText-streamedToken",e.innerText=i,d.appendChild(e)}if(this.options.streaming){const e=document.createElement("span");e.className=lt,d.appendChild(e)}if(l.length>0){const e=document.createTextNode(l);d.appendChild(e)}}destroy(e){this.options.onPointerOver&&e.removeEventListener("pointerover",this.options.onPointerOver),this.options.onPointerLeave&&e.removeEventListener("pointerleave",this.options.onPointerLeave),super.destroy(e)}}class ut extends ht{constructor(){super(...arguments),this.isSpacer=!0}}class mt extends ut{toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-lineSpacer"),e.style.animationDelay=ct.spacerRemovalDelay+"ms",e.style.animationDuration=ct.spacerRemovalDuration+"ms",e}}class pt extends ut{get content(){return this.options.content[0]}toDOM(){const e=super.toDOM();return e.classList.add("jp-GhostText-letterSpacer"),e}}var gt;!function(e){let t;var o;function s(e,t){return ge.widget({widget:new ht(e),side:1,ghostSpec:e}).range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))}(o=t||(t={}))[o.Set=0]="Set",o[o.Remove=1]="Remove",o[o.FilterAndUpdate=2]="FilterAndUpdate",e.addMark=pe.define({map:(e,t)=>({...e,from:t.mapPos(e.from),to:t.mapPos(e.from+e.content.length)})}),e.removeMark=pe.define(),e.markField=de.define({create:()=>ge.none,update(o,n){const i=function(o){for(let s of o.effects){if(s.is(e.addMark))return{action:t.Set,spec:s.value};if(s.is(e.removeMark))return{action:t.Remove}}return o.docChanged||o.selection?{action:t.FilterAndUpdate}:null}(n);if(o=o.update({filter:(e,t,o)=>!(o.spec.widget instanceof ut)||!o.spec.timeoutInfo.elapsed}),!i)return o.map(n.changes);switch(i.action){case t.Set:{const e=s(i.spec,n);return o.update({add:[e],filter:(t,o,s)=>s===e.value})}case t.Remove:return o.update({filter:()=>!1});case t.FilterAndUpdate:{let e=o.iter();for(;e.value&&e.value.spec.widget instanceof ut;)e.next();if(!e.value)return o.map(n.changes);const t=e.value.spec.ghostSpec,i={...t};let a=!1;n.changes.iterChanges((e,t,o,s,n)=>{if(!a)if(e===t&&o!==s)for(let r=0;r<n.lines;r++){const e=n.lineAt(r).text,t=r>0?"\n"+e:e;if(!i.content.startsWith(t)){a=!0;break}i.content=i.content.slice(t.length),i.from+=t.length}else a=!0});const l=a?function(e,t,o=1e3){if(e.content.length<2)return[];const s={elapsed:!1};setTimeout(()=>{s.elapsed=!0},o);const n=ge.widget({widget:new pt(e),side:1,timeoutInfo:s}),i=ge.widget({widget:new mt(e),side:1,timeoutInfo:s});return[n.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length)),i.range(Math.min(e.from,t.newDoc.length),Math.min(e.from,t.newDoc.length))]}(t,n):[s(i,n)],d=l.map(e=>e.value);if(o=o.update({add:l,filter:(e,t,o)=>d.includes(o)}),a)try{o=o.map(n.changes)}catch(r){return console.warn(r),ge.none}return o}}},provide:e=>ae.decorations.from(e)})}(gt||(gt={}));const _t="jp-mod-inline-completer-active",ft="jp-InlineCompleter-hover";class vt extends T{constructor(e){var t,o;super({node:document.createElement("div")}),this._clearHoverTimeout=null,this._current=0,this._editor=null,this._lastItem=null,this._model=null,this._providerWidget=new T,this._showShortcuts=vt.defaultSettings.showShortcuts,this._showWidget=vt.defaultSettings.showWidget,this._suggestionsCounter=new T,this._toolbar=new F,this.model=null!==(t=e.model)&&void 0!==t?t:null,this.editor=null!==(o=e.editor)&&void 0!==o?o:null,this.addClass("jp-InlineCompleter"),this.addClass("jp-ThemedContainer"),this._ghostManager=new ct({onBlur:this._onEditorBlur.bind(this)}),this._trans=e.trans;const s=this.layout=new $;s.addWidget(this._suggestionsCounter),s.addWidget(this.toolbar),s.addWidget(this._providerWidget),this._progressBar=document.createElement("div"),this._progressBar.className="jp-InlineCompleter-progressBar",this.node.appendChild(this._progressBar),this._updateShortcutsVisibility(),this._updateDisplay(),this.node.tabIndex=0}get toolbar(){return this._toolbar}get editor(){return this._editor}set editor(e){var t;null===(t=this.model)||void 0===t||t.reset(),this._editor=e}get model(){return this._model}set model(e){(e||this._model)&&e!==this._model&&(this._model&&(this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged,this),this._model.provisionProgress.disconnect(this._onProvisionProgress,this)),this._model=e,this._model&&(this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged,this),this._model.filterTextChanged.connect(this._onModelFilterTextChanged,this),this._model.provisionProgress.connect(this._onProvisionProgress,this)))}cycle(e){var t,o;const s=null===(o=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===o?void 0:o.items;if(s){if("next"===e){const e=this._current+1;this._current=e===s.length?0:e}else{const e=this._current-1;this._current=-1===e?s.length-1:e}this._updateStreamTracking(),this._render()}}accept(){const e=this.model,t=this.current,o=this._editor;if(!o||!e||!t)return;const s=e.cursor,n=t.insertText,i=o.getOffsetAt(o.getCursorPosition()),r=o.getOffsetAt(s),a={changes:{from:r,to:i,insert:n}};i<=i&&i>=r&&(a.selection={anchor:r+n.length}),o.editor.dispatch(a),e.reset(),this.update()}get current(){var e;const t=null===(e=this.model)||void 0===e?void 0:e.completions;return t?t.items[this._current]:null}_updateStreamTracking(){this._lastItem&&this._lastItem.stream.disconnect(this._onStream,this);const e=this.current;e&&e.stream.connect(this._onStream,this),this._lastItem=e}_onStream(e,t){var o;const s=null===(o=this.model)||void 0===o?void 0:o.completions;if(!s||!s.items||0===s.items.length)return;if(this.isHidden)return;const n=s.items[this._current];this._setText(n)}configure(e){this._showWidget=e.showWidget,this._updateDisplay(),e.showShortcuts!==this._showShortcuts&&(this._showShortcuts=e.showShortcuts,this._updateShortcutsVisibility()),ct.streamingAnimation=e.streamingAnimation,ct.spacerRemovalDelay=Math.max(0,e.editorResizeDelay-300),ct.spacerRemovalDuration=Math.max(0,Math.min(300,e.editorResizeDelay-300)),this._minLines=e.minLines,this._maxLines=e.maxLines,this._reserveSpaceForLongest=e.reserveSpaceForLongest,this._suppressIfTabCompleterActive=e.suppressIfTabCompleterActive}get suppressIfTabCompleterActive(){return this._suppressIfTabCompleterActive}get isActive(){var e;return!!(null===(e=this.editor)||void 0===e?void 0:e.host.classList.contains(_t))}handleEvent(e){if(!this.isHidden&&this._editor)switch(e.type){case"pointerdown":this._evtPointerdown(e);break;case"scroll":this._evtScroll(e)}}onUpdateRequest(e){super.onUpdateRequest(e);const t=this._model;if(!t)return;let o=t.completions;o&&o.items&&0!==o.items.length?this.isHidden&&(this.show(),this._setGeometry()):this.isHidden||this.hide()}onAfterAttach(e){document.addEventListener("scroll",this,!0),document.addEventListener("pointerdown",this,!0)}onBeforeDetach(e){document.removeEventListener("scroll",this,!0),document.removeEventListener("pointerdown",this,!0)}_evtPointerdown(e){var t;if(this.isHidden||!this._editor)return;const o=e.target;if(this.node.contains(o))return!0;this.hide(),null===(t=this.model)||void 0===t||t.reset()}_evtScroll(e){if(this.isHidden||!this._editor)return;const{node:t}=this;t.contains(e.target)||requestAnimationFrame(()=>{this._setGeometry()})}_onEditorBlur(e){var t;if(this.node.contains(e.relatedTarget))return!1;null===(t=this._editor)||void 0===t||t.host.classList.remove(_t),this.hide()}_onModelSuggestionsChanged(e,t){var o;if(this.isAttached){if("set"===t.event)this._current=null!==(o=t.indexMap.get(this._current))&&void 0!==o?o:0;else if("clear"===t.event){const e=this.editor;e&&(this._ghostManager.clearGhosts(e.editor),e.host.classList.remove(_t))}this._updateStreamTracking(),this.update(),this._render()}else this.update()}_onModelFilterTextChanged(e,t){var o,s;const n=null===(o=this.model)||void 0===o?void 0:o.completions;n&&n.items&&0!==n.items.length&&(this._current=null!==(s=t.get(this._current))&&void 0!==s?s:0,this._updateStreamTracking(),setTimeout(()=>{this._render(),this._setGeometry()},0))}_onProvisionProgress(e,t){requestAnimationFrame(()=>{0===t.pendingProviders?this._progressBar.style.display="none":(this._progressBar.style.display="",this._progressBar.style.width=100*t.pendingProviders/t.totalProviders+"%")})}_render(){var e,t;const o=null===(e=this.model)||void 0===e?void 0:e.completions;if(!o||!o.items||0===o.items.length)return;const s=o.items[this._current];if(this._setText(s),"never"===this._showWidget)return;this._suggestionsCounter.node.innerText=this._trans.__("%1/%2",this._current+1,o.items.length),this._providerWidget.node.title=this._trans.__("Provider: %1",s.provider.name);(null!==(t=s.provider.icon)&&void 0!==t?t:W).render(this._providerWidget.node)}_setText(e){var t,o,s;const n=e.insertText,i=this._editor,r=this._model;if(!r||!i)return;const a=i.editor;let l;if(this._reserveSpaceForLongest){const e=null!==(s=null===(o=null===(t=this.model)||void 0===t?void 0:t.completions)||void 0===o?void 0:o.items)&&void 0!==s?s:[],n=Math.max(...e.map(e=>e.insertText.split("\n").length));l=Math.max(this._minLines,n)}else l=this._minLines;this._ghostManager.placeGhost(a,{from:i.getOffsetAt(r.cursor),content:n,providerId:e.provider.identifier,addedPart:e.lastStreamed,streaming:e.streaming,minLines:l,maxLines:this._maxLines,onPointerOver:this._onPointerOverGhost.bind(this),onPointerLeave:this._onPointerLeaveGhost.bind(this),error:e.error}),i.host.classList.add(_t)}_onPointerOverGhost(){null!==this._clearHoverTimeout&&(window.clearTimeout(this._clearHoverTimeout),this._clearHoverTimeout=null),this.node.classList.add(ft)}_onPointerLeaveGhost(){this._clearHoverTimeout=window.setTimeout(()=>this.node.classList.remove(ft),500)}_setGeometry(){const{node:e}=this,t=this._model,o=this._editor;if(!o||!t||!t.cursor)return;const s=o.host.closest(".jp-MainAreaWidget > .lm-Widget")||o.host;let n;try{const e=o.getCoordinateForPosition(t.cursor);if(!e)throw Error("No coordinates for cursor position");n=e}catch(i){return void this.hide()}Ce.setGeometry({anchor:n,host:s,maxHeight:40,minHeight:20,node:e,privilege:"forceAbove",outOfViewDisplay:{top:"stick-outside",bottom:"stick-inside",left:"stick-inside",right:"stick-outside"}})}_updateShortcutsVisibility(){this.node.dataset.showShortcuts=this._showShortcuts+""}_updateDisplay(){this.node.dataset.display=this._showWidget}}function yt(t){const{message:o}=t;return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40px",zIndex:10999},children:o?e.jsxs(e.Fragment,{children:[e.jsx(s,{mr:3,children:e.jsx(n,{size:"large"})}),e.jsx(s,{children:e.jsx(i,{sx:{fontSize:5,color:"white"},children:o})})]}):e.jsx(n,{size:"large"})})}!function(e){e.defaultSettings={showWidget:"onHover",showShortcuts:!0,streamingAnimation:"uncover",providers:{},minLines:2,maxLines:4,editorResizeDelay:1e3,reserveSpaceForLongest:!1,suppressIfTabCompleterActive:!0};e.Model=class{constructor(){this.suggestionsChanged=new g(this),this.filterTextChanged=new g(this),this.provisionProgress=new g(this),this._isDisposed=!1,this._completions=null}setCompletions(e){var t,o;const s=new Map(null===(o=null===(t=this._completions)||void 0===t?void 0:t.items)||void 0===o?void 0:o.map((e,t)=>[e.insertText,t]));this._completions=e;const n=new Map(e.items.map((e,t)=>[s.get(e.insertText),t]));this.suggestionsChanged.emit({event:"set",indexMap:n})}appendCompletions(e){this._completions&&this._completions.items?(this._completions.items.push(...e.items),this.suggestionsChanged.emit({event:"append"})):console.warn("No completions to append to")}notifyProgress(e){this.provisionProgress.emit(e)}get cursor(){return this._cursor}set cursor(e){this._cursor=e}get completions(){return this._completions}reset(){this._completions=null,this.suggestionsChanged.emit({event:"clear"})}get isDisposed(){return this._isDisposed}handleTextChange(e){var t;const o=this._completions;if(!o||!o.items||0===o.items.length)return;const s=new Map(o.items.map((e,t)=>[e,t]));for(let i of null!==(t=e.sourceChange)&&void 0!==t?t:[]){const e=i.insert;if(e){const t=o.items.filter(t=>{var o;const s=null!==(o=t.filterText)&&void 0!==o?o:t.insertText;return!!s.startsWith(e)&&(t.filterText=s.substring(e.length),t.insertText=t.insertText.substring(e.length),!0)});0===t.length&&(this._completions=null),o.items=t}else i.retain||(this._completions=null)}const n=new Map(o.items.map((e,t)=>[s.get(e),t]));this.filterTextChanged.emit(n)}handleSelectionChange(e){const t=this.cursor;if(!t)return;const{start:o,end:s}=e;o.column===s.column&&o.line===s.line||this.reset(),(o.line!==t.line||o.column<t.column)&&this.reset()}dispose(){this._isDisposed||(this._isDisposed=!0,g.clearData(this))}}}(vt||(vt={}));const Ct="```~~~";function wt(e,t){return{render:o=>bt.render(o,e,t)}}var bt;!function(e){let t=null,o=null,s=[],n=null,i={},r=new E.LruCache;async function a(e){if(o)return o;if(t)return await t.promise;s=(null==e?void 0:e.blocks)||[],s=s.sort((e,t)=>{var o,s;return(null!==(o=e.rank)&&void 0!==o?o:1/0)-(null!==(s=t.rank)&&void 0!==s?s:1/0)}),t=new S;const[{marked:n,Renderer:r},a]=await Promise.all([import("./marked.esm-Bh2EzW6g.js"),l()]);for(const t of a)n.use(t);return i={async:!0,gfm:!0,walkTokens:c,renderer:d(r)},o=n,t.resolve(o),o}async function l(){return Promise.all([(async()=>(await import("./index-BYdAqxdq.js")).gfmHeadingId())(),(async()=>(await import("./index-D5E55D1z.js")).mangle())()])}function d(e){const t=new e,o=t.code;return t.code=({text:e,lang:n,escaped:i})=>{for(const t of s)if(n&&t.languages.includes(n)){const o=t.render(e);if(null!=o)return o}const a=`${n}${Ct}${e}${Ct}`,l=r.get(a);return null!=l?l:o.call(t,{text:e,lang:n,escaped:i})},t}async function c(e){if("code"===e.type){if(e.lang)for(const t of s)if(t.languages.includes(e.lang))return void(await t.walk(e.text));await async function(e){const{lang:t,text:o}=e;if(!t||!n)return;const s=`${t}${Ct}${o}${Ct}`;if(r.get(s))return;const i=document.createElement("div");try{await n.highlight(o,n.findBest(t),i);const e=`<pre><code class="language-${t}">${i.innerHTML}</code></pre>`;r.set(s,e)}catch(a){console.error(`Failed to highlight ${t} code`,a)}finally{i.remove()}}(e)}}e.render=async function(e,t,s){return n=t,o||(o=await a(s)),o(e,i)},e.initializeMarked=a}(bt||(bt={}));class kt{diff(e,t,o={}){let s;"function"==typeof o?(s=o,o={}):"callback"in o&&(s=o.callback);const n=this.castInput(e,o),i=this.castInput(t,o),r=this.removeEmpty(this.tokenize(n,o)),a=this.removeEmpty(this.tokenize(i,o));return this.diffWithOptionsObj(r,a,o,s)}diffWithOptionsObj(e,t,o,s){var n;const i=e=>(e=this.postProcess(e,o),s?void setTimeout(function(){s(e)},0):e),r=t.length,a=e.length;let l=1,d=r+a;null!=o.maxEditLength&&(d=Math.min(d,o.maxEditLength));const c=null!==(n=o.timeout)&&void 0!==n?n:1/0,h=Date.now()+c,u=[{oldPos:-1,lastComponent:void 0}];let m=this.extractCommon(u[0],t,e,0,o);if(u[0].oldPos+1>=a&&m+1>=r)return i(this.buildValues(u[0].lastComponent,t,e));let p=-1/0,g=1/0;const _=()=>{for(let s=Math.max(p,-l);s<=Math.min(g,l);s+=2){let n;const l=u[s-1],d=u[s+1];l&&(u[s-1]=void 0);let c=!1;if(d){const e=d.oldPos-s;c=d&&0<=e&&e<r}const h=l&&l.oldPos+1<a;if(c||h){if(n=!h||c&&l.oldPos<d.oldPos?this.addToPath(d,!0,!1,0,o):this.addToPath(l,!1,!0,1,o),m=this.extractCommon(n,t,e,s,o),n.oldPos+1>=a&&m+1>=r)return i(this.buildValues(n.lastComponent,t,e))||!0;u[s]=n,n.oldPos+1>=a&&(g=Math.min(g,s-1)),m+1>=r&&(p=Math.max(p,s+1))}else u[s]=void 0}l++};if(s)!function e(){setTimeout(function(){if(l>d||Date.now()>h)return s(void 0);_()||e()},0)}();else for(;l<=d&&Date.now()<=h;){const e=_();if(e)return e}}addToPath(e,t,o,s,n){const i=e.lastComponent;return i&&!n.oneChangePerToken&&i.added===t&&i.removed===o?{oldPos:e.oldPos+s,lastComponent:{count:i.count+1,added:t,removed:o,previousComponent:i.previousComponent}}:{oldPos:e.oldPos+s,lastComponent:{count:1,added:t,removed:o,previousComponent:i}}}extractCommon(e,t,o,s,n){const i=t.length,r=o.length;let a=e.oldPos,l=a-s,d=0;for(;l+1<i&&a+1<r&&this.equals(o[a+1],t[l+1],n);)l++,a++,d++,n.oneChangePerToken&&(e.lastComponent={count:1,previousComponent:e.lastComponent,added:!1,removed:!1});return d&&!n.oneChangePerToken&&(e.lastComponent={count:d,previousComponent:e.lastComponent,added:!1,removed:!1}),e.oldPos=a,l}equals(e,t,o){return o.comparator?o.comparator(e,t):e===t||!!o.ignoreCase&&e.toLowerCase()===t.toLowerCase()}removeEmpty(e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(e[o]);return t}castInput(e,t){return e}tokenize(e,t){return Array.from(e)}join(e){return e.join("")}postProcess(e,t){return e}get useLongestToken(){return!1}buildValues(e,t,o){const s=[];let n;for(;e;)s.push(e),n=e.previousComponent,delete e.previousComponent,e=n;s.reverse();const i=s.length;let r=0,a=0,l=0;for(;r<i;r++){const e=s[r];if(e.removed)e.value=this.join(o.slice(l,l+e.count)),l+=e.count;else{if(!e.added&&this.useLongestToken){let s=t.slice(a,a+e.count);s=s.map(function(e,t){const s=o[l+t];return s.length>e.length?s:e}),e.value=this.join(s)}else e.value=this.join(t.slice(a,a+e.count));a+=e.count,e.added||(l+=e.count)}}return s}}const xt=new class extends kt{constructor(){super(...arguments),this.tokenize=St}equals(e,t,o){return o.ignoreWhitespace?(o.newlineIsToken&&e.includes("\n")||(e=e.trim()),o.newlineIsToken&&t.includes("\n")||(t=t.trim())):o.ignoreNewlineAtEof&&!o.newlineIsToken&&(e.endsWith("\n")&&(e=e.slice(0,-1)),t.endsWith("\n")&&(t=t.slice(0,-1))),super.equals(e,t,o)}};function Mt(e,t,o){return xt.diff(e,t,o)}function St(e,t){t.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));const o=[],s=e.split(/(\n|\r\n)/);s[s.length-1]||s.pop();for(let n=0;n<s.length;n++){const e=s[n];n%2&&!t.newlineIsToken?o[o.length-1]+=e:o.push(e)}return o}function Pt(e,t,o,s,n,i,r){let a;a=r?"function"==typeof r?{callback:r}:r:{},void 0===a.context&&(a.context=4);const l=a.context;if(a.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(!a.callback)return d(Mt(o,s,a));{const{callback:e}=a;Mt(o,s,Object.assign(Object.assign({},a),{callback:t=>{const o=d(t);e(o)}}))}function d(o){if(!o)return;function s(e){return e.map(function(e){return" "+e})}o.push({value:"",lines:[]});const r=[];let a=0,d=0,c=[],h=1,u=1;for(let e=0;e<o.length;e++){const t=o[e],n=t.lines||Dt(t.value);if(t.lines=n,t.added||t.removed){if(!a){const t=o[e-1];a=h,d=u,t&&(c=l>0?s(t.lines.slice(-l)):[],a-=c.length,d-=c.length)}for(const e of n)c.push((t.added?"+":"-")+e);t.added?u+=n.length:h+=n.length}else{if(a)if(n.length<=2*l&&e<o.length-2)for(const e of s(n))c.push(e);else{const e=Math.min(n.length,l);for(const o of s(n.slice(0,e)))c.push(o);const t={oldStart:a,oldLines:h-a+e,newStart:d,newLines:u-d+e,lines:c};r.push(t),a=0,d=0,c=[]}h+=n.length,u+=n.length}}for(const e of r)for(let t=0;t<e.lines.length;t++)e.lines[t].endsWith("\n")?e.lines[t]=e.lines[t].slice(0,-1):(e.lines.splice(t+1,0,"\\ No newline at end of file"),t++);return{oldFileName:e,newFileName:t,oldHeader:n,newHeader:i,hunks:r}}}function Et(e){if(Array.isArray(e))return e.map(Et).join("\n");const t=[];e.oldFileName==e.newFileName&&t.push("Index: "+e.oldFileName),t.push("==================================================================="),t.push("--- "+e.oldFileName+(void 0===e.oldHeader?"":"\t"+e.oldHeader)),t.push("+++ "+e.newFileName+(void 0===e.newHeader?"":"\t"+e.newHeader));for(let o=0;o<e.hunks.length;o++){const s=e.hunks[o];0===s.oldLines&&(s.oldStart-=1),0===s.newLines&&(s.newStart-=1),t.push("@@ -"+s.oldStart+","+s.oldLines+" +"+s.newStart+","+s.newLines+" @@");for(const e of s.lines)t.push(e)}return t.join("\n")+"\n"}function jt(e,t,o,s,n,i){return function(e,t,o,s,n,i,r){if("function"==typeof r&&(r={callback:r}),!(null==r?void 0:r.callback)){const a=Pt(e,t,o,s,n,i,r);if(!a)return;return Et(a)}{const{callback:a}=r;Pt(e,t,o,s,n,i,Object.assign(Object.assign({},r),{callback:e=>{a(e?Et(e):void 0)}}))}}(e,e,t,o,s,n,i)}function Dt(e){const t=e.endsWith("\n"),o=e.split("\n").map(e=>e+"\n");return t?o.pop():o.push(o.pop().slice(0,-1)),o}class Nt{_commands;_panel;_notebook;_context;_defaultCellType="code";_kernelInfo=null;constructor(e,t,o){this._commands=e,this._panel=t,this._notebook=t.content,this._context=o}get commands(){return this._commands}get panel(){return this._panel}get notebook(){return this._notebook}get context(){return this._context}get sessionContext(){return this._panel.sessionContext}get kernel(){return this._panel.sessionContext?.session?.kernel??null}get kernelInfo(){return this._kernelInfo}async fetchKernelInfo(){if(this._kernelInfo)return this._kernelInfo;const e=this.kernel;return e?(this._kernelInfo=await e.info,this._kernelInfo):null}assignKernel(e){this._kernelInfo=null,this._context?.sessionContext.changeKernel({id:e.id})}setDefaultCellType(e){this._defaultCellType=e}get defaultCellType(){return this._defaultCellType}insertAbove(e){const t=this._notebook;B.insertAbove(t),B.changeCellType(t,this._defaultCellType),e&&t.activeCell&&t.activeCell.model.sharedModel.setSource(e),t.mode="edit"}insertBelow(e){const t=this._notebook;B.insertBelow(t),B.changeCellType(t,this._defaultCellType),e&&t.activeCell&&t.activeCell.model.sharedModel.setSource(e),t.mode="edit"}changeCellType(e){const t=this._notebook;t.activeCell&&t.activeCell.model.type!==e&&B.changeCellType(t,e)}deleteCells(){const e=this._notebook;B.deleteCells(e)}get model(){return this._context.model}undo(){const e=this._notebook;if("edit"===e.mode&&e.activeCell?.editor){const t=e.activeCell.editor;if(t&&"function"==typeof t.undo)return void t.undo()}B.undo(e)}redo(){const e=this._notebook;if("edit"===e.mode&&e.activeCell?.editor){const t=e.activeCell.editor;if(t&&"function"==typeof t.redo)return void t.redo()}B.redo(e)}setActiveCell(e){const t=this._notebook,o=t.model?.cells.length??0;e>=0&&e<o&&(t.activeCellIndex=e)}getCells(){console.log("[NotebookAdapter.getCells] Called");const e=this._notebook.model?.cells;if(!e)return console.log("[NotebookAdapter.getCells] No cells model, returning empty array"),[];console.log(`[NotebookAdapter.getCells] Found ${e.length} cells`);const t=[];for(let o=0;o<e.length;o++){const s=e.get(o);if(s){const e={index:o,type:s.type,source:s.sharedModel.getSource(),outputs:"code"===s.type?s.outputs?.toJSON():void 0};console.log(`[NotebookAdapter.getCells] Cell ${o}:`,{type:e.type,sourceLength:e.source.length}),t.push(e)}}return console.log(`[NotebookAdapter.getCells] Returning ${t.length} cells`),t}readAllCells(e="brief"){return this.getCells().map((t,o)=>{const s=this._notebook.model?.cells.get(o),n="code"===s?.type?s.executionCount??null:null;return"brief"===e?{index:o,type:t.type,preview:t.source.substring(0,40)}:{index:o,type:t.type,source:t.source,execution_count:n,outputs:t.outputs}})}getCellCount(){return this._notebook.model?.cells.length??0}insertAt(e,t){const o=this.getCellCount();if(console.log("[NotebookAdapter.insertAt] Called with:",{cellIndex:e,sourceLength:t?.length||0,sourcePreview:t?.substring(0,50),currentActiveCell:this._notebook.activeCellIndex,cellCount:o,defaultCellType:this._defaultCellType}),e<-1||e>o)throw new Error(`Index ${e} is outside valid range [-1, ${o}]. Use -1 to append at end.`);const s=-1===e?o:e;console.log("[NotebookAdapter.insertAt] Normalized index:",{originalIndex:e,actualIndex:s,cellCount:o}),s>=o?(console.log("[NotebookAdapter.insertAt] Appending at end"),o>0&&this.setActiveCell(o-1),this.insertBelow(t)):(console.log(`[NotebookAdapter.insertAt] Inserting at index ${s}`),this.setActiveCell(s),this.insertAbove(t)),console.log("[NotebookAdapter.insertAt] After insertion:",{cellCount:this.getCellCount(),activeCell:this._notebook.activeCellIndex})}insertCell(e,t,o){this.setDefaultCellType(e);const s=t??this.getCellCount();this.insertAt(s,o)}insertCells(e,t){let o=t;for(const s of e)this.setDefaultCellType(s.type),this.insertAt(o,s.source),o++}deleteCell(e){const t=this._notebook.model?.cells,o=t?.length??0;if(void 0!==e){const t=Array.isArray(e)?e:[e];for(const e of t)if(e<0||e>=o)throw console.error(`[NotebookAdapter.deleteCell] Index ${e} is out of range (cell count: ${o})`),new Error(`Cell index ${e} is out of range. Notebook has ${o} cells.`);const s=[...t].sort((e,t)=>t-e);console.log(`[NotebookAdapter.deleteCell] Deleting ${s.length} cell(s) in reverse order:`,s);for(const e of s)this.setActiveCell(e),this.deleteCells()}else{if(!this._notebook.activeCell)return void console.warn("[NotebookAdapter.deleteCell] No active cell to delete");this.deleteCells()}}updateCell(e,t){const o=this._notebook.model?.sharedModel.cells.length??0;if(e<0||e>=o)throw new Error(`Cell index ${e} is out of range. Notebook has ${o} cells.`);const s=this._notebook.model?.cells.get(e);if(!s)throw new Error(`Cell at index ${e} not found.`);const n=s.sharedModel.getSource();s.sharedModel.setSource(t);return jt(`cell_${e}`,n,t,"before","after",{context:3})}getCell(e,t=!0){if(void 0!==e){const o=this.getCells()[e];if(!o)return;const s=this._notebook.model?.cells.get(e),n="code"===s?.type?s.executionCount??null:null;return{type:o.type,source:o.source,execution_count:n,outputs:t?o.outputs:void 0}}{const e=this._notebook.activeCell;if(!e)return;const o="code"===e.model.type?e.model.executionCount??null:null;return{type:e.model.type,source:e.model.sharedModel.getSource(),execution_count:o,outputs:t&&"code"===e.model.type?e.model.outputs?.toJSON():void 0}}}async runCell(e){const{index:t}=e||{};void 0!==t&&this.setActiveCell(t);const o=t??this._notebook.activeCellIndex;if(-1===o)throw new Error("No active cell to execute");await B.run(this._notebook,this._context.sessionContext),await new Promise(e=>setTimeout(e,100));const s=this.getCell(o,!0);if(!s)return{execution_count:null,outputs:[]};const n=[];if(s.outputs&&Array.isArray(s.outputs))for(const i of s.outputs)if("string"==typeof i)n.push(i);else if(i&&"object"==typeof i){const e=i;if("stream"===e.output_type){const t=e.text;"string"==typeof t?n.push(t):Array.isArray(t)&&n.push(t.join(""))}else if("execute_result"===e.output_type||"display_data"===e.output_type){const t=e.data;if(t&&t["text/plain"]){const e=t["text/plain"];"string"==typeof e?n.push(e):Array.isArray(e)&&n.push(e.join(""))}}else if("error"===e.output_type){const t=e.ename??"Error",o=e.evalue??"",s=e.traceback;Array.isArray(s)&&s.length>0?n.push(`[ERROR: ${t}: ${o}]\n${s.join("\n")}`):n.push(`[ERROR: ${t}: ${o}]`)}}return{execution_count:s.execution_count,outputs:n}}runAllCells(){this._commands.execute(V.runAll)}clearAllOutputs(){B.clearAllOutputs(this._notebook)}async executeCode(e,t={}){const o=this._panel.sessionContext;if(!o||!o.session?.kernel)return{success:!1,error:"No active kernel session"};const s=o.session.kernel;try{const o=s.requestExecute({code:e,stop_on_error:!0,store_history:!1,silent:!1,allow_stdin:!1}),r=[];let a;o.onIOPub=e=>{const t=e.header.msg_type;"stream"===t?r.push({type:"stream",content:e.content}):"execute_result"===t?(r.push({type:"execute_result",content:e.content}),a=e.content.execution_count):"display_data"===t?r.push({type:"display_data",content:e.content}):"error"===t&&r.push({type:"error",content:e.content})};const l=1e3*(t.timeout??30),d=o.done,c=new Promise((e,o)=>{setTimeout(()=>{o(new Error(`Execution timeout after ${t.timeout??30} seconds`))},l)});try{await Promise.race([d,c])}catch(n){try{await s.interrupt()}catch(i){console.error("Failed to interrupt kernel:",i)}return{success:!1,error:`Execution exceeded ${t.timeout??30} seconds and was interrupted`,outputs:r}}return{success:!0,outputs:r,executionCount:a}}catch(r){return{success:!1,error:r instanceof Error?r.message:String(r)}}}dispose(){}}const Tt=1e3,At=new Array,It=".datalayer/ping.ipynb";function Ot(e){const t={};return e&&e.forEach(e=>{const o=e.schema?.default;t[e.identifier]={enabled:!0,debouncerDelay:o?.debouncerDelay??200,timeout:o?.timeout??15e3,autoFillInMiddle:!0}}),t}function Lt(o){const{commands:s,extensions:n=At,kernelId:i,renderers:l,serviceManager:d,model:c,onSessionConnection:h}=o;console.log("[NotebookBase] Component rendering with props:",{hasInlineProviders:!!o.inlineProviders,inlineProvidersCount:o.inlineProviders?.length,inlineProviders:o.inlineProviders,kernelId:i});const[u,m]=t.useState(!0),[p,_]=t.useState(new Array),[f,v]=t.useState(null),[y,C]=t.useState(null),b=t.useMemo(()=>o.id||H(),[o.id]),k=t.useMemo(()=>o.path||It,[o.path]),x=t.useMemo(()=>new Ft({commands:s,renderers:l}),[s,l]),M=t.useMemo(()=>new L.ContentFactory({editorFactory:x.editorServices.factoryService.newInlineEditor}),[x.editorServices.factoryService.newInlineEditor]);t.useEffect(()=>{console.log("[NotebookBase] Setting up completer with inlineProviders:",o.inlineProviders);const e=new we({model:new be}),t=new T,s=Ot(o.inlineProviders);console.log("[NotebookBase] Generated settings for providers:",s);const n=new ke({context:{widget:t},providers:[new xe],inlineProviders:o.inlineProviders,inlineProvidersSettings:s,timeout:Tt});let i;if(console.log("[NotebookBase] ProviderReconciliator created with inlineProviders:",o.inlineProviders),console.log("[NotebookBase] ProviderReconciliator object:",n),o.inlineProviders&&o.inlineProviders.length>0){console.log("[NotebookBase] Creating InlineCompleter widget");const e=w.load("jupyterlab");i=new vt({model:new vt.Model,trans:e});const t={};o.inlineProviders?.forEach(e=>{t[e.identifier]={enabled:!0}}),i.configure({showWidget:"always",showShortcuts:!0,streamingAnimation:"none",suppressIfTabCompleterActive:!1,minLines:1,maxLines:10,editorResizeDelay:250,reserveSpaceForLongest:!1,providers:t}),T.attach(i,document.body);const s=e=>!("Tab"!==e.key||e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)&&i&&i.model&&i.current?(console.log("[NotebookBase] Tab pressed - accepting inline completion"),e.preventDefault(),e.stopPropagation(),i.accept(),!1):"Escape"===e.key&&i&&i.model&&i.current?(console.log("[NotebookBase] Escape pressed - rejecting inline completion"),e.preventDefault(),e.stopPropagation(),i.model.reset(),!1):void 0;document.addEventListener("keydown",s,!0);const n=()=>{document.removeEventListener("keydown",s,!0)};console.log("[NotebookBase] InlineCompleter created, configured, attached, and keyboard handlers set up"),i._keyboardCleanup=n}const r=new Me({completer:e,reconciliator:n,inlineCompleter:i});return e.hide(),T.attach(e,document.body),v(r),()=>{r.dispose(),e.dispose(),i&&(i._keyboardCleanup&&i._keyboardCleanup(),i.dispose()),t.dispose()}},[o.inlineProviders]);const[S,P]=t.useState(null);t.useEffect(()=>{const e=new nt({name:"Notebook",label:"Notebook",modelName:"notebook",fileTypes:["notebook"],defaultFor:["notebook"],preferKernel:!0,autoStartDefault:!1,canStartKernel:!1,shutdownOnClose:!1,rendermime:x.rendermime,contentFactory:M,mimeTypeService:x.editorServices.mimeTypeService,notebookConfig:{...O.defaultNotebookConfig,recordTiming:!0}});return P(e),()=>{e.dispose(),P(t=>t===e?null:t)}},[M,x]);const E=t.useMemo(()=>new U,[]),[j,D]=t.useState(null);t.useEffect(()=>{const e=f?new st({namespace:b}):null,t=f?z(x.commands,f,e,E,o.path):null;return D(e),()=>{t?.dispose(),e?.dispose(),D(t=>t===e?null:t)}},[f,b,x.commands,o.path,E]);const[N,A]=t.useState(null);t.useEffect(()=>{if(i){const e=new $t(c),t=new tt({factory:e,manager:d??new Wt,path:k,kernelPreference:{id:i,shouldStart:!1,canStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}});return function(e,t,o,s,n=!1){const i=!o;e.sessionContext._initialize=async()=>{const t=e.sessionContext.sessionManager;await t.ready,await t.refreshRunning();const s=ee(t.running(),t=>t.kernel?.id===(e.sessionContext.kernelPreference.id??""));if(s)try{const n=t.connectTo({model:{...s,path:o??s.path,name:o??s.name},kernelConnectionOptions:{handleComms:!0}});e.sessionContext._handleNewSession(n)}catch(n){return e.sessionContext._handleSessionError(n),Promise.reject(n)}return await e.sessionContext._startIfNecessary()},e.dispose=()=>{e.isDisposed||(e._isDisposed=!0,e.sessionContext.dispose(),e._disposed.emit(void 0),g.clearData(this))},i&&(e._populate=async()=>{if(e._isPopulated=!0,e._isReady=!0,e._populatedPromise.resolve(void 0),e.isDisposed)return;const t=e._model.defaultKernelName||e.sessionContext.kernelPreference.name;e.sessionContext.kernelPreference={...e.sessionContext.kernelPreference,name:t,language:e._model.defaultKernelLanguage},n||e.sessionContext.initialize().then(t=>{t&&e._dialogs.selectKernel(e.sessionContext.sessionContext)})},e.initialize=async o=>{e.model.dirty=!1;const s=/* @__PURE__ */(new Date).toISOString(),n={path:t,name:t,type:"notebook",content:void 0,writable:!0,created:s,last_modified:s,mimetype:"application/x-ipynb+json",format:"json"};e._updateContentsModel(n),await e._populate(),e.model.sharedModel.clearUndoHistory()});e.sessionContext.sessionChanged.connect((e,t)=>{const o=t.newValue;console.log("Current Jupyter Session Connection.",o),s?.(o??void 0)}),e.sessionContext.kernelChanged.connect((e,t)=>{const o=t.newValue;console.log("Current Jupyter Kernel Connection.",o),o&&!o.handleComms&&(console.log("Updating the current Kernel Connection to enforce Comms support.",o.handleComms),o.handleComms=!0)}),e.sessionContext.ready.then(()=>{s?.(e?.sessionContext.session??void 0)}),e.initialize(!o)}(t,b,k!==It?k:void 0,h,!d),A(t),()=>{t.dispose(),e.dispose(),A(e=>e===t?null:e)}}},[b,i,d,c,k]),t.useEffect(()=>{N&&i&&!N.sessionContext.isDisposed&&N.sessionContext.changeKernel({id:i}).catch(e=>{console.error("Failed to change kernel model.",e)})},[N,i]);const[I,R]=t.useState(null);return t.useEffect(()=>{let t=null,o=null,s=null;if(N&&(t=S?.createNew(N)??null,t)){E.setPanel(t,N),o=new Nt(x.commands,t,N),C(o),_(n.map(o=>(o.init({notebookId:b,commands:x.commands,panel:t}),o.createNew(t,N),o.component??e.jsx(e.Fragment,{}))));const i=t.content.rendermime;s=new rt(N,i,{saveState:!1}),i.addFactory({safe:!0,mimeTypes:[Re],defaultRank:1,createRenderer:e=>new at(e,s)},1);for(const e of t.content.widgets)if("code"===e.model.type)for(const t of e.outputArea.widgets)for(const e of Array.from(t.children()))e instanceof at&&(e.manager=s);m(!1)}return R(t),t||(_([]),C(null)),()=>{if(E.setPanel(null,null),s?.dispose(),o&&o.dispose(),t){t.content&&g.clearData(t.content);try{t.dispose()}catch(e){}}R(e=>e===t?null:e),C(e=>e===o?null:e)}},[N,n,x.commands,S,E]),t.useEffect(()=>{if(y){console.log(`[NotebookBase] Registering adapter for notebook: ${b}`),console.log("[NotebookBase] Adapter has getCells:",typeof y.getCells),console.log("[NotebookBase] Adapter cell count:",y.getCellCount());const e=q.getState().notebooks,t=new Map(e);t.set(b,{adapter:y,portals:[]}),q.getState().setNotebooks(t),console.log(`[NotebookBase] Store now has ${t.size} notebooks`),console.log("[NotebookBase] Notebook IDs:",Array.from(t.keys()))}else{console.log(`[NotebookBase] ⚠️  No adapter yet for notebook: ${b}`);const e=q.getState().notebooks;if(e.has(b)){const t=new Map(e);t.delete(b),q.getState().setNotebooks(t)}}},[y,b]),t.useEffect(()=>{let e=!0,t=null,s=null;return I&&(j&&(j.has(I)||j.add(I).catch(e=>{console.error(`Failed to track the notebook panel '${b}'.`)})),f&&(t=(e,t)=>{t&&t.ready.then(()=>{f.editor=t?.editor})},s=(t,s)=>{if(!e)return;const n=I.content.activeCell?.editor,i=new xe,r=Ot(o.inlineProviders),a=s.newValue||{};console.log("[NotebookBase] Creating ProviderReconciliator with editor and session",{hasEditor:!!n,hasSession:!!s.newValue,usingDummySession:!s.newValue,inlineProviders:o.inlineProviders,inlineProvidersSettings:r});const l=new ke({context:{widget:I,editor:n,session:a},providers:[i],inlineProviders:o.inlineProviders,inlineProvidersSettings:r,timeout:Tt});console.log("[NotebookBase] ProviderReconciliator with editor created:",l),f.inlineCompleter&&(f.inlineCompleter.editor=n,console.log("[NotebookBase] Updated InlineCompleter editor")),f.editor=n,f.reconciliator=l},I.context.sessionContext.sessionChanged.connect(s),I.context.sessionContext.ready.then(()=>{s?.(I.context.sessionContext,{name:"session",oldValue:null,newValue:I.context.sessionContext.session})}),I.content.activeCellChanged.connect(t))),()=>{if(e=!1,f){t&&I?.content.activeCellChanged.disconnect(t),s&&I?.context.sessionContext.sessionChanged.connect(s),f.editor=null;const e=Ot(o.inlineProviders);f.reconciliator=new ke({context:{widget:new T},providers:[new xe],inlineProviders:o.inlineProviders,inlineProvidersSettings:e,timeout:Tt})}}},[f,I,j]),t.useEffect(()=>{const e=e=>{x.commands.processKeydownEvent(e)};return document.addEventListener("keydown",e,!0),()=>{document.removeEventListener("keydown",e,!0)}},[x.commands]),t.useEffect(()=>()=>{const e=q.getState().notebooks;if(e.has(b)){const t=new Map(e);t.delete(b),q.getState().setNotebooks(t)}},[b]),e.jsxs(e.Fragment,{children:[p.map((t,o)=>e.jsx(r,{children:t},`${t}-${o}`)),u?e.jsx(yt,{},"notebook-loader"):I?e.jsx(r,{sx:{height:"100%"},children:e.jsx($e,{id:b,children:I},"notebook-container")}):e.jsx(a,{variant:"critical",description:"Unable to create the notebook view.",hideTitle:!0,title:"Error"},"notebook-error")]})}function Rt(e){const{collaborationProvider:o,nbformat:s,readonly:n=!1,url:i,path:r,serviceManager:a,id:l}=e;console.log("[useNotebookModel] Hook called with options:",{hasCollaborationProvider:!!o,hasNbformat:!!s,readonly:n,hasUrl:!!i,path:r,hasServiceManager:!!a,id:l});const[d,c]=t.useState(null);return t.useEffect(()=>{console.log("[useNotebookModel] useEffect running");let e=!0;const t=new K;if(o&&a&&l){console.log("[useNotebookModel] Setting up collaboration");(async()=>{try{const s=new Ye;if(await o.connect(s,l,{serviceManager:a,path:r}),e){console.log("[useNotebookModel] Creating collaboration model");const e=new Xe({collaborationEnabled:!0,disableDocumentWideUndoRedo:!0,sharedModel:s});e.readOnly=n,console.log("[useNotebookModel] Calling setModel with collaboration model"),c(e),t.add({dispose:()=>{o.disconnect()},get isDisposed(){return!1}})}}catch(s){console.error("Failed to setup collaboration:",s)}})()}else{console.log("[useNotebookModel] No collaboration, creating standard model");const t=e=>{console.log("[useNotebookModel] createModel called with nbformat:",!!e);try{const t=new Xe;console.log("[useNotebookModel] NotebookModel created"),e&&(e.cells.forEach(e=>{e.metadata.editable=!n}),console.log("[useNotebookModel] About to call model.fromJSON"),t.fromJSON(e),console.log("[useNotebookModel] model.fromJSON completed successfully")),t.readOnly=n,console.log("[useNotebookModel] Calling setModel with standard model"),c(t)}catch(t){throw console.error("[useNotebookModel] Error creating model:",t),t}};!s&&i?(console.log("[useNotebookModel] Loading from URL:",i),async function(e){return fetch(e).then(e=>e.text()).then(e=>JSON.parse(e))}(i).then(o=>{e&&t(o)})):(console.log("[useNotebookModel] Creating model directly (nbformat provided or no URL)"),t(s))}return()=>{e=!1,t.dispose()}},[o,s,n,i,r,a,l]),console.log("[useNotebookModel] Returning model:",!!d),d}class Ft{_commands;_editorServices;_rendermime;constructor(e={}){this._commands=e.commands??new J;const t=new G;for(const l of G.getDefaultLanguages())t.addLanguage(l);t.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await import("./vendor-codemirror-OzOnFEf0.js").then(e=>e.ap)).markdown({codeLanguages:e=>t.findBest(e)})});const o=Y.filter(e=>"text/javascript"!==e.mimeTypes[0]).concat([fe,ve]).concat(e.renderers??[]);this._rendermime=new Fe({initialFactories:o,latexTypesetter:new ye,markdownParser:wt(t)});const s=new se(t),n=new Z;for(const l of Z.getDefaultThemes())n.addTheme(l);const i=new Q;for(const l of Q.getDefaultExtensions({themes:n}))i.addExtension(l);i.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return Q.createImmutableExtension(X({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),i.addExtension({name:"remote-user-cursors",factory(e){const{awareness:t,ysource:o}=e.model.sharedModel;return Q.createImmutableExtension((s={awareness:t,ytext:o},[Be.of(s),Ge]));var s}});const r=function(){const e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null}();r&&i.addExtension({name:"csp-nonce",factory:()=>Q.createImmutableExtension(ae.cspNonce.of(r))});const a=new oe({extensions:i,languages:t});this._editorServices={factoryService:a,mimeTypeService:s}}get commands(){return this._commands}get editorServices(){return this._editorServices}get rendermime(){return this._rendermime}}class $t extends et{model;constructor(e){super(),this.model=e}createNew(e){return this.model}}class Wt{contents=Object.freeze({fileChanged:{connect:()=>{}},getSharedModelFactory:e=>null,localPath(e){const t=e.split("/"),o=t[0].split(":");return 1!==o.length&&this._additionalDrives.has(o[0])?E.PathExt.join(o.slice(1).join(":"),...t.slice(1)):E.PathExt.removeSlash(e)},normalize(e){const t=e.split(":");return 1===t.length?E.PathExt.normalize(e):`${t[0]}:${E.PathExt.normalize(t.slice(1).join(":"))}`}});kernelspecs=Object.freeze({ready:new Promise(()=>{})});sessions=Object.freeze({ready:new Promise(()=>{})});ready=Promise.resolve()}const Bt=l`
  .dla-Box-Notebook .jp-Cell .dla-CellSidebar-Container {
    display: none;
  }
  .dla-Box-Notebook .jp-Cell.jp-mod-active .dla-CellSidebar-Container {
    display: block;
  }
`;function Vt(o){const{Toolbar:s,cellSidebarMargin:n=120,children:i,collaborationProvider:a,commands:l,extensions:d,height:c="100vh",id:h,inlineProviders:u,kernel:m,maxHeight:p="100vh",nbformat:g,onNotebookModelChanged:_,onSessionConnection:f,path:v,readonly:y=!1,renderers:C,serviceManager:w,startDefaultKernel:b=!1,url:k}=o,[x,M]=t.useState(!0),S=function(e={}){const{kernel:o,kernels:s,requestedKernelId:n,startDefaultKernel:i=!1}=e,r=o?.id,[a,l]=t.useState(r),[d,c]=t.useState(void 0);return t.useEffect(()=>{let e=!0;if(!r)return s&&(async()=>{let t;if(await s.ready,n)for(const e of s.running())if(e.id===n){t=n;break}if(!t&&i&&e){console.log("Starting a new default kernel.");const o=await s.startNew();e?(t=o.id,l(t),c(o)):o.dispose()}e&&l(e=>e!==t?t:e)})(),()=>{e=!1};l(e=>e!==r?r:e)},[s,r,n,i]),t.useEffect(()=>()=>{d&&(console.log(`Shutting down kernel '${d.id}'.`),d.shutdown().catch(e=>{console.warn(`Failed to shutdown kernel '${d?.id}'.`,e)}).finally(()=>{d?.dispose()}))},[d]),a}({kernel:m,kernels:w.kernels,requestedKernelId:o.kernelId,startDefaultKernel:b}),P=Rt({collaborationProvider:a,nbformat:g,readonly:y,url:k,path:v,serviceManager:w,id:h});return t.useEffect(()=>{console.log("[Notebook] useEffect - model changed:",{model:!!P,isLoading:x}),P&&(console.log("[Notebook] Setting isLoading to false"),M(!1)),_?.(P)},[P,_]),t.useEffect(()=>{const e=()=>{a&&P&&P.sharedModel.awareness.setLocalStateField("user",w.user.identity)};return e(),w.user.userChanged.connect(e),()=>{w.user.userChanged.disconnect(e)}},[a,P,w]),console.log("[Notebook] Rendering:",{isLoading:x,hasModel:!!P,hasServiceManager:!!w,hasInlineProviders:!!u}),x?e.jsx(yt,{},"notebook-loader"):e.jsxs(r,{style:{height:c,width:"100%",position:"relative"},id:"dla-Jupyter-Notebook",children:[s&&e.jsx(s,{notebookId:h}),e.jsxs(r,{className:"dla-Box-Notebook",sx:{height:c,maxHeight:p,width:"100%",overflowY:"hidden","& .datalayer-NotebookPanel-header":{minHeight:"50px"},"& .jp-Notebook":{flex:"1 1 auto !important",height:"100%",overflowY:"scroll"},"& .jp-NotebookPanel":{},"& .jp-Toolbar":{display:"none",zIndex:0},"& .jp-Toolbar .jp-HTMLSelect.jp-DefaultStyle select":{fontSize:"14px"},"& .jp-Toolbar > .jp-Toolbar-responsive-opener":{display:"none"},"& .jp-Toolbar-kernelName":{display:"none"},"& .jp-Cell":{width:`calc(100% - ${n}px)`},"& .jp-Notebook-footer":{width:`calc(100% - ${n+82}px)`},"& .jp-CodeMirrorEditor":{cursor:"text !important"},".dla-Box-Notebook":{position:"relative"}},children:[i,e.jsx(Bt,{}),P&&w&&e.jsx(Lt,{commands:l,id:h,extensions:d,inlineProviders:u,kernelId:S,model:P,path:v,renderers:C,serviceManager:w,onSessionConnection:f})]})]})}const Kt=({options:t})=>{const{serviceManager:s,defaultKernel:n}=(()=>{const e=o();return We({jupyterServerUrl:e.serverUrl||"",jupyterServerToken:e.token||"",startDefaultKernel:e.autoStartKernel,defaultKernelName:e.defaultKernel,terminals:!0})})(),i="object"==typeof t.content?t.content:void 0,r=t.height||"500px";return s?/* @__PURE__ */e.jsx("div",{style:{height:r},children:/* @__PURE__ */e.jsx(Vt,{id:t.id||"embedded-notebook",path:t.path,nbformat:i,readonly:t.readonly,serviceManager:s,kernel:n,height:r})}):/* @__PURE__ */e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:r,color:"#656d76"},children:"Connecting to Jupyter server..."})},Ht=({options:t})=>/* @__PURE__ */e.jsx(te,{children:/* @__PURE__ */e.jsx(Kt,{options:t})});export{Ht as NotebookChunk,Ht as default};
//# sourceMappingURL=NotebookChunk-BNGKZgXH.js.map
