{"version":3,"file":"NotebookChunk-BNGKZgXH.js","sources":["../../../react/lib/utils/cursorExtension.js","../../../../node_modules/@jupyter/ydoc/lib/ynotebook.js","../../../../node_modules/@jupyterlab/notebook/lib/celllist.js","../../../../node_modules/@jupyterlab/notebook/lib/history.js","../../../../node_modules/@jupyterlab/notebook/lib/model.js","../../../../node_modules/@jupyterlab/notebook/lib/modelfactory.js","../../../../node_modules/@jupyterlab/docregistry/lib/context.js","../../../../node_modules/@jupyterlab/notebook/lib/tracker.js","../../../../node_modules/@jupyterlab/notebook/lib/widgetfactory.js","../../../react/lib/jupyter/ipywidgets/lab/manager.js","../../../react/lib/jupyter/ipywidgets/lab/renderer.js","../../../../node_modules/@jupyterlab/completer/lib/ghost.js","../../../../node_modules/@jupyterlab/completer/lib/inline.js","../../../react/lib/components/utils/Loader.js","../../../../node_modules/@jupyterlab/markedparser-extension/lib/index.js","../../../../node_modules/diff/libesm/diff/base.js","../../../../node_modules/diff/libesm/diff/line.js","../../../../node_modules/diff/libesm/patch/create.js","../../../react/lib/components/notebook/NotebookAdapter.js","../../../react/lib/components/notebook/NotebookBase.js","../../../react/lib/components/notebook/Notebook.js","../../src/chunks/NotebookChunk.tsx"],"sourcesContent":["/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n// Display remote peer cursors\n//\n// This is a slightly modified version of https://github.com/jupyterlab/jupyter-collaboration/blob/main/packages/collaboration/src/cursors.ts\n// licenced under Copyright (c) Jupyter Development Team and distributed under the terms of the Modified BSD License.\nimport { Annotation, EditorSelection, Facet, StateField, } from '@codemirror/state';\nimport { EditorView, layer, RectangleMarker, showTooltip, tooltips, ViewPlugin, } from '@codemirror/view';\nimport { JSONExt } from '@lumino/coreutils';\nimport { createAbsolutePositionFromRelativePosition, createRelativePositionFromJSON, createRelativePositionFromTypeIndex, } from 'yjs';\n/**\n * Facet storing the Yjs document objects\n */\nconst editorAwarenessFacet = Facet.define({\n    combine(configs) {\n        return configs[configs.length - 1];\n    },\n});\n/**\n * Remote selection theme\n */\nconst remoteSelectionTheme = EditorView.baseTheme({\n    '.jp-remote-cursor': {\n        borderLeft: '1px solid black',\n        marginLeft: '-1px',\n    },\n    '.jp-remote-cursor.jp-mod-primary': {\n        borderLeftWidth: '2px',\n    },\n    '.jp-remote-selection': {\n        opacity: 0.5,\n    },\n    '.cm-tooltip': {\n        border: 'none',\n    },\n    '.cm-tooltip.jp-remote-userInfo': {\n        color: 'var(--jp-ui-inverse-font-color0)',\n        padding: '0px 2px',\n    },\n});\n// TODO fix which user needs update\nconst remoteSelectionsAnnotation = Annotation.define();\n/**\n * Wrapper around RectangleMarker to be able to set the user color for the remote cursor and selection ranges.\n */\nclass RemoteMarker {\n    style;\n    marker;\n    /**\n     * Constructor\n     *\n     * @param style Specific user style to be applied on the marker element\n     * @param marker {@link RectangleMarker} to wrap\n     */\n    constructor(style, marker) {\n        this.style = style;\n        this.marker = marker;\n    }\n    draw() {\n        const elt = this.marker.draw();\n        for (const [key, value] of Object.entries(this.style)) {\n            // @ts-expect-error Unknown key\n            elt.style[key] = value;\n        }\n        return elt;\n    }\n    eq(other) {\n        return (this.marker.eq(other.marker) && JSONExt.deepEqual(this.style, other.style));\n    }\n    update(dom, oldMarker) {\n        for (const [key, value] of Object.entries(this.style)) {\n            // @ts-expect-error Unknown key\n            dom.style[key] = value;\n        }\n        return this.marker.update(dom, oldMarker.marker);\n    }\n}\n/**\n * Extension defining a new editor layer storing the remote user cursors\n */\nconst remoteCursorsLayer = layer({\n    above: true,\n    markers(view) {\n        const { awareness, ytext } = view.state.facet(editorAwarenessFacet);\n        const ydoc = ytext.doc;\n        const cursors = [];\n        awareness.getStates().forEach((state, clientID) => {\n            if (clientID === awareness.doc.clientID) {\n                return;\n            }\n            const cursors_ = state.cursors;\n            for (const cursor of cursors_ ?? []) {\n                if (!cursor?.anchor || !cursor?.head) {\n                    return;\n                }\n                const anchor = createAbsolutePositionFromRelativePosition(cursor.anchor, ydoc);\n                const head = createAbsolutePositionFromRelativePosition(cursor.head, ydoc);\n                if (anchor?.type !== ytext || head?.type !== ytext) {\n                    return;\n                }\n                const className = (cursor.primary ?? true)\n                    ? 'jp-remote-cursor jp-mod-primary'\n                    : 'jp-remote-cursor';\n                const cursor_ = EditorSelection.cursor(head.index, head.index > anchor.index ? -1 : 1);\n                for (const piece of RectangleMarker.forRange(view, className, cursor_)) {\n                    // Wrap the rectangle marker to set the user color\n                    cursors.push(new RemoteMarker({ borderLeftColor: state.user?.color ?? 'black' }, piece));\n                }\n            }\n        });\n        return cursors;\n    },\n    update(update, layer) {\n        return !!update.transactions.find(t => t.annotation(remoteSelectionsAnnotation));\n    },\n    class: 'jp-remote-cursors',\n});\n/**\n * Tooltip extension to display user display name at cursor position\n */\nfunction getCursorTooltips(state) {\n    const tooltips = new Array();\n    const { awareness, ytext } = state.facet(editorAwarenessFacet);\n    const ydoc = ytext.doc;\n    for (const [clientID, state] of awareness.getStates()) {\n        if (clientID === awareness.doc.clientID) {\n            continue;\n        }\n        for (const cursor of state.cursors ?? []) {\n            if (!cursor?.head) {\n                continue;\n            }\n            const head = createAbsolutePositionFromRelativePosition(cursor.head, ydoc);\n            if (head?.type !== ytext) {\n                continue;\n            }\n            tooltips.push({\n                pos: head.index,\n                above: true,\n                create: () => {\n                    const dom = document.createElement('div');\n                    dom.classList.add('jp-remote-userInfo');\n                    dom.style.backgroundColor = state.user?.color ?? 'darkgrey';\n                    dom.textContent =\n                        state.user?.display_name ?? 'Anonymous';\n                    return { dom };\n                },\n            });\n        }\n    }\n    return tooltips;\n}\nconst remoteCursorTooltipField = StateField.define({\n    create: getCursorTooltips,\n    update(tooltips, tr) {\n        if (!tr.annotation(remoteSelectionsAnnotation))\n            return tooltips;\n        return getCursorTooltips(tr.state);\n    },\n    provide(field) {\n        return showTooltip.computeN([field], state => state.field(field));\n    },\n});\n/**\n * Extension defining a new editor layer storing the remote selections\n */\nconst remoteSelectionLayer = layer({\n    above: false,\n    markers(view) {\n        const { awareness, ytext } = view.state.facet(editorAwarenessFacet);\n        const ydoc = ytext.doc;\n        const cursors = [];\n        awareness.getStates().forEach((state, clientID) => {\n            if (clientID === awareness.doc.clientID) {\n                return;\n            }\n            const cursors_ = state.cursors;\n            for (const cursor of cursors_ ?? []) {\n                if ((cursor.empty ?? true) || !cursor?.anchor || !cursor?.head) {\n                    return;\n                }\n                const anchor = createAbsolutePositionFromRelativePosition(cursor.anchor, ydoc);\n                const head = createAbsolutePositionFromRelativePosition(cursor.head, ydoc);\n                if (anchor?.type !== ytext || head?.type !== ytext) {\n                    return;\n                }\n                const className = 'jp-remote-selection';\n                for (const piece of RectangleMarker.forRange(view, className, EditorSelection.range(anchor.index, head.index))) {\n                    // Wrap the rectangle marker to set the user color\n                    cursors.push(new RemoteMarker({ backgroundColor: state.user?.color ?? 'black' }, piece));\n                }\n            }\n        });\n        return cursors;\n    },\n    update(update, layer) {\n        return !!update.transactions.find(t => t.annotation(remoteSelectionsAnnotation));\n    },\n    class: 'jp-remote-selections',\n});\n/**\n * CodeMirror extension exchanging and displaying remote user selection ranges (including cursors)\n */\nconst showCollaborators = ViewPlugin.fromClass(class {\n    editorAwareness;\n    _listener;\n    constructor(view) {\n        this.editorAwareness = view.state.facet(editorAwarenessFacet);\n        this._listener = ({ added, updated, removed }) => {\n            const clients = added.concat(updated).concat(removed);\n            if (clients.findIndex(id => id !== this.editorAwareness.awareness.doc.clientID) >= 0) {\n                // Trick to get the remoteCursorLayers to be updated\n                view.dispatch({ annotations: [remoteSelectionsAnnotation.of([])] });\n            }\n        };\n        this.editorAwareness.awareness.on('change', this._listener);\n    }\n    destroy() {\n        this.editorAwareness.awareness.off('change', this._listener);\n    }\n    /**\n     * Communicate the current user cursor position to all remotes\n     */\n    update(update) {\n        if (!update.docChanged && !update.selectionSet) {\n            return;\n        }\n        const { awareness, ytext } = this.editorAwareness;\n        const localAwarenessState = awareness.getLocalState();\n        // set local awareness state (update cursors)\n        if (localAwarenessState) {\n            const hasFocus = update.view.hasFocus && update.view.dom.ownerDocument.hasFocus();\n            const selection = update.state.selection;\n            const cursors = new Array();\n            if (hasFocus && selection) {\n                for (const r of selection.ranges) {\n                    const primary = r === selection.main;\n                    const anchor = createRelativePositionFromTypeIndex(ytext, r.anchor);\n                    const head = createRelativePositionFromTypeIndex(ytext, r.head);\n                    cursors.push({\n                        anchor,\n                        head,\n                        primary,\n                        empty: r.empty,\n                    });\n                }\n                if (!localAwarenessState.cursors || cursors.length > 0) {\n                    const oldCursors = localAwarenessState.cursors?.map(cursor => {\n                        return {\n                            ...cursor,\n                            anchor: cursor?.anchor\n                                ? createRelativePositionFromJSON(cursor.anchor)\n                                : null,\n                            head: cursor?.head\n                                ? createRelativePositionFromJSON(cursor.head)\n                                : null,\n                        };\n                    });\n                    if (!JSONExt.deepEqual(cursors, oldCursors)) {\n                        // Update cursors\n                        awareness.setLocalStateField('cursors', cursors);\n                    }\n                }\n            }\n        }\n    }\n}, {\n    provide: () => {\n        return [\n            remoteSelectionTheme,\n            remoteCursorsLayer,\n            remoteSelectionLayer,\n            remoteCursorTooltipField,\n            // As we use relative positioning of widget, the tooltip must be positioned absolutely\n            // And we attach the tooltip to the body to avoid overflow rules\n            tooltips({ position: 'absolute', parent: document.body }),\n        ];\n    },\n});\n/**\n * CodeMirror extension to display remote users cursors\n *\n * @param config Editor source and awareness\n * @returns CodeMirror extension\n */\nexport function remoteUserCursors(config) {\n    return [editorAwarenessFacet.of(config), showCollaborators];\n}\n//# sourceMappingURL=cursorExtension.js.map","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\nimport { JSONExt } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport * as Y from 'yjs';\nimport { YDocument } from './ydocument.js';\nimport { createCell, createCellModelFromSharedType } from './ycell.js';\n/**\n * Shared implementation of the Shared Document types.\n *\n * Shared cells can be inserted into a SharedNotebook.\n * Shared cells only start emitting events when they are connected to a SharedNotebook.\n *\n * \"Standalone\" cells must not be inserted into a (Shared)Notebook.\n * Standalone cells emit events immediately after they have been created, but they must not\n * be included into a (Shared)Notebook.\n */\nexport class YNotebook extends YDocument {\n    /**\n     * Create a new notebook\n     *\n     * #### Notes\n     * The document is empty and must be populated\n     *\n     * @param options\n     */\n    constructor(options = {}) {\n        var _a;\n        super();\n        /**\n         * Document version\n         */\n        this.version = '2.0.0';\n        /**\n         * YJS map for the notebook metadata\n         */\n        this.ymeta = this.ydoc.getMap('meta');\n        /**\n         * Handle a change to the ystate.\n         */\n        this._onMetaChanged = (events) => {\n            const metadataEvents = events.find(event => event.target === this.ymeta.get('metadata'));\n            if (metadataEvents) {\n                const metadataChange = metadataEvents.changes.keys;\n                const ymetadata = this.ymeta.get('metadata');\n                metadataEvents.changes.keys.forEach((change, key) => {\n                    switch (change.action) {\n                        case 'add':\n                            this._metadataChanged.emit({\n                                key,\n                                type: 'add',\n                                newValue: ymetadata.get(key)\n                            });\n                            break;\n                        case 'delete':\n                            this._metadataChanged.emit({\n                                key,\n                                type: 'remove',\n                                oldValue: change.oldValue\n                            });\n                            break;\n                        case 'update':\n                            {\n                                const newValue = ymetadata.get(key);\n                                const oldValue = change.oldValue;\n                                let equal = true;\n                                if (typeof oldValue == 'object' && typeof newValue == 'object') {\n                                    equal = JSONExt.deepEqual(oldValue, newValue);\n                                }\n                                else {\n                                    equal = oldValue === newValue;\n                                }\n                                if (!equal) {\n                                    this._metadataChanged.emit({\n                                        key,\n                                        type: 'change',\n                                        oldValue,\n                                        newValue\n                                    });\n                                }\n                            }\n                            break;\n                    }\n                });\n                this._changed.emit({ metadataChange });\n            }\n            const metaEvent = events.find(event => event.target === this.ymeta);\n            if (!metaEvent) {\n                return;\n            }\n            if (metaEvent.keysChanged.has('metadata')) {\n                // Handle metadata change when adding/removing the YMap\n                const change = metaEvent.changes.keys.get('metadata');\n                if ((change === null || change === void 0 ? void 0 : change.action) === 'add' && !change.oldValue) {\n                    const metadataChange = new Map();\n                    for (const key of Object.keys(this.metadata)) {\n                        metadataChange.set(key, {\n                            action: 'add',\n                            oldValue: undefined\n                        });\n                        this._metadataChanged.emit({\n                            key,\n                            type: 'add',\n                            newValue: this.getMetadata(key)\n                        });\n                    }\n                    this._changed.emit({ metadataChange });\n                }\n            }\n            if (metaEvent.keysChanged.has('nbformat')) {\n                const change = metaEvent.changes.keys.get('nbformat');\n                const nbformatChanged = {\n                    key: 'nbformat',\n                    oldValue: (change === null || change === void 0 ? void 0 : change.oldValue) ? change.oldValue : undefined,\n                    newValue: this.nbformat\n                };\n                this._changed.emit({ nbformatChanged });\n            }\n            if (metaEvent.keysChanged.has('nbformat_minor')) {\n                const change = metaEvent.changes.keys.get('nbformat_minor');\n                const nbformatChanged = {\n                    key: 'nbformat_minor',\n                    oldValue: (change === null || change === void 0 ? void 0 : change.oldValue) ? change.oldValue : undefined,\n                    newValue: this.nbformat_minor\n                };\n                this._changed.emit({ nbformatChanged });\n            }\n        };\n        /**\n         * Handle a change to the list of cells.\n         */\n        this._onYCellsChanged = (event) => {\n            // update the type cell mapping by iterating through the added/removed types\n            event.changes.added.forEach(item => {\n                const type = item.content.type;\n                if (!this._ycellMapping.has(type)) {\n                    const c = createCellModelFromSharedType(type, { notebook: this });\n                    this._ycellMapping.set(type, c);\n                }\n            });\n            event.changes.deleted.forEach(item => {\n                const type = item.content.type;\n                const model = this._ycellMapping.get(type);\n                if (model) {\n                    model.dispose();\n                    this._ycellMapping.delete(type);\n                }\n            });\n            let index = 0;\n            // this reflects the event.changes.delta, but replaces the content of delta.insert with ycells\n            const cellsChange = [];\n            event.changes.delta.forEach((d) => {\n                if (d.insert != null) {\n                    const insertedCells = d.insert.map((ycell) => this._ycellMapping.get(ycell));\n                    cellsChange.push({ insert: insertedCells });\n                    this.cells.splice(index, 0, ...insertedCells);\n                    index += d.insert.length;\n                }\n                else if (d.delete != null) {\n                    cellsChange.push(d);\n                    this.cells.splice(index, d.delete);\n                }\n                else if (d.retain != null) {\n                    cellsChange.push(d);\n                    index += d.retain;\n                }\n            });\n            this._changed.emit({\n                cellsChange: cellsChange\n            });\n        };\n        this._metadataChanged = new Signal(this);\n        /**\n         * Internal Yjs cells list\n         */\n        this._ycells = this.ydoc.getArray('cells');\n        this._ycellMapping = new WeakMap();\n        this._disableDocumentWideUndoRedo =\n            (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : false;\n        this.cells = this._ycells.toArray().map(ycell => {\n            if (!this._ycellMapping.has(ycell)) {\n                this._ycellMapping.set(ycell, createCellModelFromSharedType(ycell, { notebook: this }));\n            }\n            return this._ycellMapping.get(ycell);\n        });\n        this.undoManager.addToScope(this._ycells);\n        this._ycells.observe(this._onYCellsChanged);\n        this.ymeta.observeDeep(this._onMetaChanged);\n    }\n    /**\n     * Creates a standalone YNotebook\n     *\n     * Note: This method is useful when we need to initialize\n     * the YNotebook from the JavaScript side.\n     */\n    static create(options = {}) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j;\n        const ynotebook = new YNotebook({\n            disableDocumentWideUndoRedo: (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : false\n        });\n        const data = {\n            cells: (_c = (_b = options.data) === null || _b === void 0 ? void 0 : _b.cells) !== null && _c !== void 0 ? _c : [],\n            nbformat: (_e = (_d = options.data) === null || _d === void 0 ? void 0 : _d.nbformat) !== null && _e !== void 0 ? _e : 4,\n            nbformat_minor: (_g = (_f = options.data) === null || _f === void 0 ? void 0 : _f.nbformat_minor) !== null && _g !== void 0 ? _g : 5,\n            metadata: (_j = (_h = options.data) === null || _h === void 0 ? void 0 : _h.metadata) !== null && _j !== void 0 ? _j : {}\n        };\n        ynotebook.fromJSON(data);\n        return ynotebook;\n    }\n    /**\n     * Wether the undo/redo logic should be\n     * considered on the full document across all cells.\n     *\n     * Default: false\n     */\n    get disableDocumentWideUndoRedo() {\n        return this._disableDocumentWideUndoRedo;\n    }\n    /**\n     * Notebook metadata\n     */\n    get metadata() {\n        return this.getMetadata();\n    }\n    set metadata(v) {\n        this.setMetadata(v);\n    }\n    /**\n     * Signal triggered when a metadata changes.\n     */\n    get metadataChanged() {\n        return this._metadataChanged;\n    }\n    /**\n     * nbformat major version\n     */\n    get nbformat() {\n        return this.ymeta.get('nbformat');\n    }\n    set nbformat(value) {\n        this.transact(() => {\n            this.ymeta.set('nbformat', value);\n        }, false);\n    }\n    /**\n     * nbformat minor version\n     */\n    get nbformat_minor() {\n        return this.ymeta.get('nbformat_minor');\n    }\n    set nbformat_minor(value) {\n        this.transact(() => {\n            this.ymeta.set('nbformat_minor', value);\n        }, false);\n    }\n    /**\n     * Dispose of the resources.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._ycells.unobserve(this._onYCellsChanged);\n        this.ymeta.unobserveDeep(this._onMetaChanged);\n        super.dispose();\n    }\n    /**\n     * Get a shared cell by index.\n     *\n     * @param index: Cell's position.\n     *\n     * @returns The requested shared cell.\n     */\n    getCell(index) {\n        return this.cells[index];\n    }\n    /**\n     * Add a shared cell at the notebook bottom.\n     *\n     * @param cell Cell to add.\n     *\n     * @returns The added cell.\n     */\n    addCell(cell) {\n        return this.insertCell(this._ycells.length, cell);\n    }\n    /**\n     * Insert a shared cell into a specific position.\n     *\n     * @param index: Cell's position.\n     * @param cell: Cell to insert.\n     *\n     * @returns The inserted cell.\n     */\n    insertCell(index, cell) {\n        return this.insertCells(index, [cell])[0];\n    }\n    /**\n     * Insert a list of shared cells into a specific position.\n     *\n     * @param index: Position to insert the cells.\n     * @param cells: Array of shared cells to insert.\n     *\n     * @returns The inserted cells.\n     */\n    insertCells(index, cells) {\n        const yCells = cells.map(c => {\n            const cell = createCell(c, this);\n            this._ycellMapping.set(cell.ymodel, cell);\n            return cell;\n        });\n        this.transact(() => {\n            this._ycells.insert(index, yCells.map(cell => cell.ymodel));\n        });\n        return yCells;\n    }\n    /**\n     * Move a cell.\n     *\n     * @param fromIndex: Index of the cell to move.\n     * @param toIndex: New position of the cell.\n     */\n    moveCell(fromIndex, toIndex) {\n        this.moveCells(fromIndex, toIndex);\n    }\n    /**\n     * Move cells.\n     *\n     * @param fromIndex: Index of the first cells to move.\n     * @param toIndex: New position of the first cell (in the current array).\n     * @param n: Number of cells to move (default 1)\n     */\n    moveCells(fromIndex, toIndex, n = 1) {\n        // FIXME we need to use yjs move feature to preserve undo history\n        const clones = new Array(n)\n            .fill(true)\n            .map((_, idx) => this.getCell(fromIndex + idx).toJSON());\n        this.transact(() => {\n            this._ycells.delete(fromIndex, n);\n            this._ycells.insert(fromIndex > toIndex ? toIndex : toIndex - n + 1, clones.map(clone => createCell(clone, this).ymodel));\n        });\n    }\n    /**\n     * Remove a cell.\n     *\n     * @param index: Index of the cell to remove.\n     */\n    deleteCell(index) {\n        this.deleteCellRange(index, index + 1);\n    }\n    /**\n     * Remove a range of cells.\n     *\n     * @param from: The start index of the range to remove (inclusive).\n     * @param to: The end index of the range to remove (exclusive).\n     */\n    deleteCellRange(from, to) {\n        // Cells will be removed from the mapping in the model event listener.\n        this.transact(() => {\n            this._ycells.delete(from, to - from);\n        });\n    }\n    /**\n     * Delete a metadata notebook.\n     *\n     * @param key The key to delete\n     */\n    deleteMetadata(key) {\n        if (typeof this.getMetadata(key) === 'undefined') {\n            return;\n        }\n        const allMetadata = this.metadata;\n        delete allMetadata[key];\n        this.setMetadata(allMetadata);\n    }\n    getMetadata(key) {\n        const ymetadata = this.ymeta.get('metadata');\n        // Transiently the metadata can be missing - like during destruction\n        if (ymetadata === undefined) {\n            return undefined;\n        }\n        if (typeof key === 'string') {\n            const value = ymetadata.get(key);\n            return typeof value === 'undefined'\n                ? undefined // undefined is converted to `{}` by `JSONExt.deepCopy`\n                : JSONExt.deepCopy(value);\n        }\n        else {\n            return JSONExt.deepCopy(ymetadata.toJSON());\n        }\n    }\n    setMetadata(metadata, value) {\n        var _a;\n        if (typeof metadata === 'string') {\n            if (typeof value === 'undefined') {\n                throw new TypeError(`Metadata value for ${metadata} cannot be 'undefined'; use deleteMetadata.`);\n            }\n            if (JSONExt.deepEqual((_a = this.getMetadata(metadata)) !== null && _a !== void 0 ? _a : null, value)) {\n                return;\n            }\n            const update = {};\n            update[metadata] = value;\n            this.updateMetadata(update);\n        }\n        else {\n            if (!this.metadata || !JSONExt.deepEqual(this.metadata, metadata)) {\n                const clone = JSONExt.deepCopy(metadata);\n                const ymetadata = this.ymeta.get('metadata');\n                // Transiently the metadata can be missing - like during destruction\n                if (ymetadata === undefined) {\n                    return undefined;\n                }\n                this.transact(() => {\n                    ymetadata.clear();\n                    for (const [key, value] of Object.entries(clone)) {\n                        ymetadata.set(key, value);\n                    }\n                });\n            }\n        }\n    }\n    /**\n     * Updates the metadata associated with the notebook.\n     *\n     * @param value: Metadata's attribute to update.\n     */\n    updateMetadata(value) {\n        // TODO: Maybe modify only attributes instead of replacing the whole metadata?\n        const clone = JSONExt.deepCopy(value);\n        const ymetadata = this.ymeta.get('metadata');\n        // Transiently the metadata can be missing - like during destruction\n        if (ymetadata === undefined) {\n            return undefined;\n        }\n        this.transact(() => {\n            for (const [key, value] of Object.entries(clone)) {\n                ymetadata.set(key, value);\n            }\n        });\n    }\n    /**\n     * Get the notebook source\n     *\n     * @returns The notebook\n     */\n    getSource() {\n        return this.toJSON();\n    }\n    /**\n     * Set the notebook source\n     *\n     * @param value The notebook\n     */\n    setSource(value) {\n        this.fromJSON(value);\n    }\n    /**\n     * Override the notebook with a JSON-serialized document.\n     *\n     * @param value The notebook\n     */\n    fromJSON(value) {\n        this.transact(() => {\n            this.nbformat = value.nbformat;\n            this.nbformat_minor = value.nbformat_minor;\n            const metadata = value.metadata;\n            if (metadata['orig_nbformat'] !== undefined) {\n                delete metadata['orig_nbformat'];\n            }\n            if (!this.metadata) {\n                const ymetadata = new Y.Map();\n                for (const [key, value] of Object.entries(metadata)) {\n                    ymetadata.set(key, value);\n                }\n                this.ymeta.set('metadata', ymetadata);\n            }\n            else {\n                this.metadata = metadata;\n            }\n            const useId = value.nbformat === 4 && value.nbformat_minor >= 5;\n            const ycells = value.cells.map(cell => {\n                if (!useId) {\n                    delete cell.id;\n                }\n                return cell;\n            });\n            this.insertCells(this.cells.length, ycells);\n            this.deleteCellRange(0, this.cells.length);\n        });\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        // strip cell ids if we have notebook format 4.0-4.4\n        const pruneCellId = this.nbformat === 4 && this.nbformat_minor <= 4;\n        return {\n            metadata: this.metadata,\n            nbformat_minor: this.nbformat_minor,\n            nbformat: this.nbformat,\n            cells: this.cells.map(c => {\n                const raw = c.toJSON();\n                if (pruneCellId) {\n                    delete raw.id;\n                }\n                return raw;\n            })\n        };\n    }\n}\n//# sourceMappingURL=ynotebook.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { CodeCellModel, MarkdownCellModel, RawCellModel } from '@jupyterlab/cells';\nimport { Signal } from '@lumino/signaling';\n/**\n * A cell list object that supports undo/redo.\n */\nexport class CellList {\n    /**\n     * Construct the cell list.\n     */\n    constructor(model) {\n        this.model = model;\n        this._cellMap = new WeakMap();\n        this._changed = new Signal(this);\n        this._isDisposed = false;\n        this._insertCells(0, this.model.cells);\n        this.model.changed.connect(this._onSharedModelChanged, this);\n    }\n    /**\n     * A signal emitted when the cell list has changed.\n     */\n    get changed() {\n        return this._changed;\n    }\n    /**\n     * Test whether the cell list has been disposed.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Get the length of the cell list.\n     *\n     * @returns The number of cells in the cell list.\n     */\n    get length() {\n        return this.model.cells.length;\n    }\n    /**\n     * Create an iterator over the cells in the cell list.\n     *\n     * @returns A new iterator starting at the front of the cell list.\n     */\n    *[Symbol.iterator]() {\n        for (const cell of this.model.cells) {\n            yield this._cellMap.get(cell);\n        }\n    }\n    /**\n     * Dispose of the resources held by the cell list.\n     */\n    dispose() {\n        var _a;\n        if (this._isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        // Clean up the cell map and cell order objects.\n        for (const cell of this.model.cells) {\n            (_a = this._cellMap.get(cell)) === null || _a === void 0 ? void 0 : _a.dispose();\n        }\n        Signal.clearData(this);\n    }\n    /**\n     * Get the cell at the specified index.\n     *\n     * @param index - The positive integer index of interest.\n     *\n     * @returns The cell at the specified index.\n     */\n    get(index) {\n        return this._cellMap.get(this.model.cells[index]);\n    }\n    _insertCells(index, cells) {\n        cells.forEach(sharedModel => {\n            let cellModel;\n            switch (sharedModel.cell_type) {\n                case 'code': {\n                    cellModel = new CodeCellModel({\n                        sharedModel: sharedModel\n                    });\n                    break;\n                }\n                case 'markdown': {\n                    cellModel = new MarkdownCellModel({\n                        sharedModel: sharedModel\n                    });\n                    break;\n                }\n                default: {\n                    cellModel = new RawCellModel({\n                        sharedModel: sharedModel\n                    });\n                }\n            }\n            this._cellMap.set(sharedModel, cellModel);\n            sharedModel.disposed.connect(() => {\n                cellModel.dispose();\n                this._cellMap.delete(sharedModel);\n            });\n        });\n        return this.length;\n    }\n    _onSharedModelChanged(self, change) {\n        var _a;\n        let currpos = 0;\n        // We differ emitting the list changes to ensure cell model for all current shared cell have been created.\n        const events = new Array();\n        (_a = change.cellsChange) === null || _a === void 0 ? void 0 : _a.forEach(delta => {\n            if (delta.insert != null) {\n                this._insertCells(currpos, delta.insert);\n                events.push({\n                    type: 'add',\n                    newIndex: currpos,\n                    newValues: delta.insert.map(c => this._cellMap.get(c)),\n                    oldIndex: -2,\n                    oldValues: []\n                });\n                currpos += delta.insert.length;\n            }\n            else if (delta.delete != null) {\n                events.push({\n                    type: 'remove',\n                    newIndex: -1,\n                    newValues: [],\n                    oldIndex: currpos,\n                    // Cells have been disposed, so we don't know which one are gone.\n                    oldValues: new Array(delta.delete).fill(undefined)\n                });\n            }\n            else if (delta.retain != null) {\n                currpos += delta.retain;\n            }\n        });\n        events.forEach(msg => this._changed.emit(msg));\n    }\n}\n//# sourceMappingURL=celllist.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { nullTranslator } from '@jupyterlab/translation';\nimport { Signal } from '@lumino/signaling';\n/**\n * A console history manager object.\n */\nexport class NotebookHistory {\n    /**\n     * Construct a new console history object.\n     */\n    constructor(options) {\n        /**\n         * The number of history items to increase a batch size by per subsequent request.\n         */\n        this._requestBatchSize = 10;\n        this._cursor = 0;\n        this._hasSession = false;\n        this._history = [];\n        this._placeholder = '';\n        this._kernelSession = '';\n        this._setByHistory = false;\n        this._isDisposed = false;\n        this._editor = null;\n        this._filtered = [];\n        this._kernel = null;\n        this._sessionContext = options.sessionContext;\n        this._trans = (options.translator || nullTranslator).load('jupyterlab');\n        void this._handleKernel().then(() => {\n            this._sessionContext.kernelChanged.connect(this._handleKernel, this);\n        });\n        this._toRequest = this._requestBatchSize;\n    }\n    /**\n     * The current editor used by the history manager.\n     */\n    get editor() {\n        return this._editor;\n    }\n    set editor(value) {\n        if (this._editor === value) {\n            return;\n        }\n        const prev = this._editor;\n        if (prev) {\n            prev.model.sharedModel.changed.disconnect(this.onTextChange, this);\n        }\n        this._editor = value;\n        if (value) {\n            value.model.sharedModel.changed.connect(this.onTextChange, this);\n        }\n    }\n    /**\n     * The placeholder text that a history session began with.\n     */\n    get placeholder() {\n        return this._placeholder;\n    }\n    /**\n     * Kernel session number for filtering\n     */\n    get kernelSession() {\n        return this._kernelSession;\n    }\n    /**\n     * Get whether the notebook history manager is disposed.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Dispose of the resources held by the notebook history manager.\n     */\n    dispose() {\n        this._isDisposed = true;\n        this._history.length = 0;\n        Signal.clearData(this);\n    }\n    /**\n     * Set placeholder and editor. Start session if one is not already started.\n     *\n     * @param activeCell - The currently selected Cell in the notebook.\n     */\n    async checkSession(activeCell) {\n        var _a;\n        if (!this._hasSession) {\n            await this._retrieveHistory();\n            this._hasSession = true;\n            this.editor = activeCell.editor;\n            this._placeholder = ((_a = this._editor) === null || _a === void 0 ? void 0 : _a.model.sharedModel.getSource()) || '';\n            // Filter the history with the placeholder string.\n            this.setFilter(this._placeholder);\n            this._cursor = this._filtered.length - 1;\n        }\n    }\n    /**\n     * Get the previous item in the notebook history.\n     *\n     * @param activeCell - The currently selected Cell in the notebook.\n     *\n     * @returns A Promise resolving to the historical cell content text.\n     */\n    async back(activeCell) {\n        await this.checkSession(activeCell);\n        --this._cursor;\n        if (this._cursor < 0) {\n            await this.fetchBatch();\n        }\n        this._cursor = Math.max(0, this._cursor);\n        const content = this._filtered[this._cursor];\n        // This shouldn't ever be undefined as `setFilter` will always be run first\n        return content;\n    }\n    /**\n     * Get the next item in the notebook history.\n     *\n     * @param activeCell - The currently selected Cell in the notebook.\n     *\n     * @returns A Promise resolving to the historical cell content text.\n     */\n    async forward(activeCell) {\n        await this.checkSession(activeCell);\n        ++this._cursor;\n        this._cursor = Math.min(this._filtered.length - 1, this._cursor);\n        const content = this._filtered[this._cursor];\n        // This shouldn't ever be undefined as `setFilter` will always be run first\n        return content;\n    }\n    /**\n     * Update the editor of the cell with provided text content.\n     *\n     * @param activeCell - The currently selected Cell in the notebook.\n     * @param content - the result from back or forward\n     */\n    updateEditor(activeCell, content) {\n        var _a, _b;\n        if (activeCell) {\n            const model = (_a = activeCell.editor) === null || _a === void 0 ? void 0 : _a.model;\n            const source = model === null || model === void 0 ? void 0 : model.sharedModel.getSource();\n            if (this.isDisposed || !content) {\n                return;\n            }\n            if (source === content) {\n                return;\n            }\n            this._setByHistory = true;\n            model === null || model === void 0 ? void 0 : model.sharedModel.setSource(content);\n            let columnPos = 0;\n            columnPos = content.indexOf('\\n');\n            if (columnPos < 0) {\n                columnPos = content.length;\n            }\n            (_b = activeCell.editor) === null || _b === void 0 ? void 0 : _b.setCursorPosition({ line: 0, column: columnPos });\n        }\n    }\n    /**\n     * Reset the history navigation state, i.e., start a new history session.\n     */\n    reset() {\n        this._hasSession = false;\n        this._placeholder = '';\n        this._toRequest = this._requestBatchSize;\n    }\n    /**\n     * Fetches a subsequent batch of history. Updates the filtered history and cursor to correct place in history,\n     * accounting for potentially new history items above it.\n     */\n    async fetchBatch() {\n        this._toRequest += this._requestBatchSize;\n        let oldFilteredReversed = this._filtered.slice().reverse();\n        let oldHistory = this._history.slice();\n        await this._retrieveHistory().then(() => {\n            this.setFilter(this._placeholder);\n            let cursorOffset = 0;\n            let filteredReversed = this._filtered.slice().reverse();\n            for (let i = 0; i < oldFilteredReversed.length; i++) {\n                let item = oldFilteredReversed[i];\n                for (let ij = i + cursorOffset; ij < filteredReversed.length; ij++) {\n                    if (item === filteredReversed[ij]) {\n                        break;\n                    }\n                    else {\n                        cursorOffset += 1;\n                    }\n                }\n            }\n            this._cursor =\n                this._filtered.length - (oldFilteredReversed.length + 1) - cursorOffset;\n        });\n        if (this._cursor < 0) {\n            if (this._history.length > oldHistory.length) {\n                await this.fetchBatch();\n            }\n        }\n    }\n    /**\n     * Populate the history collection on history reply from a kernel.\n     *\n     * @param value The kernel message history reply.\n     *\n     * #### Notes\n     * History entries have the shape:\n     * [session: number, line: number, input: string]\n     * Contiguous duplicates are stripped out of the API response.\n     */\n    onHistory(value, cell) {\n        this._history.length = 0;\n        let last = ['', '', ''];\n        let current = ['', '', ''];\n        let kernelSession = '';\n        if (value.content.status === 'ok') {\n            for (let i = 0; i < value.content.history.length; i++) {\n                current = value.content.history[i];\n                if (current !== last) {\n                    kernelSession = value.content.history[i][0];\n                    this._history.push((last = current));\n                }\n            }\n            // set the kernel session for filtering\n            if (!this.kernelSession) {\n                if (current[2] == (cell === null || cell === void 0 ? void 0 : cell.model.sharedModel.getSource())) {\n                    this._kernelSession = kernelSession;\n                }\n            }\n        }\n    }\n    /**\n     * Handle a text change signal from the editor.\n     */\n    onTextChange() {\n        if (this._setByHistory) {\n            this._setByHistory = false;\n            return;\n        }\n        this.reset();\n    }\n    /**\n     * Handle the current kernel changing.\n     */\n    async _handleKernel() {\n        var _a;\n        this._kernel = (_a = this._sessionContext.session) === null || _a === void 0 ? void 0 : _a.kernel;\n        if (!this._kernel) {\n            this._history.length = 0;\n            return;\n        }\n        await this._retrieveHistory().catch();\n        return;\n    }\n    /**\n     * retrieve the history from the kernel\n     *\n     * @param cell - The string to use when filtering the data.\n     */\n    async _retrieveHistory(cell) {\n        var _a;\n        return await ((_a = this._kernel) === null || _a === void 0 ? void 0 : _a.requestHistory(request(this._toRequest)).then(v => {\n            this.onHistory(v, cell);\n        }).catch(() => {\n            console.warn(this._trans.__('History was unable to be retrieved'));\n        }));\n    }\n    /**\n     * Set the filter data.\n     *\n     * @param filterStr - The string to use when filtering the data.\n     */\n    setFilter(filterStr = '') {\n        // Apply the new filter and remove contiguous duplicates.\n        this._filtered.length = 0;\n        let last = '';\n        let current = '';\n        for (let i = 0; i < this._history.length; i++) {\n            current = this._history[i][2];\n            if (current !== last && filterStr !== current) {\n                this._filtered.push((last = current));\n            }\n        }\n        this._filtered.push(filterStr);\n    }\n}\nfunction request(n) {\n    return {\n        output: false,\n        raw: true,\n        hist_access_type: 'tail',\n        n: n\n    };\n}\n//# sourceMappingURL=history.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Dialog, showDialog } from '@jupyterlab/apputils';\nimport * as nbformat from '@jupyterlab/nbformat';\nimport { YNotebook } from '@jupyter/ydoc';\nimport { nullTranslator } from '@jupyterlab/translation';\nimport { JSONExt } from '@lumino/coreutils';\nimport { Signal } from '@lumino/signaling';\nimport { CellList } from './celllist';\n/**\n * An implementation of a notebook Model.\n */\nexport class NotebookModel {\n    /**\n     * Construct a new notebook model.\n     */\n    constructor(options = {}) {\n        var _a, _b;\n        /**\n         * Whether the model should disposed the shared model on disposal or not.\n         */\n        this.standaloneModel = false;\n        this._dirty = false;\n        this._readOnly = false;\n        this._contentChanged = new Signal(this);\n        this._stateChanged = new Signal(this);\n        this._isDisposed = false;\n        this._metadataChanged = new Signal(this);\n        this.standaloneModel = typeof options.sharedModel === 'undefined';\n        if (options.sharedModel) {\n            this.sharedModel = options.sharedModel;\n        }\n        else {\n            this.sharedModel = YNotebook.create({\n                disableDocumentWideUndoRedo: (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : true,\n                data: {\n                    nbformat: nbformat.MAJOR_VERSION,\n                    nbformat_minor: nbformat.MINOR_VERSION,\n                    metadata: {\n                        kernelspec: { name: '', display_name: '' },\n                        language_info: { name: (_b = options.languagePreference) !== null && _b !== void 0 ? _b : '' }\n                    }\n                }\n            });\n        }\n        this._cells = new CellList(this.sharedModel);\n        this._trans = (options.translator || nullTranslator).load('jupyterlab');\n        this._deletedCells = [];\n        this._collaborationEnabled = !!(options === null || options === void 0 ? void 0 : options.collaborationEnabled);\n        this._cells.changed.connect(this._onCellsChanged, this);\n        this.sharedModel.changed.connect(this._onStateChanged, this);\n        this.sharedModel.metadataChanged.connect(this._onMetadataChanged, this);\n    }\n    /**\n     * A signal emitted when the document content changes.\n     */\n    get contentChanged() {\n        return this._contentChanged;\n    }\n    /**\n     * Signal emitted when notebook metadata changes.\n     */\n    get metadataChanged() {\n        return this._metadataChanged;\n    }\n    /**\n     * A signal emitted when the document state changes.\n     */\n    get stateChanged() {\n        return this._stateChanged;\n    }\n    /**\n     * Get the observable list of notebook cells.\n     */\n    get cells() {\n        return this._cells;\n    }\n    /**\n     * The dirty state of the document.\n     */\n    get dirty() {\n        return this._dirty;\n    }\n    set dirty(newValue) {\n        const oldValue = this._dirty;\n        if (newValue === oldValue) {\n            return;\n        }\n        this._dirty = newValue;\n        this.triggerStateChange({\n            name: 'dirty',\n            oldValue,\n            newValue\n        });\n    }\n    /**\n     * The read only state of the document.\n     */\n    get readOnly() {\n        return this._readOnly;\n    }\n    set readOnly(newValue) {\n        if (newValue === this._readOnly) {\n            return;\n        }\n        const oldValue = this._readOnly;\n        this._readOnly = newValue;\n        this.triggerStateChange({ name: 'readOnly', oldValue, newValue });\n    }\n    /**\n     * The metadata associated with the notebook.\n     *\n     * ### Notes\n     * This is a copy of the metadata. Changing a part of it\n     * won't affect the model.\n     * As this returns a copy of all metadata, it is advised to\n     * use `getMetadata` to speed up the process of getting a single key.\n     */\n    get metadata() {\n        return this.sharedModel.metadata;\n    }\n    /**\n     * The major version number of the nbformat.\n     */\n    get nbformat() {\n        return this.sharedModel.nbformat;\n    }\n    /**\n     * The minor version number of the nbformat.\n     */\n    get nbformatMinor() {\n        return this.sharedModel.nbformat_minor;\n    }\n    /**\n     * The default kernel name of the document.\n     */\n    get defaultKernelName() {\n        var _a;\n        const spec = this.getMetadata('kernelspec');\n        return (_a = spec === null || spec === void 0 ? void 0 : spec.name) !== null && _a !== void 0 ? _a : '';\n    }\n    /**\n     * A list of deleted cells for the notebook..\n     */\n    get deletedCells() {\n        return this._deletedCells;\n    }\n    /**\n     * The default kernel language of the document.\n     */\n    get defaultKernelLanguage() {\n        var _a;\n        const info = this.getMetadata('language_info');\n        return (_a = info === null || info === void 0 ? void 0 : info.name) !== null && _a !== void 0 ? _a : '';\n    }\n    /**\n     * Whether the model is collaborative or not.\n     */\n    get collaborative() {\n        return this._collaborationEnabled;\n    }\n    /**\n     * Dispose of the resources held by the model.\n     */\n    dispose() {\n        // Do nothing if already disposed.\n        if (this.isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        const cells = this.cells;\n        this._cells = null;\n        cells.dispose();\n        if (this.standaloneModel) {\n            this.sharedModel.dispose();\n        }\n        Signal.clearData(this);\n    }\n    /**\n     * Delete a metadata\n     *\n     * @param key Metadata key\n     */\n    deleteMetadata(key) {\n        return this.sharedModel.deleteMetadata(key);\n    }\n    /**\n     * Get a metadata\n     *\n     * ### Notes\n     * This returns a copy of the key value.\n     *\n     * @param key Metadata key\n     */\n    getMetadata(key) {\n        return this.sharedModel.getMetadata(key);\n    }\n    /**\n     * Set a metadata\n     *\n     * @param key Metadata key\n     * @param value Metadata value\n     */\n    setMetadata(key, value) {\n        if (typeof value === 'undefined') {\n            this.sharedModel.deleteMetadata(key);\n        }\n        else {\n            this.sharedModel.setMetadata(key, value);\n        }\n    }\n    /**\n     * Serialize the model to a string.\n     */\n    toString() {\n        return JSON.stringify(this.toJSON());\n    }\n    /**\n     * Deserialize the model from a string.\n     *\n     * #### Notes\n     * Should emit a [contentChanged] signal.\n     */\n    fromString(value) {\n        this.fromJSON(JSON.parse(value));\n    }\n    /**\n     * Serialize the model to JSON.\n     */\n    toJSON() {\n        this._ensureMetadata();\n        return this.sharedModel.toJSON();\n    }\n    /**\n     * Deserialize the model from JSON.\n     *\n     * #### Notes\n     * Should emit a [contentChanged] signal.\n     */\n    fromJSON(value) {\n        var _a, _b;\n        const copy = JSONExt.deepCopy(value);\n        const origNbformat = value.metadata.orig_nbformat;\n        // Alert the user if the format changes.\n        copy.nbformat = Math.max(value.nbformat, nbformat.MAJOR_VERSION);\n        if (copy.nbformat !== value.nbformat ||\n            copy.nbformat_minor < nbformat.MINOR_VERSION) {\n            copy.nbformat_minor = nbformat.MINOR_VERSION;\n        }\n        if (origNbformat !== undefined && copy.nbformat !== origNbformat) {\n            const newer = copy.nbformat > origNbformat;\n            let msg;\n            if (newer) {\n                msg = this._trans.__(`This notebook has been converted from an older notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\n'Older versions of Jupyter may not be able to read the new format.' To preserve the original format version,\nclose the notebook without saving it.`, origNbformat, copy.nbformat);\n            }\n            else {\n                msg = this._trans.__(`This notebook has been converted from an newer notebook format (v%1)\nto the current notebook format (v%2).\nThe next time you save this notebook, the current notebook format (v%2) will be used.\nSome features of the original notebook may not be available.' To preserve the original format version,\nclose the notebook without saving it.`, origNbformat, copy.nbformat);\n            }\n            void showDialog({\n                title: this._trans.__('Notebook converted'),\n                body: msg,\n                buttons: [Dialog.okButton({ label: this._trans.__('Ok') })]\n            });\n        }\n        // Ensure there is at least one cell\n        if (((_b = (_a = copy.cells) === null || _a === void 0 ? void 0 : _a.length) !== null && _b !== void 0 ? _b : 0) === 0) {\n            copy['cells'] = [\n                { cell_type: 'code', source: '', metadata: { trusted: true } }\n            ];\n        }\n        this.sharedModel.fromJSON(copy);\n        this._ensureMetadata();\n        this.dirty = true;\n    }\n    /**\n     * Handle a change in the cells list.\n     */\n    _onCellsChanged(list, change) {\n        switch (change.type) {\n            case 'add':\n                change.newValues.forEach(cell => {\n                    cell.contentChanged.connect(this.triggerContentChange, this);\n                });\n                break;\n            case 'remove':\n                break;\n            case 'clear':\n                break;\n            case 'set':\n                change.newValues.forEach(cell => {\n                    cell.contentChanged.connect(this.triggerContentChange, this);\n                });\n                break;\n            default:\n                break;\n        }\n        this.triggerContentChange();\n    }\n    _onMetadataChanged(sender, changes) {\n        this._metadataChanged.emit(changes);\n        this.triggerContentChange();\n    }\n    _onStateChanged(sender, changes) {\n        if (changes.stateChange) {\n            changes.stateChange.forEach(value => {\n                if (value.name === 'dirty') {\n                    // Setting `dirty` will trigger the state change.\n                    // We always set `dirty` because the shared model state\n                    // and the local attribute are synchronized one way shared model -> _dirty\n                    this.dirty = value.newValue;\n                }\n                else if (value.oldValue !== value.newValue) {\n                    this.triggerStateChange({\n                        newValue: undefined,\n                        oldValue: undefined,\n                        ...value\n                    });\n                }\n            });\n        }\n    }\n    /**\n     * Make sure we have the required metadata fields.\n     */\n    _ensureMetadata(languageName = '') {\n        if (!this.getMetadata('language_info')) {\n            this.sharedModel.setMetadata('language_info', { name: languageName });\n        }\n        if (!this.getMetadata('kernelspec')) {\n            this.sharedModel.setMetadata('kernelspec', {\n                name: '',\n                display_name: ''\n            });\n        }\n    }\n    /**\n     * Trigger a state change signal.\n     */\n    triggerStateChange(args) {\n        this._stateChanged.emit(args);\n    }\n    /**\n     * Trigger a content changed signal.\n     */\n    triggerContentChange() {\n        this._contentChanged.emit(void 0);\n        this.dirty = true;\n    }\n    /**\n     * Whether the model is disposed.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n}\n//# sourceMappingURL=model.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { NotebookModel } from './model';\n/**\n * A model factory for notebooks.\n */\nexport class NotebookModelFactory {\n    /**\n     * Construct a new notebook model factory.\n     */\n    constructor(options = {}) {\n        var _a, _b;\n        this._disposed = false;\n        this._disableDocumentWideUndoRedo =\n            (_a = options.disableDocumentWideUndoRedo) !== null && _a !== void 0 ? _a : true;\n        this._collaborative = (_b = options.collaborative) !== null && _b !== void 0 ? _b : true;\n    }\n    /**\n     * Define the disableDocumentWideUndoRedo property.\n     *\n     * @experimental\n     * @alpha\n     */\n    get disableDocumentWideUndoRedo() {\n        return this._disableDocumentWideUndoRedo;\n    }\n    set disableDocumentWideUndoRedo(disableDocumentWideUndoRedo) {\n        this._disableDocumentWideUndoRedo = disableDocumentWideUndoRedo;\n    }\n    /**\n     * The name of the model.\n     */\n    get name() {\n        return 'notebook';\n    }\n    /**\n     * The content type of the file.\n     */\n    get contentType() {\n        return 'notebook';\n    }\n    /**\n     * The format of the file.\n     */\n    get fileFormat() {\n        return 'json';\n    }\n    /**\n     * Whether the model is collaborative or not.\n     */\n    get collaborative() {\n        return this._collaborative;\n    }\n    /**\n     * Get whether the model factory has been disposed.\n     */\n    get isDisposed() {\n        return this._disposed;\n    }\n    /**\n     * Dispose of the model factory.\n     */\n    dispose() {\n        this._disposed = true;\n    }\n    /**\n     * Create a new model for a given path.\n     *\n     * @param options Model options.\n     *\n     * @returns A new document model.\n     */\n    createNew(options = {}) {\n        return new NotebookModel({\n            languagePreference: options.languagePreference,\n            sharedModel: options.sharedModel,\n            collaborationEnabled: options.collaborationEnabled && this.collaborative,\n            disableDocumentWideUndoRedo: this._disableDocumentWideUndoRedo\n        });\n    }\n    /**\n     * Get the preferred kernel language given a path.\n     */\n    preferredLanguage(path) {\n        return '';\n    }\n}\n//# sourceMappingURL=modelfactory.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Dialog, SessionContext, SessionContextDialogs, showDialog, showErrorMessage } from '@jupyterlab/apputils';\nimport { PathExt } from '@jupyterlab/coreutils';\nimport { RenderMimeRegistry } from '@jupyterlab/rendermime';\nimport { nullTranslator } from '@jupyterlab/translation';\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { DisposableDelegate } from '@lumino/disposable';\nimport { Signal } from '@lumino/signaling';\nimport { Widget } from '@lumino/widgets';\n/**\n * An implementation of a document context.\n *\n * This class is typically instantiated by the document manager.\n */\nexport class Context {\n    /**\n     * Construct a new document context.\n     */\n    constructor(options) {\n        var _a, _b;\n        this._isReady = false;\n        this._isDisposed = false;\n        this._isPopulated = false;\n        this._path = '';\n        this._lineEnding = null;\n        this._contentsModel = null;\n        this._populatedPromise = new PromiseDelegate();\n        this._pathChanged = new Signal(this);\n        this._fileChanged = new Signal(this);\n        this._saveState = new Signal(this);\n        this._disposed = new Signal(this);\n        this._lastModifiedCheckMargin = 500;\n        this._conflictModalIsOpen = false;\n        const manager = (this._manager = options.manager);\n        this.translator = options.translator || nullTranslator;\n        this._contentProviderId = options.contentProviderId;\n        this._trans = this.translator.load('jupyterlab');\n        this._factory = options.factory;\n        this._dialogs =\n            (_a = options.sessionDialogs) !== null && _a !== void 0 ? _a : new SessionContextDialogs({ translator: options.translator });\n        this._opener = options.opener || Private.noOp;\n        this._path = this._manager.contents.normalize(options.path);\n        this._lastModifiedCheckMargin = options.lastModifiedCheckMargin || 500;\n        const localPath = this._manager.contents.localPath(this._path);\n        const lang = this._factory.preferredLanguage(PathExt.basename(localPath));\n        const sharedFactory = this._manager.contents.getSharedModelFactory(this._path, { contentProviderId: options.contentProviderId });\n        const sharedModel = sharedFactory === null || sharedFactory === void 0 ? void 0 : sharedFactory.createNew({\n            path: this._path,\n            format: this._factory.fileFormat,\n            contentType: this._factory.contentType,\n            collaborative: this._factory.collaborative\n        });\n        this._model = this._factory.createNew({\n            languagePreference: lang,\n            sharedModel,\n            collaborationEnabled: (_b = sharedFactory === null || sharedFactory === void 0 ? void 0 : sharedFactory.collaborative) !== null && _b !== void 0 ? _b : false\n        });\n        this._readyPromise = manager.ready.then(() => {\n            return this._populatedPromise.promise;\n        });\n        const ext = PathExt.extname(this._path);\n        this.sessionContext = new SessionContext({\n            kernelManager: manager.kernels,\n            sessionManager: manager.sessions,\n            specsManager: manager.kernelspecs,\n            path: this._path,\n            type: ext === '.ipynb' ? 'notebook' : 'file',\n            name: PathExt.basename(localPath),\n            kernelPreference: options.kernelPreference || { shouldStart: false },\n            setBusy: options.setBusy\n        });\n        this.sessionContext.propertyChanged.connect(this._onSessionChanged, this);\n        manager.contents.fileChanged.connect(this._onFileChanged, this);\n        const urlResolverFactory = options.urlResolverFactory\n            ? options.urlResolverFactory\n            : {\n                createResolver: (resolverOptions) => new RenderMimeRegistry.UrlResolver(resolverOptions)\n            };\n        this._urlResolver = urlResolverFactory.createResolver({\n            path: this._path,\n            contents: manager.contents\n        });\n    }\n    /**\n     * A signal emitted when the path changes.\n     */\n    get pathChanged() {\n        return this._pathChanged;\n    }\n    /**\n     * A signal emitted when the model is saved or reverted.\n     */\n    get fileChanged() {\n        return this._fileChanged;\n    }\n    /**\n     * A signal emitted on the start and end of a saving operation.\n     */\n    get saveState() {\n        return this._saveState;\n    }\n    /**\n     * A signal emitted when the context is disposed.\n     */\n    get disposed() {\n        return this._disposed;\n    }\n    /**\n     * Configurable margin used to detect document modification conflicts, in milliseconds\n     */\n    get lastModifiedCheckMargin() {\n        return this._lastModifiedCheckMargin;\n    }\n    set lastModifiedCheckMargin(value) {\n        this._lastModifiedCheckMargin = value;\n    }\n    /**\n     * Get the model associated with the document.\n     */\n    get model() {\n        return this._model;\n    }\n    /**\n     * The current path associated with the document.\n     */\n    get path() {\n        return this._path;\n    }\n    /**\n     * The current local path associated with the document.\n     * If the document is in the default notebook file browser,\n     * this is the same as the path.\n     */\n    get localPath() {\n        return this._manager.contents.localPath(this._path);\n    }\n    /**\n     * The document metadata, stored as a services contents model.\n     *\n     * #### Notes\n     * The contents model will be `null` until the context is populated.\n     * It will not have a `content` field.\n     */\n    get contentsModel() {\n        return this._contentsModel ? { ...this._contentsModel } : null;\n    }\n    /**\n     * Get the model factory name.\n     *\n     * #### Notes\n     * This is not part of the `IContext` API.\n     */\n    get factoryName() {\n        return this.isDisposed ? '' : this._factory.name;\n    }\n    /**\n     * Test whether the context is disposed.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Dispose of the resources held by the context.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        this.sessionContext.dispose();\n        this._model.dispose();\n        // Ensure we dispose the `sharedModel` as it may have been generated in the context\n        // through the shared model factory.\n        this._model.sharedModel.dispose();\n        this._disposed.emit(void 0);\n        Signal.clearData(this);\n    }\n    /**\n     * Whether the context is ready.\n     */\n    get isReady() {\n        return this._isReady;\n    }\n    /**\n     * A promise that is fulfilled when the context is ready.\n     */\n    get ready() {\n        return this._readyPromise;\n    }\n    /**\n     * Whether the document can be saved via the Contents API.\n     */\n    get canSave() {\n        var _a;\n        return !!(((_a = this._contentsModel) === null || _a === void 0 ? void 0 : _a.writable) && !this._model.collaborative);\n    }\n    /**\n     * The url resolver for the context.\n     */\n    get urlResolver() {\n        return this._urlResolver;\n    }\n    /**\n     * Initialize the context.\n     *\n     * @param isNew - Whether it is a new file.\n     *\n     * @returns a promise that resolves upon initialization.\n     */\n    async initialize(isNew) {\n        if (isNew) {\n            await this._save();\n        }\n        else {\n            await this._revert();\n        }\n        this.model.sharedModel.clearUndoHistory();\n    }\n    /**\n     * Rename the document.\n     *\n     * @param newName - the new name for the document.\n     */\n    rename(newName) {\n        return this.ready.then(() => {\n            return this._manager.ready.then(() => {\n                return this._rename(newName);\n            });\n        });\n    }\n    /**\n     * Save the document contents to disk.\n     */\n    async save() {\n        await this.ready;\n        await this._save();\n    }\n    /**\n     * Save the document to a different path chosen by the user.\n     *\n     * @returns A promise that resolves to `true` if the save operation was initiated.\n     * Returns `false` if the user cancelled the operation.\n     *\n     * Note:\n     * - If the save operation proceeds but fails due to an error in the content manager,\n     *   the returned value will still be `true`.\n     * - Consumers interested in the actual result of the save should listen to the\n     *   {@link saveState} signal to be notified when the save succeeds or fails.\n     */\n    async saveAs() {\n        await this.ready;\n        const localPath = this._manager.contents.localPath(this.path);\n        const newLocalPath = await Private.getSavePath(localPath);\n        if (this.isDisposed || !newLocalPath) {\n            return false;\n        }\n        const drive = this._manager.contents.driveName(this.path);\n        const newPath = drive == '' ? newLocalPath : `${drive}:${newLocalPath}`;\n        if (newPath === this._path) {\n            await this.save();\n            return true;\n        }\n        // Make sure the path does not exist.\n        try {\n            await this._manager.ready;\n            await this._manager.contents.get(newPath, {\n                contentProviderId: this._contentProviderId\n            });\n            await this._maybeOverWrite(newPath);\n        }\n        catch (err) {\n            if (!err.response || err.response.status !== 404) {\n                // Dialog rejection (user cancelled)\n                if (!err.response) {\n                    return false;\n                }\n                throw err;\n            }\n        }\n        await this._finishSaveAs(newPath);\n        return true;\n    }\n    /**\n     * Download a file.\n     *\n     * @returns A promise which resolves when the file has begun\n     *   downloading.\n     */\n    async download() {\n        const url = await this._manager.contents.getDownloadUrl(this._path);\n        const element = document.createElement('a');\n        element.href = url;\n        element.download = '';\n        document.body.appendChild(element);\n        element.click();\n        document.body.removeChild(element);\n        return void 0;\n    }\n    /**\n     * Revert the document contents to disk contents.\n     */\n    async revert() {\n        await this.ready;\n        await this._revert();\n    }\n    /**\n     * Create a checkpoint for the file.\n     */\n    createCheckpoint() {\n        const contents = this._manager.contents;\n        return this._manager.ready.then(() => {\n            return contents.createCheckpoint(this._path);\n        });\n    }\n    /**\n     * Delete a checkpoint for the file.\n     */\n    deleteCheckpoint(checkpointId) {\n        const contents = this._manager.contents;\n        return this._manager.ready.then(() => {\n            return contents.deleteCheckpoint(this._path, checkpointId);\n        });\n    }\n    /**\n     * Restore the file to a known checkpoint state.\n     */\n    restoreCheckpoint(checkpointId) {\n        const contents = this._manager.contents;\n        const path = this._path;\n        return this._manager.ready.then(() => {\n            if (checkpointId) {\n                return contents.restoreCheckpoint(path, checkpointId);\n            }\n            return this.listCheckpoints().then(checkpoints => {\n                if (this.isDisposed || !checkpoints.length) {\n                    return;\n                }\n                checkpointId = checkpoints[checkpoints.length - 1].id;\n                return contents.restoreCheckpoint(path, checkpointId);\n            });\n        });\n    }\n    /**\n     * List available checkpoints for a file.\n     */\n    listCheckpoints() {\n        const contents = this._manager.contents;\n        return this._manager.ready.then(() => {\n            return contents.listCheckpoints(this._path);\n        });\n    }\n    /**\n     * Add a sibling widget to the document manager.\n     *\n     * @param widget - The widget to add to the document manager.\n     *\n     * @param options - The desired options for adding the sibling.\n     *\n     * @returns A disposable used to remove the sibling if desired.\n     *\n     * #### Notes\n     * It is assumed that the widget has the same model and context\n     * as the original widget.\n     */\n    addSibling(widget, options = {}) {\n        const opener = this._opener;\n        if (opener) {\n            opener(widget, options);\n        }\n        return new DisposableDelegate(() => {\n            widget.close();\n        });\n    }\n    /**\n     * Handle a change on the contents manager.\n     */\n    _onFileChanged(sender, change) {\n        var _a, _b, _c;\n        if (change.type === 'save' && this._model.collaborative) {\n            // Skip if the change isn't related to current file.\n            if (((_a = this._contentsModel) === null || _a === void 0 ? void 0 : _a.path) !== ((_b = change.newValue) === null || _b === void 0 ? void 0 : _b.path)) {\n                return;\n            }\n            // Update the contents model with the new values provided on save.\n            // This is needed for save operations performed on the server-side\n            // by the collaborative drive which needs to update the `hash`\n            // of the content when it changes on the backend.\n            this._updateContentsModel({\n                ...this._contentsModel,\n                ...change.newValue\n            });\n            return;\n        }\n        if (change.type !== 'rename') {\n            return;\n        }\n        let oldPath = change.oldValue && change.oldValue.path;\n        let newPath = change.newValue && change.newValue.path;\n        if (newPath && this._path.indexOf(oldPath || '') === 0) {\n            let changeModel = change.newValue;\n            // When folder name changed, `oldPath` is `foo`, `newPath` is `bar` and `this._path` is `foo/test`,\n            // we should update `foo/test` to `bar/test` as well\n            if (oldPath !== this._path) {\n                newPath = this._path.replace(new RegExp(`^${oldPath}/`), `${newPath}/`);\n                oldPath = this._path;\n                // Update client file model from folder change\n                changeModel = {\n                    last_modified: (_c = change.newValue) === null || _c === void 0 ? void 0 : _c.created,\n                    path: newPath\n                };\n            }\n            this._updateContentsModel({\n                ...this._contentsModel,\n                ...changeModel\n            });\n            this._updatePath(newPath);\n        }\n    }\n    /**\n     * Handle a change to a session property.\n     */\n    _onSessionChanged(sender, type) {\n        if (type !== 'path') {\n            return;\n        }\n        // The session uses local paths.\n        // We need to convert it to a global path.\n        const driveName = this._manager.contents.driveName(this.path);\n        let newPath = this._manager.contents.localPath(this.sessionContext.session.path);\n        if (driveName) {\n            newPath = `${driveName}:${newPath}`;\n        }\n        this._updatePath(newPath);\n    }\n    /**\n     * Update our contents model, without the content.\n     */\n    _updateContentsModel(model) {\n        var _a, _b, _c, _d;\n        const newModel = {\n            path: model.path,\n            name: model.name,\n            type: model.type,\n            writable: model.writable,\n            created: model.created,\n            last_modified: model.last_modified,\n            mimetype: model.mimetype,\n            format: model.format,\n            hash: model.hash,\n            hash_algorithm: model.hash_algorithm\n        };\n        const mod = (_b = (_a = this._contentsModel) === null || _a === void 0 ? void 0 : _a.last_modified) !== null && _b !== void 0 ? _b : null;\n        const hash = (_d = (_c = this._contentsModel) === null || _c === void 0 ? void 0 : _c.hash) !== null && _d !== void 0 ? _d : null;\n        this._contentsModel = newModel;\n        if (\n        // If neither modification date nor hash available, assume the file has changed\n        (!mod && !hash) ||\n            // Compare last_modified if no hash\n            (!hash && newModel.last_modified !== mod) ||\n            // Compare hash if available\n            (hash && newModel.hash !== hash)) {\n            this._fileChanged.emit(newModel);\n        }\n    }\n    _updatePath(newPath) {\n        var _a, _b, _c, _d;\n        if (this._path === newPath) {\n            return;\n        }\n        this._path = newPath;\n        const localPath = this._manager.contents.localPath(newPath);\n        const name = PathExt.basename(localPath);\n        if (((_a = this.sessionContext.session) === null || _a === void 0 ? void 0 : _a.path) !== newPath) {\n            void ((_b = this.sessionContext.session) === null || _b === void 0 ? void 0 : _b.setPath(newPath));\n        }\n        if (((_c = this.sessionContext.session) === null || _c === void 0 ? void 0 : _c.name) !== name) {\n            void ((_d = this.sessionContext.session) === null || _d === void 0 ? void 0 : _d.setName(name));\n        }\n        if (this._urlResolver.path !== newPath) {\n            this._urlResolver.path = newPath;\n        }\n        if (this._contentsModel &&\n            (this._contentsModel.path !== newPath ||\n                this._contentsModel.name !== name)) {\n            const contentsModel = {\n                ...this._contentsModel,\n                name: name,\n                path: newPath\n            };\n            this._updateContentsModel(contentsModel);\n        }\n        this._pathChanged.emit(newPath);\n    }\n    /**\n     * Handle an initial population.\n     */\n    async _populate() {\n        this._isPopulated = true;\n        this._isReady = true;\n        this._populatedPromise.resolve(void 0);\n        // Add a checkpoint if none exists and the file is writable.\n        await this._maybeCheckpoint(false);\n        if (this.isDisposed) {\n            return;\n        }\n        // Update the kernel preference.\n        const name = this._model.defaultKernelName ||\n            this.sessionContext.kernelPreference.name;\n        this.sessionContext.kernelPreference = {\n            ...this.sessionContext.kernelPreference,\n            name,\n            language: this._model.defaultKernelLanguage\n        };\n        // Note: we don't wait on the session to initialize\n        // so that the user can be shown the content before\n        // any kernel has started.\n        void this.sessionContext.initialize().then(shouldSelect => {\n            if (shouldSelect) {\n                void this._dialogs.selectKernel(this.sessionContext);\n            }\n        });\n    }\n    /**\n     * Rename the document.\n     *\n     * @param newName - the new name for the document.\n     */\n    async _rename(newName) {\n        const splitPath = this.localPath.split('/');\n        splitPath[splitPath.length - 1] = newName;\n        let newPath = PathExt.join(...splitPath);\n        const driveName = this._manager.contents.driveName(this.path);\n        if (driveName) {\n            newPath = `${driveName}:${newPath}`;\n        }\n        // rename triggers a fileChanged which updates the contents model\n        await this._manager.contents.rename(this.path, newPath);\n    }\n    /**\n     * Save the document contents to disk.\n     */\n    async _save() {\n        this._saveState.emit('started');\n        const options = this._createSaveOptions();\n        try {\n            await this._manager.ready;\n            const value = await this._maybeSave(options);\n            if (this.isDisposed) {\n                return;\n            }\n            this._model.dirty = false;\n            this._updateContentsModel(value);\n            if (!this._isPopulated) {\n                await this._populate();\n            }\n            // Emit completion.\n            this._saveState.emit('completed');\n        }\n        catch (err) {\n            // If the save has been canceled by the user, throw the error\n            // so that whoever called save() can decide what to do.\n            const { name } = err;\n            if (name === 'ModalCancelError' || name === 'ModalDuplicateError') {\n                throw err;\n            }\n            // Otherwise show an error message and throw the error.\n            const localPath = this._manager.contents.localPath(this._path);\n            const file = PathExt.basename(localPath);\n            void this._handleError(err, this._trans.__('File Save Error for %1', file));\n            // Emit failure.\n            this._saveState.emit('failed');\n            throw err;\n        }\n    }\n    /**\n     * Revert the document contents to disk contents.\n     *\n     * @param initializeModel - call the model's initialization function after\n     * deserializing the content.\n     */\n    _revert(initializeModel = false) {\n        const opts = {\n            type: this._factory.contentType,\n            content: this._factory.fileFormat !== null,\n            hash: this._factory.fileFormat !== null,\n            ...(this._factory.fileFormat !== null\n                ? { format: this._factory.fileFormat }\n                : {}),\n            contentProviderId: this._contentProviderId\n        };\n        const path = this._path;\n        const model = this._model;\n        return this._manager.ready\n            .then(() => {\n            return this._manager.contents.get(path, opts);\n        })\n            .then(contents => {\n            if (this.isDisposed) {\n                return;\n            }\n            if (contents.content) {\n                if (contents.format === 'json') {\n                    model.fromJSON(contents.content);\n                }\n                else {\n                    let content = contents.content;\n                    // Convert line endings if necessary, marking the file\n                    // as dirty.\n                    if (content.indexOf('\\r\\n') !== -1) {\n                        this._lineEnding = '\\r\\n';\n                        content = content.replace(/\\r\\n/g, '\\n');\n                    }\n                    else if (content.indexOf('\\r') !== -1) {\n                        this._lineEnding = '\\r';\n                        content = content.replace(/\\r/g, '\\n');\n                    }\n                    else {\n                        this._lineEnding = null;\n                    }\n                    model.fromString(content);\n                }\n            }\n            this._updateContentsModel(contents);\n            model.dirty = false;\n            if (!this._isPopulated) {\n                return this._populate();\n            }\n        })\n            .catch(async (err) => {\n            const localPath = this._manager.contents.localPath(this._path);\n            const name = PathExt.basename(localPath);\n            void this._handleError(err, this._trans.__('File Load Error for %1', name));\n            throw err;\n        });\n    }\n    /**\n     * Save a file, dealing with conflicts.\n     */\n    _maybeSave(options) {\n        const path = this._path;\n        // Make sure the file has not changed on disk.\n        const promise = this._manager.contents.get(path, {\n            content: false,\n            hash: true,\n            contentProviderId: this._contentProviderId\n        });\n        return promise.then(model => {\n            var _a, _b, _c, _d;\n            if (this.isDisposed) {\n                return Promise.reject(new Error('Disposed'));\n            }\n            // Since jupyter server may provide hash in model, we compare hash first\n            const hashAvailable = ((_a = this.contentsModel) === null || _a === void 0 ? void 0 : _a.hash) !== undefined &&\n                ((_b = this.contentsModel) === null || _b === void 0 ? void 0 : _b.hash) !== null &&\n                model.hash !== undefined &&\n                model.hash !== null;\n            const hClient = (_c = this.contentsModel) === null || _c === void 0 ? void 0 : _c.hash;\n            const hDisk = model.hash;\n            if (hashAvailable && hClient !== hDisk) {\n                console.warn(`Different hash found for ${this.path}`);\n                return this._raiseConflict(model, options);\n            }\n            // When hash is not provided, we compare last_modified\n            // We want to check last_modified (disk) > last_modified (client)\n            // (our last save)\n            // In some cases the filesystem reports an inconsistent time, so we allow buffer when comparing.\n            const lastModifiedCheckMargin = this._lastModifiedCheckMargin;\n            const modified = (_d = this.contentsModel) === null || _d === void 0 ? void 0 : _d.last_modified;\n            const tClient = modified ? new Date(modified) : new Date();\n            const tDisk = new Date(model.last_modified);\n            if (!hashAvailable &&\n                modified &&\n                tDisk.getTime() - tClient.getTime() > lastModifiedCheckMargin) {\n                console.warn(`Last saving performed ${tClient} ` +\n                    `while the current file seems to have been saved ` +\n                    `${tDisk}`);\n                return this._raiseConflict(model, options);\n            }\n            return this._manager.contents\n                .save(path, {\n                ...options,\n                contentProviderId: this._contentProviderId\n            })\n                .then(async (contentsModel) => {\n                const model = await this._manager.contents.get(path, {\n                    content: false,\n                    hash: true,\n                    contentProviderId: this._contentProviderId\n                });\n                return {\n                    ...contentsModel,\n                    hash: model.hash,\n                    hash_algorithm: model.hash_algorithm\n                };\n            });\n        }, err => {\n            if (err.response && err.response.status === 404) {\n                return this._manager.contents\n                    .save(path, options)\n                    .then(async (contentsModel) => {\n                    const model = await this._manager.contents.get(path, {\n                        content: false,\n                        hash: true,\n                        contentProviderId: this._contentProviderId\n                    });\n                    return {\n                        ...contentsModel,\n                        hash: model.hash,\n                        hash_algorithm: model.hash_algorithm\n                    };\n                });\n            }\n            throw err;\n        });\n    }\n    /**\n     * Handle a save/load error with a dialog.\n     */\n    async _handleError(err, title) {\n        await showErrorMessage(title, err);\n        return;\n    }\n    /**\n     * Add a checkpoint if the file is writable.\n     */\n    _maybeCheckpoint(force) {\n        let promise = Promise.resolve(void 0);\n        if (!this.canSave) {\n            return promise;\n        }\n        if (force) {\n            promise = this.createCheckpoint().then( /* no-op */);\n        }\n        else {\n            promise = this.listCheckpoints().then(checkpoints => {\n                if (!this.isDisposed && !checkpoints.length && this.canSave) {\n                    return this.createCheckpoint().then( /* no-op */);\n                }\n            });\n        }\n        return promise.catch(err => {\n            // Handle a read-only folder.\n            if (!err.response || err.response.status !== 403) {\n                throw err;\n            }\n        });\n    }\n    /**\n     * Handle a time conflict.\n     */\n    _raiseConflict(model, options) {\n        if (this._conflictModalIsOpen) {\n            const error = new Error('Modal is already displayed');\n            error.name = 'ModalDuplicateError';\n            return Promise.reject(error);\n        }\n        const body = this._trans.__(`\"%1\" has changed on disk since the last time it was opened or saved.\nDo you want to overwrite the file on disk with the version open here,\nor load the version on disk (revert)?`, this.path);\n        const revertBtn = Dialog.okButton({\n            label: this._trans.__('Revert'),\n            actions: ['revert']\n        });\n        const overwriteBtn = Dialog.warnButton({\n            label: this._trans.__('Overwrite'),\n            actions: ['overwrite']\n        });\n        this._conflictModalIsOpen = true;\n        return showDialog({\n            title: this._trans.__('File Changed'),\n            body,\n            buttons: [Dialog.cancelButton(), revertBtn, overwriteBtn]\n        }).then(result => {\n            this._conflictModalIsOpen = false;\n            if (this.isDisposed) {\n                return Promise.reject(new Error('Disposed'));\n            }\n            if (result.button.actions.includes('overwrite')) {\n                return this._manager.contents.save(this._path, {\n                    ...options,\n                    contentProviderId: this._contentProviderId\n                });\n            }\n            if (result.button.actions.includes('revert')) {\n                return this.revert().then(() => {\n                    return model;\n                });\n            }\n            const error = new Error('Cancel');\n            error.name = 'ModalCancelError';\n            return Promise.reject(error); // Otherwise cancel the save.\n        });\n    }\n    /**\n     * Handle a time conflict.\n     */\n    _maybeOverWrite(path) {\n        const body = this._trans.__('\"%1\" already exists. Do you want to replace it?', path);\n        const overwriteBtn = Dialog.warnButton({\n            label: this._trans.__('Overwrite'),\n            accept: true\n        });\n        return showDialog({\n            title: this._trans.__('File Overwrite?'),\n            body,\n            buttons: [Dialog.cancelButton(), overwriteBtn]\n        }).then(result => {\n            if (this.isDisposed) {\n                return Promise.reject(new Error('Disposed'));\n            }\n            if (result.button.accept) {\n                return this._manager.contents.delete(path).then(() => {\n                    return this._finishSaveAs(path);\n                });\n            }\n            else {\n                return Promise.reject(new Error('Cancelled'));\n            }\n        });\n    }\n    /**\n     * Finish a saveAs operation given a new path.\n     */\n    async _finishSaveAs(newPath) {\n        this._saveState.emit('started');\n        try {\n            await this._manager.ready;\n            const options = this._createSaveOptions();\n            await this._manager.contents.save(newPath, options);\n            await this._maybeCheckpoint(true);\n            // Emit completion.\n            this._saveState.emit('completed');\n        }\n        catch (err) {\n            // If the save has been canceled by the user,\n            // throw the error so that whoever called save()\n            // can decide what to do.\n            if (err.message === 'Cancel' ||\n                err.message === 'Modal is already displayed') {\n                throw err;\n            }\n            // Otherwise show an error message and throw the error.\n            const localPath = this._manager.contents.localPath(this._path);\n            const name = PathExt.basename(localPath);\n            void this._handleError(err, this._trans.__('File Save Error for %1', name));\n            // Emit failure.\n            this._saveState.emit('failed');\n            return;\n        }\n    }\n    _createSaveOptions() {\n        let content = null;\n        if (this._factory.fileFormat === 'json') {\n            content = this._model.toJSON();\n        }\n        else {\n            content = this._model.toString();\n            if (this._lineEnding) {\n                content = content.replace(/\\n/g, this._lineEnding);\n            }\n        }\n        return {\n            type: this._factory.contentType,\n            format: this._factory.fileFormat,\n            content\n        };\n    }\n}\n/**\n * A namespace for private data.\n */\nvar Private;\n(function (Private) {\n    /**\n     * Get a new file path from the user.\n     */\n    function getSavePath(path, translator) {\n        translator = translator || nullTranslator;\n        const trans = translator.load('jupyterlab');\n        const saveBtn = Dialog.okButton({ label: trans.__('Save'), accept: true });\n        return showDialog({\n            title: trans.__('Save File As'),\n            body: new SaveWidget(path),\n            buttons: [Dialog.cancelButton(), saveBtn]\n        }).then(result => {\n            var _a;\n            if (result.button.accept) {\n                return (_a = result.value) !== null && _a !== void 0 ? _a : undefined;\n            }\n            return;\n        });\n    }\n    Private.getSavePath = getSavePath;\n    /**\n     * A no-op function.\n     */\n    function noOp() {\n        /* no-op */\n    }\n    Private.noOp = noOp;\n    /*\n     * A widget that gets a file path from a user.\n     */\n    class SaveWidget extends Widget {\n        /**\n         * Construct a new save widget.\n         */\n        constructor(path) {\n            super({ node: createSaveNode(path) });\n        }\n        /**\n         * Get the value for the widget.\n         */\n        getValue() {\n            return this.node.value;\n        }\n    }\n    /**\n     * Create the node for a save widget.\n     */\n    function createSaveNode(path) {\n        const input = document.createElement('input');\n        input.value = path;\n        return input;\n    }\n})(Private || (Private = {}));\n//# sourceMappingURL=context.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { WidgetTracker } from '@jupyterlab/apputils';\nimport { Signal } from '@lumino/signaling';\nexport class NotebookTracker extends WidgetTracker {\n    constructor() {\n        super(...arguments);\n        this._activeCell = null;\n        this._activeCellChanged = new Signal(this);\n        this._selectionChanged = new Signal(this);\n    }\n    /**\n     * The currently focused cell.\n     *\n     * #### Notes\n     * This is a read-only property. If there is no cell with the focus, then this\n     * value is `null`.\n     */\n    get activeCell() {\n        const widget = this.currentWidget;\n        if (!widget) {\n            return null;\n        }\n        return widget.content.activeCell || null;\n    }\n    /**\n     * A signal emitted when the current active cell changes.\n     *\n     * #### Notes\n     * If there is no cell with the focus, then `null` will be emitted.\n     */\n    get activeCellChanged() {\n        return this._activeCellChanged;\n    }\n    /**\n     * A signal emitted when the selection state changes.\n     */\n    get selectionChanged() {\n        return this._selectionChanged;\n    }\n    /**\n     * Add a new notebook panel to the tracker.\n     *\n     * @param panel - The notebook panel being added.\n     */\n    add(panel) {\n        const promise = super.add(panel);\n        panel.content.activeCellChanged.connect(this._onActiveCellChanged, this);\n        panel.content.selectionChanged.connect(this._onSelectionChanged, this);\n        return promise;\n    }\n    /**\n     * Dispose of the resources held by the tracker.\n     */\n    dispose() {\n        this._activeCell = null;\n        super.dispose();\n    }\n    /**\n     * Handle the current change event.\n     */\n    onCurrentChanged(widget) {\n        // Store an internal reference to active cell to prevent false positives.\n        const activeCell = this.activeCell;\n        if (activeCell && activeCell === this._activeCell) {\n            return;\n        }\n        this._activeCell = activeCell;\n        if (!widget) {\n            return;\n        }\n        // Since the notebook has changed, immediately signal an active cell change\n        this._activeCellChanged.emit(widget.content.activeCell || null);\n    }\n    _onActiveCellChanged(sender, cell) {\n        // Check if the active cell change happened for the current notebook.\n        if (this.currentWidget && this.currentWidget.content === sender) {\n            this._activeCell = cell || null;\n            this._activeCellChanged.emit(this._activeCell);\n        }\n    }\n    _onSelectionChanged(sender) {\n        // Check if the selection change happened for the current notebook.\n        if (this.currentWidget && this.currentWidget.content === sender) {\n            this._selectionChanged.emit(void 0);\n        }\n    }\n}\n//# sourceMappingURL=tracker.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { ABCWidgetFactory } from '@jupyterlab/docregistry';\nimport { NotebookPanel } from './panel';\nimport { StaticNotebook } from './widget';\nimport { NotebookHistory } from './history';\n/**\n * A widget factory for notebook panels.\n */\nexport class NotebookWidgetFactory extends ABCWidgetFactory {\n    /**\n     * Construct a new notebook widget factory.\n     *\n     * @param options - The options used to construct the factory.\n     */\n    constructor(options) {\n        super(options);\n        this.rendermime = options.rendermime;\n        this.contentFactory = options.contentFactory;\n        this.mimeTypeService = options.mimeTypeService;\n        this._editorConfig =\n            options.editorConfig || StaticNotebook.defaultEditorConfig;\n        this._notebookConfig =\n            options.notebookConfig || StaticNotebook.defaultNotebookConfig;\n    }\n    /**\n     * A configuration object for cell editor settings.\n     */\n    get editorConfig() {\n        return this._editorConfig;\n    }\n    set editorConfig(value) {\n        this._editorConfig = value;\n    }\n    /**\n     * A configuration object for notebook settings.\n     */\n    get notebookConfig() {\n        return this._notebookConfig;\n    }\n    set notebookConfig(value) {\n        this._notebookConfig = value;\n    }\n    /**\n     * Create a new widget.\n     *\n     * #### Notes\n     * The factory will start the appropriate kernel.\n     */\n    createNewWidget(context, source) {\n        const translator = context.translator;\n        const kernelHistory = new NotebookHistory({\n            sessionContext: context.sessionContext,\n            translator: translator\n        });\n        const nbOptions = {\n            rendermime: source\n                ? source.content.rendermime\n                : this.rendermime.clone({ resolver: context.urlResolver }),\n            contentFactory: this.contentFactory,\n            mimeTypeService: this.mimeTypeService,\n            editorConfig: source ? source.content.editorConfig : this._editorConfig,\n            notebookConfig: source\n                ? source.content.notebookConfig\n                : this._notebookConfig,\n            translator,\n            kernelHistory\n        };\n        const content = this.contentFactory.createNotebook(nbOptions);\n        return new NotebookPanel({ context, content });\n    }\n}\n//# sourceMappingURL=widgetfactory.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { shims, } from '@jupyter-widgets/base';\nimport { ManagerBase, serialize_state, } from '@jupyter-widgets/base-manager';\nimport { Signal } from '@lumino/signaling';\nimport { valid } from 'semver';\nimport { requireLoader } from './../libembed-amd';\nimport { SemVerCache } from './../semvercache';\nimport { WIDGET_STATE_MIMETYPE } from './../mimetypes';\nimport * as base from '@jupyter-widgets/base';\nimport * as controls from '@jupyter-widgets/controls';\n// Exposing @jupyter-widgets/base and @jupyter-widgets/controls as AMD modules for custom widget bundles that depend on it.\nif (typeof window !== 'undefined' &&\n    typeof window.define !== 'undefined') {\n    window.define('@jupyter-widgets/base', base);\n    window.define('@jupyter-widgets/controls', controls);\n}\n/**\n * A widget manager that returns Lumino widgets.\n */\nexport class LabWidgetManager extends ManagerBase {\n    constructor(rendermime) {\n        super();\n        this._rendermime = rendermime;\n        const requireJsScript = document.createElement('script');\n        const cdnOnlyScript = document.createElement('script');\n        cdnOnlyScript.setAttribute('data-jupyter-widgets-cdn-only', 'true');\n        document.body.appendChild(cdnOnlyScript);\n        requireJsScript.src =\n            'https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js';\n        document.body.appendChild(requireJsScript);\n        requireJsScript.onload = () => {\n            window.define('@jupyter-widgets/base', base);\n            window.define('@jupyter-widgets/controls', controls);\n            this._registry = new SemVerCache();\n            this.register({\n                name: '@jupyter-widgets/base',\n                version: base.JUPYTER_WIDGETS_VERSION,\n                exports: () => import('@jupyter-widgets/base'),\n            });\n            this.register({\n                name: '@jupyter-widgets/controls',\n                version: controls.JUPYTER_CONTROLS_VERSION,\n                exports: () => import('@jupyter-widgets/controls'),\n            });\n        };\n    }\n    /**\n     * Default callback handler to emit unhandled kernel messages.\n     */\n    callbacks(view) {\n        return {\n            iopub: {\n                output: (msg) => {\n                    this._onUnhandledIOPubMessage.emit(msg);\n                },\n            },\n        };\n    }\n    registerWithKernel(kernelConnection) {\n        if (this._commRegistration) {\n            this._commRegistration.dispose();\n        }\n        if (kernelConnection) {\n            kernelConnection.registerCommTarget(this.comm_target_name, this._handleCommOpen);\n        }\n    }\n    /**\n     * Register a new kernel\n     */\n    _handleKernelChanged({ oldValue, newValue, }) {\n        if (oldValue) {\n            oldValue.removeCommTarget(this.comm_target_name, this._handleCommOpen);\n        }\n        if (newValue) {\n            newValue.registerCommTarget(this.comm_target_name, this._handleCommOpen);\n        }\n    }\n    /**\n     * Disconnect the widget manager from the kernel, setting each model's comm\n     * as dead.\n     */\n    disconnect() {\n        super.disconnect();\n        this._restoredStatus = false;\n    }\n    async _loadFromKernel() {\n        if (!this.kernel) {\n            throw new Error('Kernel not set');\n        }\n        if (this.kernel?.handleComms === false) {\n            // A \"load\" for a kernel that does not handle comms does nothing.\n            return;\n        }\n        return super._loadFromKernel();\n    }\n    /**\n     * Filter serialized widget state to remove any ID's already present in manager.\n     * @param serialized_state - Serialized state to filter\n     * @returns A copy of the state, with its 'state' attribute filtered\n     */\n    filterExistingModelState(serialized_state) {\n        return super.filterExistingModelState(serialized_state);\n    }\n    /**\n     * Create a comm.\n     */\n    async _create_comm(target_name, model_id, data, metadata, buffers) {\n        const kernel = this.kernel;\n        if (!kernel) {\n            throw new Error('No current kernel');\n        }\n        const comm = kernel.createComm(target_name, model_id);\n        if (data || metadata) {\n            comm.open(data, metadata, buffers);\n        }\n        return new shims.services.Comm(comm);\n    }\n    /**\n     * Get the currently-registered comms.\n     */\n    async _get_comm_info() {\n        const kernel = this.kernel;\n        if (!kernel) {\n            throw new Error('No current kernel');\n        }\n        const reply = await kernel.requestCommInfo({\n            target_name: this.comm_target_name,\n        });\n        if (reply.content.status === 'ok') {\n            return reply.content.comms;\n        }\n        else {\n            return {};\n        }\n    }\n    /**\n     * Get whether the manager is disposed.\n     *\n     * #### Notes\n     * This is a read-only property.\n     */\n    get isDisposed() {\n        return this._isDisposed;\n    }\n    /**\n     * Dispose the resources held by the manager.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._isDisposed = true;\n        if (this._commRegistration) {\n            this._commRegistration.dispose();\n        }\n    }\n    /**\n     * Resolve a URL relative to the current notebook location.\n     */\n    async resolveUrl(url) {\n        return url;\n    }\n    /**\n     * Load a class and return a promise to the loaded object.\n     */\n    async loadClass(className, moduleName, moduleVersion) {\n        // Special-case the Jupyter base and controls packages. If we have just a\n        // plain version, with no indication of the compatible range, prepend a ^ to\n        // get all compatible versions. We may eventually apply this logic to all\n        // widget modules. See issues #2006 and #2017 for more discussion.\n        if ((moduleName === '@jupyter-widgets/base' ||\n            moduleName === '@jupyter-widgets/controls') &&\n            valid(moduleVersion)) {\n            moduleVersion = `^${moduleVersion}`;\n        }\n        /*\n        const allVersions = this._registry.getAllVersions(moduleName);\n        if (!allVersions) {\n          throw new Error(`No version of module ${moduleName} is registered`);\n        }\n        */\n        let allVersions = this._getRegistry().getAllVersions(moduleName);\n        const semanticVersion = moduleVersion.split('.').length === 2\n            ? moduleVersion + '.0'\n            : moduleVersion;\n        if (!allVersions) {\n            const module = await requireLoader(moduleName, semanticVersion);\n            const widgetRegistryData = {\n                name: moduleName,\n                version: semanticVersion.replaceAll('^', ''),\n                exports: { ...module },\n            };\n            this.register(widgetRegistryData);\n            allVersions = this._getRegistry().getAllVersions(moduleName);\n            if (!allVersions) {\n                throw new Error(`No version of module ${moduleName} is registered`);\n            }\n        }\n        const mod = this._registry.get(moduleName, moduleVersion);\n        if (!mod) {\n            const registeredVersionList = Object.keys(allVersions);\n            throw new Error(`Module ${moduleName}, version ${moduleVersion} is not registered, however, \\\n        ${registeredVersionList.join(',')} ${registeredVersionList.length > 1 ? 'are' : 'is'}`);\n        }\n        let module;\n        if (typeof mod === 'function') {\n            module = await mod();\n        }\n        else {\n            module = await mod;\n        }\n        const cls = module[className];\n        if (!cls) {\n            throw new Error(`Class ${className} not found in module ${moduleName}`);\n        }\n        return cls;\n    }\n    _getRegistry() {\n        return this._registry;\n    }\n    get rendermime() {\n        return this._rendermime;\n    }\n    /**\n     * A signal emitted when state is restored to the widget manager.\n     *\n     * #### Notes\n     * This indicates that previously-unavailable widget models might be available now.\n     */\n    get restored() {\n        return this._restored;\n    }\n    /**\n     * Whether the state has been restored yet or not.\n     */\n    get restoredStatus() {\n        return this._restoredStatus;\n    }\n    /**\n     * A signal emitted for unhandled iopub kernel messages.\n     *\n     */\n    get onUnhandledIOPubMessage() {\n        return this._onUnhandledIOPubMessage;\n    }\n    register(data) {\n        this._registry.set(data.name, data.version, data.exports);\n    }\n    /**\n     * Register a widget model.\n     */\n    register_model(model_id, modelPromise) {\n        super.register_model(model_id, modelPromise);\n        // Update the synchronous model map\n        modelPromise.then(model => {\n            this._modelsSync.set(model_id, model);\n            model.once('comm:close', () => {\n                this._modelsSync.delete(model_id);\n            });\n        });\n    }\n    /**\n     * Close all widgets and empty the widget state.\n     * @return Promise that resolves when the widget state is cleared.\n     */\n    async clear_state() {\n        await super.clear_state();\n        this._modelsSync = new Map();\n    }\n    /**\n     * Synchronously get the state of the live widgets in the widget manager.\n     *\n     * This includes all of the live widget models, and follows the format given in\n     * the @jupyter-widgets/schema package.\n     *\n     * @param options - The options for what state to return.\n     * @returns A state dictionary\n     */\n    get_state_sync(options = {}) {\n        const models = [];\n        for (const model of this._modelsSync.values()) {\n            if (model.comm_live) {\n                models.push(model);\n            }\n        }\n        return serialize_state(models, options);\n    }\n    // _handleCommOpen is an attribute, not a method, so `this` is captured in a\n    // single object that can be registered and removed\n    _handleCommOpen = async (comm, msg) => {\n        const oldComm = new shims.services.Comm(comm);\n        await this.handle_comm_open(oldComm, msg);\n    };\n    _restored = new Signal(this);\n    _restoredStatus = false;\n    _kernelRestoreInProgress = false;\n    _isDisposed = false;\n    _registry = new SemVerCache();\n    _rendermime;\n    _commRegistration;\n    _modelsSync = new Map();\n    _onUnhandledIOPubMessage = new Signal(this);\n}\n/**\n * A widget manager that returns Lumino widgets.\n */\nexport class KernelWidgetManager extends LabWidgetManager {\n    constructor(kernel, rendermime) {\n        super(rendermime);\n        this._kernel = kernel;\n        kernel.statusChanged.connect((sender, args) => {\n            this._handleKernelStatusChange(args);\n        });\n        kernel.connectionStatusChanged.connect((sender, args) => {\n            this._handleKernelConnectionStatusChange(args);\n        });\n        this._handleKernelChanged({\n            name: 'kernel',\n            oldValue: null,\n            newValue: kernel,\n        });\n        this.restoreWidgets();\n    }\n    _handleKernelConnectionStatusChange(status) {\n        if (status === 'connected') {\n            // Only restore if we aren't currently trying to restore from the kernel\n            // (for example, in our initial restore from the constructor).\n            if (!this._kernelRestoreInProgress) {\n                this.restoreWidgets();\n            }\n        }\n    }\n    _handleKernelStatusChange(status) {\n        if (status === 'restarting') {\n            this.disconnect();\n        }\n    }\n    /**\n     * Restore widgets from kernel and saved state.\n     */\n    async restoreWidgets() {\n        try {\n            this._kernelRestoreInProgress = true;\n            await this._loadFromKernel();\n            this._restoredStatus = true;\n            this._restored.emit();\n        }\n        catch (err) {\n            // Do nothing\n        }\n        this._kernelRestoreInProgress = false;\n    }\n    /**\n     * Dispose the resources held by the manager.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._kernel = null;\n        super.dispose();\n    }\n    get kernel() {\n        return this._kernel;\n    }\n    _kernel;\n}\n/**\n * A widget manager that returns phosphor widgets.\n */\nexport class WidgetManager extends LabWidgetManager {\n    constructor(context, rendermime, settings) {\n        super(rendermime);\n        this._context = context;\n        this._context.sessionContext.kernelChanged.connect((sender, args) => {\n            this._handleKernelChanged(args);\n        });\n        this._context.sessionContext.statusChanged.connect((sender, args) => {\n            this._handleKernelStatusChange(args);\n        });\n        this._context.sessionContext.connectionStatusChanged.connect((sender, args) => {\n            this._handleKernelConnectionStatusChange(args);\n        });\n        if (this._context.sessionContext.session?.kernel) {\n            this._handleKernelChanged({\n                name: 'kernel',\n                oldValue: null,\n                newValue: this._context.sessionContext.session?.kernel,\n            });\n        }\n        this.restoreWidgets(this._context.model);\n        this._settings = settings;\n        context.saveState.connect((sender, saveState) => {\n            if (saveState === 'started' && settings.saveState) {\n                this._saveState();\n            }\n        });\n    }\n    /**\n     * Save the widget state to the context model.\n     */\n    _saveState() {\n        const state = this.get_state_sync({ drop_defaults: true });\n        this._context.model.setMetadata('widgets', {\n            'application/vnd.jupyter.widget-state+json': state,\n        });\n    }\n    _handleKernelConnectionStatusChange(status) {\n        if (status === 'connected') {\n            // Only restore if we aren't currently trying to restore from the kernel\n            // (for example, in our initial restore from the constructor).\n            if (!this._kernelRestoreInProgress) {\n                // We only want to restore widgets from the kernel, not ones saved in the notebook.\n                this.restoreWidgets(this._context.model, {\n                    loadKernel: true,\n                    loadNotebook: false,\n                });\n            }\n        }\n    }\n    _handleKernelStatusChange(status) {\n        if (status === 'restarting') {\n            this.disconnect();\n        }\n    }\n    /**\n     * Restore widgets from kernel and saved state.\n     */\n    async restoreWidgets(notebook, { loadKernel, loadNotebook } = { loadKernel: true, loadNotebook: true }) {\n        await this.context.sessionContext.ready;\n        try {\n            if (loadKernel) {\n                try {\n                    this._kernelRestoreInProgress = true;\n                    await this._loadFromKernel();\n                }\n                finally {\n                    this._kernelRestoreInProgress = false;\n                }\n            }\n            if (loadNotebook) {\n                await this._loadFromNotebook(notebook);\n            }\n            // If the restore worked above, then update our state.\n            this._restoredStatus = true;\n            this._restored.emit();\n        }\n        catch (err) {\n            // Do nothing if the restore did not work.\n        }\n    }\n    /**\n     * Load widget state from notebook metadata\n     */\n    async _loadFromNotebook(notebook) {\n        const widgets = notebook.getMetadata('widgets');\n        // Restore any widgets from saved state that are not live\n        if (widgets && widgets[WIDGET_STATE_MIMETYPE]) {\n            let state = widgets[WIDGET_STATE_MIMETYPE];\n            state = this.filterExistingModelState(state);\n            await this.set_state(state);\n        }\n    }\n    /**\n     * Dispose the resources held by the manager.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._context = null;\n        super.dispose();\n    }\n    /**\n     * Resolve a URL relative to the current notebook location.\n     */\n    async resolveUrl(url) {\n        const partial = await this.context.urlResolver.resolveUrl(url);\n        return this.context.urlResolver.getDownloadUrl(partial);\n    }\n    get context() {\n        return this._context;\n    }\n    get kernel() {\n        return this._context.sessionContext?.session?.kernel ?? null;\n    }\n    /**\n     * Register a widget model.\n     */\n    register_model(model_id, modelPromise) {\n        super.register_model(model_id, modelPromise);\n        this.setDirty();\n    }\n    /**\n     * Close all widgets and empty the widget state.\n     * @return Promise that resolves when the widget state is cleared.\n     */\n    async clear_state() {\n        await super.clear_state();\n        this.setDirty();\n    }\n    /**\n     * Set the dirty state of the notebook model if applicable.\n     *\n     * TODO: perhaps should also set dirty when any model changes any data\n     */\n    setDirty() {\n        if (this._settings.saveState) {\n            this._context.model.dirty = true;\n        }\n    }\n    _context;\n    _settings;\n}\n//# sourceMappingURL=manager.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { Panel } from '@lumino/widgets';\n/**\n * A renderer for widgets.\n */\nexport class WidgetLabRenderer extends Panel {\n    constructor(options, manager) {\n        super();\n        this.mimeType = options.mimeType;\n        if (manager) {\n            this.manager = manager;\n        }\n    }\n    /**\n     * The widget manager.\n     */\n    set manager(value) {\n        value.restored.connect(this._rerender, this);\n        this._manager.resolve(value);\n    }\n    async renderModel(model) {\n        const source = model.data[this.mimeType];\n        // Let's be optimistic, and hope the widget state will come later.\n        this.node.textContent = 'Loading widget...';\n        const manager = await this._manager.promise;\n        // If there is no model id, the view was removed, so hide the node.\n        if (source.model_id === '') {\n            this.hide();\n            return Promise.resolve();\n        }\n        let wModel;\n        try {\n            // Presume we have a DOMWidgetModel. Should we check for sure?\n            wModel = (await manager.get_model(source.model_id));\n        }\n        catch (err) {\n            if (manager.restoredStatus) {\n                // The manager has been restored, so this error won't be going away.\n                //        this.node.textContent = 'Error displaying widget: model not found';\n                this.node.textContent =\n                    'Please run the cell to display the IPyWidgets.';\n                this.addClass('jupyter-widgets');\n                console.error(err);\n                return;\n            }\n            // Store the model for a possible rerender\n            this._rerenderMimeModel = model;\n            return;\n        }\n        // Successful getting the model, so we don't need to try to rerender.\n        this._rerenderMimeModel = null;\n        let widget;\n        try {\n            widget = (await manager.create_view(wModel)).luminoWidget;\n        }\n        catch (err) {\n            this.node.textContent = 'Error displaying widget';\n            this.addClass('jupyter-widgets');\n            console.error(err);\n            return;\n        }\n        // Clear any previous loading message.\n        this.node.textContent = '';\n        this.addWidget(widget);\n        // When the widget is disposed, hide this container and make sure we\n        // change the output model to reflect the view was closed.\n        widget.disposed.connect(() => {\n            this.hide();\n            source.model_id = '';\n        });\n    }\n    /**\n     * Dispose the resources held by the manager.\n     */\n    dispose() {\n        if (this.isDisposed) {\n            return;\n        }\n        this._manager = null;\n        super.dispose();\n    }\n    _rerender() {\n        if (this._rerenderMimeModel) {\n            // Clear the error message\n            this.node.textContent = '';\n            this.removeClass('jupyter-widgets');\n            // Attempt to rerender.\n            this.renderModel(this._rerenderMimeModel);\n        }\n    }\n    /**\n     * The mimetype being rendered.\n     */\n    mimeType;\n    _manager = new PromiseDelegate();\n    _rerenderMimeModel = null;\n}\n//# sourceMappingURL=renderer.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { Decoration, EditorView, WidgetType } from '@codemirror/view';\nimport { StateEffect, StateField } from '@codemirror/state';\nconst TRANSIENT_LINE_SPACER_CLASS = 'jp-GhostText-lineSpacer';\nconst TRANSIENT_LETTER_SPACER_CLASS = 'jp-GhostText-letterSpacer';\nconst GHOST_TEXT_CLASS = 'jp-GhostText';\nconst STREAMED_TOKEN_CLASS = 'jp-GhostText-streamedToken';\nconst STREAMING_INDICATOR_CLASS = 'jp-GhostText-streamingIndicator';\nconst ERROR_INDICATOR_CLASS = 'jp-GhostText-errorIndicator';\nconst HIDDEN_LINES_CLASS = 'jp-GhostText-hiddenLines';\nexport class GhostTextManager {\n    constructor(options) {\n        this.options = options;\n        // no-op\n    }\n    /**\n     * Place ghost text in an editor.\n     */\n    placeGhost(view, text) {\n        const effects = [Private.addMark.of(text)];\n        if (!view.state.field(Private.markField, false)) {\n            effects.push(StateEffect.appendConfig.of([Private.markField]));\n            effects.push(StateEffect.appendConfig.of([\n                EditorView.domEventHandlers({\n                    blur: (event) => {\n                        if (this.options.onBlur(event) === false) {\n                            return true;\n                        }\n                        const effects = [\n                            Private.removeMark.of(null)\n                        ];\n                        // Only execute it after editor update has completed.\n                        setTimeout(() => {\n                            view.dispatch({ effects });\n                        }, 0);\n                    }\n                })\n            ]));\n        }\n        view.dispatch({ effects });\n    }\n    /**\n     * Clear all ghost texts from the editor.\n     */\n    clearGhosts(view) {\n        const effects = [Private.removeMark.of(null)];\n        view.dispatch({ effects });\n    }\n}\n/**\n * Typing animation.\n */\nGhostTextManager.streamingAnimation = 'uncover';\n/**\n * Delay for removal of line spacer.\n */\nGhostTextManager.spacerRemovalDelay = 700;\n/**\n * Duration for line spacer removal.\n */\nGhostTextManager.spacerRemovalDuration = 300;\nclass GhostTextWidget extends WidgetType {\n    constructor(options) {\n        super();\n        this.options = options;\n        this.isSpacer = false;\n        this._clearErrorTimeout = null;\n    }\n    eq(other) {\n        return (other.content == this.content &&\n            other.options.streaming === this.options.streaming &&\n            other.options.error === this.options.error);\n    }\n    get lineBreaks() {\n        return (this.content.match(/\\n/g) || '').length;\n    }\n    updateDOM(dom, _view) {\n        this._updateDOM(dom);\n        return true;\n    }\n    get content() {\n        return this.options.content;\n    }\n    toDOM() {\n        let wrap = document.createElement('span');\n        if (this.options.onPointerOver) {\n            wrap.addEventListener('pointerover', this.options.onPointerOver);\n        }\n        if (this.options.onPointerLeave) {\n            wrap.addEventListener('pointerleave', this.options.onPointerLeave);\n        }\n        wrap.classList.add(GHOST_TEXT_CLASS);\n        wrap.dataset.animation = GhostTextManager.streamingAnimation;\n        wrap.dataset.providedBy = this.options.providerId;\n        this._updateDOM(wrap);\n        return wrap;\n    }\n    _removeErrorAnimation(dom) {\n        const elementsToRemove = dom.querySelectorAll(`.${ERROR_INDICATOR_CLASS}`);\n        elementsToRemove.forEach(element => {\n            element.remove();\n        });\n    }\n    /**\n     * Mount the error animation DOM and remove the streaming indicator if any.\n     */\n    _mountErrorAnimation(dom) {\n        const errorIndicator = document.createElement('span');\n        errorIndicator.className = ERROR_INDICATOR_CLASS;\n        const error = this.options.error;\n        if (error === null || error === void 0 ? void 0 : error.message) {\n            errorIndicator.title = error === null || error === void 0 ? void 0 : error.message;\n        }\n        // Delete stream and previous error animation\n        const elementsToRemove = dom.querySelectorAll(`.${STREAMING_INDICATOR_CLASS}, .${ERROR_INDICATOR_CLASS}`);\n        elementsToRemove.forEach(element => {\n            element.remove();\n        });\n        dom.appendChild(errorIndicator);\n    }\n    _updateDOM(dom) {\n        var _a, _b;\n        if (this.options.error) {\n            this._mountErrorAnimation(dom);\n            this._clearErrorTimeout = setTimeout(() => {\n                this._removeErrorAnimation(dom);\n                this._clearErrorTimeout = null;\n            }, 5000);\n            return;\n        }\n        // If not in an error anymore, clear the error indicator\n        if (this._clearErrorTimeout !== null) {\n            clearTimeout(this._clearErrorTimeout);\n            this._removeErrorAnimation(dom);\n            this._clearErrorTimeout = null;\n        }\n        let content = this.content;\n        let hiddenContent = '';\n        let addition = this.options.addedPart;\n        if (addition) {\n            if (addition.startsWith('\\n')) {\n                // Show the new line straight away to ensure proper positioning.\n                addition = addition.substring(1);\n            }\n            content = content.substring(0, content.length - addition.length);\n        }\n        if (this.options.maxLines) {\n            // Split into content to show immediately and the hidden part\n            const lines = content.split('\\n');\n            content = lines.slice(0, this.options.maxLines).join('\\n');\n            hiddenContent = lines.slice(this.options.maxLines).join('\\n');\n        }\n        const minLines = Math.min((_a = this.options.minLines) !== null && _a !== void 0 ? _a : 0, (_b = this.options.maxLines) !== null && _b !== void 0 ? _b : Infinity);\n        const linesToAdd = Math.max(0, minLines - content.split('\\n').length + 1);\n        const placeHolderLines = new Array(linesToAdd).fill('').join('\\n');\n        if (this.isSpacer) {\n            dom.innerText = content + placeHolderLines;\n            return;\n        }\n        dom.innerText = content;\n        let streamedTokenHost = dom;\n        if (hiddenContent.length > 0) {\n            const hiddenWrapper = document.createElement('span');\n            hiddenWrapper.className = 'jp-GhostText-hiddenWrapper';\n            dom.appendChild(hiddenWrapper);\n            const expandOnHover = document.createElement('span');\n            expandOnHover.className = 'jp-GhostText-expandHidden';\n            expandOnHover.innerText = '';\n            const hiddenPart = document.createElement('span');\n            hiddenWrapper.appendChild(expandOnHover);\n            hiddenPart.className = HIDDEN_LINES_CLASS;\n            hiddenPart.innerText = '\\n' + hiddenContent;\n            hiddenWrapper.appendChild(hiddenPart);\n            streamedTokenHost = hiddenPart;\n        }\n        if (addition) {\n            const addedPart = document.createElement('span');\n            addedPart.className = STREAMED_TOKEN_CLASS;\n            addedPart.innerText = addition;\n            streamedTokenHost.appendChild(addedPart);\n        }\n        // Add \"streaming-in-progress\" indicator\n        if (this.options.streaming) {\n            const streamingIndicator = document.createElement('span');\n            streamingIndicator.className = STREAMING_INDICATOR_CLASS;\n            streamedTokenHost.appendChild(streamingIndicator);\n        }\n        if (placeHolderLines.length > 0) {\n            const placeholderLinesNode = document.createTextNode(placeHolderLines);\n            streamedTokenHost.appendChild(placeholderLinesNode);\n        }\n    }\n    destroy(dom) {\n        if (this.options.onPointerOver) {\n            dom.removeEventListener('pointerover', this.options.onPointerOver);\n        }\n        if (this.options.onPointerLeave) {\n            dom.removeEventListener('pointerleave', this.options.onPointerLeave);\n        }\n        super.destroy(dom);\n    }\n}\n/**\n * Spacers are used to reduce height jitter in the transition between multi-line inline suggestions.\n * In particular, when user removes a letter they will often get a new suggestion in split-second,\n * but without spacer they would see the editor collapse in height and then elongate again.\n */\nclass TransientSpacerWidget extends GhostTextWidget {\n    constructor() {\n        super(...arguments);\n        this.isSpacer = true;\n    }\n}\nclass TransientLineSpacerWidget extends TransientSpacerWidget {\n    toDOM() {\n        const wrap = super.toDOM();\n        wrap.classList.add(TRANSIENT_LINE_SPACER_CLASS);\n        wrap.style.animationDelay = GhostTextManager.spacerRemovalDelay + 'ms';\n        wrap.style.animationDuration =\n            GhostTextManager.spacerRemovalDuration + 'ms';\n        return wrap;\n    }\n}\nclass TransientLetterSpacerWidget extends TransientSpacerWidget {\n    get content() {\n        return this.options.content[0];\n    }\n    toDOM() {\n        const wrap = super.toDOM();\n        wrap.classList.add(TRANSIENT_LETTER_SPACER_CLASS);\n        return wrap;\n    }\n}\nvar Private;\n(function (Private) {\n    let GhostAction;\n    (function (GhostAction) {\n        GhostAction[GhostAction[\"Set\"] = 0] = \"Set\";\n        GhostAction[GhostAction[\"Remove\"] = 1] = \"Remove\";\n        GhostAction[GhostAction[\"FilterAndUpdate\"] = 2] = \"FilterAndUpdate\";\n    })(GhostAction || (GhostAction = {}));\n    Private.addMark = StateEffect.define({\n        map: (old, change) => ({\n            ...old,\n            from: change.mapPos(old.from),\n            to: change.mapPos(old.from + old.content.length)\n        })\n    });\n    Private.removeMark = StateEffect.define();\n    /**\n     * Decide what should be done for transaction effects.\n     */\n    function chooseAction(tr) {\n        // This function can short-circuit because at any time there is no more than one ghost text.\n        for (let e of tr.effects) {\n            if (e.is(Private.addMark)) {\n                return {\n                    action: GhostAction.Set,\n                    spec: e.value\n                };\n            }\n            else if (e.is(Private.removeMark)) {\n                return {\n                    action: GhostAction.Remove\n                };\n            }\n        }\n        if (tr.docChanged || tr.selection) {\n            return {\n                action: GhostAction.FilterAndUpdate\n            };\n        }\n        return null;\n    }\n    function createWidget(spec, tr) {\n        const ghost = Decoration.widget({\n            widget: new GhostTextWidget(spec),\n            side: 1,\n            ghostSpec: spec\n        });\n        // Widget decorations can only have zero-length ranges\n        return ghost.range(Math.min(spec.from, tr.newDoc.length), Math.min(spec.from, tr.newDoc.length));\n    }\n    function createSpacer(spec, tr, timeout = 1000) {\n        // no spacer needed if content is only one character long.\n        if (spec.content.length < 2) {\n            return [];\n        }\n        const timeoutInfo = {\n            elapsed: false\n        };\n        setTimeout(() => {\n            timeoutInfo.elapsed = true;\n        }, timeout);\n        const characterSpacer = Decoration.widget({\n            widget: new TransientLetterSpacerWidget(spec),\n            side: 1,\n            timeoutInfo\n        });\n        const lineSpacer = Decoration.widget({\n            widget: new TransientLineSpacerWidget(spec),\n            side: 1,\n            timeoutInfo\n        });\n        // We add two different spacers: one to temporarily preserve height of as many lines\n        // as there were in the content, and the other (character spacer) to ensure that\n        // cursor is not malformed by the presence of the line spacer.\n        return [\n            characterSpacer.range(Math.min(spec.from, tr.newDoc.length), Math.min(spec.from, tr.newDoc.length)),\n            lineSpacer.range(Math.min(spec.from, tr.newDoc.length), Math.min(spec.from, tr.newDoc.length))\n        ];\n    }\n    Private.markField = StateField.define({\n        create() {\n            return Decoration.none;\n        },\n        update(marks, tr) {\n            const data = chooseAction(tr);\n            // remove spacers after timeout\n            marks = marks.update({\n                filter: (_from, _to, value) => {\n                    if (value.spec.widget instanceof TransientSpacerWidget) {\n                        return !value.spec.timeoutInfo.elapsed;\n                    }\n                    return true;\n                }\n            });\n            if (!data) {\n                return marks.map(tr.changes);\n            }\n            switch (data.action) {\n                case GhostAction.Set: {\n                    const spec = data.spec;\n                    const newWidget = createWidget(spec, tr);\n                    return marks.update({\n                        add: [newWidget],\n                        filter: (_from, _to, value) => value === newWidget.value\n                    });\n                }\n                case GhostAction.Remove:\n                    return marks.update({\n                        filter: () => false\n                    });\n                case GhostAction.FilterAndUpdate: {\n                    let cursor = marks.iter();\n                    // skip over spacer if any\n                    while (cursor.value &&\n                        cursor.value.spec.widget instanceof TransientSpacerWidget) {\n                        cursor.next();\n                    }\n                    if (!cursor.value) {\n                        // short-circuit if no widgets are present, or if only spacer was present\n                        return marks.map(tr.changes);\n                    }\n                    const originalSpec = cursor.value.spec.ghostSpec;\n                    const spec = { ...originalSpec };\n                    let shouldRemoveGhost = false;\n                    tr.changes.iterChanges((fromA, toA, fromB, toB, inserted) => {\n                        if (shouldRemoveGhost) {\n                            return;\n                        }\n                        if (fromA === toA && fromB !== toB) {\n                            // text was inserted without modifying old text\n                            for (let lineNumber = 0; lineNumber < inserted.lines; lineNumber++) {\n                                const lineContent = inserted.lineAt(lineNumber).text;\n                                const line = lineNumber > 0 ? '\\n' + lineContent : lineContent;\n                                if (spec.content.startsWith(line)) {\n                                    spec.content = spec.content.slice(line.length);\n                                    spec.from += line.length;\n                                }\n                                else {\n                                    shouldRemoveGhost = true;\n                                    break;\n                                }\n                            }\n                        }\n                        else if (fromB === toB && fromA !== toA) {\n                            // text was removed\n                            shouldRemoveGhost = true;\n                        }\n                        else {\n                            // text was replaced\n                            shouldRemoveGhost = true;\n                            // TODO: could check if the previous spec matches\n                        }\n                    });\n                    // removing multi-line widget would cause the code cell to jump; instead\n                    // we add a temporary spacer widget(s) which will be removed in a future update\n                    // allowing a slight delay between getting a new suggestion and reducing cell height\n                    const newWidgets = shouldRemoveGhost\n                        ? createSpacer(originalSpec, tr)\n                        : [createWidget(spec, tr)];\n                    const newValues = newWidgets.map(widget => widget.value);\n                    marks = marks.update({\n                        add: newWidgets,\n                        filter: (_from, _to, value) => newValues.includes(value)\n                    });\n                    if (shouldRemoveGhost) {\n                        // TODO this can error out when deleting text, ideally a clean solution would be used.\n                        try {\n                            marks = marks.map(tr.changes);\n                        }\n                        catch (e) {\n                            console.warn(e);\n                            return Decoration.none;\n                        }\n                    }\n                    return marks;\n                }\n            }\n        },\n        provide: f => EditorView.decorations.from(f)\n    });\n})(Private || (Private = {}));\n//# sourceMappingURL=ghost.js.map","// Copyright (c) Jupyter Development Team.\n// Distributed under the terms of the Modified BSD License.\nimport { HoverBox, kernelIcon, Toolbar } from '@jupyterlab/ui-components';\nimport { Signal } from '@lumino/signaling';\nimport { PanelLayout, Widget } from '@lumino/widgets';\nimport { GhostTextManager } from './ghost';\nconst INLINE_COMPLETER_CLASS = 'jp-InlineCompleter';\nconst INLINE_COMPLETER_ACTIVE_CLASS = 'jp-mod-inline-completer-active';\nconst HOVER_CLASS = 'jp-InlineCompleter-hover';\nconst PROGRESS_BAR_CLASS = 'jp-InlineCompleter-progressBar';\n/**\n * Widget enabling user to choose among inline completions,\n * typically by pressing next/previous buttons, and showing\n * additional metadata about active completion, such as\n * inline completion provider name.\n */\nexport class InlineCompleter extends Widget {\n    constructor(options) {\n        var _a, _b;\n        super({ node: document.createElement('div') });\n        this._clearHoverTimeout = null;\n        this._current = 0;\n        this._editor = null;\n        this._lastItem = null;\n        this._model = null;\n        this._providerWidget = new Widget();\n        this._showShortcuts = InlineCompleter.defaultSettings.showShortcuts;\n        this._showWidget = InlineCompleter.defaultSettings.showWidget;\n        this._suggestionsCounter = new Widget();\n        this._toolbar = new Toolbar();\n        this.model = (_a = options.model) !== null && _a !== void 0 ? _a : null;\n        this.editor = (_b = options.editor) !== null && _b !== void 0 ? _b : null;\n        this.addClass(INLINE_COMPLETER_CLASS);\n        this.addClass('jp-ThemedContainer');\n        this._ghostManager = new GhostTextManager({\n            onBlur: this._onEditorBlur.bind(this)\n        });\n        this._trans = options.trans;\n        const layout = (this.layout = new PanelLayout());\n        layout.addWidget(this._suggestionsCounter);\n        layout.addWidget(this.toolbar);\n        layout.addWidget(this._providerWidget);\n        this._progressBar = document.createElement('div');\n        this._progressBar.className = PROGRESS_BAR_CLASS;\n        this.node.appendChild(this._progressBar);\n        this._updateShortcutsVisibility();\n        this._updateDisplay();\n        // Allow the node to receive focus, which prevents removing the ghost text\n        // when user mis-clicks on the tooltip instead of the button in the tooltip.\n        this.node.tabIndex = 0;\n    }\n    /**\n     * Toolbar with buttons such as previous/next/accept.\n     */\n    get toolbar() {\n        return this._toolbar;\n    }\n    /**\n     * The editor used by the completion widget.\n     */\n    get editor() {\n        return this._editor;\n    }\n    set editor(newValue) {\n        var _a;\n        (_a = this.model) === null || _a === void 0 ? void 0 : _a.reset();\n        this._editor = newValue;\n    }\n    /**\n     * The model used by the completer widget.\n     */\n    get model() {\n        return this._model;\n    }\n    set model(model) {\n        if ((!model && !this._model) || model === this._model) {\n            return;\n        }\n        if (this._model) {\n            this._model.suggestionsChanged.disconnect(this._onModelSuggestionsChanged, this);\n            this._model.filterTextChanged.disconnect(this._onModelFilterTextChanged, this);\n            this._model.provisionProgress.disconnect(this._onProvisionProgress, this);\n        }\n        this._model = model;\n        if (this._model) {\n            this._model.suggestionsChanged.connect(this._onModelSuggestionsChanged, this);\n            this._model.filterTextChanged.connect(this._onModelFilterTextChanged, this);\n            this._model.provisionProgress.connect(this._onProvisionProgress, this);\n        }\n    }\n    cycle(direction) {\n        var _a, _b;\n        const items = (_b = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions) === null || _b === void 0 ? void 0 : _b.items;\n        if (!items) {\n            return;\n        }\n        if (direction === 'next') {\n            const proposed = this._current + 1;\n            this._current = proposed === items.length ? 0 : proposed;\n        }\n        else {\n            const proposed = this._current - 1;\n            this._current = proposed === -1 ? items.length - 1 : proposed;\n        }\n        this._updateStreamTracking();\n        this._render();\n    }\n    accept() {\n        const model = this.model;\n        const candidate = this.current;\n        const editor = this._editor;\n        if (!editor || !model || !candidate) {\n            return;\n        }\n        const position = model.cursor;\n        const value = candidate.insertText;\n        const cursorBeforeChange = editor.getOffsetAt(editor.getCursorPosition());\n        const requestPosition = editor.getOffsetAt(position);\n        const start = requestPosition;\n        const end = cursorBeforeChange;\n        const transactions = {\n            changes: { from: start, to: end, insert: value }\n        };\n        if (cursorBeforeChange <= end && cursorBeforeChange >= start) {\n            transactions.selection = { anchor: start + value.length };\n        }\n        editor.editor.dispatch(transactions);\n        model.reset();\n        this.update();\n    }\n    get current() {\n        var _a;\n        const completions = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions;\n        if (!completions) {\n            return null;\n        }\n        return completions.items[this._current];\n    }\n    _updateStreamTracking() {\n        if (this._lastItem) {\n            this._lastItem.stream.disconnect(this._onStream, this);\n        }\n        const current = this.current;\n        if (current) {\n            current.stream.connect(this._onStream, this);\n        }\n        this._lastItem = current;\n    }\n    _onStream(_emitter, _change) {\n        var _a;\n        // TODO handle stuck streams, i.e. if we connected and received 'opened'\n        // but then did not receive 'closed' for a long time we should disconnect\n        // and update widget with an 'timed out' status.\n        const completions = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions;\n        if (!completions || !completions.items || completions.items.length === 0) {\n            return;\n        }\n        if (this.isHidden) {\n            return;\n        }\n        const candidate = completions.items[this._current];\n        this._setText(candidate);\n    }\n    /**\n     * Change user-configurable settings.\n     */\n    configure(settings) {\n        this._showWidget = settings.showWidget;\n        this._updateDisplay();\n        if (settings.showShortcuts !== this._showShortcuts) {\n            this._showShortcuts = settings.showShortcuts;\n            this._updateShortcutsVisibility();\n        }\n        GhostTextManager.streamingAnimation = settings.streamingAnimation;\n        GhostTextManager.spacerRemovalDelay = Math.max(0, settings.editorResizeDelay - 300);\n        GhostTextManager.spacerRemovalDuration = Math.max(0, Math.min(300, settings.editorResizeDelay - 300));\n        this._minLines = settings.minLines;\n        this._maxLines = settings.maxLines;\n        this._reserveSpaceForLongest = settings.reserveSpaceForLongest;\n        this._suppressIfTabCompleterActive = settings.suppressIfTabCompleterActive;\n    }\n    /**\n     * Whether to suppress the inline completer when tab completer is active.\n     */\n    get suppressIfTabCompleterActive() {\n        return this._suppressIfTabCompleterActive;\n    }\n    /**\n     * Whether the inline completer is active.\n     */\n    get isActive() {\n        var _a;\n        return !!((_a = this.editor) === null || _a === void 0 ? void 0 : _a.host.classList.contains(INLINE_COMPLETER_ACTIVE_CLASS));\n    }\n    /**\n     * Handle the DOM events for the widget.\n     *\n     * @param event - The DOM event sent to the widget.\n     *\n     * #### Notes\n     * This method implements the DOM `EventListener` interface and is\n     * called in response to events on the dock panel's node. It should\n     * not be called directly by user code.\n     */\n    handleEvent(event) {\n        if (this.isHidden || !this._editor) {\n            return;\n        }\n        switch (event.type) {\n            case 'pointerdown':\n                this._evtPointerdown(event);\n                break;\n            case 'scroll':\n                this._evtScroll(event);\n                break;\n            default:\n                break;\n        }\n    }\n    /**\n     * Handle `update-request` messages.\n     */\n    onUpdateRequest(msg) {\n        super.onUpdateRequest(msg);\n        const model = this._model;\n        if (!model) {\n            return;\n        }\n        let reply = model.completions;\n        // If there are no items, hide.\n        if (!reply || !reply.items || reply.items.length === 0) {\n            if (!this.isHidden) {\n                this.hide();\n            }\n            return;\n        }\n        if (this.isHidden) {\n            this.show();\n            this._setGeometry();\n        }\n    }\n    /**\n     * Handle `after-attach` messages for the widget.\n     */\n    onAfterAttach(msg) {\n        document.addEventListener('scroll', this, true);\n        document.addEventListener('pointerdown', this, true);\n    }\n    /**\n     * Handle `before-detach` messages for the widget.\n     */\n    onBeforeDetach(msg) {\n        document.removeEventListener('scroll', this, true);\n        document.removeEventListener('pointerdown', this, true);\n    }\n    /**\n     * Handle pointerdown events for the widget.\n     */\n    _evtPointerdown(event) {\n        var _a;\n        if (this.isHidden || !this._editor) {\n            return;\n        }\n        const target = event.target;\n        if (this.node.contains(target)) {\n            return true;\n        }\n        this.hide();\n        (_a = this.model) === null || _a === void 0 ? void 0 : _a.reset();\n    }\n    /**\n     * Handle scroll events for the widget\n     */\n    _evtScroll(event) {\n        if (this.isHidden || !this._editor) {\n            return;\n        }\n        const { node } = this;\n        // All scrolls except scrolls in the actual hover box node may cause the\n        // referent editor that anchors the node to move, so the only scroll events\n        // that can safely be ignored are ones that happen inside the hovering node.\n        if (node.contains(event.target)) {\n            return;\n        }\n        // Set the geometry of the node asynchronously.\n        requestAnimationFrame(() => {\n            this._setGeometry();\n        });\n    }\n    _onEditorBlur(event) {\n        var _a;\n        if (this.node.contains(event.relatedTarget)) {\n            // Cancel removing ghost text if our node is receiving focus\n            return false;\n        }\n        // The ghost text will be removed, so nothing to accept\n        (_a = this._editor) === null || _a === void 0 ? void 0 : _a.host.classList.remove(INLINE_COMPLETER_ACTIVE_CLASS);\n        // Hide the widget if editor was blurred.\n        this.hide();\n    }\n    _onModelSuggestionsChanged(_emitter, args) {\n        var _a;\n        if (!this.isAttached) {\n            this.update();\n            return;\n        }\n        if (args.event === 'set') {\n            this._current = (_a = args.indexMap.get(this._current)) !== null && _a !== void 0 ? _a : 0;\n        }\n        else if (args.event === 'clear') {\n            const editor = this.editor;\n            if (editor) {\n                this._ghostManager.clearGhosts(editor.editor);\n                editor.host.classList.remove(INLINE_COMPLETER_ACTIVE_CLASS);\n            }\n        }\n        this._updateStreamTracking();\n        this.update();\n        this._render();\n    }\n    _onModelFilterTextChanged(_emitter, mapping) {\n        var _a, _b;\n        const completions = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions;\n        if (!completions || !completions.items || completions.items.length === 0) {\n            return;\n        }\n        this._current = (_b = mapping.get(this._current)) !== null && _b !== void 0 ? _b : 0;\n        this._updateStreamTracking();\n        // Because the signal will be emitted during `EditorView.update` we want to\n        // wait for the update to complete before calling `this._render()`. As there\n        // is no API to check if update is done, we instead defer to next engine tick.\n        setTimeout(() => {\n            this._render();\n            // (reading layout to get coordinate to position hoverbox is not allowed either)\n            this._setGeometry();\n        }, 0);\n    }\n    _onProvisionProgress(_emitter, progress) {\n        requestAnimationFrame(() => {\n            if (progress.pendingProviders === 0) {\n                this._progressBar.style.display = 'none';\n            }\n            else {\n                this._progressBar.style.display = '';\n                this._progressBar.style.width =\n                    (100 * progress.pendingProviders) / progress.totalProviders + '%';\n            }\n        });\n    }\n    _render() {\n        var _a, _b;\n        const completions = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions;\n        if (!completions || !completions.items || completions.items.length === 0) {\n            return;\n        }\n        const candidate = completions.items[this._current];\n        this._setText(candidate);\n        if (this._showWidget === 'never') {\n            return;\n        }\n        this._suggestionsCounter.node.innerText = this._trans.__('%1/%2', this._current + 1, completions.items.length);\n        this._providerWidget.node.title = this._trans.__('Provider: %1', candidate.provider.name);\n        const icon = (_b = candidate.provider.icon) !== null && _b !== void 0 ? _b : kernelIcon;\n        icon.render(this._providerWidget.node);\n    }\n    _setText(item) {\n        var _a, _b, _c;\n        const text = item.insertText;\n        const editor = this._editor;\n        const model = this._model;\n        if (!model || !editor) {\n            return;\n        }\n        const view = editor.editor;\n        let minLines;\n        if (this._reserveSpaceForLongest) {\n            const items = (_c = (_b = (_a = this.model) === null || _a === void 0 ? void 0 : _a.completions) === null || _b === void 0 ? void 0 : _b.items) !== null && _c !== void 0 ? _c : [];\n            const longest = Math.max(...items.map(i => i.insertText.split('\\n').length));\n            minLines = Math.max(this._minLines, longest);\n        }\n        else {\n            minLines = this._minLines;\n        }\n        this._ghostManager.placeGhost(view, {\n            from: editor.getOffsetAt(model.cursor),\n            content: text,\n            providerId: item.provider.identifier,\n            addedPart: item.lastStreamed,\n            streaming: item.streaming,\n            minLines: minLines,\n            maxLines: this._maxLines,\n            onPointerOver: this._onPointerOverGhost.bind(this),\n            onPointerLeave: this._onPointerLeaveGhost.bind(this),\n            error: item.error\n        });\n        editor.host.classList.add(INLINE_COMPLETER_ACTIVE_CLASS);\n    }\n    _onPointerOverGhost() {\n        if (this._clearHoverTimeout !== null) {\n            window.clearTimeout(this._clearHoverTimeout);\n            this._clearHoverTimeout = null;\n        }\n        this.node.classList.add(HOVER_CLASS);\n    }\n    _onPointerLeaveGhost() {\n        // Remove after a small delay to avoid flicker when moving cursor\n        // between the lines or around the edges of the ghost text.\n        this._clearHoverTimeout = window.setTimeout(() => this.node.classList.remove(HOVER_CLASS), 500);\n    }\n    _setGeometry() {\n        const { node } = this;\n        const model = this._model;\n        const editor = this._editor;\n        if (!editor || !model || !model.cursor) {\n            return;\n        }\n        const host = editor.host.closest('.jp-MainAreaWidget > .lm-Widget') ||\n            editor.host;\n        let anchor;\n        try {\n            const maybeAnchor = editor.getCoordinateForPosition(model.cursor);\n            if (!maybeAnchor) {\n                throw Error('No coordinates for cursor position');\n            }\n            anchor = maybeAnchor;\n        }\n        catch (_a) {\n            // if coordinate is no longer in editor (e.g. after deleting a line), hide widget\n            this.hide();\n            return;\n        }\n        HoverBox.setGeometry({\n            anchor,\n            host: host,\n            maxHeight: 40,\n            minHeight: 20,\n            node: node,\n            privilege: 'forceAbove',\n            outOfViewDisplay: {\n                top: 'stick-outside',\n                bottom: 'stick-inside',\n                left: 'stick-inside',\n                right: 'stick-outside'\n            }\n        });\n    }\n    _updateShortcutsVisibility() {\n        this.node.dataset.showShortcuts = this._showShortcuts + '';\n    }\n    _updateDisplay() {\n        this.node.dataset.display = this._showWidget;\n    }\n}\n/**\n * A namespace for inline completer statics.\n */\n(function (InlineCompleter) {\n    /**\n     * Defaults for runtime user-configurable settings.\n     */\n    InlineCompleter.defaultSettings = {\n        showWidget: 'onHover',\n        showShortcuts: true,\n        streamingAnimation: 'uncover',\n        providers: {},\n        minLines: 2,\n        maxLines: 4,\n        editorResizeDelay: 1000,\n        reserveSpaceForLongest: false,\n        suppressIfTabCompleterActive: true\n    };\n    /**\n     * Model for inline completions.\n     */\n    class Model {\n        constructor() {\n            this.suggestionsChanged = new Signal(this);\n            this.filterTextChanged = new Signal(this);\n            this.provisionProgress = new Signal(this);\n            this._isDisposed = false;\n            this._completions = null;\n        }\n        setCompletions(reply) {\n            var _a, _b;\n            const previousPositions = new Map((_b = (_a = this._completions) === null || _a === void 0 ? void 0 : _a.items) === null || _b === void 0 ? void 0 : _b.map((item, index) => [item.insertText, index]));\n            this._completions = reply;\n            const indexMap = new Map(reply.items.map((item, newIndex) => [\n                previousPositions.get(item.insertText),\n                newIndex\n            ]));\n            this.suggestionsChanged.emit({\n                event: 'set',\n                indexMap\n            });\n        }\n        appendCompletions(reply) {\n            if (!this._completions || !this._completions.items) {\n                console.warn('No completions to append to');\n                return;\n            }\n            this._completions.items.push(...reply.items);\n            this.suggestionsChanged.emit({ event: 'append' });\n        }\n        notifyProgress(progress) {\n            this.provisionProgress.emit(progress);\n        }\n        get cursor() {\n            return this._cursor;\n        }\n        set cursor(value) {\n            this._cursor = value;\n        }\n        get completions() {\n            return this._completions;\n        }\n        reset() {\n            this._completions = null;\n            this.suggestionsChanged.emit({ event: 'clear' });\n        }\n        /**\n         * Get whether the model is disposed.\n         */\n        get isDisposed() {\n            return this._isDisposed;\n        }\n        handleTextChange(sourceChange) {\n            var _a;\n            const completions = this._completions;\n            if (!completions ||\n                !completions.items ||\n                completions.items.length === 0) {\n                return;\n            }\n            const originalPositions = new Map(completions.items.map((item, index) => [item, index]));\n            for (let change of (_a = sourceChange.sourceChange) !== null && _a !== void 0 ? _a : []) {\n                const insert = change.insert;\n                if (insert) {\n                    const items = completions.items.filter(item => {\n                        var _a;\n                        const filterText = (_a = item.filterText) !== null && _a !== void 0 ? _a : item.insertText;\n                        if (!filterText.startsWith(insert)) {\n                            return false;\n                        }\n                        item.filterText = filterText.substring(insert.length);\n                        item.insertText = item.insertText.substring(insert.length);\n                        return true;\n                    });\n                    if (items.length === 0) {\n                        // all items from this provider were filtered out\n                        this._completions = null;\n                    }\n                    completions.items = items;\n                }\n                else {\n                    if (!change.retain) {\n                        this._completions = null;\n                    }\n                }\n            }\n            const indexMap = new Map(completions.items.map((item, newIndex) => [\n                originalPositions.get(item),\n                newIndex\n            ]));\n            this.filterTextChanged.emit(indexMap);\n        }\n        handleSelectionChange(range) {\n            const initialCursor = this.cursor;\n            if (!initialCursor) {\n                return;\n            }\n            const { start, end } = range;\n            if (start.column !== end.column || start.line !== end.line) {\n                // Cancel if user started selecting text.\n                this.reset();\n            }\n            if (start.line !== initialCursor.line ||\n                start.column < initialCursor.column) {\n                // Cancel if user moved cursor to next line or receded to before the origin\n                this.reset();\n            }\n        }\n        /**\n         * Dispose of the resources held by the model.\n         */\n        dispose() {\n            // Do nothing if already disposed.\n            if (this._isDisposed) {\n                return;\n            }\n            this._isDisposed = true;\n            Signal.clearData(this);\n        }\n    }\n    InlineCompleter.Model = Model;\n})(InlineCompleter || (InlineCompleter = {}));\n//# sourceMappingURL=inline.js.map","import { jsx as _jsx, Fragment as _Fragment, jsxs as _jsxs } from \"react/jsx-runtime\";\n/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n/*\n * Copyright (c) 2021-2024 Datalayer, Inc.\n *\n * MIT License\n */\nimport { Box, Heading, Spinner } from '@primer/react';\nexport function Loader(props) {\n    const { message } = props;\n    return (_jsx(Box, { sx: {\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            minHeight: '40px',\n            zIndex: 10999,\n        }, children: message ? (_jsxs(_Fragment, { children: [_jsx(Box, { mr: 3, children: _jsx(Spinner, { size: \"large\" }) }), _jsx(Box, { children: _jsx(Heading, { sx: { fontSize: 5, color: 'white' }, children: message }) })] })) : (_jsx(Spinner, { size: \"large\" })) }));\n}\n//# sourceMappingURL=Loader.js.map","/* -----------------------------------------------------------------------------\n| Copyright (c) Jupyter Development Team.\n| Distributed under the terms of the Modified BSD License.\n|----------------------------------------------------------------------------*/\n/**\n * @packageDocumentation\n * @module markedparser-extension\n */\nimport { PromiseDelegate } from '@lumino/coreutils';\nimport { LruCache } from '@jupyterlab/coreutils';\nimport { IEditorLanguageRegistry } from '@jupyterlab/codemirror';\nimport { IMarkdownParser } from '@jupyterlab/rendermime';\nimport { IMermaidMarkdown } from '@jupyterlab/mermaid';\n// highlight cache key separator\nconst FENCE = '```~~~';\n/**\n * Create a markdown parser\n *\n * @param languages Editor languages\n * @returns Markdown parser\n */\nexport function createMarkdownParser(languages, options) {\n    return {\n        render: (content) => {\n            return Private.render(content, languages, options);\n        }\n    };\n}\n/**\n * The markdown parser plugin.\n */\nconst plugin = {\n    id: '@jupyterlab/markedparser-extension:plugin',\n    description: 'Provides the Markdown parser.',\n    autoStart: true,\n    provides: IMarkdownParser,\n    requires: [IEditorLanguageRegistry],\n    optional: [IMermaidMarkdown],\n    activate: (app, languages, mermaidMarkdown) => {\n        return createMarkdownParser(languages, {\n            blocks: mermaidMarkdown ? [mermaidMarkdown] : []\n        });\n    }\n};\n/**\n * Export the plugin as default.\n */\nexport default plugin;\n/**\n * A namespace for private marked functions\n */\nvar Private;\n(function (Private) {\n    let _initializing = null;\n    let _marked = null;\n    let _blocks = [];\n    let _languages = null;\n    let _markedOptions = {};\n    let _highlights = new LruCache();\n    async function render(content, languages, options) {\n        _languages = languages;\n        if (!_marked) {\n            _marked = await initializeMarked(options);\n        }\n        return _marked(content, _markedOptions);\n    }\n    Private.render = render;\n    /**\n     * Load marked lazily and exactly once.\n     */\n    async function initializeMarked(options) {\n        if (_marked) {\n            return _marked;\n        }\n        if (_initializing) {\n            return await _initializing.promise;\n        }\n        // order blocks by `rank`\n        _blocks = (options === null || options === void 0 ? void 0 : options.blocks) || [];\n        _blocks = _blocks.sort((a, b) => { var _a, _b; return ((_a = a.rank) !== null && _a !== void 0 ? _a : Infinity) - ((_b = b.rank) !== null && _b !== void 0 ? _b : Infinity); });\n        _initializing = new PromiseDelegate();\n        // load marked lazily, and exactly once\n        const [{ marked, Renderer }, plugins] = await Promise.all([\n            import('marked'),\n            loadMarkedPlugins()\n        ]);\n        // use load marked plugins\n        for (const plugin of plugins) {\n            marked.use(plugin);\n        }\n        // finish marked configuration\n        _markedOptions = {\n            // use the explicit async paradigm for `walkTokens`\n            async: true,\n            // enable all built-in GitHub-flavored Markdown opinions\n            gfm: true,\n            // asynchronously prepare for any special tokens, like highlighting and mermaid\n            walkTokens,\n            // use custom renderer\n            renderer: makeRenderer(Renderer)\n        };\n        // complete initialization\n        _marked = marked;\n        _initializing.resolve(_marked);\n        return _marked;\n    }\n    Private.initializeMarked = initializeMarked;\n    /**\n     * Load and use marked plugins.\n     *\n     * As of writing, both of these features would work without plugins, but emit\n     * deprecation warnings.\n     */\n    async function loadMarkedPlugins() {\n        // use loaded marked plugins\n        return Promise.all([\n            (async () => (await import('marked-gfm-heading-id')).gfmHeadingId())(),\n            (async () => (await import('marked-mangle')).mangle())()\n        ]);\n    }\n    /**\n     * Build a custom marked renderer.\n     */\n    function makeRenderer(Renderer_) {\n        const renderer = new Renderer_();\n        const originalCode = renderer.code;\n        renderer.code = ({ text, lang, escaped }) => {\n            // handle block renderers\n            for (const block of _blocks) {\n                if (lang && block.languages.includes(lang)) {\n                    const rendered = block.render(text);\n                    if (rendered != null) {\n                        return rendered;\n                    }\n                }\n            }\n            // handle known highlighting\n            const key = `${lang}${FENCE}${text}${FENCE}`;\n            const highlight = _highlights.get(key);\n            if (highlight != null) {\n                return highlight;\n            }\n            // fall back to calling with the renderer as `this`\n            return originalCode.call(renderer, { text, lang, escaped });\n        };\n        return renderer;\n    }\n    /**\n     * Apply and cache syntax highlighting for code blocks.\n     */\n    async function highlight(token) {\n        const { lang, text } = token;\n        if (!lang || !_languages) {\n            // no language(s), no highlight\n            return;\n        }\n        const key = `${lang}${FENCE}${text}${FENCE}`;\n        if (_highlights.get(key)) {\n            // already cached, don't make another DOM element\n            return;\n        }\n        const el = document.createElement('div');\n        try {\n            await _languages.highlight(text, _languages.findBest(lang), el);\n            const html = `<pre><code class=\"language-${lang}\">${el.innerHTML}</code></pre>`;\n            _highlights.set(key, html);\n        }\n        catch (err) {\n            console.error(`Failed to highlight ${lang} code`, err);\n        }\n        finally {\n            el.remove();\n        }\n    }\n    /**\n     * After parsing, lazily load and render or highlight code blocks\n     */\n    async function walkTokens(token) {\n        switch (token.type) {\n            case 'code':\n                if (token.lang) {\n                    for (const block of _blocks) {\n                        if (block.languages.includes(token.lang)) {\n                            await block.walk(token.text);\n                            return;\n                        }\n                    }\n                }\n                await highlight(token);\n        }\n    }\n})(Private || (Private = {}));\n//# sourceMappingURL=index.js.map","export default class Diff {\n    diff(oldStr, newStr, \n    // Type below is not accurate/complete - see above for full possibilities - but it compiles\n    options = {}) {\n        let callback;\n        if (typeof options === 'function') {\n            callback = options;\n            options = {};\n        }\n        else if ('callback' in options) {\n            callback = options.callback;\n        }\n        // Allow subclasses to massage the input prior to running\n        const oldString = this.castInput(oldStr, options);\n        const newString = this.castInput(newStr, options);\n        const oldTokens = this.removeEmpty(this.tokenize(oldString, options));\n        const newTokens = this.removeEmpty(this.tokenize(newString, options));\n        return this.diffWithOptionsObj(oldTokens, newTokens, options, callback);\n    }\n    diffWithOptionsObj(oldTokens, newTokens, options, callback) {\n        var _a;\n        const done = (value) => {\n            value = this.postProcess(value, options);\n            if (callback) {\n                setTimeout(function () { callback(value); }, 0);\n                return undefined;\n            }\n            else {\n                return value;\n            }\n        };\n        const newLen = newTokens.length, oldLen = oldTokens.length;\n        let editLength = 1;\n        let maxEditLength = newLen + oldLen;\n        if (options.maxEditLength != null) {\n            maxEditLength = Math.min(maxEditLength, options.maxEditLength);\n        }\n        const maxExecutionTime = (_a = options.timeout) !== null && _a !== void 0 ? _a : Infinity;\n        const abortAfterTimestamp = Date.now() + maxExecutionTime;\n        const bestPath = [{ oldPos: -1, lastComponent: undefined }];\n        // Seed editLength = 0, i.e. the content starts with the same values\n        let newPos = this.extractCommon(bestPath[0], newTokens, oldTokens, 0, options);\n        if (bestPath[0].oldPos + 1 >= oldLen && newPos + 1 >= newLen) {\n            // Identity per the equality and tokenizer\n            return done(this.buildValues(bestPath[0].lastComponent, newTokens, oldTokens));\n        }\n        // Once we hit the right edge of the edit graph on some diagonal k, we can\n        // definitely reach the end of the edit graph in no more than k edits, so\n        // there's no point in considering any moves to diagonal k+1 any more (from\n        // which we're guaranteed to need at least k+1 more edits).\n        // Similarly, once we've reached the bottom of the edit graph, there's no\n        // point considering moves to lower diagonals.\n        // We record this fact by setting minDiagonalToConsider and\n        // maxDiagonalToConsider to some finite value once we've hit the edge of\n        // the edit graph.\n        // This optimization is not faithful to the original algorithm presented in\n        // Myers's paper, which instead pointlessly extends D-paths off the end of\n        // the edit graph - see page 7 of Myers's paper which notes this point\n        // explicitly and illustrates it with a diagram. This has major performance\n        // implications for some common scenarios. For instance, to compute a diff\n        // where the new text simply appends d characters on the end of the\n        // original text of length n, the true Myers algorithm will take O(n+d^2)\n        // time while this optimization needs only O(n+d) time.\n        let minDiagonalToConsider = -Infinity, maxDiagonalToConsider = Infinity;\n        // Main worker method. checks all permutations of a given edit length for acceptance.\n        const execEditLength = () => {\n            for (let diagonalPath = Math.max(minDiagonalToConsider, -editLength); diagonalPath <= Math.min(maxDiagonalToConsider, editLength); diagonalPath += 2) {\n                let basePath;\n                const removePath = bestPath[diagonalPath - 1], addPath = bestPath[diagonalPath + 1];\n                if (removePath) {\n                    // No one else is going to attempt to use this value, clear it\n                    // @ts-expect-error - perf optimisation. This type-violating value will never be read.\n                    bestPath[diagonalPath - 1] = undefined;\n                }\n                let canAdd = false;\n                if (addPath) {\n                    // what newPos will be after we do an insertion:\n                    const addPathNewPos = addPath.oldPos - diagonalPath;\n                    canAdd = addPath && 0 <= addPathNewPos && addPathNewPos < newLen;\n                }\n                const canRemove = removePath && removePath.oldPos + 1 < oldLen;\n                if (!canAdd && !canRemove) {\n                    // If this path is a terminal then prune\n                    // @ts-expect-error - perf optimisation. This type-violating value will never be read.\n                    bestPath[diagonalPath] = undefined;\n                    continue;\n                }\n                // Select the diagonal that we want to branch from. We select the prior\n                // path whose position in the old string is the farthest from the origin\n                // and does not pass the bounds of the diff graph\n                if (!canRemove || (canAdd && removePath.oldPos < addPath.oldPos)) {\n                    basePath = this.addToPath(addPath, true, false, 0, options);\n                }\n                else {\n                    basePath = this.addToPath(removePath, false, true, 1, options);\n                }\n                newPos = this.extractCommon(basePath, newTokens, oldTokens, diagonalPath, options);\n                if (basePath.oldPos + 1 >= oldLen && newPos + 1 >= newLen) {\n                    // If we have hit the end of both strings, then we are done\n                    return done(this.buildValues(basePath.lastComponent, newTokens, oldTokens)) || true;\n                }\n                else {\n                    bestPath[diagonalPath] = basePath;\n                    if (basePath.oldPos + 1 >= oldLen) {\n                        maxDiagonalToConsider = Math.min(maxDiagonalToConsider, diagonalPath - 1);\n                    }\n                    if (newPos + 1 >= newLen) {\n                        minDiagonalToConsider = Math.max(minDiagonalToConsider, diagonalPath + 1);\n                    }\n                }\n            }\n            editLength++;\n        };\n        // Performs the length of edit iteration. Is a bit fugly as this has to support the\n        // sync and async mode which is never fun. Loops over execEditLength until a value\n        // is produced, or until the edit length exceeds options.maxEditLength (if given),\n        // in which case it will return undefined.\n        if (callback) {\n            (function exec() {\n                setTimeout(function () {\n                    if (editLength > maxEditLength || Date.now() > abortAfterTimestamp) {\n                        return callback(undefined);\n                    }\n                    if (!execEditLength()) {\n                        exec();\n                    }\n                }, 0);\n            }());\n        }\n        else {\n            while (editLength <= maxEditLength && Date.now() <= abortAfterTimestamp) {\n                const ret = execEditLength();\n                if (ret) {\n                    return ret;\n                }\n            }\n        }\n    }\n    addToPath(path, added, removed, oldPosInc, options) {\n        const last = path.lastComponent;\n        if (last && !options.oneChangePerToken && last.added === added && last.removed === removed) {\n            return {\n                oldPos: path.oldPos + oldPosInc,\n                lastComponent: { count: last.count + 1, added: added, removed: removed, previousComponent: last.previousComponent }\n            };\n        }\n        else {\n            return {\n                oldPos: path.oldPos + oldPosInc,\n                lastComponent: { count: 1, added: added, removed: removed, previousComponent: last }\n            };\n        }\n    }\n    extractCommon(basePath, newTokens, oldTokens, diagonalPath, options) {\n        const newLen = newTokens.length, oldLen = oldTokens.length;\n        let oldPos = basePath.oldPos, newPos = oldPos - diagonalPath, commonCount = 0;\n        while (newPos + 1 < newLen && oldPos + 1 < oldLen && this.equals(oldTokens[oldPos + 1], newTokens[newPos + 1], options)) {\n            newPos++;\n            oldPos++;\n            commonCount++;\n            if (options.oneChangePerToken) {\n                basePath.lastComponent = { count: 1, previousComponent: basePath.lastComponent, added: false, removed: false };\n            }\n        }\n        if (commonCount && !options.oneChangePerToken) {\n            basePath.lastComponent = { count: commonCount, previousComponent: basePath.lastComponent, added: false, removed: false };\n        }\n        basePath.oldPos = oldPos;\n        return newPos;\n    }\n    equals(left, right, options) {\n        if (options.comparator) {\n            return options.comparator(left, right);\n        }\n        else {\n            return left === right\n                || (!!options.ignoreCase && left.toLowerCase() === right.toLowerCase());\n        }\n    }\n    removeEmpty(array) {\n        const ret = [];\n        for (let i = 0; i < array.length; i++) {\n            if (array[i]) {\n                ret.push(array[i]);\n            }\n        }\n        return ret;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    castInput(value, options) {\n        return value;\n    }\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    tokenize(value, options) {\n        return Array.from(value);\n    }\n    join(chars) {\n        // Assumes ValueT is string, which is the case for most subclasses.\n        // When it's false, e.g. in diffArrays, this method needs to be overridden (e.g. with a no-op)\n        // Yes, the casts are verbose and ugly, because this pattern - of having the base class SORT OF\n        // assume tokens and values are strings, but not completely - is weird and janky.\n        return chars.join('');\n    }\n    postProcess(changeObjects, \n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    options) {\n        return changeObjects;\n    }\n    get useLongestToken() {\n        return false;\n    }\n    buildValues(lastComponent, newTokens, oldTokens) {\n        // First we convert our linked list of components in reverse order to an\n        // array in the right order:\n        const components = [];\n        let nextComponent;\n        while (lastComponent) {\n            components.push(lastComponent);\n            nextComponent = lastComponent.previousComponent;\n            delete lastComponent.previousComponent;\n            lastComponent = nextComponent;\n        }\n        components.reverse();\n        const componentLen = components.length;\n        let componentPos = 0, newPos = 0, oldPos = 0;\n        for (; componentPos < componentLen; componentPos++) {\n            const component = components[componentPos];\n            if (!component.removed) {\n                if (!component.added && this.useLongestToken) {\n                    let value = newTokens.slice(newPos, newPos + component.count);\n                    value = value.map(function (value, i) {\n                        const oldValue = oldTokens[oldPos + i];\n                        return oldValue.length > value.length ? oldValue : value;\n                    });\n                    component.value = this.join(value);\n                }\n                else {\n                    component.value = this.join(newTokens.slice(newPos, newPos + component.count));\n                }\n                newPos += component.count;\n                // Common case\n                if (!component.added) {\n                    oldPos += component.count;\n                }\n            }\n            else {\n                component.value = this.join(oldTokens.slice(oldPos, oldPos + component.count));\n                oldPos += component.count;\n            }\n        }\n        return components;\n    }\n}\n","import Diff from './base.js';\nimport { generateOptions } from '../util/params.js';\nclass LineDiff extends Diff {\n    constructor() {\n        super(...arguments);\n        this.tokenize = tokenize;\n    }\n    equals(left, right, options) {\n        // If we're ignoring whitespace, we need to normalise lines by stripping\n        // whitespace before checking equality. (This has an annoying interaction\n        // with newlineIsToken that requires special handling: if newlines get their\n        // own token, then we DON'T want to trim the *newline* tokens down to empty\n        // strings, since this would cause us to treat whitespace-only line content\n        // as equal to a separator between lines, which would be weird and\n        // inconsistent with the documented behavior of the options.)\n        if (options.ignoreWhitespace) {\n            if (!options.newlineIsToken || !left.includes('\\n')) {\n                left = left.trim();\n            }\n            if (!options.newlineIsToken || !right.includes('\\n')) {\n                right = right.trim();\n            }\n        }\n        else if (options.ignoreNewlineAtEof && !options.newlineIsToken) {\n            if (left.endsWith('\\n')) {\n                left = left.slice(0, -1);\n            }\n            if (right.endsWith('\\n')) {\n                right = right.slice(0, -1);\n            }\n        }\n        return super.equals(left, right, options);\n    }\n}\nexport const lineDiff = new LineDiff();\nexport function diffLines(oldStr, newStr, options) {\n    return lineDiff.diff(oldStr, newStr, options);\n}\nexport function diffTrimmedLines(oldStr, newStr, options) {\n    options = generateOptions(options, { ignoreWhitespace: true });\n    return lineDiff.diff(oldStr, newStr, options);\n}\n// Exported standalone so it can be used from jsonDiff too.\nexport function tokenize(value, options) {\n    if (options.stripTrailingCr) {\n        // remove one \\r before \\n to match GNU diff's --strip-trailing-cr behavior\n        value = value.replace(/\\r\\n/g, '\\n');\n    }\n    const retLines = [], linesAndNewlines = value.split(/(\\n|\\r\\n)/);\n    // Ignore the final empty token that occurs if the string ends with a new line\n    if (!linesAndNewlines[linesAndNewlines.length - 1]) {\n        linesAndNewlines.pop();\n    }\n    // Merge the content and line separators into single tokens\n    for (let i = 0; i < linesAndNewlines.length; i++) {\n        const line = linesAndNewlines[i];\n        if (i % 2 && !options.newlineIsToken) {\n            retLines[retLines.length - 1] += line;\n        }\n        else {\n            retLines.push(line);\n        }\n    }\n    return retLines;\n}\n","import { diffLines } from '../diff/line.js';\nexport function structuredPatch(oldFileName, newFileName, oldStr, newStr, oldHeader, newHeader, options) {\n    let optionsObj;\n    if (!options) {\n        optionsObj = {};\n    }\n    else if (typeof options === 'function') {\n        optionsObj = { callback: options };\n    }\n    else {\n        optionsObj = options;\n    }\n    if (typeof optionsObj.context === 'undefined') {\n        optionsObj.context = 4;\n    }\n    // We copy this into its own variable to placate TypeScript, which thinks\n    // optionsObj.context might be undefined in the callbacks below.\n    const context = optionsObj.context;\n    // @ts-expect-error (runtime check for something that is correctly a static type error)\n    if (optionsObj.newlineIsToken) {\n        throw new Error('newlineIsToken may not be used with patch-generation functions, only with diffing functions');\n    }\n    if (!optionsObj.callback) {\n        return diffLinesResultToPatch(diffLines(oldStr, newStr, optionsObj));\n    }\n    else {\n        const { callback } = optionsObj;\n        diffLines(oldStr, newStr, Object.assign(Object.assign({}, optionsObj), { callback: (diff) => {\n                const patch = diffLinesResultToPatch(diff);\n                // TypeScript is unhappy without the cast because it does not understand that `patch` may\n                // be undefined here only if `callback` is StructuredPatchCallbackAbortable:\n                callback(patch);\n            } }));\n    }\n    function diffLinesResultToPatch(diff) {\n        // STEP 1: Build up the patch with no \"\\ No newline at end of file\" lines and with the arrays\n        //         of lines containing trailing newline characters. We'll tidy up later...\n        if (!diff) {\n            return;\n        }\n        diff.push({ value: '', lines: [] }); // Append an empty value to make cleanup easier\n        function contextLines(lines) {\n            return lines.map(function (entry) { return ' ' + entry; });\n        }\n        const hunks = [];\n        let oldRangeStart = 0, newRangeStart = 0, curRange = [], oldLine = 1, newLine = 1;\n        for (let i = 0; i < diff.length; i++) {\n            const current = diff[i], lines = current.lines || splitLines(current.value);\n            current.lines = lines;\n            if (current.added || current.removed) {\n                // If we have previous context, start with that\n                if (!oldRangeStart) {\n                    const prev = diff[i - 1];\n                    oldRangeStart = oldLine;\n                    newRangeStart = newLine;\n                    if (prev) {\n                        curRange = context > 0 ? contextLines(prev.lines.slice(-context)) : [];\n                        oldRangeStart -= curRange.length;\n                        newRangeStart -= curRange.length;\n                    }\n                }\n                // Output our changes\n                for (const line of lines) {\n                    curRange.push((current.added ? '+' : '-') + line);\n                }\n                // Track the updated file position\n                if (current.added) {\n                    newLine += lines.length;\n                }\n                else {\n                    oldLine += lines.length;\n                }\n            }\n            else {\n                // Identical context lines. Track line changes\n                if (oldRangeStart) {\n                    // Close out any changes that have been output (or join overlapping)\n                    if (lines.length <= context * 2 && i < diff.length - 2) {\n                        // Overlapping\n                        for (const line of contextLines(lines)) {\n                            curRange.push(line);\n                        }\n                    }\n                    else {\n                        // end the range and output\n                        const contextSize = Math.min(lines.length, context);\n                        for (const line of contextLines(lines.slice(0, contextSize))) {\n                            curRange.push(line);\n                        }\n                        const hunk = {\n                            oldStart: oldRangeStart,\n                            oldLines: (oldLine - oldRangeStart + contextSize),\n                            newStart: newRangeStart,\n                            newLines: (newLine - newRangeStart + contextSize),\n                            lines: curRange\n                        };\n                        hunks.push(hunk);\n                        oldRangeStart = 0;\n                        newRangeStart = 0;\n                        curRange = [];\n                    }\n                }\n                oldLine += lines.length;\n                newLine += lines.length;\n            }\n        }\n        // Step 2: eliminate the trailing `\\n` from each line of each hunk, and, where needed, add\n        //         \"\\ No newline at end of file\".\n        for (const hunk of hunks) {\n            for (let i = 0; i < hunk.lines.length; i++) {\n                if (hunk.lines[i].endsWith('\\n')) {\n                    hunk.lines[i] = hunk.lines[i].slice(0, -1);\n                }\n                else {\n                    hunk.lines.splice(i + 1, 0, '\\\\ No newline at end of file');\n                    i++; // Skip the line we just added, then continue iterating\n                }\n            }\n        }\n        return {\n            oldFileName: oldFileName, newFileName: newFileName,\n            oldHeader: oldHeader, newHeader: newHeader,\n            hunks: hunks\n        };\n    }\n}\n/**\n * creates a unified diff patch.\n * @param patch either a single structured patch object (as returned by `structuredPatch`) or an array of them (as returned by `parsePatch`)\n */\nexport function formatPatch(patch) {\n    if (Array.isArray(patch)) {\n        return patch.map(formatPatch).join('\\n');\n    }\n    const ret = [];\n    if (patch.oldFileName == patch.newFileName) {\n        ret.push('Index: ' + patch.oldFileName);\n    }\n    ret.push('===================================================================');\n    ret.push('--- ' + patch.oldFileName + (typeof patch.oldHeader === 'undefined' ? '' : '\\t' + patch.oldHeader));\n    ret.push('+++ ' + patch.newFileName + (typeof patch.newHeader === 'undefined' ? '' : '\\t' + patch.newHeader));\n    for (let i = 0; i < patch.hunks.length; i++) {\n        const hunk = patch.hunks[i];\n        // Unified Diff Format quirk: If the chunk size is 0,\n        // the first number is one lower than one would expect.\n        // https://www.artima.com/weblogs/viewpost.jsp?thread=164293\n        if (hunk.oldLines === 0) {\n            hunk.oldStart -= 1;\n        }\n        if (hunk.newLines === 0) {\n            hunk.newStart -= 1;\n        }\n        ret.push('@@ -' + hunk.oldStart + ',' + hunk.oldLines\n            + ' +' + hunk.newStart + ',' + hunk.newLines\n            + ' @@');\n        for (const line of hunk.lines) {\n            ret.push(line);\n        }\n    }\n    return ret.join('\\n') + '\\n';\n}\nexport function createTwoFilesPatch(oldFileName, newFileName, oldStr, newStr, oldHeader, newHeader, options) {\n    if (typeof options === 'function') {\n        options = { callback: options };\n    }\n    if (!(options === null || options === void 0 ? void 0 : options.callback)) {\n        const patchObj = structuredPatch(oldFileName, newFileName, oldStr, newStr, oldHeader, newHeader, options);\n        if (!patchObj) {\n            return;\n        }\n        return formatPatch(patchObj);\n    }\n    else {\n        const { callback } = options;\n        structuredPatch(oldFileName, newFileName, oldStr, newStr, oldHeader, newHeader, Object.assign(Object.assign({}, options), { callback: patchObj => {\n                if (!patchObj) {\n                    callback(undefined);\n                }\n                else {\n                    callback(formatPatch(patchObj));\n                }\n            } }));\n    }\n}\nexport function createPatch(fileName, oldStr, newStr, oldHeader, newHeader, options) {\n    return createTwoFilesPatch(fileName, fileName, oldStr, newStr, oldHeader, newHeader, options);\n}\n/**\n * Split `text` into an array of lines, including the trailing newline character (where present)\n */\nfunction splitLines(text) {\n    const hasTrailingNl = text.endsWith('\\n');\n    const result = text.split('\\n').map(line => line + '\\n');\n    if (hasTrailingNl) {\n        result.pop();\n    }\n    else {\n        result.push(result.pop().slice(0, -1));\n    }\n    return result;\n}\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { NotebookActions, } from '@jupyterlab/notebook';\nimport { NotebookCommandIds } from './NotebookCommands';\nimport * as Diff from 'diff';\nexport class NotebookAdapter {\n    _commands;\n    _panel;\n    _notebook;\n    _context;\n    _defaultCellType = 'code';\n    _kernelInfo = null;\n    constructor(commands, panel, context) {\n        this._commands = commands;\n        this._panel = panel;\n        this._notebook = panel.content;\n        this._context = context;\n    }\n    /**\n     * Get the command registry.\n     */\n    get commands() {\n        return this._commands;\n    }\n    /**\n     * Get the notebook panel.\n     */\n    get panel() {\n        return this._panel;\n    }\n    /**\n     * Get the notebook widget.\n     */\n    get notebook() {\n        return this._notebook;\n    }\n    /**\n     * Get the notebook context.\n     */\n    get context() {\n        return this._context;\n    }\n    /**\n     * Get the session context from the notebook panel.\n     */\n    get sessionContext() {\n        return this._panel.sessionContext;\n    }\n    /**\n     * Get the kernel connection from the session context.\n     */\n    get kernel() {\n        return this._panel.sessionContext?.session?.kernel ?? null;\n    }\n    /**\n     * Get the cached kernel info (language_info, etc.).\n     * Call fetchKernelInfo() first to populate this.\n     */\n    get kernelInfo() {\n        return this._kernelInfo;\n    }\n    /**\n     * Fetch and cache the kernel info.\n     * Returns the cached info if already fetched.\n     */\n    async fetchKernelInfo() {\n        if (this._kernelInfo) {\n            return this._kernelInfo;\n        }\n        const kernel = this.kernel;\n        if (kernel) {\n            this._kernelInfo = await kernel.info;\n            return this._kernelInfo;\n        }\n        return null;\n    }\n    /**\n     * Assign a new kernel to the notebook.\n     *\n     * @param kernel - The Kernel instance to assign to the notebook\n     *\n     * @remarks\n     * This method changes the kernel associated with the notebook's session context.\n     * It uses the kernel's id to request a kernel change through the session context.\n     * The kernel info cache is cleared when a new kernel is assigned.\n     */\n    assignKernel(kernel) {\n        // Clear the cached kernel info since we're changing kernels\n        this._kernelInfo = null;\n        // Change the kernel using the session context\n        this._context?.sessionContext.changeKernel({\n            id: kernel.id,\n        });\n    }\n    /**\n     * Set the default cell type for new cells.\n     */\n    setDefaultCellType(cellType) {\n        this._defaultCellType = cellType;\n    }\n    /**\n     * Get the default cell type for new cells.\n     */\n    get defaultCellType() {\n        return this._defaultCellType;\n    }\n    /**\n     * Insert a new cell above the active cell.\n     */\n    insertAbove(source) {\n        const notebook = this._notebook;\n        // Insert above using NotebookActions\n        NotebookActions.insertAbove(notebook);\n        // Always set the cell type to match _defaultCellType\n        // (NotebookActions may create cells with a different default type)\n        NotebookActions.changeCellType(notebook, this._defaultCellType);\n        // Set the source if provided\n        if (source && notebook.activeCell) {\n            notebook.activeCell.model.sharedModel.setSource(source);\n        }\n        // Enter edit mode\n        notebook.mode = 'edit';\n    }\n    /**\n     * Insert a new cell below the active cell.\n     */\n    insertBelow(source) {\n        const notebook = this._notebook;\n        // Insert below using NotebookActions\n        NotebookActions.insertBelow(notebook);\n        // Always set the cell type to match _defaultCellType\n        // (NotebookActions may create cells with a different default type)\n        NotebookActions.changeCellType(notebook, this._defaultCellType);\n        // Set the source if provided\n        if (source && notebook.activeCell) {\n            notebook.activeCell.model.sharedModel.setSource(source);\n        }\n        // Enter edit mode\n        notebook.mode = 'edit';\n    }\n    /**\n     * Change the type of the active cell.\n     */\n    changeCellType(cellType) {\n        const notebook = this._notebook;\n        if (notebook.activeCell && notebook.activeCell.model.type !== cellType) {\n            NotebookActions.changeCellType(notebook, cellType);\n        }\n    }\n    /**\n     * Delete the currently selected cells.\n     */\n    deleteCells() {\n        const notebook = this._notebook;\n        NotebookActions.deleteCells(notebook);\n    }\n    /**\n     * Get the notebook model.\n     */\n    get model() {\n        return this._context.model;\n    }\n    /**\n     * Undo the last change in the notebook.\n     *\n     * @remarks\n     * If there is no history to undo (e.g., at the beginning of the undo stack),\n     * this operation will have no effect. The notebook must be available and\n     * properly initialized for this operation to succeed.\n     */\n    undo() {\n        const notebook = this._notebook;\n        // If we're in edit mode and have an active cell with an editor,\n        // try to undo in the cell editor first\n        if (notebook.mode === 'edit' && notebook.activeCell?.editor) {\n            const editor = notebook.activeCell.editor;\n            // CodeMirror editor has an undo method\n            if (editor && typeof editor.undo === 'function') {\n                editor.undo();\n                return;\n            }\n        }\n        // Otherwise, undo at the notebook level (add/remove cells, etc.)\n        NotebookActions.undo(notebook);\n    }\n    /**\n     * Redo the last undone change in the notebook.\n     *\n     * @remarks\n     * If there is no history to redo (e.g., no prior undo operations or at the\n     * end of the redo stack), this operation will have no effect. The notebook\n     * must be available and properly initialized for this operation to succeed.\n     */\n    redo() {\n        const notebook = this._notebook;\n        // If we're in edit mode and have an active cell with an editor,\n        // try to redo in the cell editor first\n        if (notebook.mode === 'edit' && notebook.activeCell?.editor) {\n            const editor = notebook.activeCell.editor;\n            // CodeMirror editor has a redo method\n            if (editor && typeof editor.redo === 'function') {\n                editor.redo();\n                return;\n            }\n        }\n        // Otherwise, redo at the notebook level (add/remove cells, etc.)\n        NotebookActions.redo(notebook);\n    }\n    /**\n     * Set the active cell by index.\n     *\n     * @param index - The index of the cell to activate (0-based)\n     *\n     * @remarks\n     * This method programmatically selects a cell at the specified index.\n     * If the index is out of bounds, the operation has no effect.\n     */\n    setActiveCell(index) {\n        const notebook = this._notebook;\n        const cellCount = notebook.model?.cells.length ?? 0;\n        if (index >= 0 && index < cellCount) {\n            notebook.activeCellIndex = index;\n        }\n    }\n    /**\n     * Get all cells from the notebook.\n     *\n     * @returns Array of cell data including type, source, and outputs\n     *\n     * @remarks\n     * This method extracts cell information from the notebook model.\n     * For code cells, outputs are included. Returns an empty array if\n     * the notebook model is not available.\n     */\n    getCells() {\n        console.log('[NotebookAdapter.getCells] Called');\n        const cells = this._notebook.model?.cells;\n        if (!cells) {\n            console.log('[NotebookAdapter.getCells] No cells model, returning empty array');\n            return [];\n        }\n        console.log(`[NotebookAdapter.getCells] Found ${cells.length} cells`);\n        const result = [];\n        for (let i = 0; i < cells.length; i++) {\n            const cell = cells.get(i);\n            if (cell) {\n                const cellData = {\n                    index: i,\n                    type: cell.type,\n                    source: cell.sharedModel.getSource(),\n                    outputs: cell.type === 'code' ? cell.outputs?.toJSON() : undefined,\n                };\n                console.log(`[NotebookAdapter.getCells] Cell ${i}:`, {\n                    type: cellData.type,\n                    sourceLength: cellData.source.length,\n                });\n                result.push(cellData);\n            }\n        }\n        console.log(`[NotebookAdapter.getCells] Returning ${result.length} cells`);\n        return result;\n    }\n    /**\n     * Read all cells from the notebook (alias for getCells).\n     *\n     * @param format - Response format: 'brief' returns preview only, 'detailed' returns full content\n     * @returns Array of cell data - brief or detailed based on format\n     *\n     * @remarks\n     * This method is an alias for getCells() to match the readAllCells tool operation.\n     * Provides a consistent naming convention for read operations.\n     * Supports brief format (index, type, 40-char preview) and detailed format (full content).\n     */\n    readAllCells(format = 'brief') {\n        const cells = this.getCells();\n        return cells.map((cell, index) => {\n            // Get execution count for code cells\n            const cellModel = this._notebook.model?.cells.get(index);\n            const execution_count = cellModel?.type === 'code'\n                ? (cellModel.executionCount ?? null)\n                : null;\n            if (format === 'brief') {\n                // Brief format: index, type, 40-char preview\n                return {\n                    index,\n                    type: cell.type,\n                    preview: cell.source.substring(0, 40),\n                };\n            }\n            else {\n                // Detailed format: full content with source, execution_count, outputs\n                return {\n                    index,\n                    type: cell.type,\n                    source: cell.source,\n                    execution_count,\n                    outputs: cell.outputs,\n                };\n            }\n        });\n    }\n    /**\n     * Get the total number of cells in the notebook.\n     *\n     * @returns The number of cells, or 0 if the notebook model is not available\n     */\n    getCellCount() {\n        return this._notebook.model?.cells.length ?? 0;\n    }\n    /**\n     * Insert a new cell at a specific index.\n     *\n     * @param cellIndex - The index where the cell should be inserted (0-based)\n     * @param source - Optional source code/text for the new cell\n     *\n     * @remarks\n     * This method inserts a cell at the specified position by:\n     * 1. Setting the active cell to cellIndex\n     * 2. Calling insertAbove to insert before that cell\n     *\n     * Note: The cell type is determined by _defaultCellType, which should be set\n     * before calling this method (typically done by the store layer).\n     */\n    insertAt(cellIndex, source) {\n        const cellCount = this.getCellCount();\n        console.log('[NotebookAdapter.insertAt] Called with:', {\n            cellIndex,\n            sourceLength: source?.length || 0,\n            sourcePreview: source?.substring(0, 50),\n            currentActiveCell: this._notebook.activeCellIndex,\n            cellCount,\n            defaultCellType: this._defaultCellType,\n        });\n        // Validate cell index is within bounds (matches Jupyter MCP Server)\n        if (cellIndex < -1 || cellIndex > cellCount) {\n            throw new Error(`Index ${cellIndex} is outside valid range [-1, ${cellCount}]. ` +\n                `Use -1 to append at end.`);\n        }\n        // Normalize -1 to append position (matches Jupyter MCP Server)\n        const actualIndex = cellIndex === -1 ? cellCount : cellIndex;\n        console.log('[NotebookAdapter.insertAt] Normalized index:', {\n            originalIndex: cellIndex,\n            actualIndex,\n            cellCount,\n        });\n        // Insert at the actual index\n        if (actualIndex >= cellCount) {\n            // Append at end\n            console.log('[NotebookAdapter.insertAt] Appending at end');\n            if (cellCount > 0) {\n                this.setActiveCell(cellCount - 1);\n            }\n            this.insertBelow(source);\n        }\n        else {\n            // Insert at specific position\n            console.log(`[NotebookAdapter.insertAt] Inserting at index ${actualIndex}`);\n            this.setActiveCell(actualIndex);\n            this.insertAbove(source);\n        }\n        console.log('[NotebookAdapter.insertAt] After insertion:', {\n            cellCount: this.getCellCount(),\n            activeCell: this._notebook.activeCellIndex,\n        });\n    }\n    /**\n     * NEW ALIGNED TOOL METHODS\n     * These methods align 1:1 with tool operation names for seamless integration\n     */\n    /**\n     * Insert a cell at a specific index (aligned with insertCell tool).\n     *\n     * @param cellType - Type of cell to insert (code, markdown, or raw)\n     * @param cellIndex - Index where to insert (0-based). If undefined, inserts at end.\n     * @param source - Optional source code/text for the cell\n     */\n    insertCell(cellType, cellIndex, source) {\n        this.setDefaultCellType(cellType);\n        // Default to cell count (end of notebook) if index not provided\n        const targetIndex = cellIndex ?? this.getCellCount();\n        this.insertAt(targetIndex, source);\n    }\n    /**\n     * Insert multiple cells at a specific index (aligned with insertCells tool).\n     *\n     * More efficient than calling insertCell multiple times.\n     * Cells are inserted sequentially starting at the given index.\n     *\n     * @param cells - Array of cells to insert (each with type and source)\n     * @param cellIndex - Index where to insert first cell (0-based). Use large number for end.\n     */\n    insertCells(cells, cellIndex) {\n        let currentIndex = cellIndex;\n        for (const cell of cells) {\n            this.setDefaultCellType(cell.type);\n            this.insertAt(currentIndex, cell.source);\n            currentIndex++;\n        }\n    }\n    /**\n     * Delete cell(s) at the specified index/indices (aligned with deleteCell tool and Jupyter MCP Server).\n     *\n     * @param index - Single cell index, array of indices, or undefined.\n     *   - Single number: Deletes that cell\n     *   - Array: Deletes all cells at those indices (in reverse order to prevent shifting)\n     *   - Undefined: Deletes the active cell if one exists\n     *\n     * @remarks\n     * This method matches the Jupyter MCP Server behavior:\n     * - Validates ALL indices are in range before deleting any\n     * - Deletes in reverse order (highest to lowest) to prevent index shifting\n     * - Throws error with MCP-compatible message format if any index is out of range\n     *\n     * @throws {Error} If any index is out of range\n     */\n    deleteCell(index) {\n        const cells = this._notebook.model?.cells;\n        const cellCount = cells?.length ?? 0;\n        if (index !== undefined) {\n            // Convert single index to array for unified handling\n            const indices = Array.isArray(index) ? index : [index];\n            // Validate ALL indices first (match Jupyter MCP Server error format)\n            for (const idx of indices) {\n                if (idx < 0 || idx >= cellCount) {\n                    console.error(`[NotebookAdapter.deleteCell] Index ${idx} is out of range (cell count: ${cellCount})`);\n                    throw new Error(`Cell index ${idx} is out of range. Notebook has ${cellCount} cells.`);\n                }\n            }\n            // Sort indices in REVERSE order (highest to lowest) to prevent index shifting\n            // This matches the Jupyter MCP Server behavior\n            const sortedIndices = [...indices].sort((a, b) => b - a);\n            console.log(`[NotebookAdapter.deleteCell] Deleting ${sortedIndices.length} cell(s) in reverse order:`, sortedIndices);\n            // Delete each cell in reverse order\n            for (const idx of sortedIndices) {\n                this.setActiveCell(idx);\n                this.deleteCells();\n            }\n        }\n        else {\n            // No index provided: check if there's an active cell to delete\n            const activeCell = this._notebook.activeCell;\n            if (!activeCell) {\n                console.warn('[NotebookAdapter.deleteCell] No active cell to delete');\n                return; // Safely return without deleting\n            }\n            // Active cell exists, safe to delete\n            this.deleteCells();\n        }\n    }\n    /**\n     * Updates cell source at the specified index and returns a diff.\n     * Matches MCP server's overwrite_cell_source behavior.\n     *\n     * @param index - Cell index (0-based)\n     * @param source - New cell source content\n     * @returns Diff string showing changes made\n     * @throws Error if cell index is out of range or cell not found\n     */\n    updateCell(index, source) {\n        // Validate cell index\n        const cellCount = this._notebook.model?.sharedModel.cells.length ?? 0;\n        if (index < 0 || index >= cellCount) {\n            throw new Error(`Cell index ${index} is out of range. Notebook has ${cellCount} cells.`);\n        }\n        // Get the cell at the specified index\n        const cellModel = this._notebook.model?.cells.get(index);\n        if (!cellModel) {\n            throw new Error(`Cell at index ${index} not found.`);\n        }\n        // Store old source before updating\n        const oldSource = cellModel.sharedModel.getSource();\n        // Update the cell source\n        cellModel.sharedModel.setSource(source);\n        // Generate diff (matches MCP server behavior)\n        const patch = Diff.createPatch(`cell_${index}`, oldSource, source, 'before', 'after', { context: 3 });\n        return patch;\n    }\n    /**\n     * Get a cell's content by index or active cell (aligned with getCell tool and MCP Server).\n     *\n     * @param index - Optional cell index (0-based). If not provided, returns active cell.\n     * @param includeOutputs - Whether to include cell outputs (default: true)\n     * @returns Cell data or undefined if not found\n     */\n    getCell(index, includeOutputs = true) {\n        if (index !== undefined) {\n            // Get cell at specific index\n            const cells = this.getCells();\n            const cell = cells[index];\n            if (!cell)\n                return undefined;\n            // Get execution count for code cells\n            const cellModel = this._notebook.model?.cells.get(index);\n            const execution_count = cellModel?.type === 'code'\n                ? (cellModel.executionCount ?? null)\n                : null;\n            return {\n                type: cell.type,\n                source: cell.source,\n                execution_count,\n                outputs: includeOutputs ? cell.outputs : undefined,\n            };\n        }\n        else {\n            // Get active cell\n            const activeCell = this._notebook.activeCell;\n            if (!activeCell)\n                return undefined;\n            const execution_count = activeCell.model.type === 'code'\n                ? (activeCell.model.executionCount ?? null)\n                : null;\n            return {\n                type: activeCell.model.type,\n                source: activeCell.model.sharedModel.getSource(),\n                execution_count,\n                outputs: includeOutputs && activeCell.model.type === 'code'\n                    ? activeCell.model.outputs?.toJSON()\n                    : undefined,\n            };\n        }\n    }\n    /**\n     * Run a cell and optionally capture outputs (aligned with runCell tool).\n     *\n     * @param params - Parameters for cell execution\n     * @param params.index - Cell index to run (optional, defaults to active cell)\n     * @param params.timeoutSeconds - Timeout in seconds (optional, for future use)\n     * @param params.stream - Enable streaming progress (optional, for future use)\n     * @param params.progressInterval - Progress update interval (optional, for future use)\n     * @returns Promise resolving to execution result with outputs\n     */\n    async runCell(params) {\n        const { index } = params || {};\n        // Note: timeoutSeconds, stream, progressInterval are accepted for future use\n        // but timeout/streaming logic is handled at the operation layer\n        // Set active cell if index provided\n        if (index !== undefined) {\n            this.setActiveCell(index);\n        }\n        const targetIndex = index ?? this._notebook.activeCellIndex;\n        if (targetIndex === -1) {\n            throw new Error('No active cell to execute');\n        }\n        // Execute the cell using JupyterLab's NotebookActions\n        await NotebookActions.run(this._notebook, this._context.sessionContext);\n        // Wait a brief moment for outputs to be available\n        await new Promise(resolve => setTimeout(resolve, 100));\n        // Capture outputs after execution\n        const cellData = this.getCell(targetIndex, true);\n        if (!cellData) {\n            return {\n                execution_count: null,\n                outputs: [],\n            };\n        }\n        // Convert outputs to string array (matching MCP format)\n        const outputs = [];\n        if (cellData.outputs && Array.isArray(cellData.outputs)) {\n            for (const output of cellData.outputs) {\n                if (typeof output === 'string') {\n                    outputs.push(output);\n                }\n                else if (output && typeof output === 'object') {\n                    // Handle different output types\n                    const outputObj = output;\n                    if (outputObj.output_type === 'stream') {\n                        const text = outputObj.text;\n                        if (typeof text === 'string') {\n                            outputs.push(text);\n                        }\n                        else if (Array.isArray(text)) {\n                            outputs.push(text.join(''));\n                        }\n                    }\n                    else if (outputObj.output_type === 'execute_result' ||\n                        outputObj.output_type === 'display_data') {\n                        const data = outputObj.data;\n                        if (data) {\n                            // Prefer text/plain output\n                            if (data['text/plain']) {\n                                const text = data['text/plain'];\n                                if (typeof text === 'string') {\n                                    outputs.push(text);\n                                }\n                                else if (Array.isArray(text)) {\n                                    outputs.push(text.join(''));\n                                }\n                            }\n                        }\n                    }\n                    else if (outputObj.output_type === 'error') {\n                        // Format error output\n                        const ename = outputObj.ename ?? 'Error';\n                        const evalue = outputObj.evalue ?? '';\n                        const traceback = outputObj.traceback;\n                        if (Array.isArray(traceback) && traceback.length > 0) {\n                            outputs.push(`[ERROR: ${ename}: ${evalue}]\\n${traceback.join('\\n')}`);\n                        }\n                        else {\n                            outputs.push(`[ERROR: ${ename}: ${evalue}]`);\n                        }\n                    }\n                }\n            }\n        }\n        return {\n            execution_count: cellData.execution_count,\n            outputs,\n        };\n    }\n    /**\n     * Run all cells in the notebook (aligned with runAllCells tool).\n     */\n    runAllCells() {\n        this._commands.execute(NotebookCommandIds.runAll);\n    }\n    /**\n     * Clear all outputs from all cells in the notebook.\n     *\n     * @remarks\n     * Removes all execution outputs from all cells. This operation:\n     * - Clears outputs but preserves cell source code\n     * - Resets execution counts\n     * - Cannot be undone\n     */\n    clearAllOutputs() {\n        NotebookActions.clearAllOutputs(this._notebook);\n    }\n    /**\n     * Execute code directly in the kernel without creating a cell.\n     *\n     * This method sends code execution requests directly to the kernel,\n     * bypassing the notebook cell model. Useful for:\n     * - Variable inspection\n     * - Environment setup\n     * - Background tasks\n     * - Tool introspection\n     *\n     * @param code - Code to execute\n     * @param options - Execution options\n     * @returns Promise with execution result including outputs\n     */\n    async executeCode(code, options = {}) {\n        const sessionContext = this._panel.sessionContext;\n        if (!sessionContext || !sessionContext.session?.kernel) {\n            return {\n                success: false,\n                error: 'No active kernel session',\n            };\n        }\n        const kernel = sessionContext.session.kernel;\n        try {\n            const future = kernel.requestExecute({\n                code,\n                stop_on_error: true, // Internal default: stop on error\n                store_history: false, // Internal default: don't store in history\n                silent: false, // Internal default: not silent (show outputs)\n                allow_stdin: false,\n            });\n            const outputs = [];\n            let executionCount;\n            // Collect outputs\n            future.onIOPub = msg => {\n                const msgType = msg.header.msg_type;\n                if (msgType === 'stream') {\n                    outputs.push({\n                        type: 'stream',\n                        content: msg.content,\n                    });\n                }\n                else if (msgType === 'execute_result') {\n                    outputs.push({\n                        type: 'execute_result',\n                        content: msg.content,\n                    });\n                    executionCount = msg.content.execution_count;\n                }\n                else if (msgType === 'display_data') {\n                    outputs.push({\n                        type: 'display_data',\n                        content: msg.content,\n                    });\n                }\n                else if (msgType === 'error') {\n                    outputs.push({\n                        type: 'error',\n                        content: msg.content,\n                    });\n                }\n            };\n            // Handle timeout if specified (default: 30 seconds, max: 60)\n            const timeoutMs = (options.timeout ?? 30) * 1000;\n            const executionPromise = future.done;\n            const timeoutPromise = new Promise((_, reject) => {\n                setTimeout(() => {\n                    reject(new Error(`Execution timeout after ${options.timeout ?? 30} seconds`));\n                }, timeoutMs);\n            });\n            try {\n                await Promise.race([executionPromise, timeoutPromise]);\n            }\n            catch (timeoutError) {\n                // Interrupt kernel on timeout\n                try {\n                    await kernel.interrupt();\n                }\n                catch (interruptError) {\n                    console.error('Failed to interrupt kernel:', interruptError);\n                }\n                return {\n                    success: false,\n                    error: `Execution exceeded ${options.timeout ?? 30} seconds and was interrupted`,\n                    outputs,\n                };\n            }\n            return {\n                success: true,\n                outputs,\n                executionCount,\n            };\n        }\n        catch (error) {\n            return {\n                success: false,\n                error: error instanceof Error ? error.message : String(error),\n            };\n        }\n    }\n    /**\n     * Dispose of the adapter.\n     */\n    dispose() {\n        // Clean up any resources if needed\n        // The panel, notebook, and context are managed by NotebookBase\n    }\n}\nexport default NotebookAdapter;\n//# sourceMappingURL=NotebookAdapter.js.map","import { Fragment as _Fragment, jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { useEffect, useMemo, useState } from 'react';\nimport { CodeMirrorEditorFactory, CodeMirrorMimeTypeService, EditorExtensionRegistry, EditorLanguageRegistry, EditorThemeRegistry, ybinding, } from '@jupyterlab/codemirror';\nimport { Completer, CompleterModel, CompletionHandler, InlineCompleter, KernelCompleterProvider, ProviderReconciliator, } from '@jupyterlab/completer';\nimport { nullTranslator } from '@jupyterlab/translation';\nimport { PathExt } from '@jupyterlab/coreutils';\nimport { Context } from '@jupyterlab/docregistry';\nimport { rendererFactory as javascriptRendererFactory } from '@jupyterlab/javascript-extension';\nimport { rendererFactory as jsonRendererFactory } from '@jupyterlab/json-extension';\nimport { createMarkdownParser } from '@jupyterlab/markedparser-extension';\nimport { MathJaxTypesetter } from '@jupyterlab/mathjax-extension';\nimport { NotebookModel, NotebookModelFactory, NotebookPanel, NotebookTracker, NotebookWidgetFactory, StaticNotebook, } from '@jupyterlab/notebook';\nimport { RenderMimeRegistry, standardRendererFactories, } from '@jupyterlab/rendermime';\nimport { YNotebook } from '@jupyter/ydoc';\nimport { find } from '@lumino/algorithm';\nimport { CommandRegistry } from '@lumino/commands';\nimport { DisposableSet } from '@lumino/disposable';\nimport { Signal } from '@lumino/signaling';\nimport { Widget } from '@lumino/widgets';\nimport { Box } from '@datalayer/primer-addons';\nimport { Banner } from '@primer/react/experimental';\nimport { EditorView } from 'codemirror';\nimport { WIDGET_MIMETYPE, WidgetLabRenderer, WidgetManager, } from '../../jupyter';\nimport { newUuid, remoteUserCursors } from '../../utils';\nimport { Lumino } from '../lumino';\nimport { Loader } from '../utils';\nimport { addNotebookCommands, NotebookPanelProvider } from './NotebookCommands';\nimport { NotebookAdapter } from './NotebookAdapter';\nimport { notebookStore } from './NotebookState';\nconst COMPLETER_TIMEOUT_MILLISECONDS = 1000;\nconst DEFAULT_EXTENSIONS = new Array();\nconst FALLBACK_NOTEBOOK_PATH = '.datalayer/ping.ipynb';\n/**\n * Generate settings for inline completion providers.\n * Each provider needs to be explicitly enabled with settings.\n */\nfunction generateInlineProviderSettings(providers) {\n    const settings = {};\n    if (providers) {\n        providers.forEach(provider => {\n            const providerSchema = provider.schema?.default;\n            settings[provider.identifier] = {\n                enabled: true,\n                debouncerDelay: providerSchema?.debouncerDelay ?? 200,\n                timeout: providerSchema?.timeout ?? 15000,\n                autoFillInMiddle: true,\n            };\n        });\n    }\n    return settings;\n}\n/**\n * Base notebook component\n *\n * The notebook model and kernel lifecycle is not handled by\n * this component.\n *\n * Important\n * This component is not connected to any React stores.\n */\nexport function NotebookBase(props) {\n    const { commands, extensions = DEFAULT_EXTENSIONS, kernelId, renderers, serviceManager, model, onSessionConnection, } = props;\n    console.log('[NotebookBase] Component rendering with props:', {\n        hasInlineProviders: !!props.inlineProviders,\n        inlineProvidersCount: props.inlineProviders?.length,\n        inlineProviders: props.inlineProviders,\n        kernelId,\n    });\n    const [isLoading, setIsLoading] = useState(true);\n    const [extensionComponents, setExtensionComponents] = useState(new Array());\n    const [completer, setCompleter] = useState(null);\n    const [adapter, setAdapter] = useState(null);\n    const id = useMemo(() => props.id || newUuid(), [props.id]);\n    const path = useMemo(() => props.path || FALLBACK_NOTEBOOK_PATH, [props.path]);\n    const features = useMemo(() => new CommonFeatures({ commands, renderers }), [commands, renderers]);\n    const contentFactory = useMemo(() => new NotebookPanel.ContentFactory({\n        editorFactory: features.editorServices.factoryService.newInlineEditor,\n    }), [features.editorServices.factoryService.newInlineEditor]);\n    useEffect(() => {\n        console.log('[NotebookBase] Setting up completer with inlineProviders:', props.inlineProviders);\n        const completer = new Completer({ model: new CompleterModel() });\n        // Dummy widget to initialize\n        const widget = new Widget();\n        const inlineProvidersSettings = generateInlineProviderSettings(props.inlineProviders);\n        console.log('[NotebookBase] Generated settings for providers:', inlineProvidersSettings);\n        const reconciliator = new ProviderReconciliator({\n            context: {\n                widget,\n            },\n            providers: [new KernelCompleterProvider()],\n            inlineProviders: props.inlineProviders,\n            inlineProvidersSettings,\n            timeout: COMPLETER_TIMEOUT_MILLISECONDS,\n        });\n        console.log('[NotebookBase] ProviderReconciliator created with inlineProviders:', props.inlineProviders);\n        console.log('[NotebookBase] ProviderReconciliator object:', reconciliator);\n        // Create InlineCompleter widget if inline providers are configured\n        let inlineCompleter;\n        if (props.inlineProviders && props.inlineProviders.length > 0) {\n            console.log('[NotebookBase] Creating InlineCompleter widget');\n            const trans = nullTranslator.load('jupyterlab');\n            inlineCompleter = new InlineCompleter({\n                model: new InlineCompleter.Model(),\n                trans,\n            });\n            // Configure inline completer settings\n            const providerSettings = {};\n            props.inlineProviders?.forEach(provider => {\n                providerSettings[provider.identifier] = { enabled: true };\n            });\n            inlineCompleter.configure({\n                showWidget: 'always',\n                showShortcuts: true,\n                streamingAnimation: 'none',\n                suppressIfTabCompleterActive: false,\n                minLines: 1,\n                maxLines: 10,\n                editorResizeDelay: 250,\n                reserveSpaceForLongest: false,\n                providers: providerSettings,\n            });\n            Widget.attach(inlineCompleter, document.body);\n            // Set up keyboard shortcut for accepting inline completions\n            // Tab key should accept the current suggestion\n            const handleKeyDown = (event) => {\n                if (event.key === 'Tab' &&\n                    !event.shiftKey &&\n                    !event.ctrlKey &&\n                    !event.metaKey &&\n                    !event.altKey) {\n                    // Check if there's an active inline completion\n                    if (inlineCompleter &&\n                        inlineCompleter.model &&\n                        inlineCompleter.current) {\n                        console.log('[NotebookBase] Tab pressed - accepting inline completion');\n                        event.preventDefault();\n                        event.stopPropagation();\n                        inlineCompleter.accept();\n                        return false;\n                    }\n                }\n                // Escape to reject\n                if (event.key === 'Escape') {\n                    if (inlineCompleter &&\n                        inlineCompleter.model &&\n                        inlineCompleter.current) {\n                        console.log('[NotebookBase] Escape pressed - rejecting inline completion');\n                        event.preventDefault();\n                        event.stopPropagation();\n                        inlineCompleter.model.reset();\n                        return false;\n                    }\n                }\n            };\n            document.addEventListener('keydown', handleKeyDown, true);\n            // Store cleanup function for keyboard handler\n            const cleanupKeyboard = () => {\n                document.removeEventListener('keydown', handleKeyDown, true);\n            };\n            console.log('[NotebookBase] InlineCompleter created, configured, attached, and keyboard handlers set up');\n            // Store the cleanup function on the inlineCompleter for later cleanup\n            inlineCompleter._keyboardCleanup = cleanupKeyboard;\n        }\n        const handler = new CompletionHandler({\n            completer,\n            reconciliator,\n            inlineCompleter,\n        });\n        completer.hide();\n        Widget.attach(completer, document.body);\n        setCompleter(handler);\n        return () => {\n            handler.dispose();\n            completer.dispose();\n            if (inlineCompleter) {\n                // Clean up keyboard listeners\n                if (inlineCompleter._keyboardCleanup) {\n                    inlineCompleter._keyboardCleanup();\n                }\n                inlineCompleter.dispose();\n            }\n            widget.dispose();\n        };\n    }, [props.inlineProviders]);\n    // Widget factory.\n    const [widgetFactory, setWidgetFactory] = useState(null);\n    useEffect(() => {\n        const thisFactory = new NotebookWidgetFactory({\n            name: 'Notebook',\n            label: 'Notebook',\n            modelName: 'notebook',\n            fileTypes: ['notebook'],\n            defaultFor: ['notebook'],\n            preferKernel: true,\n            autoStartDefault: false,\n            canStartKernel: false,\n            shutdownOnClose: false,\n            rendermime: features.rendermime,\n            contentFactory,\n            mimeTypeService: features.editorServices.mimeTypeService,\n            notebookConfig: {\n                ...StaticNotebook.defaultNotebookConfig,\n                recordTiming: true,\n            },\n        });\n        setWidgetFactory(thisFactory);\n        return () => {\n            thisFactory.dispose();\n            setWidgetFactory(factory => (factory === thisFactory ? null : factory));\n        };\n    }, [contentFactory, features]);\n    // Panel provider - persists across React re-renders to avoid tracker.currentWidget becoming null\n    const panelProvider = useMemo(() => new NotebookPanelProvider(), []);\n    // Tracker & commands.\n    const [tracker, setTracker] = useState(null);\n    useEffect(() => {\n        const thisTracker = completer\n            ? new NotebookTracker({ namespace: id })\n            : null;\n        const commands = completer\n            ? addNotebookCommands(features.commands, completer, thisTracker, panelProvider, props.path)\n            : null;\n        setTracker(thisTracker);\n        return () => {\n            commands?.dispose();\n            thisTracker?.dispose();\n            setTracker(tracker => (tracker === thisTracker ? null : tracker));\n        };\n    }, [completer, id, features.commands, props.path, panelProvider]);\n    // Context\n    const [context, setContext] = useState(null);\n    useEffect(() => {\n        if (kernelId) {\n            const factory = new DummyModelFactory(model);\n            const thisContext = new Context({\n                factory,\n                manager: serviceManager ?? new NoServiceManager(),\n                path,\n                kernelPreference: {\n                    id: kernelId,\n                    shouldStart: false,\n                    canStart: false,\n                    autoStartDefault: false,\n                    shutdownOnDispose: false,\n                },\n            });\n            initializeContext(thisContext, id, \n            // Initialization must not trigger revert in case we set up the model content\n            path !== FALLBACK_NOTEBOOK_PATH ? path : undefined, onSessionConnection, !serviceManager);\n            setContext(thisContext);\n            return () => {\n                thisContext.dispose();\n                factory.dispose();\n                setContext(context => (context === thisContext ? null : context));\n            };\n        }\n    }, [id, kernelId, serviceManager, model, path]);\n    // Set kernel\n    useEffect(() => {\n        if (context && kernelId && !context.sessionContext.isDisposed) {\n            context.sessionContext.changeKernel({ id: kernelId }).catch(reason => {\n                console.error('Failed to change kernel model.', reason);\n            });\n            /*\n            context.sessionContext.changeKernel({ id: kernelId }).catch(reason => {\n              console.error('Failed to change kernel model.', reason);\n            });\n            */\n        }\n    }, [context, kernelId]);\n    // Notebook\n    const [panel, setPanel] = useState(null);\n    useEffect(() => {\n        let thisPanel = null;\n        let thisAdapter = null;\n        let widgetsManager = null;\n        if (context) {\n            thisPanel = widgetFactory?.createNew(context) ?? null;\n            if (thisPanel) {\n                // Update panel provider with persistent references\n                panelProvider.setPanel(thisPanel, context);\n                // Create the adapter\n                thisAdapter = new NotebookAdapter(features.commands, thisPanel, context);\n                setAdapter(thisAdapter);\n                setExtensionComponents(extensions.map(extension => {\n                    extension.init({\n                        notebookId: id,\n                        commands: features.commands,\n                        panel: thisPanel,\n                    });\n                    extension.createNew(thisPanel, context);\n                    return extension.component ?? _jsx(_Fragment, {});\n                }));\n                //-- Add ipywidgets renderer\n                const notebookRenderers = thisPanel.content.rendermime;\n                widgetsManager = new WidgetManager(context, notebookRenderers, {\n                    saveState: false,\n                });\n                notebookRenderers.addFactory({\n                    safe: true,\n                    mimeTypes: [WIDGET_MIMETYPE],\n                    defaultRank: 1,\n                    createRenderer: options => new WidgetLabRenderer(options, widgetsManager),\n                }, 1);\n                for (const cell of thisPanel.content.widgets) {\n                    if (cell.model.type === 'code') {\n                        for (const codecell of cell.outputArea.widgets) {\n                            for (const output of Array.from(codecell.children())) {\n                                if (output instanceof WidgetLabRenderer) {\n                                    output.manager = widgetsManager;\n                                }\n                            }\n                        }\n                    }\n                }\n                setIsLoading(false);\n            }\n        }\n        setPanel(thisPanel);\n        if (!thisPanel) {\n            setExtensionComponents([]);\n            setAdapter(null);\n        }\n        return () => {\n            // Clear panel provider to avoid stale references\n            panelProvider.setPanel(null, null);\n            widgetsManager?.dispose();\n            if (thisAdapter) {\n                thisAdapter.dispose();\n            }\n            if (thisPanel) {\n                if (thisPanel.content) {\n                    Signal.clearData(thisPanel.content);\n                }\n                try {\n                    thisPanel.dispose();\n                }\n                catch (reason) {\n                    // No-op\n                }\n            }\n            setPanel(panel => (panel === thisPanel ? null : panel));\n            setAdapter(adapter => (adapter === thisAdapter ? null : adapter));\n        };\n    }, [context, extensions, features.commands, widgetFactory, panelProvider]);\n    // Update notebook store when adapter changes\n    useEffect(() => {\n        if (adapter) {\n            console.log(`[NotebookBase] Registering adapter for notebook: ${id}`);\n            console.log(`[NotebookBase] Adapter has getCells:`, typeof adapter.getCells);\n            console.log(`[NotebookBase] Adapter cell count:`, adapter.getCellCount());\n            const currentNotebooks = notebookStore.getState().notebooks;\n            const updatedNotebooks = new Map(currentNotebooks);\n            updatedNotebooks.set(id, { adapter, portals: [] });\n            notebookStore.getState().setNotebooks(updatedNotebooks);\n            console.log(`[NotebookBase] Store now has ${updatedNotebooks.size} notebooks`);\n            console.log(`[NotebookBase] Notebook IDs:`, Array.from(updatedNotebooks.keys()));\n        }\n        else {\n            console.log(`[NotebookBase]   No adapter yet for notebook: ${id}`);\n            const currentNotebooks = notebookStore.getState().notebooks;\n            if (currentNotebooks.has(id)) {\n                const updatedNotebooks = new Map(currentNotebooks);\n                updatedNotebooks.delete(id);\n                notebookStore.getState().setNotebooks(updatedNotebooks);\n            }\n        }\n    }, [adapter, id]);\n    useEffect(() => {\n        let isMounted = true;\n        let onActiveCellChanged = null;\n        let onSessionChanged = null;\n        if (panel) {\n            if (tracker) {\n                if (!tracker.has(panel)) {\n                    tracker.add(panel).catch(reason => {\n                        console.error(`Failed to track the notebook panel '${id}'.`);\n                    });\n                }\n            }\n            if (completer) {\n                // Setup the completer here as it requires the panel\n                onActiveCellChanged = (notebook, cell) => {\n                    if (cell) {\n                        cell.ready.then(() => {\n                            completer.editor = cell?.editor;\n                        });\n                    }\n                };\n                onSessionChanged = (_, changes) => {\n                    if (!isMounted) {\n                        return;\n                    }\n                    const editor = panel.content.activeCell?.editor;\n                    const provider = new KernelCompleterProvider();\n                    const inlineProvidersSettings = generateInlineProviderSettings(props.inlineProviders);\n                    // Create a dummy session if none exists to enable inline completions without a kernel\n                    const sessionForCompletion = changes.newValue || {};\n                    console.log('[NotebookBase] Creating ProviderReconciliator with editor and session', {\n                        hasEditor: !!editor,\n                        hasSession: !!changes.newValue,\n                        usingDummySession: !changes.newValue,\n                        inlineProviders: props.inlineProviders,\n                        inlineProvidersSettings,\n                    });\n                    const reconciliator = new ProviderReconciliator({\n                        context: {\n                            widget: panel,\n                            editor,\n                            session: sessionForCompletion,\n                        },\n                        providers: [provider],\n                        inlineProviders: props.inlineProviders,\n                        inlineProvidersSettings,\n                        timeout: COMPLETER_TIMEOUT_MILLISECONDS,\n                    });\n                    console.log('[NotebookBase] ProviderReconciliator with editor created:', reconciliator);\n                    // Update the inline completer's editor if it exists\n                    if (completer.inlineCompleter) {\n                        completer.inlineCompleter.editor = editor;\n                        console.log('[NotebookBase] Updated InlineCompleter editor');\n                    }\n                    completer.editor = editor;\n                    completer.reconciliator = reconciliator;\n                };\n                panel.context.sessionContext.sessionChanged.connect(onSessionChanged);\n                panel.context.sessionContext.ready.then(() => {\n                    onSessionChanged?.(panel.context.sessionContext, {\n                        name: 'session',\n                        oldValue: null,\n                        newValue: panel.context.sessionContext.session,\n                    });\n                });\n                panel.content.activeCellChanged.connect(onActiveCellChanged);\n            }\n        }\n        return () => {\n            isMounted = false;\n            // Reset the completer\n            if (completer) {\n                if (onActiveCellChanged) {\n                    panel?.content.activeCellChanged.disconnect(onActiveCellChanged);\n                }\n                if (onSessionChanged) {\n                    panel?.context.sessionContext.sessionChanged.connect(onSessionChanged);\n                }\n                completer.editor = null;\n                const inlineProvidersSettings = generateInlineProviderSettings(props.inlineProviders);\n                completer.reconciliator = new ProviderReconciliator({\n                    context: {\n                        widget: new Widget(),\n                    },\n                    providers: [new KernelCompleterProvider()],\n                    inlineProviders: props.inlineProviders,\n                    inlineProvidersSettings,\n                    timeout: COMPLETER_TIMEOUT_MILLISECONDS,\n                });\n            }\n        };\n    }, [completer, panel, tracker]);\n    useEffect(() => {\n        const onKeyDown = (event) => {\n            features.commands.processKeydownEvent(event);\n        };\n        // FIXME It would be better to add the listener to the Box wrapping the panel\n        // but this requires the use of the latest version of JupyterLab/Lumino that\n        // capture event at bubbling phase for keyboard shortcuts rather than at capture phase.\n        document.addEventListener('keydown', onKeyDown, true);\n        return () => {\n            document.removeEventListener('keydown', onKeyDown, true);\n        };\n    }, [features.commands]);\n    // Cleanup notebook from store on unmount\n    useEffect(() => {\n        return () => {\n            const currentNotebooks = notebookStore.getState().notebooks;\n            if (currentNotebooks.has(id)) {\n                const updatedNotebooks = new Map(currentNotebooks);\n                updatedNotebooks.delete(id);\n                notebookStore.getState().setNotebooks(updatedNotebooks);\n            }\n        };\n    }, [id]);\n    return (_jsxs(_Fragment, { children: [extensionComponents.map((extensionComponent, index) => {\n                return (_jsx(Box, { children: extensionComponent }, `${extensionComponent}-${index}`));\n            }), isLoading ? (_jsx(Loader, {}, \"notebook-loader\")) : panel ? (_jsx(Box, { sx: { height: '100%' }, children: _jsx(Lumino, { id: id, children: panel }, \"notebook-container\") })) : (_jsx(Banner, { variant: \"critical\", description: \"Unable to create the notebook view.\", hideTitle: true, title: \"Error\" }, \"notebook-error\"))] }));\n}\n/**\n * Get the kernel ID to connect to.\n *\n * Steps:\n * - Check the requested kernel ID exists\n * - If no kernel found, start a new one if required\n *\n * Note\n * If the hook starts the kernel, it will shut it down when unmounting.\n */\nexport function useKernelId(options = {}) {\n    const { kernel, kernels, requestedKernelId, startDefaultKernel = false, } = options;\n    // Track the kernel prop ID as a string to avoid object reference issues\n    const kernelPropId = kernel?.id;\n    // Define the kernel to be used.\n    // - Check the provided kernel id exists\n    // - If no kernel found, start a new one if required\n    const [kernelId, setKernelId] = useState(kernelPropId);\n    // Track if we started a connection (to know if we should dispose it)\n    const [startedConnection, setStartedConnection] = useState(undefined);\n    useEffect(() => {\n        let isMounted = true;\n        // If a kernel is provided via props, use its ID\n        if (kernelPropId) {\n            setKernelId(prev => (prev !== kernelPropId ? kernelPropId : prev));\n            return;\n        }\n        // No kernel provided, check if we need to find or start one\n        if (kernels) {\n            (async () => {\n                let foundKernelId;\n                await kernels.ready;\n                // Check if requested kernel exists\n                if (requestedKernelId) {\n                    for (const model of kernels.running()) {\n                        if (model.id === requestedKernelId) {\n                            foundKernelId = requestedKernelId;\n                            break;\n                        }\n                    }\n                }\n                // Start a new default kernel if none found and one requested.\n                if (!foundKernelId && startDefaultKernel && isMounted) {\n                    console.log('Starting a new default kernel.');\n                    const connection = await kernels.startNew();\n                    if (isMounted) {\n                        foundKernelId = connection.id;\n                        setKernelId(foundKernelId);\n                        setStartedConnection(connection);\n                    }\n                    else {\n                        connection.dispose();\n                    }\n                }\n                if (isMounted) {\n                    setKernelId(prev => (prev !== foundKernelId ? foundKernelId : prev));\n                }\n            })();\n        }\n        return () => {\n            isMounted = false;\n        };\n    }, [kernels, kernelPropId, requestedKernelId, startDefaultKernel]);\n    // Cleanup: shutdown the kernel we started when component unmounts\n    useEffect(() => {\n        return () => {\n            if (startedConnection) {\n                console.log(`Shutting down kernel '${startedConnection.id}'.`);\n                startedConnection\n                    .shutdown()\n                    .catch(reason => {\n                    console.warn(`Failed to shutdown kernel '${startedConnection?.id}'.`, reason);\n                })\n                    .finally(() => {\n                    startedConnection?.dispose();\n                });\n            }\n        };\n    }, [startedConnection]);\n    return kernelId;\n}\n/**\n * Hook to handle a notebook model.\n *\n * The notebook content may come from 3 sources:\n * - `nbformat`: The notebook content\n * - `url`: A URL to fetch the notebook content from\n * - `collaborationProvider`: A collaboration provider for real-time editing\n *\n * @param options - Configuration options for the notebook model\n * @returns The notebook model or null if not yet initialized\n */\nexport function useNotebookModel(options) {\n    const { collaborationProvider, nbformat, readonly = false, url, path, serviceManager, id, } = options;\n    console.log('[useNotebookModel] Hook called with options:', {\n        hasCollaborationProvider: !!collaborationProvider,\n        hasNbformat: !!nbformat,\n        readonly,\n        hasUrl: !!url,\n        path,\n        hasServiceManager: !!serviceManager,\n        id,\n    });\n    // Generate the notebook model\n    // There are three posibilities (by priority order):\n    // - Connection to a collaborative document\n    // - Provided notebook content\n    // - Provided URL to fetch notebook content from\n    const [model, setModel] = useState(null);\n    useEffect(() => {\n        console.log('[useNotebookModel] useEffect running');\n        let isMounted = true;\n        const disposable = new DisposableSet();\n        // Handle new collaboration provider\n        if (collaborationProvider && serviceManager && id) {\n            console.log('[useNotebookModel] Setting up collaboration');\n            const setupCollaboration = async () => {\n                try {\n                    const sharedModel = new YNotebook();\n                    // Connect to the collaboration provider\n                    await collaborationProvider.connect(sharedModel, id, {\n                        serviceManager,\n                        path,\n                    });\n                    if (isMounted) {\n                        console.log('[useNotebookModel] Creating collaboration model');\n                        const model = new NotebookModel({\n                            collaborationEnabled: true,\n                            disableDocumentWideUndoRedo: true,\n                            sharedModel,\n                        });\n                        model.readOnly = readonly;\n                        console.log('[useNotebookModel] Calling setModel with collaboration model');\n                        setModel(model);\n                        disposable.add({\n                            dispose: () => {\n                                collaborationProvider.disconnect();\n                            },\n                            get isDisposed() {\n                                return false;\n                            },\n                        });\n                    }\n                }\n                catch (error) {\n                    console.error('Failed to setup collaboration:', error);\n                }\n            };\n            setupCollaboration();\n        }\n        else {\n            console.log('[useNotebookModel] No collaboration, creating standard model');\n            const createModel = (nbformat) => {\n                console.log('[useNotebookModel] createModel called with nbformat:', !!nbformat);\n                try {\n                    const model = new NotebookModel();\n                    console.log('[useNotebookModel] NotebookModel created');\n                    if (nbformat) {\n                        nbformat.cells.forEach(cell => {\n                            cell.metadata['editable'] = !readonly;\n                        });\n                        console.log('[useNotebookModel] About to call model.fromJSON');\n                        model.fromJSON(nbformat);\n                        console.log('[useNotebookModel] model.fromJSON completed successfully');\n                    }\n                    model.readOnly = readonly;\n                    console.log('[useNotebookModel] Calling setModel with standard model');\n                    setModel(model);\n                }\n                catch (error) {\n                    console.error('[useNotebookModel] Error creating model:', error);\n                    throw error;\n                }\n            };\n            if (!nbformat && url) {\n                console.log('[useNotebookModel] Loading from URL:', url);\n                loadFromUrl(url).then(nbformat => {\n                    if (isMounted) {\n                        createModel(nbformat);\n                    }\n                });\n            }\n            else {\n                console.log('[useNotebookModel] Creating model directly (nbformat provided or no URL)');\n                createModel(nbformat);\n            }\n        }\n        return () => {\n            isMounted = false;\n            disposable.dispose();\n        };\n    }, [\n        collaborationProvider,\n        nbformat,\n        readonly,\n        url,\n        path,\n        serviceManager,\n        id,\n    ]);\n    console.log('[useNotebookModel] Returning model:', !!model);\n    return model;\n}\nasync function loadFromUrl(url) {\n    return fetch(url)\n        .then(response => {\n        return response.text();\n    })\n        .then(nb => {\n        return JSON.parse(nb);\n    });\n}\n/**\n * Common immutable JupyterLab features required for the notebook panel.\n */\nclass CommonFeatures {\n    _commands;\n    _editorServices;\n    _rendermime;\n    constructor(options = {}) {\n        this._commands = options.commands ?? new CommandRegistry();\n        const languages = new EditorLanguageRegistry();\n        // Register default languages.\n        for (const language of EditorLanguageRegistry.getDefaultLanguages()) {\n            languages.addLanguage(language);\n        }\n        // Add Jupyter Markdown flavor here to support code block highlighting.\n        languages.addLanguage({\n            name: 'ipythongfm',\n            mime: 'text/x-ipythongfm',\n            load: async () => {\n                // TODO: add support for LaTeX.\n                const m = await import('@codemirror/lang-markdown');\n                return m.markdown({\n                    codeLanguages: (info) => languages.findBest(info),\n                });\n            },\n        });\n        const initialFactories = standardRendererFactories\n            .filter(factory => factory.mimeTypes[0] !== 'text/javascript')\n            .concat([jsonRendererFactory, javascriptRendererFactory])\n            .concat(options.renderers ?? []);\n        this._rendermime = new RenderMimeRegistry({\n            initialFactories,\n            latexTypesetter: new MathJaxTypesetter(),\n            markdownParser: createMarkdownParser(languages),\n        });\n        const mimeTypeService = new CodeMirrorMimeTypeService(languages);\n        const themes = new EditorThemeRegistry();\n        for (const theme of EditorThemeRegistry.getDefaultThemes()) {\n            themes.addTheme(theme);\n        }\n        const editorExtensions = new EditorExtensionRegistry();\n        for (const extensionFactory of EditorExtensionRegistry.getDefaultExtensions({ themes })) {\n            editorExtensions.addExtension(extensionFactory);\n        }\n        editorExtensions.addExtension({\n            name: 'shared-model-binding',\n            factory: options => {\n                const sharedModel = options.model.sharedModel;\n                return EditorExtensionRegistry.createImmutableExtension(ybinding({\n                    ytext: sharedModel.ysource,\n                    undoManager: sharedModel.undoManager ?? undefined,\n                }));\n            },\n        });\n        editorExtensions.addExtension({\n            name: 'remote-user-cursors',\n            factory(options) {\n                const { awareness, ysource: ytext } = options.model.sharedModel;\n                return EditorExtensionRegistry.createImmutableExtension(remoteUserCursors({ awareness, ytext }));\n            },\n        });\n        // Fix to deal with Content Security Policy\n        const nonce = getNonce();\n        if (nonce) {\n            editorExtensions.addExtension({\n                name: 'csp-nonce',\n                factory() {\n                    return EditorExtensionRegistry.createImmutableExtension(EditorView.cspNonce.of(nonce));\n                },\n            });\n        }\n        const factoryService = new CodeMirrorEditorFactory({\n            extensions: editorExtensions,\n            languages: languages,\n        });\n        this._editorServices = {\n            factoryService,\n            mimeTypeService,\n        };\n    }\n    get commands() {\n        return this._commands;\n    }\n    get editorServices() {\n        return this._editorServices;\n    }\n    get rendermime() {\n        return this._rendermime;\n    }\n}\n/**\n * Dummy notebook factory\n *\n * It returns the provided notebook model.\n */\nclass DummyModelFactory extends NotebookModelFactory {\n    model;\n    constructor(model) {\n        super();\n        this.model = model;\n    }\n    createNew(options) {\n        return this.model;\n    }\n}\nfunction initializeContext(context, id, path, onSessionConnection, serverLess = false) {\n    const shuntContentManager = path ? false : true;\n    // TODO we should implement our own thing rather this Javascript patch.\n    // These are fixes on the Context and the SessionContext to have more control on the kernel launch.\n    context.sessionContext._initialize = async () => {\n        const manager = context.sessionContext.sessionManager;\n        await manager.ready;\n        await manager.refreshRunning();\n        const model = find(manager.running(), model => {\n            return (model.kernel?.id === (context.sessionContext.kernelPreference.id ?? ''));\n        });\n        if (model) {\n            try {\n                const session = manager.connectTo({\n                    model: {\n                        ...model,\n                        path: path ?? model.path,\n                        name: path ?? model.name,\n                    },\n                    kernelConnectionOptions: {\n                        handleComms: true,\n                    },\n                });\n                context.sessionContext._handleNewSession(session);\n                // TODO Dispose the previous KernelConnection to avoid errors with Comms.\n                // this._kernel?.connection?.dispose();\n            }\n            catch (err) {\n                void context.sessionContext._handleSessionError(err);\n                return Promise.reject(err);\n            }\n        }\n        return await context.sessionContext._startIfNecessary();\n    };\n    // Custom dispose that does not dispose the model\n    context.dispose = () => {\n        if (context.isDisposed) {\n            return;\n        }\n        context._isDisposed = true;\n        context.sessionContext.dispose();\n        context._disposed.emit(void 0);\n        Signal.clearData(this);\n    };\n    if (shuntContentManager) {\n        // If nbformat is provided and we don't want to interact with the Content Manager.\n        context._populate = async () => {\n            context._isPopulated = true;\n            context._isReady = true;\n            context._populatedPromise.resolve(void 0);\n            // Add a checkpoint if none exists and the file is writable.\n            // Force skip this step for nbformat notebooks.\n            // await (context as any)._maybeCheckpoint(false);\n            if (context.isDisposed) {\n                return;\n            }\n            // Update the kernel preference.\n            const name = context._model.defaultKernelName ||\n                context.sessionContext.kernelPreference.name;\n            context.sessionContext.kernelPreference = {\n                ...context.sessionContext.kernelPreference,\n                name,\n                language: context._model.defaultKernelLanguage,\n            };\n            if (!serverLess) {\n                // Note: we don't wait on the session to initialize\n                // so that the user can be shown the content before\n                // any kernel has started.\n                void context.sessionContext\n                    .initialize()\n                    .then((shouldSelect) => {\n                    if (shouldSelect) {\n                        void context._dialogs.selectKernel(context.sessionContext.sessionContext);\n                    }\n                });\n            }\n        };\n        context.initialize = async (isNew) => {\n            context.model.dirty = false;\n            const now = new Date().toISOString();\n            const model = {\n                path: id,\n                name: id,\n                type: 'notebook',\n                content: undefined,\n                writable: true,\n                created: now,\n                last_modified: now,\n                mimetype: 'application/x-ipynb+json',\n                format: 'json',\n            };\n            context._updateContentsModel(model);\n            await context._populate();\n            context.model.sharedModel.clearUndoHistory();\n        };\n    }\n    // Connect signals\n    context.sessionContext.sessionChanged.connect((_, args) => {\n        const session = args.newValue;\n        console.log('Current Jupyter Session Connection.', session);\n        onSessionConnection?.(session ?? undefined);\n    });\n    context.sessionContext.kernelChanged.connect((_, args) => {\n        const kernelConnection = args.newValue;\n        console.log('Current Jupyter Kernel Connection.', kernelConnection);\n        if (kernelConnection && !kernelConnection.handleComms) {\n            console.log('Updating the current Kernel Connection to enforce Comms support.', kernelConnection.handleComms);\n            kernelConnection.handleComms = true;\n        }\n    });\n    context.sessionContext.ready.then(() => {\n        onSessionConnection?.(context?.sessionContext.session ?? undefined);\n    });\n    // Initialize the context\n    context.initialize(path ? false : true);\n}\n/**\n * Service manager facade for missing manager.\n */\nclass NoServiceManager {\n    contents = Object.freeze({\n        fileChanged: { connect: () => { } },\n        getSharedModelFactory(path) {\n            return null;\n        },\n        localPath(path) {\n            const parts = path.split('/');\n            const firstParts = parts[0].split(':');\n            if (firstParts.length === 1 ||\n                !this._additionalDrives.has(firstParts[0])) {\n                return PathExt.removeSlash(path);\n            }\n            return PathExt.join(firstParts.slice(1).join(':'), ...parts.slice(1));\n        },\n        normalize(path) {\n            const parts = path.split(':');\n            if (parts.length === 1) {\n                return PathExt.normalize(path);\n            }\n            return `${parts[0]}:${PathExt.normalize(parts.slice(1).join(':'))}`;\n        },\n    });\n    kernelspecs = Object.freeze({\n        // Ever hanging promise.\n        ready: new Promise(() => { }),\n    });\n    sessions = Object.freeze({\n        // Ever hanging promise.\n        ready: new Promise(() => { }),\n    });\n    // Always ready otherwise the spinner in the MainAreaWidget won't be discarded.\n    ready = Promise.resolve();\n}\n/**\n * Returns the nonce used in the page, if any.\n *\n * Based on https://github.com/cssinjs/jss/blob/master/packages/jss/src/DomRenderer.js\n */\nfunction getNonce() {\n    const node = document.querySelector('meta[property=\"csp-nonce\"]');\n    if (node) {\n        return node.getAttribute('content');\n    }\n    else {\n        return null;\n    }\n}\n//# sourceMappingURL=NotebookBase.js.map","import { jsx as _jsx, jsxs as _jsxs } from \"react/jsx-runtime\";\n/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\nimport { useEffect, useState } from 'react';\nimport { createGlobalStyle } from 'styled-components';\nimport { Box } from '@datalayer/primer-addons';\nimport { Loader } from '../utils';\nimport { useKernelId, useNotebookModel, NotebookBase } from './NotebookBase';\nimport './Notebook.css';\nconst GlobalStyle = createGlobalStyle `\n  .dla-Box-Notebook .jp-Cell .dla-CellSidebar-Container {\n    display: none;\n  }\n  .dla-Box-Notebook .jp-Cell.jp-mod-active .dla-CellSidebar-Container {\n    display: block;\n  }\n`;\n/**\n * Simple notebook component without adapter and stores.\n *\n * Notes:\n * - You must provide the appropriate service manager\n * - You can specify the kernel id to use; if it is not defined or empty and startDefaultKernel is true, a new kernel will be started.\n */\nexport function Notebook(props) {\n    const { Toolbar, cellSidebarMargin = 120, children, collaborationProvider, commands, extensions, height = '100vh', id, inlineProviders, kernel, maxHeight = '100vh', nbformat, onNotebookModelChanged, onSessionConnection, path, readonly = false, renderers, serviceManager, startDefaultKernel = false, url, } = props;\n    const [isLoading, setIsLoading] = useState(true);\n    const kernelId = useKernelId({\n        kernel,\n        kernels: serviceManager.kernels,\n        requestedKernelId: props.kernelId,\n        startDefaultKernel,\n    });\n    const model = useNotebookModel({\n        collaborationProvider,\n        nbformat,\n        readonly,\n        url,\n        path,\n        serviceManager,\n        id,\n    });\n    useEffect(() => {\n        console.log('[Notebook] useEffect - model changed:', {\n            model: !!model,\n            isLoading,\n        });\n        if (model) {\n            console.log('[Notebook] Setting isLoading to false');\n            setIsLoading(false);\n        }\n        onNotebookModelChanged?.(model);\n    }, [model, onNotebookModelChanged]);\n    useEffect(() => {\n        // Set user identity if collaborating using Jupyter collaboration\n        const setUserIdentity = () => {\n            if (collaborationProvider && model) {\n                // Yjs details are hidden from the interface\n                model.sharedModel.awareness.setLocalStateField('user', serviceManager.user.identity);\n            }\n        };\n        setUserIdentity();\n        serviceManager.user.userChanged.connect(setUserIdentity);\n        return () => {\n            serviceManager.user.userChanged.disconnect(setUserIdentity);\n        };\n    }, [collaborationProvider, model, serviceManager]);\n    console.log('[Notebook] Rendering:', {\n        isLoading,\n        hasModel: !!model,\n        hasServiceManager: !!serviceManager,\n        hasInlineProviders: !!inlineProviders,\n    });\n    return isLoading ? (_jsx(Loader, {}, \"notebook-loader\")) : (_jsxs(Box, { style: { height, width: '100%', position: 'relative' }, id: \"dla-Jupyter-Notebook\", children: [Toolbar && _jsx(Toolbar, { notebookId: id }), _jsxs(Box, { className: \"dla-Box-Notebook\", sx: {\n                    height,\n                    maxHeight,\n                    width: '100%',\n                    overflowY: 'hidden',\n                    '& .datalayer-NotebookPanel-header': {\n                        minHeight: '50px',\n                    },\n                    '& .jp-Notebook': {\n                        flex: '1 1 auto !important',\n                        height: '100%',\n                        overflowY: 'scroll',\n                    },\n                    '& .jp-NotebookPanel': {\n                    //            height: '100% !important',\n                    //            width: '100% !important',\n                    },\n                    '& .jp-Toolbar': {\n                        display: 'none',\n                        zIndex: 0,\n                    },\n                    '& .jp-Toolbar .jp-HTMLSelect.jp-DefaultStyle select': {\n                        fontSize: '14px',\n                    },\n                    '& .jp-Toolbar > .jp-Toolbar-responsive-opener': {\n                        display: 'none',\n                    },\n                    '& .jp-Toolbar-kernelName': {\n                        display: 'none',\n                    },\n                    '& .jp-Cell': {\n                        width: `calc(100% - ${cellSidebarMargin}px)`,\n                    },\n                    '& .jp-Notebook-footer': {\n                        width: `calc(100% - ${cellSidebarMargin + 82}px)`,\n                    },\n                    '& .jp-CodeMirrorEditor': {\n                        cursor: 'text !important',\n                    },\n                    '.dla-Box-Notebook': {\n                        position: 'relative',\n                    },\n                }, children: [children, _jsx(GlobalStyle, {}), model && serviceManager && (_jsx(NotebookBase, { commands: commands, id: id, extensions: extensions, inlineProviders: inlineProviders, kernelId: kernelId, model: model, path: path, renderers: renderers, serviceManager: serviceManager, onSessionConnection: onSessionConnection }))] })] }));\n}\n//# sourceMappingURL=Notebook.js.map","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\n/**\n * Notebook Chunk - Contains all Notebook-related dependencies\n * This chunk is loaded on-demand when a Notebook component is needed\n */\n\nimport React from 'react';\nimport {\n  JupyterReactTheme,\n  Notebook,\n  useJupyter,\n} from '@datalayer/jupyter-react';\nimport { getJupyterEmbedConfig } from '../config';\nimport type { INotebookEmbedOptions } from '../types';\n\n/**\n * Hook to get Jupyter context from embed config\n */\nconst useJupyterEmbed = () => {\n  const config = getJupyterEmbedConfig();\n  return useJupyter({\n    jupyterServerUrl: config.serverUrl || '',\n    jupyterServerToken: config.token || '',\n    startDefaultKernel: config.autoStartKernel,\n    defaultKernelName: config.defaultKernel,\n    terminals: true,\n  });\n};\n\ninterface INotebookChunkProps {\n  options: INotebookEmbedOptions;\n}\n\nconst NotebookInner: React.FC<INotebookChunkProps> = ({ options }) => {\n  const { serviceManager, defaultKernel } = useJupyterEmbed();\n  const nbformat =\n    typeof options.content === 'object' ? options.content : undefined;\n  const height = options.height || '500px';\n\n  if (!serviceManager) {\n    return (\n      <div style={{ \n        display: 'flex', \n        alignItems: 'center', \n        justifyContent: 'center',\n        height,\n        color: '#656d76',\n      }}>\n        Connecting to Jupyter server...\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ height }}>\n      <Notebook\n        id={options.id || 'embedded-notebook'}\n        path={options.path}\n        nbformat={nbformat as any}\n        readonly={options.readonly}\n        serviceManager={serviceManager}\n        kernel={defaultKernel}\n        height={height}\n      />\n    </div>\n  );\n};\n\nexport const NotebookChunk: React.FC<INotebookChunkProps> = ({ options }) => {\n  return (\n    <JupyterReactTheme>\n      <NotebookInner options={options} />\n    </JupyterReactTheme>\n  );\n};\n\nexport default NotebookChunk;\n"],"names":["editorAwarenessFacet","Facet","define","combine","configs","length","remoteSelectionTheme","EditorView","baseTheme","borderLeft","marginLeft","borderLeftWidth","opacity","border","color","padding","remoteSelectionsAnnotation","Annotation","RemoteMarker","style","marker","constructor","this","draw","elt","key","value","Object","entries","eq","other","JSONExt","deepEqual","update","dom","oldMarker","remoteCursorsLayer","layer","above","markers","view","awareness","ytext","state","facet","ydoc","doc","cursors","getStates","forEach","clientID","cursors_","cursor","anchor","head","createAbsolutePositionFromRelativePosition","type","className","primary","cursor_","EditorSelection","index","piece","RectangleMarker","forRange","push","borderLeftColor","user","transactions","find","t","annotation","class","getCursorTooltips","tooltips","Array","pos","create","document","createElement","classList","add","backgroundColor","textContent","display_name","remoteCursorTooltipField","StateField","tr","provide","field","showTooltip","computeN","remoteSelectionLayer","empty","range","showCollaborators","ViewPlugin","fromClass","editorAwareness","_listener","added","updated","removed","concat","findIndex","id","dispatch","annotations","of","on","destroy","off","docChanged","selectionSet","localAwarenessState","getLocalState","hasFocus","ownerDocument","selection","r","ranges","main","createRelativePositionFromTypeIndex","oldCursors","map","createRelativePositionFromJSON","setLocalStateField","position","parent","body","YNotebook","YDocument","options","_a","super","version","ymeta","getMap","_onMetaChanged","events","metadataEvents","event","target","get","metadataChange","changes","keys","ymetadata","change","action","_metadataChanged","emit","newValue","oldValue","equal","_changed","metaEvent","keysChanged","has","Map","metadata","set","getMetadata","nbformatChanged","nbformat","nbformat_minor","_onYCellsChanged","item","content","_ycellMapping","c","createCellModelFromSharedType","notebook","deleted","model","dispose","delete","cellsChange","delta","d","insert","insertedCells","ycell","cells","splice","retain","Signal","_ycells","getArray","WeakMap","_disableDocumentWideUndoRedo","disableDocumentWideUndoRedo","toArray","undoManager","addToScope","observe","observeDeep","_b","_c","_d","_e","_f","_g","_h","_j","ynotebook","data","fromJSON","v","setMetadata","metadataChanged","transact","isDisposed","unobserve","unobserveDeep","getCell","addCell","cell","insertCell","insertCells","yCells","createCell","ymodel","moveCell","fromIndex","toIndex","moveCells","n","clones","fill","_","idx","toJSON","clone","deleteCell","deleteCellRange","from","to","deleteMetadata","allMetadata","deepCopy","TypeError","updateMetadata","clear","getSource","setSource","Y.Map","useId","ycells","pruneCellId","raw","CellList","_cellMap","_isDisposed","_insertCells","changed","connect","_onSharedModelChanged","Symbol","iterator","clearData","sharedModel","cellModel","cell_type","CodeCellModel","MarkdownCellModel","RawCellModel","disposed","self","currpos","newIndex","newValues","oldIndex","oldValues","msg","NotebookHistory","_requestBatchSize","_cursor","_hasSession","_history","_placeholder","_kernelSession","_setByHistory","_editor","_filtered","_kernel","_sessionContext","sessionContext","_trans","translator","nullTranslator","load","_handleKernel","then","kernelChanged","_toRequest","editor","prev","disconnect","onTextChange","placeholder","kernelSession","checkSession","activeCell","_retrieveHistory","setFilter","back","fetchBatch","Math","max","forward","min","updateEditor","source","columnPos","indexOf","setCursorPosition","line","column","reset","oldFilteredReversed","slice","reverse","oldHistory","cursorOffset","filteredReversed","i","ij","onHistory","last","current","status","history","session","kernel","catch","requestHistory","output","hist_access_type","console","warn","__","filterStr","NotebookModel","standaloneModel","_dirty","_readOnly","_contentChanged","_stateChanged","nbformat.MAJOR_VERSION","nbformat.MINOR_VERSION","kernelspec","name","language_info","languagePreference","_cells","_deletedCells","_collaborationEnabled","collaborationEnabled","_onCellsChanged","_onStateChanged","_onMetadataChanged","contentChanged","stateChanged","dirty","triggerStateChange","readOnly","nbformatMinor","defaultKernelName","spec","deletedCells","defaultKernelLanguage","info","collaborative","toString","JSON","stringify","fromString","parse","_ensureMetadata","copy","origNbformat","orig_nbformat","showDialog","title","buttons","Dialog","okButton","label","trusted","list","triggerContentChange","sender","stateChange","languageName","args","NotebookModelFactory","_disposed","_collaborative","contentType","fileFormat","createNew","preferredLanguage","path","Context","_isReady","_isPopulated","_path","_lineEnding","_contentsModel","_populatedPromise","PromiseDelegate","_pathChanged","_fileChanged","_saveState","_lastModifiedCheckMargin","_conflictModalIsOpen","manager","_manager","_contentProviderId","contentProviderId","_factory","factory","_dialogs","sessionDialogs","SessionContextDialogs","_opener","opener","Private","noOp","contents","normalize","lastModifiedCheckMargin","localPath","lang","PathExt","basename","sharedFactory","getSharedModelFactory","format","_model","_readyPromise","ready","promise","ext","extname","SessionContext","kernelManager","kernels","sessionManager","sessions","specsManager","kernelspecs","kernelPreference","shouldStart","setBusy","propertyChanged","_onSessionChanged","fileChanged","_onFileChanged","urlResolverFactory","createResolver","resolverOptions","RenderMimeRegistry","UrlResolver","_urlResolver","pathChanged","saveState","contentsModel","factoryName","isReady","canSave","writable","urlResolver","initialize","isNew","_save","_revert","clearUndoHistory","rename","newName","_rename","save","saveAs","newLocalPath","getSavePath","drive","driveName","newPath","_maybeOverWrite","err","response","_finishSaveAs","download","url","getDownloadUrl","element","href","appendChild","click","removeChild","revert","createCheckpoint","deleteCheckpoint","checkpointId","restoreCheckpoint","listCheckpoints","checkpoints","addSibling","widget","DisposableDelegate","close","_updateContentsModel","oldPath","changeModel","replace","RegExp","last_modified","created","_updatePath","newModel","mimetype","hash","hash_algorithm","mod","setPath","setName","_populate","resolve","_maybeCheckpoint","language","shouldSelect","selectKernel","splitPath","split","join","_createSaveOptions","_maybeSave","file","_handleError","initializeModel","opts","async","Promise","reject","Error","hashAvailable","hClient","hDisk","_raiseConflict","modified","tClient","Date","tDisk","getTime","showErrorMessage","force","error","revertBtn","actions","overwriteBtn","warnButton","cancelButton","result","button","includes","accept","message","trans","saveBtn","SaveWidget","Widget","node","createSaveNode","getValue","input","NotebookTracker","WidgetTracker","arguments","_activeCell","_activeCellChanged","_selectionChanged","currentWidget","activeCellChanged","selectionChanged","panel","_onActiveCellChanged","_onSelectionChanged","onCurrentChanged","NotebookWidgetFactory","ABCWidgetFactory","rendermime","contentFactory","mimeTypeService","_editorConfig","editorConfig","StaticNotebook","defaultEditorConfig","_notebookConfig","notebookConfig","defaultNotebookConfig","createNewWidget","context","kernelHistory","nbOptions","resolver","createNotebook","NotebookPanel","window","base","controls","LabWidgetManager","ManagerBase","_rendermime","requireJsScript","cdnOnlyScript","setAttribute","src","onload","_registry","SemVerCache","register","base.JUPYTER_WIDGETS_VERSION","exports","import","controls.JUPYTER_CONTROLS_VERSION","e","callbacks","iopub","_onUnhandledIOPubMessage","registerWithKernel","kernelConnection","_commRegistration","registerCommTarget","comm_target_name","_handleCommOpen","_handleKernelChanged","removeCommTarget","_restoredStatus","_loadFromKernel","handleComms","filterExistingModelState","serialized_state","_create_comm","target_name","model_id","buffers","comm","createComm","open","shims","services","Comm","_get_comm_info","reply","requestCommInfo","comms","resolveUrl","loadClass","moduleName","moduleVersion","valid","allVersions","_getRegistry","getAllVersions","semanticVersion","module","requireLoader","widgetRegistryData","replaceAll","registeredVersionList","cls","restored","_restored","restoredStatus","onUnhandledIOPubMessage","register_model","modelPromise","_modelsSync","once","clear_state","get_state_sync","models","values","comm_live","serialize_state","oldComm","handle_comm_open","_kernelRestoreInProgress","WidgetManager","settings","_context","statusChanged","_handleKernelStatusChange","connectionStatusChanged","_handleKernelConnectionStatusChange","restoreWidgets","_settings","drop_defaults","loadKernel","loadNotebook","_loadFromNotebook","widgets","WIDGET_STATE_MIMETYPE","set_state","partial","setDirty","WidgetLabRenderer","Panel","mimeType","_rerender","renderModel","hide","wModel","get_model","addClass","_rerenderMimeModel","create_view","luminoWidget","addWidget","removeClass","STREAMING_INDICATOR_CLASS","ERROR_INDICATOR_CLASS","GhostTextManager","placeGhost","text","effects","addMark","markField","StateEffect","appendConfig","domEventHandlers","blur","onBlur","removeMark","setTimeout","clearGhosts","streamingAnimation","spacerRemovalDelay","spacerRemovalDuration","GhostTextWidget","WidgetType","isSpacer","_clearErrorTimeout","streaming","lineBreaks","match","updateDOM","_view","_updateDOM","toDOM","wrap","onPointerOver","addEventListener","onPointerLeave","dataset","animation","providedBy","providerId","_removeErrorAnimation","querySelectorAll","remove","_mountErrorAnimation","errorIndicator","clearTimeout","hiddenContent","addition","addedPart","startsWith","substring","maxLines","lines","minLines","Infinity","linesToAdd","placeHolderLines","innerText","streamedTokenHost","hiddenWrapper","expandOnHover","hiddenPart","streamingIndicator","placeholderLinesNode","createTextNode","removeEventListener","TransientSpacerWidget","TransientLineSpacerWidget","animationDelay","animationDuration","TransientLetterSpacerWidget","GhostAction","createWidget","Decoration","side","ghostSpec","newDoc","old","mapPos","none","marks","is","Set","Remove","FilterAndUpdate","chooseAction","filter","_from","_to","timeoutInfo","elapsed","newWidget","iter","next","originalSpec","shouldRemoveGhost","iterChanges","fromA","toA","fromB","toB","inserted","lineNumber","lineContent","lineAt","newWidgets","timeout","characterSpacer","lineSpacer","createSpacer","f","decorations","INLINE_COMPLETER_ACTIVE_CLASS","HOVER_CLASS","InlineCompleter","_clearHoverTimeout","_current","_lastItem","_providerWidget","_showShortcuts","defaultSettings","showShortcuts","_showWidget","showWidget","_suggestionsCounter","_toolbar","Toolbar","_ghostManager","_onEditorBlur","bind","layout","PanelLayout","toolbar","_progressBar","_updateShortcutsVisibility","_updateDisplay","tabIndex","suggestionsChanged","_onModelSuggestionsChanged","filterTextChanged","_onModelFilterTextChanged","provisionProgress","_onProvisionProgress","cycle","direction","items","completions","proposed","_updateStreamTracking","_render","candidate","insertText","cursorBeforeChange","getOffsetAt","getCursorPosition","start","stream","_onStream","_emitter","_change","isHidden","_setText","configure","editorResizeDelay","_minLines","_maxLines","_reserveSpaceForLongest","reserveSpaceForLongest","_suppressIfTabCompleterActive","suppressIfTabCompleterActive","isActive","host","contains","handleEvent","_evtPointerdown","_evtScroll","onUpdateRequest","show","_setGeometry","onAfterAttach","onBeforeDetach","requestAnimationFrame","relatedTarget","isAttached","indexMap","mapping","progress","pendingProviders","display","width","totalProviders","provider","icon","kernelIcon","render","longest","identifier","lastStreamed","_onPointerOverGhost","_onPointerLeaveGhost","closest","maybeAnchor","getCoordinateForPosition","HoverBox","setGeometry","maxHeight","minHeight","privilege","outOfViewDisplay","top","bottom","left","right","Loader","props","_jsx","Box","sx","alignItems","justifyContent","zIndex","children","_jsxs","_Fragment","mr","Spinner","size","Heading","fontSize","providers","Model","_completions","setCompletions","previousPositions","appendCompletions","notifyProgress","handleTextChange","sourceChange","originalPositions","filterText","handleSelectionChange","initialCursor","end","FENCE","createMarkdownParser","languages","_initializing","_marked","_blocks","_languages","_markedOptions","_highlights","LruCache","initializeMarked","blocks","sort","a","b","rank","marked","Renderer","plugins","all","loadMarkedPlugins","plugin","use","gfm","walkTokens","renderer","makeRenderer","gfmHeadingId","mangle","Renderer_","originalCode","code","escaped","block","rendered","highlight","call","token","walk","el","findBest","html","innerHTML","Diff","diff","oldStr","newStr","callback","oldString","castInput","newString","oldTokens","removeEmpty","tokenize","newTokens","diffWithOptionsObj","done","postProcess","newLen","oldLen","editLength","maxEditLength","maxExecutionTime","abortAfterTimestamp","now","bestPath","oldPos","lastComponent","newPos","extractCommon","buildValues","minDiagonalToConsider","maxDiagonalToConsider","execEditLength","diagonalPath","basePath","removePath","addPath","canAdd","addPathNewPos","canRemove","addToPath","exec","ret","oldPosInc","oneChangePerToken","count","previousComponent","commonCount","equals","comparator","ignoreCase","toLowerCase","array","chars","changeObjects","useLongestToken","components","nextComponent","componentLen","componentPos","component","lineDiff","ignoreWhitespace","newlineIsToken","trim","ignoreNewlineAtEof","endsWith","diffLines","stripTrailingCr","retLines","linesAndNewlines","pop","structuredPatch","oldFileName","newFileName","oldHeader","newHeader","optionsObj","diffLinesResultToPatch","assign","patch","contextLines","entry","hunks","oldRangeStart","newRangeStart","curRange","oldLine","newLine","splitLines","contextSize","hunk","oldStart","oldLines","newStart","newLines","formatPatch","isArray","createPatch","fileName","patchObj","createTwoFilesPatch","hasTrailingNl","NotebookAdapter","_commands","_panel","_notebook","_defaultCellType","_kernelInfo","commands","kernelInfo","fetchKernelInfo","assignKernel","changeKernel","setDefaultCellType","cellType","defaultCellType","insertAbove","NotebookActions","changeCellType","mode","insertBelow","deleteCells","undo","redo","setActiveCell","cellCount","activeCellIndex","getCells","log","cellData","outputs","sourceLength","readAllCells","execution_count","executionCount","preview","getCellCount","insertAt","cellIndex","sourcePreview","currentActiveCell","actualIndex","originalIndex","targetIndex","currentIndex","indices","sortedIndices","updateCell","oldSource","Diff.createPatch","includeOutputs","runCell","params","run","outputObj","output_type","ename","evalue","traceback","runAllCells","execute","NotebookCommandIds","runAll","clearAllOutputs","executeCode","success","future","requestExecute","stop_on_error","store_history","silent","allow_stdin","onIOPub","msgType","header","msg_type","timeoutMs","executionPromise","timeoutPromise","race","timeoutError","interrupt","interruptError","String","COMPLETER_TIMEOUT_MILLISECONDS","DEFAULT_EXTENSIONS","FALLBACK_NOTEBOOK_PATH","generateInlineProviderSettings","providerSchema","schema","default","enabled","debouncerDelay","autoFillInMiddle","NotebookBase","extensions","kernelId","renderers","serviceManager","onSessionConnection","hasInlineProviders","inlineProviders","inlineProvidersCount","isLoading","setIsLoading","useState","extensionComponents","setExtensionComponents","completer","setCompleter","adapter","setAdapter","useMemo","newUuid","features","CommonFeatures","ContentFactory","editorFactory","editorServices","factoryService","newInlineEditor","useEffect","Completer","CompleterModel","inlineProvidersSettings","reconciliator","ProviderReconciliator","KernelCompleterProvider","inlineCompleter","providerSettings","attach","handleKeyDown","shiftKey","ctrlKey","metaKey","altKey","preventDefault","stopPropagation","cleanupKeyboard","_keyboardCleanup","handler","CompletionHandler","widgetFactory","setWidgetFactory","thisFactory","modelName","fileTypes","defaultFor","preferKernel","autoStartDefault","canStartKernel","shutdownOnClose","recordTiming","panelProvider","NotebookPanelProvider","tracker","setTracker","thisTracker","namespace","addNotebookCommands","setContext","DummyModelFactory","thisContext","NoServiceManager","canStart","shutdownOnDispose","serverLess","shuntContentManager","_initialize","refreshRunning","running","connectTo","kernelConnectionOptions","_handleNewSession","_handleSessionError","_startIfNecessary","toISOString","sessionChanged","initializeContext","reason","setPanel","thisPanel","thisAdapter","widgetsManager","extension","init","notebookId","notebookRenderers","addFactory","safe","mimeTypes","WIDGET_MIMETYPE","defaultRank","createRenderer","codecell","outputArea","currentNotebooks","notebookStore","getState","notebooks","updatedNotebooks","portals","setNotebooks","isMounted","onActiveCellChanged","onSessionChanged","sessionForCompletion","hasEditor","hasSession","usingDummySession","onKeyDown","processKeydownEvent","extensionComponent","height","Lumino","Banner","variant","description","hideTitle","useNotebookModel","collaborationProvider","readonly","hasCollaborationProvider","hasNbformat","hasUrl","hasServiceManager","setModel","disposable","DisposableSet","setupCollaboration","createModel","fetch","nb","loadFromUrl","_editorServices","CommandRegistry","EditorLanguageRegistry","getDefaultLanguages","addLanguage","mime","ap","markdown","codeLanguages","initialFactories","standardRendererFactories","jsonRendererFactory","javascriptRendererFactory","latexTypesetter","MathJaxTypesetter","markdownParser","CodeMirrorMimeTypeService","themes","EditorThemeRegistry","theme","getDefaultThemes","addTheme","editorExtensions","EditorExtensionRegistry","extensionFactory","getDefaultExtensions","addExtension","createImmutableExtension","ybinding","ysource","config","nonce","querySelector","getAttribute","getNonce","cspNonce","CodeMirrorEditorFactory","freeze","parts","firstParts","_additionalDrives","removeSlash","GlobalStyle","createGlobalStyle","Notebook","cellSidebarMargin","onNotebookModelChanged","startDefaultKernel","requestedKernelId","kernelPropId","setKernelId","startedConnection","setStartedConnection","foundKernelId","connection","startNew","shutdown","finally","useKernelId","setUserIdentity","identity","userChanged","hasModel","overflowY","flex","NotebookInner","defaultKernel","getJupyterEmbedConfig","useJupyter","jupyterServerUrl","serverUrl","jupyterServerToken","autoStartKernel","terminals","useJupyterEmbed","jsx","NotebookChunk","JupyterReactTheme"],"mappings":"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","x_google_ignoreList":[1,2,3,4,5,6,7,8,11,12,14,15,16,17]}