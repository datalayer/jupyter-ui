import{a as e,t,j as n}from"./vendor-react-Bc3S_DuI.js";import{getJupyterEmbedConfig as s}from"../jupyter-embed.lazy.js";import{B as a}from"./vendor-primer-BmSALTY4.js";import{n as o,V as i,x as r,D as l,T as c,F as d,G as u,H as h,K as m,U as p,L as _,W as g,N as C,Q as y,X as x,Y as k,Z as w,j as S,h as f,_ as v,$ as j,m as K,E as b,a0 as I,s as N,g as M,e as E,k as D,i as T,a1 as B,a2 as A,a3 as L,a as O,y as P,c as W,a4 as R,J as z}from"./JupyterReactTheme-CX3WbnDJ.js";import{C as F}from"./factory-BucVdXsD.js";import{C as J}from"./mimetype-WrG96ErW.js";import"./vendor-codemirror-OzOnFEf0.js";import{M as $}from"./index-49nYpSCp.js";import{C as U,e as H}from"./OutputExecutor-acninrYJ.js";import{r as V,W as q,b as G}from"./index-V6IoXEpD.js";import{g as Q}from"./marked-BQg5Jj21.js";import{C as X,a as Y,P as Z,K as ee,b as te}from"./kernelprovider-D2ZPVQRu.js";import{R as ne,L as se}from"./Lumino-D6-gHQxh.js";import{u as ae}from"./JupyterUse-0A4JMZk-.js";function oe(t){const{title:n,source:s,className:a,...o}=t;return e.createElement("span",{className:a?`jp-StatusBar-TextItem ${a}`:"jp-StatusBar-TextItem",title:n,...o},s)}var ie;function re(e){const t=(e=e||o).load("jupyterlab");return{unknown:t.__("Unknown"),starting:t.__("Starting"),idle:t.__("Idle"),busy:t.__("Busy"),terminating:t.__("Terminating"),restarting:t.__("Restarting"),autorestarting:t.__("Autorestarting"),dead:t.__("Dead"),connected:t.__("Connected"),connecting:t.__("Connecting"),disconnected:t.__("Disconnected"),initializing:t.__("Initializing"),"":""}}function le(e){const n=(e.translator||o).load("jupyterlab");let s="";return e.status&&(s=` | ${e.status}`),t.createElement(oe,{role:"button","aria-haspopup":!0,onClick:e.handleClick,onKeyDown:e.handleKeyDown,source:`${e.kernelName}${s}`,title:n.__("Change kernel for %1",e.activityName),tabIndex:0})}(ie||(ie={})).statusItemDefaults={align:"left",rank:0,priority:0,isActive:()=>!0,activeStateChanged:void 0};class ce extends l{constructor(e,t){super(new ce.Model(t)),this.translator=t||o,this._handleClick=e.onClick,this._handleKeyDown=e.onKeyDown,this.addClass("jp-mod-highlighted")}render(){return null===this.model?null:t.createElement(le,{status:this.model.status,kernelName:this.model.kernelName,activityName:this.model.activityName,handleClick:this._handleClick,handleKeyDown:this._handleKeyDown,translator:this.translator})}}(ce||(ce={})).Model=class extends i{constructor(e){super(),this._activityName="",this._kernelName="",this._kernelStatus="",this._sessionContext=null,e=null!=e?e:o,this._trans=e.load("jupyterlab"),this._statusNames=re(e)}get kernelName(){return this._kernelName}get status(){return this._kernelStatus?this._statusNames[this._kernelStatus]:void 0}get activityName(){return this._activityName}set activityName(e){this._activityName!==e&&(this._activityName=e,this.stateChanged.emit())}get sessionContext(){return this._sessionContext}set sessionContext(e){var t,n,s,a;null===(t=this._sessionContext)||void 0===t||t.statusChanged.disconnect(this._onKernelStatusChanged,this),null===(n=this._sessionContext)||void 0===n||n.connectionStatusChanged.disconnect(this._onKernelStatusChanged,this),null===(s=this._sessionContext)||void 0===s||s.kernelChanged.disconnect(this._onKernelChanged,this);const o=this._getAllState();this._sessionContext=e,this._kernelStatus=null==e?void 0:e.kernelDisplayStatus,this._kernelName=null!==(a=null==e?void 0:e.kernelDisplayName)&&void 0!==a?a:this._trans.__("No Kernel"),null==e||e.statusChanged.connect(this._onKernelStatusChanged,this),null==e||e.connectionStatusChanged.connect(this._onKernelStatusChanged,this),null==e||e.kernelChanged.connect(this._onKernelChanged,this),this._triggerChange(o,this._getAllState())}_onKernelStatusChanged(){var e;this._kernelStatus=null===(e=this._sessionContext)||void 0===e?void 0:e.kernelDisplayStatus,this.stateChanged.emit(void 0)}_onKernelChanged(e,t){var n;const s=this._getAllState();this._kernelStatus=null===(n=this._sessionContext)||void 0===n?void 0:n.kernelDisplayStatus,this._kernelName=e.kernelDisplayName,this._triggerChange(s,this._getAllState())}_getAllState(){return[this._kernelName,this._kernelStatus,this._activityName]}_triggerChange(e,t){r.deepEqual(e,t)&&this.stateChanged.emit(void 0)}};var de,ue,he;(ue=de||(de={})).createInterruptButton=function(e,t){const n=(t=t||o).load("jupyterlab");return new c({icon:d,onClick:()=>{var t,n;null===(n=null===(t=e.session)||void 0===t?void 0:t.kernel)||void 0===n||n.interrupt()},tooltip:n.__("Interrupt the kernel")})},ue.createRestartButton=function(e,t,n){const s=(n=null!=n?n:o).load("jupyterlab");return new c({icon:u,onClick:()=>{(null!=t?t:new h({translator:n})).restart(e)},tooltip:s.__("Restart the kernel")})},ue.createKernelNameItem=function(t,n,s){const a=m.create(e.createElement(he.KernelNameComponent,{sessionContext:t,dialogs:null!=n?n:new h({translator:s}),translator:s}));return a.addClass("jp-KernelName"),a},ue.createKernelStatusItem=function(e,t){return new he.KernelStatus(e,t)},function(t){t.KernelNameComponent=function(t){const n=(t.translator||o).load("jupyterlab"),s=()=>{t.dialogs.selectKernel(t.sessionContext)};return e.createElement(p,{signal:t.sessionContext.kernelChanged,initialSender:t.sessionContext},t=>e.createElement(_,{className:"jp-Toolbar-kernelName",onClick:s,tooltip:n.__("Switch kernel"),label:null==t?void 0:t.kernelDisplayName}))};t.KernelStatus=class extends g{constructor(e,t){super(),this.translator=t||o,this._trans=this.translator.load("jupyterlab"),this.addClass("jp-Toolbar-kernelStatus"),this._statusNames=re(this.translator),this._onStatusChanged(e),e.statusChanged.connect(this._onStatusChanged,this),e.connectionStatusChanged.connect(this._onStatusChanged,this)}_onStatusChanged(e){if(this.isDisposed)return;const t=e.kernelDisplayStatus,n={container:this.node,title:this._trans.__("Kernel %1",this._statusNames[t]||t),stylesheet:"toolbarButton",alignSelf:"normal",height:"24px"};C.remove(this.node),"busy"===t||"starting"===t||"terminating"===t||"restarting"===t||"initializing"===t?y.element(n):"connecting"===t||"disconnected"===t||"unknown"===t?x.element(n):k.element(n)}}}(he||(he={}));class me extends w{}!function(e){e.createInterruptButton=de.createInterruptButton,e.createKernelNameItem=de.createKernelNameItem,e.createKernelStatusItem=de.createKernelStatusItem,e.createRestartButton=de.createRestartButton,e.createSpacerItem=w.createSpacerItem}(me||(me={}));const pe="completer:invoke",_e="completer:select";class ge{_id;_outputs;_cell;_kernel;_panel;_sessionContext;_type;_iPyWidgetsClassicManager;constructor(e){const{id:t,type:n,source:s,outputs:a,kernel:o,boxOptions:i}=e;this._id=t,this._outputs=a,this._kernel=o,this._type=n,this.setupCell(n,s,o,i)}setupCell(e="code",t,n,s){const a=n.sessionManager,o=n.kernelSpecManager,i=n?{id:n.id,shouldStart:!1,autoStartDefault:!1,shutdownOnDispose:!1}:{name:"python",shouldStart:!0,autoStartDefault:!0,shutdownOnDispose:!0};this._sessionContext=new v({name:n?.path,path:n?.path,sessionManager:a,specsManager:o,type:"python",kernelPreference:i}),this._sessionContext._initialize=async()=>{const e=this._sessionContext.sessionManager;await e.ready,await e.refreshRunning();const t=j(e.running(),e=>e.kernel?.id===this._kernel.id);if(t)try{const n=e.connectTo({model:t,kernelConnectionOptions:{handleComms:!0}});n.kernel&&!n.kernel.handleComms&&(n.kernel.handleComms=!0),this._sessionContext._handleNewSession(n)}catch(n){return this._sessionContext._handleSessionError(n),Promise.reject(n)}return await this._sessionContext._startIfNecessary()};const r=new K;for(const c of K.getDefaultThemes())r.addTheme(c);const l=new b;for(const c of b.getDefaultLanguages())l.addLanguage(c);l.addLanguage({name:"ipythongfm",mime:"text/x-ipythongfm",load:async()=>(await import("./vendor-codemirror-OzOnFEf0.js").then(e=>e.ap)).markdown({codeLanguages:e=>l.findBest(e)})});const d=new J(l),u=new I;document.addEventListener("keydown",e=>{const t=document.activeElement;t&&t.closest(".dla-Jupyter-Cell")===this._cell.node&&u.processKeydownEvent(e)},!0);const h=new ne({initialFactories:N,latexTypesetter:new $,markdownParser:Q(l)});this._iPyWidgetsClassicManager=new U({loader:V}),h.addFactory({safe:!1,mimeTypes:[G],createRenderer:e=>new q(e,this._iPyWidgetsClassicManager)},0);const m=new F({extensions:(()=>{const e=new O;for(const t of O.getDefaultExtensions({themes:r}))e.addExtension(t);return e.addExtension({name:"shared-model-binding",factory:e=>{const t=e.model.sharedModel;return O.createImmutableExtension(P({ytext:t.ysource,undoManager:t.undoManager??void 0}))}}),e})(),languages:l}),p=M({cell_type:e,source:t,outputs:this._outputs,metadata:{}}),_=new E.ContentFactory({editorFactory:m.newInlineEditor.bind(m)});"code"===e?this._cell=new S({rendermime:h,model:new D({sharedModel:p}),contentFactory:_}):"markdown"===e&&(this._cell=new f({rendermime:h,model:new T({sharedModel:p}),contentFactory:_})),this._cell.addClass("dla-Jupyter-Cell"),this._cell.initializeState(),"markdown"===this._type&&(this._cell.rendered=!1);let C=!1,y=null;const x=async e=>{if(!e||C&&y===e.id)!e&&C&&(this._iPyWidgetsClassicManager?.registerWithKernel(null),C=!1,y=null);else try{e.handleComms||(console.warn("Kernel connection does not handle Comms, enabling it",e.id),e.handleComms=!0),C=!0,y=e.id,await e.info,"connected"===e.connectionStatus?this._iPyWidgetsClassicManager?.registerWithKernel(e):console.log("Kernel disconnected while waiting for info, will retry on next connection...")}catch(t){console.error("Error getting kernel info or registering widget manager:",t),C=!1,y=null,setTimeout(()=>{"connected"===e.connectionStatus&&y!==e.id&&(this._iPyWidgetsClassicManager?.registerWithKernel(e),C=!0,y=e.id)},1e3)}};this._sessionContext.kernelChanged.connect((e,t)=>{const n=t.newValue;C=!1,y=null,x(n)}),this._sessionContext.kernelChanged.connect(()=>{this._sessionContext.session?.kernel?.info.then(e=>{if("code"===this._type){const t=e.language_info,n=d.getMimeTypeByLanguage(t);this._cell.model&&(this._cell.model.mimeType=n)}})}),this._sessionContext.ready.then(()=>{const e=this._sessionContext.session?.kernel;x(e||null)});const k=this._cell.editor,w=new X,L=new Y({editor:k,model:w}),W=new ee,R=new Z({context:{widget:this._cell,editor:k,session:this._sessionContext.session},providers:[W],timeout:1e3}),z=new te({completer:L,reconciliator:R});this._sessionContext.ready.then(()=>{const e=new ee;z.reconciliator=new Z({context:{widget:this._cell,editor:k,session:this._sessionContext.session},providers:[e],timeout:1e3})}),this._cell.ready.then(()=>{z.editor=this._cell&&this._cell.editor}),((e,t,n,s)=>{e.addCommand(pe,{label:"Completer: Invoke",execute:()=>n.invoke()}),e.addCommand(_e,{label:"Completer: Select",execute:()=>n.completer.selectActive()}),e.addCommand("run:cell",{execute:()=>{t instanceof S?s.execute():t instanceof f&&(t.rendered=!0)}}),e.addKeyBinding({selector:".jp-InputArea-editor.jp-mod-completer-enabled",keys:["Tab"],command:pe}),e.addKeyBinding({selector:".jp-InputArea-editor",keys:["Shift Enter"],command:"run:cell"}),[{selector:".jp-InputArea-editor.jp-mod-completer-active",keys:["Enter"],command:_e}].map(t=>e.addKeyBinding(t))})(u,this._cell,z,this),L.hide(),L.addClass("jp-Completer-Cell"),g.attach(L,document.body);const H=new me;H.addItem("spacer",me.createSpacerItem());const se=new c({icon:B,onClick:()=>{"code"===this._type?this.execute():"markdown"===this._type&&(this._cell.rendered=!0)},tooltip:"Run"});H.addItem("run",se),H.addItem("interrupt",me.createInterruptButton(this._sessionContext)),H.addItem("restart",me.createRestartButton(this._sessionContext)),H.addItem("status",me.createKernelStatusItem(this._sessionContext)),"code"===this._type&&(this._cell.outputsScrolled=!1),this._cell.activate(),this._panel=new A,this._panel.direction="top-to-bottom",this._panel.spacing=0,!1!==s?.showToolbar&&this._panel.addWidget(H),this._panel.addWidget(this._cell),!1!==s?.showToolbar&&A.setStretch(H,0),A.setStretch(this._cell,1),window.addEventListener("resize",()=>{this._panel.update()}),this._panel.update()}get panel(){return this._panel}get cell(){return this._cell}get sessionContext(){return this._sessionContext}get kernel(){return this._kernel}execute=()=>{"code"===this._type?(this._iPyWidgetsClassicManager?.registerWithKernel(this._kernel.connection),this._execute(this._cell)):"markdown"===this._type&&(this._cell.rendered=!0)};async _execute(e,t){L.getState().setIsExecuting(this._id,!0);const n=e.model,s=n.sharedModel.getSource();if(!s.trim()||!this.kernel)return n.sharedModel.transact(()=>{n.clearExecution()},!1),L.getState().setIsExecuting(this._id,!1),new Promise(()=>{});const a={cellId:n.sharedModel.getId()};t={...n.metadata,...t,...a};const{recordTiming:o}=t;let i;n.sharedModel.transact(()=>{n.clearExecution(),e.outputHidden=!1},!1),e.setPrompt("*"),n.trusted=!0;try{const a=H(this._id,s,e.outputArea,this._kernel,t);if(o){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const s=e.header.date||/* @__PURE__ */(new Date).toISOString(),a=Object.assign({},n.getMetadata("execution"));return a[`iopub.${t}`]=s,n.setMetadata("execution",a),!0};e.outputArea.future.registerMessageHook(t)}else n.deleteMetadata("execution");i=e.outputArea.future;const r=await a;if(n.executionCount=r.content.execution_count,o){const e=Object.assign({},n.getMetadata("execution")),t=r.metadata.started;t&&(e["shell.execute_reply.started"]=t);const s=r.header.date;e["shell.execute_reply"]=s||/* @__PURE__ */(new Date).toISOString(),n.setMetadata("execution",e)}return L.getState().setIsExecuting(this._id,!1),r}catch(r){if(L.getState().setIsExecuting(this._id,!1),i&&!e.isDisposed&&e.outputArea.future===i&&(e.setPrompt(""),o&&i.isDisposed)){const e=Object.assign({},n.getMetadata("execution"));e.execution_failed=/* @__PURE__ */(new Date).toISOString(),n.setMetadata("execution",e)}throw r}}}const Ce=({autoStart:t=!0,id:s,kernel:o,outputs:i=[],showToolbar:r=!0,source:l="",type:c="code"})=>{const[d]=e.useState(s||W()),[u,h]=e.useState(),m=R(),p=e.useRef(!1);return e.useEffect(()=>{u||p.current||!o||(p.current=!0,o.ready.then(()=>{const e=new ge({id:d,type:c,source:l,outputs:i,kernel:o,boxOptions:{showToolbar:r}});h(e),m.setAdapter(d,e),m.setSource(d,l),(e=>{e.cell.model.contentChanged.connect((e,t)=>{m.setSource(d,e.sharedModel.getSource())}),e.cell instanceof S&&e.cell.outputArea.outputLengthChanged?.connect((e,t)=>{m.setOutputsCount(d,t)}),e.sessionContext.initialize().then(()=>{t&&e.cell.model&&e.execute()}),e.sessionContext.kernelChanged.connect(()=>{e.sessionContext.session?.kernel?.info.then(e=>{m.setKernelSessionAvailable(d,!0)})})})(e);const n=t=>{let n=t.target;for(;n&&!n.classList.contains("jp-MarkdownOutput");)n=n.parentElement;n&&n.classList.contains("jp-MarkdownOutput")&&(e.cell.rendered=!1)};return document.addEventListener("dblclick",n),()=>{document.removeEventListener("dblclick",n)}}))},[l,o]),u?n.jsx(a,{sx:{"& .dla-Jupyter-Cell":{position:"relative !important",contain:"content !important"},"& .jp-Toolbar":{height:"auto !important",position:"relative"},"& .lm-BoxPanel":{position:"relative"},"& .jp-Cell":{position:"relative"},"& .jp-CodeCell":{height:"auto !important",position:"relative"},"& .jp-MarkdownCell":{height:"auto !important",minHeight:"65px",position:"relative"},"& .jp-Cell-outputArea":{paddingBottom:"30px"},"& .jp-CodeMirrorEditor":{cursor:"text !important"}},children:n.jsx(se,{children:u.panel})}):n.jsx(a,{children:"Loading Jupyter Cell..."})},ye=({options:e})=>{const{defaultKernel:t}=(()=>{const e=s();return ae({jupyterServerUrl:e.serverUrl||"",jupyterServerToken:e.token||"",startDefaultKernel:e.autoStartKernel,defaultKernelName:e.defaultKernel,terminals:!0})})();/* @__PURE__ */
return n.jsx("div",{style:{height:e.height||"200px"},children:/* @__PURE__ */n.jsx(Ce,{id:e.id,source:e.source||"",type:e.cellType||"code",autoStart:e.autoExecute,showToolbar:e.showToolbar,kernel:t})})},xe=({options:e})=>/* @__PURE__ */n.jsx(z,{children:/* @__PURE__ */n.jsx(ye,{options:e})});export{xe as CellChunk,xe as default};
//# sourceMappingURL=CellChunk-DNBlmMXN.js.map
