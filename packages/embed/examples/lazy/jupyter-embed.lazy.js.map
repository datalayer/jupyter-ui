{"version":3,"file":"jupyter-embed.lazy.js","sources":["../src/config.ts","../src/types.ts","../src/parser.ts","../src/components-lazy.tsx","../src/init-lazy.ts"],"sourcesContent":["/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\n/**\n * Configuration options for Jupyter Embed\n */\nexport interface IJupyterEmbedConfig {\n  /**\n   * Base URL for the Jupyter server (e.g., 'http://localhost:8888')\n   */\n  serverUrl?: string;\n\n  /**\n   * WebSocket URL for the Jupyter server (e.g., 'ws://localhost:8888')\n   * If not provided, it will be derived from serverUrl\n   */\n  wsUrl?: string;\n\n  /**\n   * Authentication token for the Jupyter server\n   */\n  token?: string;\n\n  /**\n   * Default kernel name to use (e.g., 'python3')\n   */\n  defaultKernel?: string;\n\n  /**\n   * Whether to start kernel automatically\n   */\n  autoStartKernel?: boolean;\n\n  /**\n   * Whether to lazy load components (only initialize when visible)\n   */\n  lazyLoad?: boolean;\n\n  /**\n   * Theme to use ('light' or 'dark')\n   */\n  theme?: 'light' | 'dark';\n\n  /**\n   * Base path for the Jupyter server\n   */\n  basePath?: string;\n}\n\n/**\n * Global configuration instance\n */\nlet globalConfig: IJupyterEmbedConfig = {\n  serverUrl: '',\n  token: '',\n  defaultKernel: 'python3',\n  autoStartKernel: true,\n  lazyLoad: true,\n  theme: 'light',\n  basePath: '/',\n};\n\n/**\n * Configure Jupyter Embed globally\n */\nexport function configureJupyterEmbed(\n  config: Partial<IJupyterEmbedConfig>,\n): void {\n  globalConfig = { ...globalConfig, ...config };\n\n  // Derive wsUrl from serverUrl if not provided\n  if (config.serverUrl && !config.wsUrl) {\n    globalConfig.wsUrl = config.serverUrl\n      .replace('https://', 'wss://')\n      .replace('http://', 'ws://');\n  }\n}\n\n/**\n * Get the current global configuration\n */\nexport function getJupyterEmbedConfig(): IJupyterEmbedConfig {\n  return { ...globalConfig };\n}\n\n/**\n * Parse configuration from a script tag's data attributes\n */\nexport function parseConfigFromScript(\n  script: HTMLScriptElement,\n): Partial<IJupyterEmbedConfig> {\n  const config: Partial<IJupyterEmbedConfig> = {};\n\n  if (script.dataset.serverUrl) {\n    config.serverUrl = script.dataset.serverUrl;\n  }\n  if (script.dataset.wsUrl) {\n    config.wsUrl = script.dataset.wsUrl;\n  }\n  if (script.dataset.token) {\n    config.token = script.dataset.token;\n  }\n  if (script.dataset.kernel) {\n    config.defaultKernel = script.dataset.kernel;\n  }\n  if (script.dataset.autoStart !== undefined) {\n    config.autoStartKernel = script.dataset.autoStart !== 'false';\n  }\n  if (script.dataset.lazyLoad !== undefined) {\n    config.lazyLoad = script.dataset.lazyLoad !== 'false';\n  }\n  if (script.dataset.theme) {\n    config.theme = script.dataset.theme as 'light' | 'dark';\n  }\n  if (script.dataset.basePath) {\n    config.basePath = script.dataset.basePath;\n  }\n\n  return config;\n}\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\n/**\n * Base interface for all embed element options\n */\nexport interface IEmbedElementOptions {\n  /**\n   * Unique identifier for this element\n   */\n  id?: string;\n\n  /**\n   * Height of the embedded component (CSS value)\n   */\n  height?: string;\n\n  /**\n   * Theme override ('light' or 'dark')\n   */\n  theme?: 'light' | 'dark';\n\n  /**\n   * Whether to auto-execute code on initialization\n   */\n  autoExecute?: boolean;\n}\n\n/**\n * Options specific to Cell embeds\n */\nexport interface ICellEmbedOptions extends IEmbedElementOptions {\n  type: 'cell';\n\n  /**\n   * Cell type: 'code', 'markdown', or 'raw'\n   */\n  cellType?: 'code' | 'markdown' | 'raw';\n\n  /**\n   * Source code for the cell\n   */\n  source?: string;\n\n  /**\n   * Whether to show the cell toolbar\n   */\n  showToolbar?: boolean;\n\n  /**\n   * Kernel name to use\n   */\n  kernel?: string;\n}\n\n/**\n * Options specific to Notebook embeds\n */\nexport interface INotebookEmbedOptions extends IEmbedElementOptions {\n  type: 'notebook';\n\n  /**\n   * Path to the notebook file on the Jupyter server\n   */\n  path?: string;\n\n  /**\n   * URL to fetch the notebook from\n   */\n  url?: string;\n\n  /**\n   * Notebook content as JSON string or object\n   */\n  content?: string | object;\n\n  /**\n   * Whether the notebook should be read-only\n   */\n  readonly?: boolean;\n\n  /**\n   * Whether to show the notebook toolbar\n   */\n  showToolbar?: boolean;\n\n  /**\n   * Kernel name to use\n   */\n  kernel?: string;\n}\n\n/**\n * Options specific to Terminal embeds\n */\nexport interface ITerminalEmbedOptions extends IEmbedElementOptions {\n  type: 'terminal';\n\n  /**\n   * Terminal name (creates new if not exists)\n   */\n  name?: string;\n\n  /**\n   * Whether to colorize the terminal output\n   */\n  colorMode?: 'light' | 'dark';\n}\n\n/**\n * Options specific to Console embeds\n */\nexport interface IConsoleEmbedOptions extends IEmbedElementOptions {\n  type: 'console';\n\n  /**\n   * Kernel name to use\n   */\n  kernel?: string;\n\n  /**\n   * Initial code to execute in the console\n   */\n  initCode?: string;\n}\n\n/**\n * Options specific to Output embeds (display only)\n */\nexport interface IOutputEmbedOptions extends IEmbedElementOptions {\n  type: 'output';\n\n  /**\n   * Output data to display\n   */\n  outputs?: any[];\n\n  /**\n   * Code to execute (optional)\n   */\n  code?: string;\n\n  /**\n   * Auto-run code on load\n   */\n  autoRun?: boolean;\n}\n\n/**\n * Options specific to Viewer embeds (read-only notebook display)\n */\nexport interface IViewerEmbedOptions extends IEmbedElementOptions {\n  type: 'viewer';\n\n  /**\n   * Notebook path to load from Jupyter server\n   */\n  path?: string;\n\n  /**\n   * URL to fetch notebook JSON from\n   */\n  url?: string;\n\n  /**\n   * Inline notebook content (nbformat)\n   */\n  content?: any;\n\n  /**\n   * Whether to show outputs (default: true)\n   */\n  outputs?: boolean;\n}\n\n/**\n * Union type of all embed options\n */\nexport type EmbedOptions =\n  | ICellEmbedOptions\n  | INotebookEmbedOptions\n  | IViewerEmbedOptions\n  | ITerminalEmbedOptions\n  | IConsoleEmbedOptions\n  | IOutputEmbedOptions;\n\n/**\n * Data attributes used on HTML elements for auto-initialization\n */\nexport const DATA_ATTRIBUTES = {\n  // Main marker\n  JUPYTER_EMBED: 'data-jupyter-embed',\n\n  // Component type\n  TYPE: 'data-type',\n\n  // Common options\n  ID: 'data-id',\n  HEIGHT: 'data-height',\n  THEME: 'data-theme',\n  AUTO_EXECUTE: 'data-auto-execute',\n\n  // Cell options\n  CELL_TYPE: 'data-cell-type',\n  SOURCE: 'data-source',\n  SHOW_TOOLBAR: 'data-show-toolbar',\n  KERNEL: 'data-kernel',\n\n  // Notebook options\n  PATH: 'data-path',\n  URL: 'data-url',\n  READONLY: 'data-readonly',\n\n  // Terminal options\n  TERMINAL_NAME: 'data-terminal-name',\n  COLOR_MODE: 'data-color-mode',\n\n  // Console options\n  INIT_CODE: 'data-init-code',\n\n  // Output options\n  AUTO_RUN: 'data-auto-run',\n\n  // Content holders\n  CONTENT_PRE_EXECUTE: 'pre-execute-code',\n  CONTENT_SOURCE: 'source-code',\n  CONTENT_SOLUTION: 'solution-code',\n  CONTENT_HINT: 'hint',\n} as const;\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\nimport {\n  EmbedOptions,\n  ICellEmbedOptions,\n  INotebookEmbedOptions,\n  IViewerEmbedOptions,\n  ITerminalEmbedOptions,\n  IConsoleEmbedOptions,\n  IOutputEmbedOptions,\n  DATA_ATTRIBUTES,\n} from './types';\n\n/**\n * Parse embed options from an HTML element's data attributes and child elements\n */\nexport function parseElementOptions(element: HTMLElement): EmbedOptions | null {\n  const type = element.getAttribute(DATA_ATTRIBUTES.TYPE);\n\n  if (!type) {\n    console.warn(\n      '[jupyter-embed] Element missing data-type attribute:',\n      element,\n    );\n    return null;\n  }\n\n  const baseOptions = {\n    id: element.getAttribute(DATA_ATTRIBUTES.ID) || undefined,\n    height: element.getAttribute(DATA_ATTRIBUTES.HEIGHT) || undefined,\n    theme: element.getAttribute(DATA_ATTRIBUTES.THEME) as\n      | 'light'\n      | 'dark'\n      | undefined,\n    autoExecute: element.getAttribute(DATA_ATTRIBUTES.AUTO_EXECUTE) !== 'false',\n  };\n\n  switch (type) {\n    case 'cell':\n      return parseCellOptions(element, baseOptions);\n    case 'notebook':\n      return parseNotebookOptions(element, baseOptions);\n    case 'viewer':\n      return parseViewerOptions(element, baseOptions);\n    case 'terminal':\n      return parseTerminalOptions(element, baseOptions);\n    case 'console':\n      return parseConsoleOptions(element, baseOptions);\n    case 'output':\n      return parseOutputOptions(element, baseOptions);\n    default:\n      console.warn(`[jupyter-embed] Unknown embed type: ${type}`);\n      return null;\n  }\n}\n\n/**\n * Parse cell-specific options\n */\nfunction parseCellOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): ICellEmbedOptions {\n  // Get source from data attribute or from child <code> elements\n  let source = element.getAttribute(DATA_ATTRIBUTES.SOURCE) || '';\n\n  // Check for source-code child element\n  const sourceElement = element.querySelector(\n    `[data-type=\"${DATA_ATTRIBUTES.CONTENT_SOURCE}\"]`,\n  );\n  if (sourceElement) {\n    source = extractCode(sourceElement);\n  }\n\n  // Fallback: check for direct <code> child without data-type\n  if (!source) {\n    const codeElement = element.querySelector('code:not([data-type])');\n    if (codeElement) {\n      source = extractCode(codeElement);\n    }\n  }\n\n  return {\n    ...baseOptions,\n    type: 'cell',\n    cellType:\n      (element.getAttribute(DATA_ATTRIBUTES.CELL_TYPE) as\n        | 'code'\n        | 'markdown'\n        | 'raw') || 'code',\n    source,\n    showToolbar: element.getAttribute(DATA_ATTRIBUTES.SHOW_TOOLBAR) !== 'false',\n    kernel: element.getAttribute(DATA_ATTRIBUTES.KERNEL) || undefined,\n  };\n}\n\n/**\n * Parse notebook-specific options\n */\nfunction parseNotebookOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): INotebookEmbedOptions {\n  let content: string | object | undefined = undefined;\n\n  // Check for inline content in <script type=\"application/json\">\n  const jsonScript = element.querySelector('script[type=\"application/json\"]');\n  if (jsonScript?.textContent) {\n    try {\n      content = JSON.parse(jsonScript.textContent);\n    } catch (e) {\n      console.warn('[jupyter-embed] Failed to parse inline notebook JSON:', e);\n    }\n  }\n\n  return {\n    ...baseOptions,\n    type: 'notebook',\n    path: element.getAttribute(DATA_ATTRIBUTES.PATH) || undefined,\n    url: element.getAttribute(DATA_ATTRIBUTES.URL) || undefined,\n    content,\n    readonly: element.getAttribute(DATA_ATTRIBUTES.READONLY) === 'true',\n    showToolbar: element.getAttribute(DATA_ATTRIBUTES.SHOW_TOOLBAR) !== 'false',\n    kernel: element.getAttribute(DATA_ATTRIBUTES.KERNEL) || undefined,\n  };\n}\n\n/**\n * Parse viewer-specific options\n */\nfunction parseViewerOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): IViewerEmbedOptions {\n  let content: string | object | undefined = undefined;\n\n  // Check for inline content in <script type=\"application/json\">\n  const jsonScript = element.querySelector('script[type=\"application/json\"]');\n  if (jsonScript?.textContent) {\n    try {\n      content = JSON.parse(jsonScript.textContent);\n    } catch (e) {\n      console.warn('[jupyter-embed] Failed to parse inline viewer JSON:', e);\n    }\n  }\n\n  const outputsAttr = element.getAttribute('data-outputs');\n\n  return {\n    ...baseOptions,\n    type: 'viewer',\n    path: element.getAttribute(DATA_ATTRIBUTES.PATH) || undefined,\n    url: element.getAttribute(DATA_ATTRIBUTES.URL) || undefined,\n    content,\n    outputs: outputsAttr !== 'false',\n  };\n}\n\n/**\n * Parse terminal-specific options\n */\nfunction parseTerminalOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): ITerminalEmbedOptions {\n  return {\n    ...baseOptions,\n    type: 'terminal',\n    name: element.getAttribute(DATA_ATTRIBUTES.TERMINAL_NAME) || undefined,\n    colorMode:\n      (element.getAttribute(DATA_ATTRIBUTES.COLOR_MODE) as 'light' | 'dark') ||\n      undefined,\n  };\n}\n\n/**\n * Parse console-specific options\n */\nfunction parseConsoleOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): IConsoleEmbedOptions {\n  let initCode = element.getAttribute(DATA_ATTRIBUTES.INIT_CODE) || '';\n\n  // Check for pre-execute-code child element\n  const preExecuteElement = element.querySelector(\n    `[data-type=\"${DATA_ATTRIBUTES.CONTENT_PRE_EXECUTE}\"]`,\n  );\n  if (preExecuteElement) {\n    initCode = extractCode(preExecuteElement);\n  }\n\n  return {\n    ...baseOptions,\n    type: 'console',\n    kernel: element.getAttribute(DATA_ATTRIBUTES.KERNEL) || undefined,\n    initCode,\n  };\n}\n\n/**\n * Safely parse JSON content from a trusted script element.\n * This validates the content is well-formed JSON before parsing.\n */\nfunction safeParseJSON(content: string): unknown {\n  // Validate that content looks like JSON (starts with [ or {)\n  const trimmed = content.trim();\n  if (!trimmed.startsWith('[') && !trimmed.startsWith('{')) {\n    throw new Error('Content does not appear to be valid JSON');\n  }\n  // Parse the JSON - this is safe as we're parsing data from\n  // a script[type=\"application/json\"] element which browsers\n  // don't execute, following the standard pattern for embedding\n  // structured data in HTML (similar to JSON-LD)\n  return JSON.parse(trimmed);\n}\n\n/**\n * Parse output-specific options\n */\nfunction parseOutputOptions(\n  element: HTMLElement,\n  baseOptions: any,\n): IOutputEmbedOptions {\n  let outputs: any[] = [];\n  let code: string | undefined;\n\n  // Check for source code\n  const sourceElement = element.querySelector(\n    `[data-type=\"${DATA_ATTRIBUTES.CONTENT_SOURCE}\"]`,\n  );\n  if (sourceElement) {\n    code = extractCode(sourceElement);\n  }\n\n  // Check for inline outputs in <script type=\"application/json\">\n  // This is a standard pattern for embedding data in HTML\n  // (see: https://html.spec.whatwg.org/multipage/scripting.html#data-block)\n  const jsonScript = element.querySelector('script[type=\"application/json\"]');\n  if (jsonScript?.textContent) {\n    try {\n      const parsed = safeParseJSON(jsonScript.textContent);\n      outputs = Array.isArray(parsed) ? parsed : [parsed];\n    } catch (e) {\n      console.warn('[jupyter-embed] Failed to parse inline outputs JSON:', e);\n    }\n  }\n\n  return {\n    ...baseOptions,\n    type: 'output',\n    outputs,\n    code,\n    autoRun: element.getAttribute(DATA_ATTRIBUTES.AUTO_RUN) === 'true',\n  };\n}\n\n/**\n * Extract code from an element, handling indentation\n */\nfunction extractCode(element: Element): string {\n  const text = element.textContent || '';\n  return stripLeadingIndentation(text);\n}\n\n/**\n * Strip common leading indentation from multi-line code blocks\n */\nfunction stripLeadingIndentation(code: string): string {\n  const lines = code.split('\\n');\n\n  // Remove empty first and last lines (often artifacts of HTML formatting)\n  while (lines.length > 0 && lines[0].trim() === '') {\n    lines.shift();\n  }\n  while (lines.length > 0 && lines[lines.length - 1].trim() === '') {\n    lines.pop();\n  }\n\n  if (lines.length === 0) return '';\n\n  // Find minimum indentation (excluding empty lines)\n  let minIndent = Infinity;\n  for (const line of lines) {\n    if (line.trim() === '') continue;\n    const match = line.match(/^(\\s*)/);\n    if (match) {\n      minIndent = Math.min(minIndent, match[1].length);\n    }\n  }\n\n  if (minIndent === Infinity || minIndent === 0) {\n    return lines.join('\\n');\n  }\n\n  // Strip the common indentation\n  return lines.map(line => line.slice(minIndent)).join('\\n');\n}\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\n/**\n * Lazy-loaded embed components\n *\n * This module provides components that are dynamically imported only when needed,\n * enabling proper code splitting. Each component type is loaded on-demand.\n *\n * IMPORTANT: This file should NOT import anything from @datalayer/jupyter-react\n * directly to avoid pulling in heavy dependencies into the main bundle.\n */\n\nimport React, { lazy, Suspense } from 'react';\nimport { createRoot, Root } from 'react-dom/client';\nimport {\n  EmbedOptions,\n  ICellEmbedOptions,\n  INotebookEmbedOptions,\n  ITerminalEmbedOptions,\n  IConsoleEmbedOptions,\n  IOutputEmbedOptions,\n  IViewerEmbedOptions,\n} from './types';\n\n/**\n * Lightweight skeleton loader component\n */\nconst JupyterLoader: React.FC<{ height?: string; type?: string }> = ({\n  height = '200px',\n  type = 'component',\n}) => (\n  <div\n    style={{\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height,\n      gap: '12px',\n      backgroundColor: '#f6f8fa',\n      borderRadius: '6px',\n      border: '1px solid #d0d7de',\n      fontFamily:\n        '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, sans-serif',\n    }}\n    role=\"status\"\n  >\n    <div\n      style={{\n        width: '24px',\n        height: '24px',\n        border: '3px solid #d0d7de',\n        borderTopColor: '#0969da',\n        borderRadius: '50%',\n        animation: 'jupyter-spin 1s linear infinite',\n      }}\n    />\n    <style>{`\n      @keyframes jupyter-spin {\n        to { transform: rotate(360deg); }\n      }\n    `}</style>\n    <div style={{ color: '#656d76', fontSize: '14px' }}>\n      Loading Jupyter {type}...\n    </div>\n  </div>\n);\n\n// ============================================================================\n// Lazy-loaded component factories\n// ============================================================================\n\n/**\n * Create a lazy-loaded component module\n * This ensures each component type is in its own chunk\n */\n\n// Cell chunk - loads JupyterLab cell dependencies\nconst LazyCellModule = lazy(() =>\n  import(/* webpackChunkName: \"jupyter-cell\" */ './chunks/CellChunk').then(\n    m => ({\n      default: m.CellChunk,\n    }),\n  ),\n);\n\n// Notebook chunk - loads JupyterLab notebook dependencies\nconst LazyNotebookModule = lazy(() =>\n  import(\n    /* webpackChunkName: \"jupyter-notebook\" */ './chunks/NotebookChunk'\n  ).then(m => ({\n    default: m.NotebookChunk,\n  })),\n);\n\n// Output chunk - loads JupyterLab output dependencies\nconst LazyOutputModule = lazy(() =>\n  import(/* webpackChunkName: \"jupyter-output\" */ './chunks/OutputChunk').then(\n    m => ({\n      default: m.OutputChunk,\n    }),\n  ),\n);\n\n// Terminal chunk - loads xterm dependencies\nconst LazyTerminalModule = lazy(() =>\n  import(\n    /* webpackChunkName: \"jupyter-terminal\" */ './chunks/TerminalChunk'\n  ).then(m => ({\n    default: m.TerminalChunk,\n  })),\n);\n\n// Console chunk - loads JupyterLab console dependencies\nconst LazyConsoleModule = lazy(() =>\n  import(\n    /* webpackChunkName: \"jupyter-console\" */ './chunks/ConsoleChunk'\n  ).then(m => ({\n    default: m.ConsoleChunk,\n  })),\n);\n\n// Viewer chunk - lighter, just needs rendering\nconst LazyViewerModule = lazy(() =>\n  import(/* webpackChunkName: \"jupyter-viewer\" */ './chunks/ViewerChunk').then(\n    m => ({\n      default: m.ViewerChunk,\n    }),\n  ),\n);\n\n// ============================================================================\n// Embed Components with Lazy Loading\n// ============================================================================\n\ninterface ICellEmbedProps {\n  options: ICellEmbedOptions;\n}\n\nconst CellEmbed: React.FC<ICellEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={<JupyterLoader height={options.height || '200px'} type=\"cell\" />}\n  >\n    <LazyCellModule options={options} />\n  </Suspense>\n);\n\ninterface INotebookEmbedProps {\n  options: INotebookEmbedOptions;\n}\n\nconst NotebookEmbed: React.FC<INotebookEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={\n      <JupyterLoader height={options.height || '500px'} type=\"notebook\" />\n    }\n  >\n    <LazyNotebookModule options={options} />\n  </Suspense>\n);\n\ninterface IOutputEmbedProps {\n  options: IOutputEmbedOptions;\n}\n\nconst OutputEmbed: React.FC<IOutputEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={\n      <JupyterLoader height={options.height || '100px'} type=\"output\" />\n    }\n  >\n    <LazyOutputModule options={options} />\n  </Suspense>\n);\n\ninterface ITerminalEmbedProps {\n  options: ITerminalEmbedOptions;\n}\n\nconst TerminalEmbed: React.FC<ITerminalEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={\n      <JupyterLoader height={options.height || '400px'} type=\"terminal\" />\n    }\n  >\n    <LazyTerminalModule options={options} />\n  </Suspense>\n);\n\ninterface IConsoleEmbedProps {\n  options: IConsoleEmbedOptions;\n}\n\nconst ConsoleEmbed: React.FC<IConsoleEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={\n      <JupyterLoader height={options.height || '400px'} type=\"console\" />\n    }\n  >\n    <LazyConsoleModule options={options} />\n  </Suspense>\n);\n\ninterface IViewerEmbedProps {\n  options: IViewerEmbedOptions;\n}\n\nconst ViewerEmbed: React.FC<IViewerEmbedProps> = ({ options }) => (\n  <Suspense\n    fallback={\n      <JupyterLoader height={options.height || '300px'} type=\"viewer\" />\n    }\n  >\n    <LazyViewerModule options={options} />\n  </Suspense>\n);\n\n// ============================================================================\n// Render Functions\n// ============================================================================\n\n/**\n * Map to track rendered components\n */\nconst renderedComponents = new Map<HTMLElement, Root>();\n\n/**\n * Render an embed component into an HTML element (lazy version)\n */\nexport function renderEmbedLazy(\n  element: HTMLElement,\n  options: EmbedOptions,\n): Root | null {\n  // Clean up existing render if any\n  const existingRoot = renderedComponents.get(element);\n  if (existingRoot) {\n    existingRoot.unmount();\n    renderedComponents.delete(element);\n  }\n\n  // Clear element content\n  element.innerHTML = '';\n\n  // Add a container div\n  const container = document.createElement('div');\n  container.className = 'jupyter-embed-container';\n  container.style.width = '100%';\n  container.style.height = '100%';\n  element.appendChild(container);\n\n  // Create React root and render\n  const root = createRoot(container);\n  renderedComponents.set(element, root);\n\n  let component: React.ReactElement | null = null;\n\n  switch (options.type) {\n    case 'cell':\n      component = <CellEmbed options={options} />;\n      break;\n    case 'notebook':\n      component = <NotebookEmbed options={options} />;\n      break;\n    case 'viewer':\n      component = <ViewerEmbed options={options} />;\n      break;\n    case 'terminal':\n      component = <TerminalEmbed options={options} />;\n      break;\n    case 'console':\n      component = <ConsoleEmbed options={options} />;\n      break;\n    case 'output':\n      component = <OutputEmbed options={options} />;\n      break;\n    default:\n      console.error('[jupyter-embed] Unknown component type');\n      return null;\n  }\n\n  root.render(component);\n  return root;\n}\n\n/**\n * Unmount a lazy embed from an element\n */\nexport function unmountEmbedLazy(element: HTMLElement): boolean {\n  const root = renderedComponents.get(element);\n  if (root) {\n    root.unmount();\n    renderedComponents.delete(element);\n    return true;\n  }\n  return false;\n}\n\n/**\n * Unmount all lazy embeds\n */\nexport function unmountAllEmbedsLazy(): void {\n  renderedComponents.forEach(root => {\n    root.unmount();\n  });\n  renderedComponents.clear();\n}\n\n// Export components for direct use\nexport {\n  JupyterLoader,\n  CellEmbed as LazyCellEmbed,\n  NotebookEmbed as LazyNotebookEmbed,\n  ViewerEmbed as LazyViewerEmbed,\n  TerminalEmbed as LazyTerminalEmbed,\n  ConsoleEmbed as LazyConsoleEmbed,\n  OutputEmbed as LazyOutputEmbed,\n};\n","/*\n * Copyright (c) 2021-2023 Datalayer, Inc.\n *\n * MIT License\n */\n\n/**\n * Lazy initialization module\n * Uses the lazy-loading components for reduced initial bundle size\n */\n\nimport {\n  configureJupyterEmbed,\n  parseConfigFromScript,\n  getJupyterEmbedConfig,\n} from './config';\nimport { parseElementOptions } from './parser';\nimport { renderEmbedLazy, unmountAllEmbedsLazy } from './components-lazy';\nimport { DATA_ATTRIBUTES } from './types';\n\n/**\n * IntersectionObserver for lazy loading\n */\nlet lazyLoadObserver: IntersectionObserver | null = null;\n\n/**\n * Elements waiting to be initialized\n */\nconst pendingElements = new Set<HTMLElement>();\n\n/**\n * Initialize a single embed element (lazy version)\n */\nfunction initializeElementLazy(element: HTMLElement): void {\n  // Skip if already initialized\n  if (element.getAttribute('data-jupyter-initialized') === 'true') {\n    return;\n  }\n\n  const options = parseElementOptions(element);\n  if (!options) {\n    return;\n  }\n\n  // Mark as initializing\n  element.setAttribute('data-jupyter-initializing', 'true');\n\n  try {\n    renderEmbedLazy(element, options);\n    element.setAttribute('data-jupyter-initialized', 'true');\n    element.removeAttribute('data-jupyter-initializing');\n\n    // Make visible (in case CSS hides uninitialized elements)\n    element.style.visibility = 'visible';\n  } catch (error) {\n    console.error('[jupyter-embed] Failed to initialize element:', error);\n    element.removeAttribute('data-jupyter-initializing');\n    element.setAttribute('data-jupyter-error', 'true');\n  }\n}\n\n/**\n * Setup lazy loading observer\n */\nfunction setupLazyLoadObserver(): void {\n  if (lazyLoadObserver) {\n    return;\n  }\n\n  lazyLoadObserver = new IntersectionObserver(\n    entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          const element = entry.target as HTMLElement;\n          lazyLoadObserver?.unobserve(element);\n          pendingElements.delete(element);\n          initializeElementLazy(element);\n        }\n      });\n    },\n    {\n      rootMargin: '100px', // Start loading slightly before element is visible\n    },\n  );\n}\n\n/**\n * Find and initialize all Jupyter embed elements in the document (lazy version)\n */\nexport function initJupyterEmbedsLazy(\n  container: HTMLElement = document.body,\n): void {\n  const config = getJupyterEmbedConfig();\n  const selector = `[${DATA_ATTRIBUTES.JUPYTER_EMBED}]`;\n  const elements = container.querySelectorAll<HTMLElement>(selector);\n\n  if (elements.length === 0) {\n    return;\n  }\n\n  console.log(\n    `[jupyter-embed] Found ${elements.length} embed element(s) (lazy mode)`,\n  );\n\n  if (config.lazyLoad) {\n    setupLazyLoadObserver();\n\n    elements.forEach(element => {\n      if (element.getAttribute('data-jupyter-initialized') !== 'true') {\n        pendingElements.add(element);\n        lazyLoadObserver?.observe(element);\n      }\n    });\n  } else {\n    // Initialize all elements immediately\n    elements.forEach(element => {\n      initializeElementLazy(element);\n    });\n  }\n}\n\n/**\n * Initialize embeds that were added after page load (lazy version)\n */\nexport function initAddedJupyterEmbedsLazy(\n  container: HTMLElement = document.body,\n): void {\n  initJupyterEmbedsLazy(container);\n}\n\n/**\n * Clean up all embeds and observers (lazy version)\n */\nexport function destroyJupyterEmbedsLazy(): void {\n  // Stop observing\n  if (lazyLoadObserver) {\n    lazyLoadObserver.disconnect();\n    lazyLoadObserver = null;\n  }\n\n  pendingElements.clear();\n\n  // Unmount all components\n  unmountAllEmbedsLazy();\n\n  // Reset initialized flags\n  document.querySelectorAll('[data-jupyter-initialized]').forEach(el => {\n    el.removeAttribute('data-jupyter-initialized');\n    el.removeAttribute('data-jupyter-initializing');\n  });\n}\n\n/**\n * Auto-initialize on page load (lazy version)\n */\nfunction autoInitLazy(): void {\n  // Find our script tag and parse config from it\n  const scripts = document.querySelectorAll('script[src*=\"jupyter-embed\"]');\n  scripts.forEach(script => {\n    const config = parseConfigFromScript(script as HTMLScriptElement);\n    if (Object.keys(config).length > 0) {\n      configureJupyterEmbed(config);\n    }\n  });\n\n  // Also check for a config script tag\n  const configScript = document.querySelector(\n    'script[data-jupyter-embed-config]',\n  );\n  if (configScript?.textContent) {\n    try {\n      const config = JSON.parse(configScript.textContent);\n      configureJupyterEmbed(config);\n    } catch (e) {\n      console.warn('[jupyter-embed] Failed to parse config script:', e);\n    }\n  }\n\n  // Initialize all embeds\n  initJupyterEmbedsLazy();\n}\n\n// Auto-initialize when DOM is ready\nif (typeof document !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', autoInitLazy);\n  } else {\n    // DOM already loaded\n    autoInitLazy();\n  }\n}\n\n// Export for manual initialization\nexport { autoInitLazy };\n"],"names":["globalConfig","serverUrl","token","defaultKernel","autoStartKernel","lazyLoad","theme","basePath","configureJupyterEmbed","config","wsUrl","replace","getJupyterEmbedConfig","parseConfigFromScript","script","dataset","kernel","autoStart","DATA_ATTRIBUTES","JUPYTER_EMBED","TYPE","ID","HEIGHT","THEME","AUTO_EXECUTE","CELL_TYPE","SOURCE","SHOW_TOOLBAR","KERNEL","PATH","URL","READONLY","TERMINAL_NAME","COLOR_MODE","INIT_CODE","AUTO_RUN","CONTENT_PRE_EXECUTE","CONTENT_SOURCE","CONTENT_SOLUTION","CONTENT_HINT","parseElementOptions","element","type","getAttribute","console","warn","baseOptions","id","height","autoExecute","source","sourceElement","querySelector","extractCode","codeElement","cellType","showToolbar","parseCellOptions","content","jsonScript","textContent","JSON","parse","e","path","url","readonly","parseNotebookOptions","outputsAttr","outputs","parseViewerOptions","name","colorMode","parseTerminalOptions","initCode","preExecuteElement","parseConsoleOptions","code","parsed","trimmed","trim","startsWith","Error","safeParseJSON","Array","isArray","autoRun","parseOutputOptions","lines","split","length","shift","pop","minIndent","Infinity","line","match","Math","min","join","map","slice","stripLeadingIndentation","JupyterLoader","jsxs","style","display","flexDirection","alignItems","justifyContent","gap","backgroundColor","borderRadius","border","fontFamily","role","children","jsx","width","borderTopColor","animation","color","fontSize","LazyCellModule","lazy","import","then","m","default","CellChunk","LazyNotebookModule","NotebookChunk","LazyOutputModule","OutputChunk","LazyTerminalModule","TerminalChunk","LazyConsoleModule","ConsoleChunk","LazyViewerModule","ViewerChunk","CellEmbed","options","Suspense","fallback","NotebookEmbed","OutputEmbed","TerminalEmbed","ConsoleEmbed","ViewerEmbed","renderedComponents","Map","renderEmbedLazy","existingRoot","get","unmount","delete","innerHTML","container","document","createElement","className","appendChild","root","createRoot","set","component","error","render","unmountEmbedLazy","unmountAllEmbedsLazy","forEach","clear","lazyLoadObserver","pendingElements","Set","initializeElementLazy","setAttribute","removeAttribute","visibility","initJupyterEmbedsLazy","body","selector","elements","querySelectorAll","log","IntersectionObserver","entries","entry","isIntersecting","target","unobserve","rootMargin","add","observe","initAddedJupyterEmbedsLazy","destroyJupyterEmbedsLazy","disconnect","el","autoInitLazy","Object","keys","configScript","readyState","addEventListener"],"mappings":"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"}